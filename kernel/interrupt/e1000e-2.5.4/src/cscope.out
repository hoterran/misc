cscope 15 $HOME/Projects/misc/kernel/interrupt/e1000e-2.5.4/src -q 0000005257 0000774254
	@80003es2lan.c

33 
	~"e1000.h
"

39 c⁄° 
u16
 
	ge1000_gg82563_ˇbÀ_Àngth_èbÀ
[] = {

43 
	#GG82563_CABLE_LENGTH_TABLE_SIZE
 \

44 ((
e1000_gg82563_ˇbÀ_Àngth_èbÀ
) / \

45 (
e1000_gg82563_ˇbÀ_Àngth_èbÀ
[0]))

	)

47 
s32
 
e1000_£tup_c›≥r_lök_80003es2œn
(
e1000_hw
 *
hw
);

48 
s32
 
e1000_acquúe_swfw_sync_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
mask
);

49 
e1000_ªÀa£_swfw_sync_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
mask
);

50 
e1000_öôülize_hw_bôs_80003es2œn
(
e1000_hw
 *
hw
);

51 
e1000_˛ór_hw_˙ås_80003es2œn
(
e1000_hw
 *
hw
);

52 
s32
 
e1000_cfg_km∫_1000_80003es2œn
(
e1000_hw
 *
hw
);

53 
s32
 
e1000_cfg_km∫_10_100_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
du∂ex
);

54 
s32
 
e1000_ªad_km∫_ªg_80003es2œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

55 
u16
 *
d©a
);

56 
s32
 
e1000_wrôe_km∫_ªg_80003es2œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

57 
u16
 
d©a
);

58 
e1000_powî_down_phy_c›≥r_80003es2œn
(
e1000_hw
 *
hw
);

64 
s32
 
	$e1000_öô_phy_∑øms_80003es2œn
(
e1000_hw
 *
hw
)

66 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

67 
s32
 
ªt_vÆ
;

69 i‡(
hw
->
phy
.
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
) {

70 
phy
->
ty≥
 = 
e1000_phy_n⁄e
;

73 
phy
->
›s
.
powî_up
 = 
e1000_powî_up_phy_c›≥r
;

74 
phy
->
›s
.
powî_down
 = 
e1000_powî_down_phy_c›≥r_80003es2œn
;

77 
phy
->
addr
 = 1;

78 
phy
->
aut⁄eg_mask
 = 
AUTONEG_ADVERTISE_SPEED_DEFAULT
;

79 
phy
->
ª£t_dñay_us
 = 100;

80 
phy
->
ty≥
 = 
e1000_phy_gg82563
;

83 
ªt_vÆ
 = 
	`e1000e_gë_phy_id
(
hw
);

86 i‡(
phy
->
id
 !
GG82563_E_PHY_ID
)

87  -
E1000_ERR_PHY
;

89  
ªt_vÆ
;

90 
	}
}

96 
s32
 
	$e1000_öô_nvm_∑øms_80003es2œn
(
e1000_hw
 *
hw
)

98 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

99 
u32
 
ìcd
 = 
	`î32
(
EECD
);

100 
u16
 
size
;

102 
nvm
->
›code_bôs
 = 8;

103 
nvm
->
dñay_u£c
 = 1;

104 
nvm
->
ovîride
) {

105 
e1000_nvm_ovîride_•i_œrge
:

106 
nvm
->
∑ge_size
 = 32;

107 
nvm
->
addªss_bôs
 = 16;

109 
e1000_nvm_ovîride_•i_smÆl
:

110 
nvm
->
∑ge_size
 = 8;

111 
nvm
->
addªss_bôs
 = 8;

114 
nvm
->
∑ge_size
 = 
ìcd
 & 
E1000_EECD_ADDR_BITS
 ? 32 : 8;

115 
nvm
->
addªss_bôs
 = 
ìcd
 & 
E1000_EECD_ADDR_BITS
 ? 16 : 8;

119 
nvm
->
ty≥
 = 
e1000_nvm_ì¥om_•i
;

121 
size
 = (
u16
)((
ìcd
 & 
E1000_EECD_SIZE_EX_MASK
) >>

122 
E1000_EECD_SIZE_EX_SHIFT
);

127 
size
 +
NVM_WORD_SIZE_BASE_SHIFT
;

130 i‡(
size
 > 14)

131 
size
 = 14;

132 
nvm
->
w‹d_size
 = 1 << 
size
;

135 
	}
}

141 
s32
 
	$e1000_öô_mac_∑øms_80003es2œn
(
e1000_hw
 *
hw
)

143 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

146 
hw
->
ad≠ãr
->
pdev
->
devi˚
) {

147 
E1000_DEV_ID_80003ES2LAN_SERDES_DPT
:

148 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_öã∫Æ_£rdes
;

149 
mac
->
›s
.
check_f‹_lök
 = 
e1000e_check_f‹_£rdes_lök
;

150 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

151 
e1000e_£tup_fibî_£rdes_lök
;

154 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_c›≥r
;

155 
mac
->
›s
.
check_f‹_lök
 = 
e1000e_check_f‹_c›≥r_lök
;

156 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

157 
e1000_£tup_c›≥r_lök_80003es2œn
;

162 
mac
->
mè_ªg_cou¡
 = 128;

164 
mac
->
ør_íåy_cou¡
 = 
E1000_RAR_ENTRIES
;

166 
mac
->
has_fwsm
 = 
åue
;

168 
mac
->
¨c_subsy°em_vÆid
 = !!(
	`î32
(
FWSM
Ë& 
E1000_FWSM_MODE_MASK
);

170 
mac
->
ad≠tive_ifs
 = 
Ál£
;

173 
hw
->
mac
.
›s
.
	`£t_œn_id
(hw);

176 
	}
}

178 
s32
 
	$e1000_gë_v¨ü¡s_80003es2œn
(
e1000_ad≠ãr
 *
ad≠ãr
)

180 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

181 
s32
 
rc
;

183 
rc
 = 
	`e1000_öô_mac_∑øms_80003es2œn
(
hw
);

184 i‡(
rc
)

185  
rc
;

187 
rc
 = 
	`e1000_öô_nvm_∑øms_80003es2œn
(
hw
);

188 i‡(
rc
)

189  
rc
;

191 
rc
 = 
	`e1000_öô_phy_∑øms_80003es2œn
(
hw
);

192 i‡(
rc
)

193  
rc
;

196 
	}
}

204 
s32
 
	$e1000_acquúe_phy_80003es2œn
(
e1000_hw
 *
hw
)

206 
u16
 
mask
;

208 
mask
 = 
hw
->
bus
.
func
 ? 
E1000_SWFW_PHY1_SM
 : 
E1000_SWFW_PHY0_SM
;

209  
	`e1000_acquúe_swfw_sync_80003es2œn
(
hw
, 
mask
);

210 
	}
}

218 
	$e1000_ªÀa£_phy_80003es2œn
(
e1000_hw
 *
hw
)

220 
u16
 
mask
;

222 
mask
 = 
hw
->
bus
.
func
 ? 
E1000_SWFW_PHY1_SM
 : 
E1000_SWFW_PHY0_SM
;

223 
	`e1000_ªÀa£_swfw_sync_80003es2œn
(
hw
, 
mask
);

224 
	}
}

233 
s32
 
	$e1000_acquúe_mac_c§_80003es2œn
(
e1000_hw
 *
hw
)

235 
u16
 
mask
;

237 
mask
 = 
E1000_SWFW_CSR_SM
;

239  
	`e1000_acquúe_swfw_sync_80003es2œn
(
hw
, 
mask
);

240 
	}
}

248 
	$e1000_ªÀa£_mac_c§_80003es2œn
(
e1000_hw
 *
hw
)

250 
u16
 
mask
;

252 
mask
 = 
E1000_SWFW_CSR_SM
;

254 
	`e1000_ªÀa£_swfw_sync_80003es2œn
(
hw
, 
mask
);

255 
	}
}

263 
s32
 
	$e1000_acquúe_nvm_80003es2œn
(
e1000_hw
 *
hw
)

265 
s32
 
ªt_vÆ
;

267 
ªt_vÆ
 = 
	`e1000_acquúe_swfw_sync_80003es2œn
(
hw
, 
E1000_SWFW_EEP_SM
);

268 i‡(
ªt_vÆ
)

269  
ªt_vÆ
;

271 
ªt_vÆ
 = 
	`e1000e_acquúe_nvm
(
hw
);

273 i‡(
ªt_vÆ
)

274 
	`e1000_ªÀa£_swfw_sync_80003es2œn
(
hw
, 
E1000_SWFW_EEP_SM
);

276  
ªt_vÆ
;

277 
	}
}

285 
	$e1000_ªÀa£_nvm_80003es2œn
(
e1000_hw
 *
hw
)

287 
	`e1000e_ªÀa£_nvm
(
hw
);

288 
	`e1000_ªÀa£_swfw_sync_80003es2œn
(
hw
, 
E1000_SWFW_EEP_SM
);

289 
	}
}

299 
s32
 
	$e1000_acquúe_swfw_sync_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
mask
)

301 
u32
 
swfw_sync
;

302 
u32
 
swmask
 = 
mask
;

303 
u32
 
fwmask
 = 
mask
 << 16;

304 
s32
 
i
 = 0;

305 
s32
 
timeout
 = 50;

307 
i
 < 
timeout
) {

308 i‡(
	`e1000e_gë_hw_£m≠h‹e
(
hw
))

309  -
E1000_ERR_SWFW_SYNC
;

311 
swfw_sync
 = 
	`î32
(
SW_FW_SYNC
);

312 i‡(!(
swfw_sync
 & (
fwmask
 | 
swmask
)))

318 
	`e1000e_put_hw_£m≠h‹e
(
hw
);

319 
	`mdñay
(5);

320 
i
++;

323 i‡(
i
 =
timeout
) {

324 
	`e_dbg
("Driver can'táccessÑesource, SW_FW_SYNCÅimeout.\n");

325  -
E1000_ERR_SWFW_SYNC
;

328 
swfw_sync
 |
swmask
;

329 
	`ew32
(
SW_FW_SYNC
, 
swfw_sync
);

331 
	`e1000e_put_hw_£m≠h‹e
(
hw
);

334 
	}
}

344 
	$e1000_ªÀa£_swfw_sync_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
mask
)

346 
u32
 
swfw_sync
;

348 
	`e1000e_gë_hw_£m≠h‹e
(
hw
) != 0)

351 
swfw_sync
 = 
	`î32
(
SW_FW_SYNC
);

352 
swfw_sync
 &~
mask
;

353 
	`ew32
(
SW_FW_SYNC
, 
swfw_sync
);

355 
	`e1000e_put_hw_£m≠h‹e
(
hw
);

356 
	}
}

366 
s32
 
	$e1000_ªad_phy_ªg_gg82563_80003es2œn
(
e1000_hw
 *
hw
,

367 
u32
 
off£t
, 
u16
 *
d©a
)

369 
s32
 
ªt_vÆ
;

370 
u32
 
∑ge_£À˘
;

371 
u16
 
ãmp
;

373 
ªt_vÆ
 = 
	`e1000_acquúe_phy_80003es2œn
(
hw
);

374 i‡(
ªt_vÆ
)

375  
ªt_vÆ
;

378 i‡((
off£t
 & 
MAX_PHY_REG_ADDRESS
Ë< 
GG82563_MIN_ALT_REG
) {

379 
∑ge_£À˘
 = 
GG82563_PHY_PAGE_SELECT
;

384 
∑ge_£À˘
 = 
GG82563_PHY_PAGE_SELECT_ALT
;

387 
ãmp
 = (
u16
)((u16)
off£t
 >> 
GG82563_PAGE_SHIFT
);

388 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
, 
ãmp
);

389 i‡(
ªt_vÆ
) {

390 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

391  
ªt_vÆ
;

394 i‡(
hw
->
dev_•ec
.
e80003es2œn
.
mdic_wa_íabÀ
) {

399 
	`u¶ìp_ønge
(200, 400);

402 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
, &
ãmp
);

404 i‡(((
u16
)
off£t
 >> 
GG82563_PAGE_SHIFT
Ë!
ãmp
) {

405 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

406  -
E1000_ERR_PHY
;

409 
	`u¶ìp_ønge
(200, 400);

411 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
,

412 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

413 
d©a
);

415 
	`u¶ìp_ønge
(200, 400);

417 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
,

418 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

419 
d©a
);

422 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

424  
ªt_vÆ
;

425 
	}
}

435 
s32
 
	$e1000_wrôe_phy_ªg_gg82563_80003es2œn
(
e1000_hw
 *
hw
,

436 
u32
 
off£t
, 
u16
 
d©a
)

438 
s32
 
ªt_vÆ
;

439 
u32
 
∑ge_£À˘
;

440 
u16
 
ãmp
;

442 
ªt_vÆ
 = 
	`e1000_acquúe_phy_80003es2œn
(
hw
);

443 i‡(
ªt_vÆ
)

444  
ªt_vÆ
;

447 i‡((
off£t
 & 
MAX_PHY_REG_ADDRESS
Ë< 
GG82563_MIN_ALT_REG
) {

448 
∑ge_£À˘
 = 
GG82563_PHY_PAGE_SELECT
;

453 
∑ge_£À˘
 = 
GG82563_PHY_PAGE_SELECT_ALT
;

456 
ãmp
 = (
u16
)((u16)
off£t
 >> 
GG82563_PAGE_SHIFT
);

457 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
, 
ãmp
);

458 i‡(
ªt_vÆ
) {

459 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

460  
ªt_vÆ
;

463 i‡(
hw
->
dev_•ec
.
e80003es2œn
.
mdic_wa_íabÀ
) {

468 
	`u¶ìp_ønge
(200, 400);

471 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
, &
ãmp
);

473 i‡(((
u16
)
off£t
 >> 
GG82563_PAGE_SHIFT
Ë!
ãmp
) {

474 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

475  -
E1000_ERR_PHY
;

478 
	`u¶ìp_ønge
(200, 400);

480 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
,

481 
MAX_PHY_REG_ADDRESS
 &

482 
off£t
, 
d©a
);

484 
	`u¶ìp_ønge
(200, 400);

486 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
,

487 
MAX_PHY_REG_ADDRESS
 &

488 
off£t
, 
d©a
);

491 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

493  
ªt_vÆ
;

494 
	}
}

505 
s32
 
	$e1000_wrôe_nvm_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
off£t
,

506 
u16
 
w‹ds
, u16 *
d©a
)

508  
	`e1000e_wrôe_nvm_•i
(
hw
, 
off£t
, 
w‹ds
, 
d©a
);

509 
	}
}

518 
s32
 
	$e1000_gë_cfg_d⁄e_80003es2œn
(
e1000_hw
 *
hw
)

520 
s32
 
timeout
 = 
PHY_CFG_TIMEOUT
;

521 
u32
 
mask
 = 
E1000_NVM_CFG_DONE_PORT_0
;

523 i‡(
hw
->
bus
.
func
 == 1)

524 
mask
 = 
E1000_NVM_CFG_DONE_PORT_1
;

526 
timeout
) {

527 i‡(
	`î32
(
EEMNGCTL
Ë& 
mask
)

529 
	`u¶ìp_ønge
(1000, 2000);

530 
timeout
--;

532 i‡(!
timeout
) {

533 
	`e_dbg
("MNG configuration cycle hasÇot completed.\n");

534  -
E1000_ERR_RESET
;

538 
	}
}

547 
s32
 
	$e1000_phy_f‹˚_•ìd_du∂ex_80003es2œn
(
e1000_hw
 *
hw
)

549 
s32
 
ªt_vÆ
;

550 
u16
 
phy_d©a
;

551 
boﬁ
 
lök
;

556 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

557 i‡(
ªt_vÆ
)

558  
ªt_vÆ
;

560 
phy_d©a
 &~
GG82563_PSCR_CROSSOVER_MODE_AUTO
;

561 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_SPEC_CTRL
, 
phy_d©a
);

562 i‡(
ªt_vÆ
)

563  
ªt_vÆ
;

565 
	`e_dbg
("GG82563 PSCR: %X\n", 
phy_d©a
);

567 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_d©a
);

568 i‡(
ªt_vÆ
)

569  
ªt_vÆ
;

571 
	`e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
hw
, &
phy_d©a
);

574 
phy_d©a
 |
BMCR_RESET
;

576 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_d©a
);

577 i‡(
ªt_vÆ
)

578  
ªt_vÆ
;

580 
	`udñay
(1);

582 i‡(
hw
->
phy
.
aut⁄eg_waô_to_com∂ëe
) {

583 
	`e_dbg
("Waiting for forced speed/duplexÜink on GG82563Öhy.\n");

585 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

586 100000, &
lök
);

587 i‡(
ªt_vÆ
)

588  
ªt_vÆ
;

590 i‡(!
lök
) {

594 
ªt_vÆ
 = 
	`e1000e_phy_ª£t_d•
(
hw
);

595 i‡(
ªt_vÆ
)

596  
ªt_vÆ
;

600 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

601 100000, &
lök
);

602 i‡(
ªt_vÆ
)

603  
ªt_vÆ
;

606 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_MAC_SPEC_CTRL
, &
phy_d©a
);

607 i‡(
ªt_vÆ
)

608  
ªt_vÆ
;

613 
phy_d©a
 &~
GG82563_MSCR_TX_CLK_MASK
;

614 i‡(
hw
->
mac
.
f‹˚d_•ìd_du∂ex
 & 
E1000_ALL_10_SPEED
)

615 
phy_d©a
 |
GG82563_MSCR_TX_CLK_10MBPS_2_5
;

617 
phy_d©a
 |
GG82563_MSCR_TX_CLK_100MBPS_25
;

622 
phy_d©a
 |
GG82563_MSCR_ASSERT_CRS_ON_TX
;

623 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_MAC_SPEC_CTRL
, 
phy_d©a
);

625  
ªt_vÆ
;

626 
	}
}

635 
s32
 
	$e1000_gë_ˇbÀ_Àngth_80003es2œn
(
e1000_hw
 *
hw
)

637 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

638 
s32
 
ªt_vÆ
;

639 
u16
 
phy_d©a
, 
ödex
;

641 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_DSP_DISTANCE
, &
phy_d©a
);

642 i‡(
ªt_vÆ
)

643  
ªt_vÆ
;

645 
ödex
 = 
phy_d©a
 & 
GG82563_DSPD_CABLE_LENGTH
;

647 i‡(
ödex
 >
GG82563_CABLE_LENGTH_TABLE_SIZE
 - 5)

648  -
E1000_ERR_PHY
;

650 
phy
->
mö_ˇbÀ_Àngth
 = 
e1000_gg82563_ˇbÀ_Àngth_èbÀ
[
ödex
];

651 
phy
->
max_ˇbÀ_Àngth
 = 
e1000_gg82563_ˇbÀ_Àngth_èbÀ
[
ödex
 + 5];

653 
phy
->
ˇbÀ_Àngth
 = (phy->
mö_ˇbÀ_Àngth
 +Öhy->
max_ˇbÀ_Àngth
) / 2;

656 
	}
}

666 
s32
 
	$e1000_gë_lök_up_öfo_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 *
•ìd
,

667 
u16
 *
du∂ex
)

669 
s32
 
ªt_vÆ
;

671 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

672 
ªt_vÆ
 = 
	`e1000e_gë_•ìd_™d_du∂ex_c›≥r
(
hw
, 
•ìd
, 
du∂ex
);

673 
hw
->
phy
.
›s
.
	`cfg_⁄_lök_up
(hw);

675 
ªt_vÆ
 = 
	`e1000e_gë_•ìd_™d_du∂ex_fibî_£rdes
(
hw
,

676 
•ìd
,

677 
du∂ex
);

680  
ªt_vÆ
;

681 
	}
}

689 
s32
 
	$e1000_ª£t_hw_80003es2œn
(
e1000_hw
 *
hw
)

691 
u32
 
˘æ
;

692 
s32
 
ªt_vÆ
;

693 
u16
 
kum_ªg_d©a
;

698 
ªt_vÆ
 = 
	`e1000e_dißbÀ_pcõ_ma°î
(
hw
);

699 i‡(
ªt_vÆ
)

700 
	`e_dbg
("PCI-E Master disableÖolling has failed.\n");

702 
	`e_dbg
("Masking offáll interrupts\n");

703 
	`ew32
(
IMC
, 0xffffffff);

705 
	`ew32
(
RCTL
, 0);

706 
	`ew32
(
TCTL
, 
E1000_TCTL_PSP
);

707 
	`e1e_Êush
();

709 
	`u¶ìp_ønge
(10000, 20000);

711 
˘æ
 = 
	`î32
(
CTRL
);

713 
ªt_vÆ
 = 
	`e1000_acquúe_phy_80003es2œn
(
hw
);

714 i‡(
ªt_vÆ
)

715  
ªt_vÆ
;

717 
	`e_dbg
("Issuingá globalÑesetÅo MAC\n");

718 
	`ew32
(
CTRL
, 
˘æ
 | 
E1000_CTRL_RST
);

719 
	`e1000_ªÀa£_phy_80003es2œn
(
hw
);

722 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
, 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

723 &
kum_ªg_d©a
);

724 
kum_ªg_d©a
 |
E1000_KMRNCTRLSTA_IBIST_DISABLE
;

725 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

726 
kum_ªg_d©a
);

728 
ªt_vÆ
 = 
	`e1000e_gë_auto_rd_d⁄e
(
hw
);

729 i‡(
ªt_vÆ
)

731  
ªt_vÆ
;

734 
	`ew32
(
IMC
, 0xffffffff);

735 
	`î32
(
ICR
);

737  
	`e1000_check_Æt_mac_addr_gíîic
(
hw
);

738 
	}
}

746 
s32
 
	$e1000_öô_hw_80003es2œn
(
e1000_hw
 *
hw
)

748 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

749 
u32
 
ªg_d©a
;

750 
s32
 
ªt_vÆ
;

751 
u16
 
kum_ªg_d©a
;

752 
u16
 
i
;

754 
	`e1000_öôülize_hw_bôs_80003es2œn
(
hw
);

757 
ªt_vÆ
 = 
mac
->
›s
.
	`id_Àd_öô
(
hw
);

759 i‡(
ªt_vÆ
)

760 
	`e_dbg
("Error initializing identification LED\n");

763 
	`e_dbg
("InitializingÅhe IEEE VLAN\n");

764 
mac
->
›s
.
	`˛ór_v·a
(
hw
);

767 
	`e1000e_öô_rx_addrs
(
hw
, 
mac
->
ør_íåy_cou¡
);

770 
	`e_dbg
("ZeroingÅhe MTA\n");

771 
i
 = 0; i < 
mac
->
mè_ªg_cou¡
; i++)

772 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_MTA
, 
i
, 0);

775 
ªt_vÆ
 = 
mac
->
›s
.
	`£tup_lök
(
hw
);

776 i‡(
ªt_vÆ
)

777  
ªt_vÆ
;

780 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
, 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

781 &
kum_ªg_d©a
);

782 
kum_ªg_d©a
 |
E1000_KMRNCTRLSTA_IBIST_DISABLE
;

783 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

784 
kum_ªg_d©a
);

787 
ªg_d©a
 = 
	`î32
(
	`TXDCTL
(0));

788 
ªg_d©a
 = (‘eg_d©®& ~
E1000_TXDCTL_WTHRESH
) |

789 
E1000_TXDCTL_FULL_TX_DESC_WB
 | 
E1000_TXDCTL_COUNT_DESC
);

790 
	`ew32
(
	`TXDCTL
(0), 
ªg_d©a
);

793 
ªg_d©a
 = 
	`î32
(
	`TXDCTL
(1));

794 
ªg_d©a
 = (‘eg_d©®& ~
E1000_TXDCTL_WTHRESH
) |

795 
E1000_TXDCTL_FULL_TX_DESC_WB
 | 
E1000_TXDCTL_COUNT_DESC
);

796 
	`ew32
(
	`TXDCTL
(1), 
ªg_d©a
);

799 
ªg_d©a
 = 
	`î32
(
TCTL
);

800 
ªg_d©a
 |
E1000_TCTL_RTLC
;

801 
	`ew32
(
TCTL
, 
ªg_d©a
);

804 
ªg_d©a
 = 
	`î32
(
TCTL_EXT
);

805 
ªg_d©a
 &~
E1000_TCTL_EXT_GCEX_MASK
;

806 
ªg_d©a
 |
DEFAULT_TCTL_EXT_GCEX_80003ES2LAN
;

807 
	`ew32
(
TCTL_EXT
, 
ªg_d©a
);

810 
ªg_d©a
 = 
	`î32
(
TIPG
);

811 
ªg_d©a
 &~
E1000_TIPG_IPGT_MASK
;

812 
ªg_d©a
 |
DEFAULT_TIPG_IPGT_1000_80003ES2LAN
;

813 
	`ew32
(
TIPG
, 
ªg_d©a
);

815 
ªg_d©a
 = 
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_FFLT
, 0x0001);

816 
ªg_d©a
 &= ~0x00100000;

817 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_FFLT
, 0x0001, 
ªg_d©a
);

820 
hw
->
dev_•ec
.
e80003es2œn
.
mdic_wa_íabÀ
 = 
åue
;

822 
ªt_vÆ
 =

823 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
, 
E1000_KMRNCTRLSTA_OFFSET
 >>

824 
E1000_KMRNCTRLSTA_OFFSET_SHIFT
, &
i
);

825 i‡(!
ªt_vÆ
) {

826 i‡((
i
 & 
E1000_KMRNCTRLSTA_OPMODE_MASK
) ==

827 
E1000_KMRNCTRLSTA_OPMODE_INBAND_MDIO
)

828 
hw
->
dev_•ec
.
e80003es2œn
.
mdic_wa_íabÀ
 = 
Ál£
;

836 
	`e1000_˛ór_hw_˙ås_80003es2œn
(
hw
);

838  
ªt_vÆ
;

839 
	}
}

847 
	$e1000_öôülize_hw_bôs_80003es2œn
(
e1000_hw
 *
hw
)

849 
u32
 
ªg
;

852 
ªg
 = 
	`î32
(
	`TXDCTL
(0));

853 
ªg
 |= (1 << 22);

854 
	`ew32
(
	`TXDCTL
(0), 
ªg
);

857 
ªg
 = 
	`î32
(
	`TXDCTL
(1));

858 
ªg
 |= (1 << 22);

859 
	`ew32
(
	`TXDCTL
(1), 
ªg
);

862 
ªg
 = 
	`î32
(
	`TARC
(0));

863 
ªg
 &= ~(0xF << 27);

864 i‡(
hw
->
phy
.
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
)

865 
ªg
 &= ~(1 << 20);

866 
	`ew32
(
	`TARC
(0), 
ªg
);

869 
ªg
 = 
	`î32
(
	`TARC
(1));

870 i‡(
	`î32
(
TCTL
Ë& 
E1000_TCTL_MULR
)

871 
ªg
 &= ~(1 << 28);

873 
ªg
 |= (1 << 28);

874 
	`ew32
(
	`TARC
(1), 
ªg
);

879 
ªg
 = 
	`î32
(
RFCTL
);

880 
ªg
 |(
E1000_RFCTL_IPV6_EX_DIS
 | 
E1000_RFCTL_NEW_IPV6_EXT_DIS
);

881 
	`ew32
(
RFCTL
, 
ªg
);

882 
	}
}

890 
s32
 
	$e1000_c›≥r_lök_£tup_gg82563_80003es2œn
(
e1000_hw
 *
hw
)

892 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

893 
s32
 
ªt_vÆ
;

894 
u32
 
ªg
;

895 
u16
 
d©a
;

897 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_MAC_SPEC_CTRL
, &
d©a
);

898 i‡(
ªt_vÆ
)

899  
ªt_vÆ
;

901 
d©a
 |
GG82563_MSCR_ASSERT_CRS_ON_TX
;

903 
d©a
 |
GG82563_MSCR_TX_CLK_1000MBPS_25
;

905 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_MAC_SPEC_CTRL
, 
d©a
);

906 i‡(
ªt_vÆ
)

907  
ªt_vÆ
;

916 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_SPEC_CTRL
, &
d©a
);

917 i‡(
ªt_vÆ
)

918  
ªt_vÆ
;

920 
d©a
 &~
GG82563_PSCR_CROSSOVER_MODE_MASK
;

922 
phy
->
mdix
) {

924 
d©a
 |
GG82563_PSCR_CROSSOVER_MODE_MDI
;

927 
d©a
 |
GG82563_PSCR_CROSSOVER_MODE_MDIX
;

931 
d©a
 |
GG82563_PSCR_CROSSOVER_MODE_AUTO
;

941 
d©a
 &~
GG82563_PSCR_POLARITY_REVERSAL_DISABLE
;

942 i‡(
phy
->
dißbÀ_pﬁ¨ôy_c‹ª˘i⁄
)

943 
d©a
 |
GG82563_PSCR_POLARITY_REVERSAL_DISABLE
;

945 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_SPEC_CTRL
, 
d©a
);

946 i‡(
ªt_vÆ
)

947  
ªt_vÆ
;

950 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`commô
(hw);

951 i‡(
ªt_vÆ
) {

952 
	`e_dbg
("Error ResettingÅhe PHY\n");

953  
ªt_vÆ
;

957 
ªg
 = 
E1000_KMRNCTRLSTA_OFFSET_FIFO_CTRL
;

958 
d©a
 = (
E1000_KMRNCTRLSTA_FIFO_CTRL_RX_BYPASS
 |

959 
E1000_KMRNCTRLSTA_FIFO_CTRL_TX_BYPASS
);

960 
ªt_vÆ
 = 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
ªg
, 
d©a
);

961 i‡(
ªt_vÆ
)

962  
ªt_vÆ
;

964 
ªg
 = 
E1000_KMRNCTRLSTA_OFFSET_MAC2PHY_OPMODE
;

965 
ªt_vÆ
 = 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
, 
ªg
, &
d©a
);

966 i‡(
ªt_vÆ
)

967  
ªt_vÆ
;

968 
d©a
 |
E1000_KMRNCTRLSTA_OPMODE_E_IDLE
;

969 
ªt_vÆ
 = 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
ªg
, 
d©a
);

970 i‡(
ªt_vÆ
)

971  
ªt_vÆ
;

973 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_SPEC_CTRL_2
, &
d©a
);

974 i‡(
ªt_vÆ
)

975  
ªt_vÆ
;

977 
d©a
 &~
GG82563_PSCR2_REVERSE_AUTO_NEG
;

978 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_SPEC_CTRL_2
, 
d©a
);

979 i‡(
ªt_vÆ
)

980  
ªt_vÆ
;

982 
ªg
 = 
	`î32
(
CTRL_EXT
);

983 
ªg
 &~
E1000_CTRL_EXT_LINK_MODE_MASK
;

984 
	`ew32
(
CTRL_EXT
, 
ªg
);

986 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_PWR_MGMT_CTRL
, &
d©a
);

987 i‡(
ªt_vÆ
)

988  
ªt_vÆ
;

994 i‡(!
hw
->
mac
.
›s
.
	`check_mng_mode
(hw)) {

996 
d©a
 |
GG82563_PMCR_ENABLE_ELECTRICAL_IDLE
;

997 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_PWR_MGMT_CTRL
, 
d©a
);

998 i‡(
ªt_vÆ
)

999  
ªt_vÆ
;

1001 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, &
d©a
);

1002 i‡(
ªt_vÆ
)

1003  
ªt_vÆ
;

1005 
d©a
 &~
GG82563_KMCR_PASS_FALSE_CARRIER
;

1006 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, 
d©a
);

1007 i‡(
ªt_vÆ
)

1008  
ªt_vÆ
;

1014 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_INBAND_CTRL
, &
d©a
);

1015 i‡(
ªt_vÆ
)

1016  
ªt_vÆ
;

1018 
d©a
 |
GG82563_ICR_DIS_PADDING
;

1019 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
GG82563_PHY_INBAND_CTRL
, 
d©a
);

1020 i‡(
ªt_vÆ
)

1021  
ªt_vÆ
;

1024 
	}
}

1033 
s32
 
	$e1000_£tup_c›≥r_lök_80003es2œn
(
e1000_hw
 *
hw
)

1035 
u32
 
˘æ
;

1036 
s32
 
ªt_vÆ
;

1037 
u16
 
ªg_d©a
;

1039 
˘æ
 = 
	`î32
(
CTRL
);

1040 
˘æ
 |
E1000_CTRL_SLU
;

1041 
˘æ
 &~(
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
);

1042 
	`ew32
(
CTRL
, 
˘æ
);

1048 
ªt_vÆ
 = 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
	`GG82563_REG
(0x34, 4),

1050 i‡(
ªt_vÆ
)

1051  
ªt_vÆ
;

1052 
ªt_vÆ
 = 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
, 
	`GG82563_REG
(0x34, 9),

1053 &
ªg_d©a
);

1054 i‡(
ªt_vÆ
)

1055  
ªt_vÆ
;

1056 
ªg_d©a
 |= 0x3F;

1057 
ªt_vÆ
 = 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
, 
	`GG82563_REG
(0x34, 9),

1058 
ªg_d©a
);

1059 i‡(
ªt_vÆ
)

1060  
ªt_vÆ
;

1061 
ªt_vÆ
 =

1062 
	`e1000_ªad_km∫_ªg_80003es2œn
(
hw
,

1063 
E1000_KMRNCTRLSTA_OFFSET_INB_CTRL
,

1064 &
ªg_d©a
);

1065 i‡(
ªt_vÆ
)

1066  
ªt_vÆ
;

1067 
ªg_d©a
 |
E1000_KMRNCTRLSTA_INB_CTRL_DIS_PADDING
;

1068 
ªt_vÆ
 =

1069 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
,

1070 
E1000_KMRNCTRLSTA_OFFSET_INB_CTRL
,

1071 
ªg_d©a
);

1072 i‡(
ªt_vÆ
)

1073  
ªt_vÆ
;

1075 
ªt_vÆ
 = 
	`e1000_c›≥r_lök_£tup_gg82563_80003es2œn
(
hw
);

1076 i‡(
ªt_vÆ
)

1077  
ªt_vÆ
;

1079  
	`e1000e_£tup_c›≥r_lök
(
hw
);

1080 
	}
}

1090 
s32
 
	$e1000_cfg_⁄_lök_up_80003es2œn
(
e1000_hw
 *
hw
)

1092 
s32
 
ªt_vÆ
 = 0;

1093 
u16
 
•ìd
;

1094 
u16
 
du∂ex
;

1096 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

1097 
ªt_vÆ
 = 
	`e1000e_gë_•ìd_™d_du∂ex_c›≥r
(
hw
, &
•ìd
,

1098 &
du∂ex
);

1099 i‡(
ªt_vÆ
)

1100  
ªt_vÆ
;

1102 i‡(
•ìd
 =
SPEED_1000
)

1103 
ªt_vÆ
 = 
	`e1000_cfg_km∫_1000_80003es2œn
(
hw
);

1105 
ªt_vÆ
 = 
	`e1000_cfg_km∫_10_100_80003es2œn
(
hw
, 
du∂ex
);

1108  
ªt_vÆ
;

1109 
	}
}

1119 
s32
 
	$e1000_cfg_km∫_10_100_80003es2œn
(
e1000_hw
 *
hw
, 
u16
 
du∂ex
)

1121 
s32
 
ªt_vÆ
;

1122 
u32
 
tùg
;

1123 
u32
 
i
 = 0;

1124 
u16
 
ªg_d©a
, 
ªg_d©a2
;

1126 
ªg_d©a
 = 
E1000_KMRNCTRLSTA_HD_CTRL_10_100_DEFAULT
;

1127 
ªt_vÆ
 =

1128 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
,

1129 
E1000_KMRNCTRLSTA_OFFSET_HD_CTRL
,

1130 
ªg_d©a
);

1131 i‡(
ªt_vÆ
)

1132  
ªt_vÆ
;

1135 
tùg
 = 
	`î32
(
TIPG
);

1136 
tùg
 &~
E1000_TIPG_IPGT_MASK
;

1137 
tùg
 |
DEFAULT_TIPG_IPGT_10_100_80003ES2LAN
;

1138 
	`ew32
(
TIPG
, 
tùg
);

1141 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, &
ªg_d©a
);

1142 i‡(
ªt_vÆ
)

1143  
ªt_vÆ
;

1145 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, &
ªg_d©a2
);

1146 i‡(
ªt_vÆ
)

1147  
ªt_vÆ
;

1148 
i
++;

1149 } (
ªg_d©a
 !
ªg_d©a2
Ë&& (
i
 < 
GG82563_MAX_KMRN_RETRY
));

1151 i‡(
du∂ex
 =
HALF_DUPLEX
)

1152 
ªg_d©a
 |
GG82563_KMCR_PASS_FALSE_CARRIER
;

1154 
ªg_d©a
 &~
GG82563_KMCR_PASS_FALSE_CARRIER
;

1156  
	`e1e_wphy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, 
ªg_d©a
);

1157 
	}
}

1166 
s32
 
	$e1000_cfg_km∫_1000_80003es2œn
(
e1000_hw
 *
hw
)

1168 
s32
 
ªt_vÆ
;

1169 
u16
 
ªg_d©a
, 
ªg_d©a2
;

1170 
u32
 
tùg
;

1171 
u32
 
i
 = 0;

1173 
ªg_d©a
 = 
E1000_KMRNCTRLSTA_HD_CTRL_1000_DEFAULT
;

1174 
ªt_vÆ
 =

1175 
	`e1000_wrôe_km∫_ªg_80003es2œn
(
hw
,

1176 
E1000_KMRNCTRLSTA_OFFSET_HD_CTRL
,

1177 
ªg_d©a
);

1178 i‡(
ªt_vÆ
)

1179  
ªt_vÆ
;

1182 
tùg
 = 
	`î32
(
TIPG
);

1183 
tùg
 &~
E1000_TIPG_IPGT_MASK
;

1184 
tùg
 |
DEFAULT_TIPG_IPGT_1000_80003ES2LAN
;

1185 
	`ew32
(
TIPG
, 
tùg
);

1188 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, &
ªg_d©a
);

1189 i‡(
ªt_vÆ
)

1190  
ªt_vÆ
;

1192 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, &
ªg_d©a2
);

1193 i‡(
ªt_vÆ
)

1194  
ªt_vÆ
;

1195 
i
++;

1196 } (
ªg_d©a
 !
ªg_d©a2
Ë&& (
i
 < 
GG82563_MAX_KMRN_RETRY
));

1198 
ªg_d©a
 &~
GG82563_KMCR_PASS_FALSE_CARRIER
;

1200  
	`e1e_wphy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, 
ªg_d©a
);

1201 
	}
}

1213 
s32
 
	$e1000_ªad_km∫_ªg_80003es2œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

1214 
u16
 *
d©a
)

1216 
u32
 
km∫˘æ°a
;

1217 
s32
 
ªt_vÆ
;

1219 
ªt_vÆ
 = 
	`e1000_acquúe_mac_c§_80003es2œn
(
hw
);

1220 i‡(
ªt_vÆ
)

1221  
ªt_vÆ
;

1223 
km∫˘æ°a
 = ((
off£t
 << 
E1000_KMRNCTRLSTA_OFFSET_SHIFT
) &

1224 
E1000_KMRNCTRLSTA_OFFSET
Ë| 
E1000_KMRNCTRLSTA_REN
;

1225 
	`ew32
(
KMRNCTRLSTA
, 
km∫˘æ°a
);

1226 
	`e1e_Êush
();

1228 
	`udñay
(2);

1230 
km∫˘æ°a
 = 
	`î32
(
KMRNCTRLSTA
);

1231 *
d©a
 = (
u16
)
km∫˘æ°a
;

1233 
	`e1000_ªÀa£_mac_c§_80003es2œn
(
hw
);

1235  
ªt_vÆ
;

1236 
	}
}

1248 
s32
 
	$e1000_wrôe_km∫_ªg_80003es2œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

1249 
u16
 
d©a
)

1251 
u32
 
km∫˘æ°a
;

1252 
s32
 
ªt_vÆ
;

1254 
ªt_vÆ
 = 
	`e1000_acquúe_mac_c§_80003es2œn
(
hw
);

1255 i‡(
ªt_vÆ
)

1256  
ªt_vÆ
;

1258 
km∫˘æ°a
 = ((
off£t
 << 
E1000_KMRNCTRLSTA_OFFSET_SHIFT
) &

1259 
E1000_KMRNCTRLSTA_OFFSET
Ë| 
d©a
;

1260 
	`ew32
(
KMRNCTRLSTA
, 
km∫˘æ°a
);

1261 
	`e1e_Êush
();

1263 
	`udñay
(2);

1265 
	`e1000_ªÀa£_mac_c§_80003es2œn
(
hw
);

1267  
ªt_vÆ
;

1268 
	}
}

1274 
s32
 
	$e1000_ªad_mac_addr_80003es2œn
(
e1000_hw
 *
hw
)

1276 
s32
 
ªt_vÆ
;

1282 
ªt_vÆ
 = 
	`e1000_check_Æt_mac_addr_gíîic
(
hw
);

1283 i‡(
ªt_vÆ
)

1284  
ªt_vÆ
;

1286  
	`e1000_ªad_mac_addr_gíîic
(
hw
);

1287 
	}
}

1296 
	$e1000_powî_down_phy_c›≥r_80003es2œn
(
e1000_hw
 *
hw
)

1299 i‡(!(
hw
->
mac
.
›s
.
	`check_mng_mode
(hw) ||

1300 
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)))

1301 
	`e1000_powî_down_phy_c›≥r
(
hw
);

1302 
	}
}

1310 
	$e1000_˛ór_hw_˙ås_80003es2œn
(
e1000_hw
 *
hw
)

1312 
	`e1000e_˛ór_hw_˙ås_ba£
(
hw
);

1314 
	`î32
(
PRC64
);

1315 
	`î32
(
PRC127
);

1316 
	`î32
(
PRC255
);

1317 
	`î32
(
PRC511
);

1318 
	`î32
(
PRC1023
);

1319 
	`î32
(
PRC1522
);

1320 
	`î32
(
PTC64
);

1321 
	`î32
(
PTC127
);

1322 
	`î32
(
PTC255
);

1323 
	`î32
(
PTC511
);

1324 
	`î32
(
PTC1023
);

1325 
	`î32
(
PTC1522
);

1327 
	`î32
(
ALGNERRC
);

1328 
	`î32
(
RXERRC
);

1329 
	`î32
(
TNCRS
);

1330 
	`î32
(
CEXTERR
);

1331 
	`î32
(
TSCTC
);

1332 
	`î32
(
TSCTFC
);

1334 
	`î32
(
MGTPRC
);

1335 
	`î32
(
MGTPDC
);

1336 
	`î32
(
MGTPTC
);

1338 
	`î32
(
IAC
);

1339 
	`î32
(
ICRXOC
);

1341 
	`î32
(
ICRXPTC
);

1342 
	`î32
(
ICRXATC
);

1343 
	`î32
(
ICTXPTC
);

1344 
	`î32
(
ICTXATC
);

1345 
	`î32
(
ICTXQEC
);

1346 
	`î32
(
ICTXQMTC
);

1347 
	`î32
(
ICRXDMTC
);

1348 
	}
}

1350 c⁄° 
e1000_mac_›î©i⁄s
 
	ges2_mac_›s
 = {

1351 .
ªad_mac_addr
 = 
e1000_ªad_mac_addr_80003es2œn
,

1352 .
	gid_Àd_öô
 = 
e1000e_id_Àd_öô_gíîic
,

1353 .
	gblök_Àd
 = 
e1000e_blök_Àd_gíîic
,

1354 .
	gcheck_mng_mode
 = 
e1000e_check_mng_mode_gíîic
,

1356 .
	g˛ónup_Àd
 = 
e1000e_˛ónup_Àd_gíîic
,

1357 .
	g˛ór_hw_˙ås
 = 
e1000_˛ór_hw_˙ås_80003es2œn
,

1358 .
	ggë_bus_öfo
 = 
e1000e_gë_bus_öfo_pcõ
,

1359 .
	g£t_œn_id
 = 
e1000_£t_œn_id_mu…i_p‹t_pcõ
,

1360 .
	ggë_lök_up_öfo
 = 
e1000_gë_lök_up_öfo_80003es2œn
,

1361 .
	gÀd_⁄
 = 
e1000e_Àd_⁄_gíîic
,

1362 .
	gÀd_off
 = 
e1000e_Àd_off_gíîic
,

1363 .
	gupd©e_mc_addr_li°
 = 
e1000e_upd©e_mc_addr_li°_gíîic
,

1364 .
	gwrôe_v·a
 = 
e1000_wrôe_v·a_gíîic
,

1365 .
	g˛ór_v·a
 = 
e1000_˛ór_v·a_gíîic
,

1366 .
	gª£t_hw
 = 
e1000_ª£t_hw_80003es2œn
,

1367 .
	göô_hw
 = 
e1000_öô_hw_80003es2œn
,

1368 .
	g£tup_lök
 = 
e1000e_£tup_lök_gíîic
,

1370 .
	g£tup_Àd
 = 
e1000e_£tup_Àd_gíîic
,

1371 .
	gc⁄fig_cﬁlisi⁄_di°
 = 
e1000e_c⁄fig_cﬁlisi⁄_di°_gíîic
,

1372 .
	gør_£t
 = 
e1000e_ør_£t_gíîic
,

1373 .
	gvÆid©e_mdi_£âög
 = 
e1000e_vÆid©e_mdi_£âög_gíîic
,

1376 c⁄° 
e1000_phy_›î©i⁄s
 
	ges2_phy_›s
 = {

1377 .
acquúe
 = 
e1000_acquúe_phy_80003es2œn
,

1378 .
	gcheck_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_m88
,

1379 .
	gcheck_ª£t_block
 = 
e1000e_check_ª£t_block_gíîic
,

1380 .
	gcommô
 = 
e1000e_phy_sw_ª£t
,

1381 .
	gf‹˚_•ìd_du∂ex
 = 
e1000_phy_f‹˚_•ìd_du∂ex_80003es2œn
,

1382 .
	ggë_cfg_d⁄e
 = 
e1000_gë_cfg_d⁄e_80003es2œn
,

1383 .
	ggë_ˇbÀ_Àngth
 = 
e1000_gë_ˇbÀ_Àngth_80003es2œn
,

1384 .
	ggë_öfo
 = 
e1000e_gë_phy_öfo_m88
,

1385 .
	gªad_ªg
 = 
e1000_ªad_phy_ªg_gg82563_80003es2œn
,

1386 .
	gªÀa£
 = 
e1000_ªÀa£_phy_80003es2œn
,

1387 .
	gª£t
 = 
e1000e_phy_hw_ª£t_gíîic
,

1388 .
	g£t_d0_Õlu_°©e
 = 
NULL
,

1389 .
	g£t_d3_Õlu_°©e
 = 
e1000e_£t_d3_Õlu_°©e
,

1390 .
	gwrôe_ªg
 = 
e1000_wrôe_phy_ªg_gg82563_80003es2œn
,

1391 .
	gcfg_⁄_lök_up
 = 
e1000_cfg_⁄_lök_up_80003es2œn
,

1394 c⁄° 
e1000_nvm_›î©i⁄s
 
	ges2_nvm_›s
 = {

1395 .
acquúe
 = 
e1000_acquúe_nvm_80003es2œn
,

1396 .
	gªad
 = 
e1000e_ªad_nvm_ìrd
,

1397 .
	gªÀa£
 = 
e1000_ªÀa£_nvm_80003es2œn
,

1398 .
	gªlﬂd
 = 
e1000e_ªlﬂd_nvm_gíîic
,

1399 .
	gupd©e
 = 
e1000e_upd©e_nvm_checksum_gíîic
,

1400 .
	gvÆid_Àd_deÁu…
 = 
e1000e_vÆid_Àd_deÁu…
,

1401 .
	gvÆid©e
 = 
e1000e_vÆid©e_nvm_checksum_gíîic
,

1402 .
	gwrôe
 = 
e1000_wrôe_nvm_80003es2œn
,

1405 c⁄° 
e1000_öfo
 
	ge1000_es2_öfo
 = {

1406 .
mac
 = 
e1000_80003es2œn
,

1407 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


1408 | 
FLAG_HAS_JUMBO_FRAMES


1409 | 
FLAG_HAS_WOL


1410 | 
FLAG_APME_IN_CTRL3


1411 #i‚de‡
HAVE_NDO_SET_FEATURES


1412 | 
FLAG_RX_CSUM_ENABLED


1414 | 
FLAG_HAS_CTRLEXT_ON_LOAD


1415 | 
FLAG_RX_NEEDS_RESTART


1416 | 
FLAG_TARC_SET_BIT_ZERO


1417 | 
FLAG_APME_CHECK_PORT_B


1418 | 
FLAG_DISABLE_FC_PAUSE_TIME
,

1419 .
	gÊags2
 = 
FLAG2_DMA_BURST
,

1420 .
	gpba
 = 38,

1421 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

1422 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_80003es2œn
,

1423 .
	gmac_›s
 = &
es2_mac_›s
,

1424 .
	gphy_›s
 = &
es2_phy_›s
,

1425 .
	gnvm_›s
 = &
es2_nvm_›s
,

	@80003es2lan.h

29 #i‚de‡
_E1000E_80003ES2LAN_H_


30 
	#_E1000E_80003ES2LAN_H_


	)

32 
	#E1000_KMRNCTRLSTA_OFFSET_FIFO_CTRL
 0x00

	)

33 
	#E1000_KMRNCTRLSTA_OFFSET_INB_CTRL
 0x02

	)

34 
	#E1000_KMRNCTRLSTA_OFFSET_HD_CTRL
 0x10

	)

35 
	#E1000_KMRNCTRLSTA_OFFSET_MAC2PHY_OPMODE
 0x1F

	)

37 
	#E1000_KMRNCTRLSTA_FIFO_CTRL_RX_BYPASS
 0x0008

	)

38 
	#E1000_KMRNCTRLSTA_FIFO_CTRL_TX_BYPASS
 0x0800

	)

39 
	#E1000_KMRNCTRLSTA_INB_CTRL_DIS_PADDING
 0x0010

	)

41 
	#E1000_KMRNCTRLSTA_HD_CTRL_10_100_DEFAULT
 0x0004

	)

42 
	#E1000_KMRNCTRLSTA_HD_CTRL_1000_DEFAULT
 0x0000

	)

43 
	#E1000_KMRNCTRLSTA_OPMODE_E_IDLE
 0x2000

	)

45 
	#E1000_KMRNCTRLSTA_OPMODE_MASK
 0x000C

	)

46 
	#E1000_KMRNCTRLSTA_OPMODE_INBAND_MDIO
 0x0004

	)

48 
	#E1000_TCTL_EXT_GCEX_MASK
 0x000FFC00

	)

49 
	#DEFAULT_TCTL_EXT_GCEX_80003ES2LAN
 0x00010000

	)

51 
	#DEFAULT_TIPG_IPGT_1000_80003ES2LAN
 0x8

	)

52 
	#DEFAULT_TIPG_IPGT_10_100_80003ES2LAN
 0x9

	)

55 
	#GG82563_PSCR_POLARITY_REVERSAL_DISABLE
 0x0002

	)

56 
	#GG82563_PSCR_CROSSOVER_MODE_MASK
 0x0060

	)

57 
	#GG82563_PSCR_CROSSOVER_MODE_MDI
 0x0000

	)

58 
	#GG82563_PSCR_CROSSOVER_MODE_MDIX
 0x0020

	)

59 
	#GG82563_PSCR_CROSSOVER_MODE_AUTO
 0x0060

	)

62 
	#GG82563_PSCR2_REVERSE_AUTO_NEG
 0x2000

	)

66 
	#GG82563_MSCR_TX_CLK_MASK
 0x0007

	)

67 
	#GG82563_MSCR_TX_CLK_10MBPS_2_5
 0x0004

	)

68 
	#GG82563_MSCR_TX_CLK_100MBPS_25
 0x0005

	)

69 
	#GG82563_MSCR_TX_CLK_1000MBPS_25
 0x0007

	)

71 
	#GG82563_MSCR_ASSERT_CRS_ON_TX
 0x0010

	)

80 
	#GG82563_DSPD_CABLE_LENGTH
 0x0007

	)

83 
	#GG82563_KMCR_PASS_FALSE_CARRIER
 0x0800

	)

86 
	#GG82563_MAX_KMRN_RETRY
 0x5

	)

90 
	#GG82563_PMCR_ENABLE_ELECTRICAL_IDLE
 0x0001

	)

93 
	#GG82563_ICR_DIS_PADDING
 0x0010

	)

	@82571.c

45 
	~"e1000.h
"

47 
s32
 
e1000_gë_phy_id_82571
(
e1000_hw
 *
hw
);

48 
s32
 
e1000_£tup_c›≥r_lök_82571
(
e1000_hw
 *
hw
);

49 
s32
 
e1000_£tup_fibî_£rdes_lök_82571
(
e1000_hw
 *
hw
);

50 
s32
 
e1000_check_f‹_£rdes_lök_82571
(
e1000_hw
 *
hw
);

51 
s32
 
e1000_wrôe_nvm_ìwr_82571
(
e1000_hw
 *
hw
, 
u16
 
off£t
,

52 
u16
 
w‹ds
, u16 *
d©a
);

53 
s32
 
e1000_fix_nvm_checksum_82571
(
e1000_hw
 *
hw
);

54 
e1000_öôülize_hw_bôs_82571
(
e1000_hw
 *
hw
);

55 
e1000_˛ór_hw_˙ås_82571
(
e1000_hw
 *
hw
);

56 
boﬁ
 
e1000_check_mng_mode_82574
(
e1000_hw
 *
hw
);

57 
s32
 
e1000_Àd_⁄_82574
(
e1000_hw
 *
hw
);

58 
e1000_put_hw_£m≠h‹e_82571
(
e1000_hw
 *
hw
);

59 
e1000_powî_down_phy_c›≥r_82571
(
e1000_hw
 *
hw
);

60 
e1000_put_hw_£m≠h‹e_82573
(
e1000_hw
 *
hw
);

61 
s32
 
e1000_gë_hw_£m≠h‹e_82574
(
e1000_hw
 *
hw
);

62 
e1000_put_hw_£m≠h‹e_82574
(
e1000_hw
 *
hw
);

63 
s32
 
e1000_£t_d0_Õlu_°©e_82574
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
);

64 
s32
 
e1000_£t_d3_Õlu_°©e_82574
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
);

70 
s32
 
	$e1000_öô_phy_∑øms_82571
(
e1000_hw
 *
hw
)

72 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

73 
s32
 
ªt_vÆ
;

75 i‡(
hw
->
phy
.
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
) {

76 
phy
->
ty≥
 = 
e1000_phy_n⁄e
;

80 
phy
->
addr
 = 1;

81 
phy
->
aut⁄eg_mask
 = 
AUTONEG_ADVERTISE_SPEED_DEFAULT
;

82 
phy
->
ª£t_dñay_us
 = 100;

84 
phy
->
›s
.
powî_up
 = 
e1000_powî_up_phy_c›≥r
;

85 
phy
->
›s
.
powî_down
 = 
e1000_powî_down_phy_c›≥r_82571
;

87 
hw
->
mac
.
ty≥
) {

88 
e1000_82571
:

89 
e1000_82572
:

90 
phy
->
ty≥
 = 
e1000_phy_igp_2
;

92 
e1000_82573
:

93 
phy
->
ty≥
 = 
e1000_phy_m88
;

95 
e1000_82574
:

96 
e1000_82583
:

97 
phy
->
ty≥
 = 
e1000_phy_bm
;

98 
phy
->
›s
.
acquúe
 = 
e1000_gë_hw_£m≠h‹e_82574
;

99 
phy
->
›s
.
ªÀa£
 = 
e1000_put_hw_£m≠h‹e_82574
;

100 
phy
->
›s
.
£t_d0_Õlu_°©e
 = 
e1000_£t_d0_Õlu_°©e_82574
;

101 
phy
->
›s
.
£t_d3_Õlu_°©e
 = 
e1000_£t_d3_Õlu_°©e_82574
;

104  -
E1000_ERR_PHY
;

109 
ªt_vÆ
 = 
	`e1000_gë_phy_id_82571
(
hw
);

110 i‡(
ªt_vÆ
) {

111 
	`e_dbg
("Error getting PHY ID\n");

112  
ªt_vÆ
;

116 
hw
->
mac
.
ty≥
) {

117 
e1000_82571
:

118 
e1000_82572
:

119 i‡(
phy
->
id
 !
IGP01E1000_I_PHY_ID
)

120 
ªt_vÆ
 = -
E1000_ERR_PHY
;

122 
e1000_82573
:

123 i‡(
phy
->
id
 !
M88E1111_I_PHY_ID
)

124 
ªt_vÆ
 = -
E1000_ERR_PHY
;

126 
e1000_82574
:

127 
e1000_82583
:

128 i‡(
phy
->
id
 !
BME1000_E_PHY_ID_R2
)

129 
ªt_vÆ
 = -
E1000_ERR_PHY
;

132 
ªt_vÆ
 = -
E1000_ERR_PHY
;

136 i‡(
ªt_vÆ
)

137 
	`e_dbg
("PHY ID unknown:Åy≥ = 0x%08x\n", 
phy
->
id
);

139  
ªt_vÆ
;

140 
	}
}

146 
s32
 
	$e1000_öô_nvm_∑øms_82571
(
e1000_hw
 *
hw
)

148 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

149 
u32
 
ìcd
 = 
	`î32
(
EECD
);

150 
u16
 
size
;

152 
nvm
->
›code_bôs
 = 8;

153 
nvm
->
dñay_u£c
 = 1;

154 
nvm
->
ovîride
) {

155 
e1000_nvm_ovîride_•i_œrge
:

156 
nvm
->
∑ge_size
 = 32;

157 
nvm
->
addªss_bôs
 = 16;

159 
e1000_nvm_ovîride_•i_smÆl
:

160 
nvm
->
∑ge_size
 = 8;

161 
nvm
->
addªss_bôs
 = 8;

164 
nvm
->
∑ge_size
 = 
ìcd
 & 
E1000_EECD_ADDR_BITS
 ? 32 : 8;

165 
nvm
->
addªss_bôs
 = 
ìcd
 & 
E1000_EECD_ADDR_BITS
 ? 16 : 8;

169 
hw
->
mac
.
ty≥
) {

170 
e1000_82573
:

171 
e1000_82574
:

172 
e1000_82583
:

173 i‡(((
ìcd
 >> 15) & 0x3) == 0x3) {

174 
nvm
->
ty≥
 = 
e1000_nvm_Êash_hw
;

175 
nvm
->
w‹d_size
 = 2048;

179 
ìcd
 &~
E1000_EECD_AUPDEN
;

180 
	`ew32
(
EECD
, 
ìcd
);

185 
nvm
->
ty≥
 = 
e1000_nvm_ì¥om_•i
;

186 
size
 = (
u16
)((
ìcd
 & 
E1000_EECD_SIZE_EX_MASK
) >>

187 
E1000_EECD_SIZE_EX_SHIFT
);

191 
size
 +
NVM_WORD_SIZE_BASE_SHIFT
;

194 i‡(
size
 > 14)

195 
size
 = 14;

196 
nvm
->
w‹d_size
 = 1 << 
size
;

201 
hw
->
mac
.
ty≥
) {

202 
e1000_82574
:

203 
e1000_82583
:

204 
nvm
->
›s
.
acquúe
 = 
e1000_gë_hw_£m≠h‹e_82574
;

205 
nvm
->
›s
.
ªÀa£
 = 
e1000_put_hw_£m≠h‹e_82574
;

212 
	}
}

218 
s32
 
	$e1000_öô_mac_∑øms_82571
(
e1000_hw
 *
hw
)

220 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

221 
u32
 
swsm
 = 0;

222 
u32
 
swsm2
 = 0;

223 
boﬁ
 
f‹˚_˛ór_smbi
 = 
Ál£
;

226 
hw
->
ad≠ãr
->
pdev
->
devi˚
) {

227 
E1000_DEV_ID_82571EB_FIBER
:

228 
E1000_DEV_ID_82572EI_FIBER
:

229 
E1000_DEV_ID_82571EB_QUAD_FIBER
:

230 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_fibî
;

231 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

232 
e1000_£tup_fibî_£rdes_lök_82571
;

233 
mac
->
›s
.
check_f‹_lök
 = 
e1000e_check_f‹_fibî_lök
;

234 
mac
->
›s
.
gë_lök_up_öfo
 =

235 
e1000e_gë_•ìd_™d_du∂ex_fibî_£rdes
;

237 
E1000_DEV_ID_82571EB_SERDES
:

238 
E1000_DEV_ID_82571EB_SERDES_DUAL
:

239 
E1000_DEV_ID_82571EB_SERDES_QUAD
:

240 
E1000_DEV_ID_82572EI_SERDES
:

241 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_öã∫Æ_£rdes
;

242 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

243 
e1000_£tup_fibî_£rdes_lök_82571
;

244 
mac
->
›s
.
check_f‹_lök
 = 
e1000_check_f‹_£rdes_lök_82571
;

245 
mac
->
›s
.
gë_lök_up_öfo
 =

246 
e1000e_gë_•ìd_™d_du∂ex_fibî_£rdes
;

249 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_c›≥r
;

250 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

251 
e1000_£tup_c›≥r_lök_82571
;

252 
mac
->
›s
.
check_f‹_lök
 = 
e1000e_check_f‹_c›≥r_lök
;

253 
mac
->
›s
.
gë_lök_up_öfo
 = 
e1000e_gë_•ìd_™d_du∂ex_c›≥r
;

258 
mac
->
mè_ªg_cou¡
 = 128;

260 
mac
->
ør_íåy_cou¡
 = 
E1000_RAR_ENTRIES
;

262 
mac
->
ad≠tive_ifs
 = 
åue
;

265 
hw
->
mac
.
ty≥
) {

266 
e1000_82573
:

267 
mac
->
›s
.
£t_œn_id
 = 
e1000_£t_œn_id_sögÀ_p‹t
;

268 
mac
->
›s
.
check_mng_mode
 = 
e1000e_check_mng_mode_gíîic
;

269 
mac
->
›s
.
Àd_⁄
 = 
e1000e_Àd_⁄_gíîic
;

270 
mac
->
›s
.
blök_Àd
 = 
e1000e_blök_Àd_gíîic
;

273 
mac
->
has_fwsm
 = 
åue
;

277 
mac
->
¨c_subsy°em_vÆid
 = !!(
	`î32
(
FWSM
) &

278 
E1000_FWSM_MODE_MASK
);

280 
e1000_82574
:

281 
e1000_82583
:

282 
mac
->
›s
.
£t_œn_id
 = 
e1000_£t_œn_id_sögÀ_p‹t
;

283 
mac
->
›s
.
check_mng_mode
 = 
e1000_check_mng_mode_82574
;

284 
mac
->
›s
.
Àd_⁄
 = 
e1000_Àd_⁄_82574
;

287 
mac
->
›s
.
check_mng_mode
 = 
e1000e_check_mng_mode_gíîic
;

288 
mac
->
›s
.
Àd_⁄
 = 
e1000e_Àd_⁄_gíîic
;

289 
mac
->
›s
.
blök_Àd
 = 
e1000e_blök_Àd_gíîic
;

292 
mac
->
has_fwsm
 = 
åue
;

302 
hw
->
mac
.
ty≥
) {

303 
e1000_82571
:

304 
e1000_82572
:

305 
swsm2
 = 
	`î32
(
SWSM2
);

307 i‡(!(
swsm2
 & 
E1000_SWSM2_LOCK
)) {

309 
	`ew32
(
SWSM2
, 
swsm2
 | 
E1000_SWSM2_LOCK
);

310 
f‹˚_˛ór_smbi
 = 
åue
;

312 
f‹˚_˛ór_smbi
 = 
Ál£
;

316 
f‹˚_˛ór_smbi
 = 
åue
;

320 i‡(
f‹˚_˛ór_smbi
) {

322 
swsm
 = 
	`î32
(
SWSM
);

323 i‡(
swsm
 & 
E1000_SWSM_SMBI
) {

328 
	`e_dbg
("Please update your 82571 Bootagent\n");

330 
	`ew32
(
SWSM
, 
swsm
 & ~
E1000_SWSM_SMBI
);

334 
hw
->
dev_•ec
.
e82571
.
smb_cou¡î
 = 0;

337 
	}
}

339 
s32
 
	$e1000_gë_v¨ü¡s_82571
(
e1000_ad≠ãr
 *
ad≠ãr
)

341 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

342 
globÆ_quad_p‹t_a
;

343 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

344 
is_p‹t_b
 = 
	`î32
(
STATUS
Ë& 
E1000_STATUS_FUNC_1
;

345 
s32
 
rc
;

347 
rc
 = 
	`e1000_öô_mac_∑øms_82571
(
hw
);

348 i‡(
rc
)

349  
rc
;

351 
rc
 = 
	`e1000_öô_nvm_∑øms_82571
(
hw
);

352 i‡(
rc
)

353  
rc
;

355 
rc
 = 
	`e1000_öô_phy_∑øms_82571
(
hw
);

356 i‡(
rc
)

357  
rc
;

360 
pdev
->
devi˚
) {

361 
E1000_DEV_ID_82571EB_QUAD_COPPER
:

362 
E1000_DEV_ID_82571EB_QUAD_FIBER
:

363 
E1000_DEV_ID_82571EB_QUAD_COPPER_LP
:

364 
E1000_DEV_ID_82571PT_QUAD_COPPER
:

365 
ad≠ãr
->
Êags
 |
FLAG_IS_QUAD_PORT
;

367 i‡(
globÆ_quad_p‹t_a
 == 0)

368 
ad≠ãr
->
Êags
 |
FLAG_IS_QUAD_PORT_A
;

370 
globÆ_quad_p‹t_a
++;

371 i‡(
globÆ_quad_p‹t_a
 == 4)

372 
globÆ_quad_p‹t_a
 = 0;

378 
ad≠ãr
->
hw
.
mac
.
ty≥
) {

379 
e1000_82571
:

381 i‡(((
pdev
->
devi˚
 =
E1000_DEV_ID_82571EB_FIBER
) ||

382 (
pdev
->
devi˚
 =
E1000_DEV_ID_82571EB_SERDES
) ||

383 (
pdev
->
devi˚
 =
E1000_DEV_ID_82571EB_COPPER
)) &&

384 (
is_p‹t_b
))

385 
ad≠ãr
->
Êags
 &~
FLAG_HAS_WOL
;

387 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_QUAD_PORT
 &&

388 (!(
ad≠ãr
->
Êags
 & 
FLAG_IS_QUAD_PORT_A
)))

389 
ad≠ãr
->
Êags
 &~
FLAG_HAS_WOL
;

391 i‡(
pdev
->
devi˚
 =
E1000_DEV_ID_82571EB_SERDES_QUAD
)

392 
ad≠ãr
->
Êags
 &~
FLAG_HAS_WOL
;

394 
e1000_82573
:

395 i‡(
pdev
->
devi˚
 =
E1000_DEV_ID_82573L
) {

396 
ad≠ãr
->
Êags
 |
FLAG_HAS_JUMBO_FRAMES
;

397 
ad≠ãr
->
max_hw_‰ame_size
 = 
DEFAULT_JUMBO
;

405 
	}
}

414 
s32
 
	$e1000_gë_phy_id_82571
(
e1000_hw
 *
hw
)

416 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

417 
s32
 
ªt_vÆ
;

418 
u16
 
phy_id
 = 0;

420 
hw
->
mac
.
ty≥
) {

421 
e1000_82571
:

422 
e1000_82572
:

428 
phy
->
id
 = 
IGP01E1000_I_PHY_ID
;

430 
e1000_82573
:

431  
	`e1000e_gë_phy_id
(
hw
);

433 
e1000_82574
:

434 
e1000_82583
:

435 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_PHYSID1
, &
phy_id
);

436 i‡(
ªt_vÆ
)

437  
ªt_vÆ
;

439 
phy
->
id
 = (
u32
)(
phy_id
 << 16);

440 
	`u¶ìp_ønge
(20, 40);

441 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_PHYSID2
, &
phy_id
);

442 i‡(
ªt_vÆ
)

443  
ªt_vÆ
;

445 
phy
->
id
 |(
u32
)(
phy_id
);

446 
phy
->
ªvisi⁄
 = (
u32
)(
phy_id
 & ~
PHY_REVISION_MASK
);

449  -
E1000_ERR_PHY
;

454 
	}
}

462 
s32
 
	$e1000_gë_hw_£m≠h‹e_82571
(
e1000_hw
 *
hw
)

464 
u32
 
swsm
;

465 
s32
 
sw_timeout
 = 
hw
->
nvm
.
w‹d_size
 + 1;

466 
s32
 
fw_timeout
 = 
hw
->
nvm
.
w‹d_size
 + 1;

467 
s32
 
i
 = 0;

476 i‡(
hw
->
dev_•ec
.
e82571
.
smb_cou¡î
 > 2)

477 
sw_timeout
 = 1;

480 
i
 < 
sw_timeout
) {

481 
swsm
 = 
	`î32
(
SWSM
);

482 i‡(!(
swsm
 & 
E1000_SWSM_SMBI
))

485 
	`u¶ìp_ønge
(50, 100);

486 
i
++;

489 i‡(
i
 =
sw_timeout
) {

490 
	`e_dbg
("Driver can'táccess device - SMBI bit is set.\n");

491 
hw
->
dev_•ec
.
e82571
.
smb_cou¡î
++;

494 
i
 = 0; i < 
fw_timeout
; i++) {

495 
swsm
 = 
	`î32
(
SWSM
);

496 
	`ew32
(
SWSM
, 
swsm
 | 
E1000_SWSM_SWESMBI
);

499 i‡(
	`î32
(
SWSM
Ë& 
E1000_SWSM_SWESMBI
)

502 
	`u¶ìp_ønge
(50, 100);

505 i‡(
i
 =
fw_timeout
) {

507 
	`e1000_put_hw_£m≠h‹e_82571
(
hw
);

508 
	`e_dbg
("Driver can'táccessÅhe NVM\n");

509  -
E1000_ERR_NVM
;

513 
	}
}

521 
	$e1000_put_hw_£m≠h‹e_82571
(
e1000_hw
 *
hw
)

523 
u32
 
swsm
;

525 
swsm
 = 
	`î32
(
SWSM
);

526 
swsm
 &~(
E1000_SWSM_SMBI
 | 
E1000_SWSM_SWESMBI
);

527 
	`ew32
(
SWSM
, 
swsm
);

528 
	}
}

537 
s32
 
	$e1000_gë_hw_£m≠h‹e_82573
(
e1000_hw
 *
hw
)

539 
u32
 
ext˙f_˘æ
;

540 
s32
 
i
 = 0;

542 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

544 
ext˙f_˘æ
 |
E1000_EXTCNF_CTRL_MDIO_SW_OWNERSHIP
;

545 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

546 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

548 i‡(
ext˙f_˘æ
 & 
E1000_EXTCNF_CTRL_MDIO_SW_OWNERSHIP
)

551 
	`u¶ìp_ønge
(2000, 4000);

552 
i
++;

553 } 
i
 < 
MDIO_OWNERSHIP_TIMEOUT
);

555 i‡(
i
 =
MDIO_OWNERSHIP_TIMEOUT
) {

557 
	`e1000_put_hw_£m≠h‹e_82573
(
hw
);

558 
	`e_dbg
("Driver can'táccessÅhe PHY\n");

559  -
E1000_ERR_PHY
;

563 
	}
}

572 
	$e1000_put_hw_£m≠h‹e_82573
(
e1000_hw
 *
hw
)

574 
u32
 
ext˙f_˘æ
;

576 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

577 
ext˙f_˘æ
 &~
E1000_EXTCNF_CTRL_MDIO_SW_OWNERSHIP
;

578 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

579 
	}
}

581 
DEFINE_MUTEX
(
swÊag_muãx
);

590 
s32
 
	$e1000_gë_hw_£m≠h‹e_82574
(
e1000_hw
 *
hw
)

592 
s32
 
ªt_vÆ
;

594 
	`muãx_lock
(&
swÊag_muãx
);

595 
ªt_vÆ
 = 
	`e1000_gë_hw_£m≠h‹e_82573
(
hw
);

596 i‡(
ªt_vÆ
)

597 
	`muãx_u∆ock
(&
swÊag_muãx
);

598  
ªt_vÆ
;

599 
	}
}

608 
	$e1000_put_hw_£m≠h‹e_82574
(
e1000_hw
 *
hw
)

610 
	`e1000_put_hw_£m≠h‹e_82573
(
hw
);

611 
	`muãx_u∆ock
(&
swÊag_muãx
);

612 
	}
}

626 
s32
 
	$e1000_£t_d0_Õlu_°©e_82574
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

628 
u32
 
d©a
 = 
	`î32
(
POEMB
);

630 i‡(
a˘ive
)

631 
d©a
 |
E1000_PHY_CTRL_D0A_LPLU
;

633 
d©a
 &~
E1000_PHY_CTRL_D0A_LPLU
;

635 
	`ew32
(
POEMB
, 
d©a
);

637 
	}
}

650 
s32
 
	$e1000_£t_d3_Õlu_°©e_82574
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

652 
u32
 
d©a
 = 
	`î32
(
POEMB
);

654 i‡(!
a˘ive
) {

655 
d©a
 &~
E1000_PHY_CTRL_NOND0A_LPLU
;

656 } i‡((
hw
->
phy
.
aut⁄eg_advîti£d
 =
E1000_ALL_SPEED_DUPLEX
) ||

657 (
hw
->
phy
.
aut⁄eg_advîti£d
 =
E1000_ALL_NOT_GIG
) ||

658 (
hw
->
phy
.
aut⁄eg_advîti£d
 =
E1000_ALL_10_SPEED
)) {

659 
d©a
 |
E1000_PHY_CTRL_NOND0A_LPLU
;

662 
	`ew32
(
POEMB
, 
d©a
);

664 
	}
}

675 
s32
 
	$e1000_acquúe_nvm_82571
(
e1000_hw
 *
hw
)

677 
s32
 
ªt_vÆ
;

679 
ªt_vÆ
 = 
	`e1000_gë_hw_£m≠h‹e_82571
(
hw
);

680 i‡(
ªt_vÆ
)

681  
ªt_vÆ
;

683 
hw
->
mac
.
ty≥
) {

684 
e1000_82573
:

687 
ªt_vÆ
 = 
	`e1000e_acquúe_nvm
(
hw
);

691 i‡(
ªt_vÆ
)

692 
	`e1000_put_hw_£m≠h‹e_82571
(
hw
);

694  
ªt_vÆ
;

695 
	}
}

703 
	$e1000_ªÀa£_nvm_82571
(
e1000_hw
 *
hw
)

705 
	`e1000e_ªÀa£_nvm
(
hw
);

706 
	`e1000_put_hw_£m≠h‹e_82571
(
hw
);

707 
	}
}

721 
s32
 
	$e1000_wrôe_nvm_82571
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
,

722 
u16
 *
d©a
)

724 
s32
 
ªt_vÆ
;

726 
hw
->
mac
.
ty≥
) {

727 
e1000_82573
:

728 
e1000_82574
:

729 
e1000_82583
:

730 
ªt_vÆ
 = 
	`e1000_wrôe_nvm_ìwr_82571
(
hw
, 
off£t
, 
w‹ds
, 
d©a
);

732 
e1000_82571
:

733 
e1000_82572
:

734 
ªt_vÆ
 = 
	`e1000e_wrôe_nvm_•i
(
hw
, 
off£t
, 
w‹ds
, 
d©a
);

737 
ªt_vÆ
 = -
E1000_ERR_NVM
;

741  
ªt_vÆ
;

742 
	}
}

752 
s32
 
	$e1000_upd©e_nvm_checksum_82571
(
e1000_hw
 *
hw
)

754 
u32
 
ìcd
;

755 
s32
 
ªt_vÆ
;

756 
u16
 
i
;

758 
ªt_vÆ
 = 
	`e1000e_upd©e_nvm_checksum_gíîic
(
hw
);

759 i‡(
ªt_vÆ
)

760  
ªt_vÆ
;

765 i‡(
hw
->
nvm
.
ty≥
 !
e1000_nvm_Êash_hw
)

769 
i
 = 0; i < 
E1000_FLASH_UPDATES
; i++) {

770 
	`u¶ìp_ønge
(1000, 2000);

771 i‡(!(
	`î32
(
EECD
Ë& 
E1000_EECD_FLUPD
))

775 i‡(
i
 =
E1000_FLASH_UPDATES
)

776  -
E1000_ERR_NVM
;

779 i‡((
	`î32
(
FLOP
Ë& 0xFF00Ë=
E1000_STM_OPCODE
) {

783 
	`ew32
(
HICR
, 
E1000_HICR_FW_RESET_ENABLE
);

784 
	`e1e_Êush
();

785 
	`ew32
(
HICR
, 
E1000_HICR_FW_RESET
);

789 
ìcd
 = 
	`î32
(
EECD
Ë| 
E1000_EECD_FLUPD
;

790 
	`ew32
(
EECD
, 
ìcd
);

792 
i
 = 0; i < 
E1000_FLASH_UPDATES
; i++) {

793 
	`u¶ìp_ønge
(1000, 2000);

794 i‡(!(
	`î32
(
EECD
Ë& 
E1000_EECD_FLUPD
))

798 i‡(
i
 =
E1000_FLASH_UPDATES
)

799  -
E1000_ERR_NVM
;

802 
	}
}

811 
s32
 
	$e1000_vÆid©e_nvm_checksum_82571
(
e1000_hw
 *
hw
)

813 i‡(
hw
->
nvm
.
ty≥
 =
e1000_nvm_Êash_hw
)

814 
	`e1000_fix_nvm_checksum_82571
(
hw
);

816  
	`e1000e_vÆid©e_nvm_checksum_gíîic
(
hw
);

817 
	}
}

833 
s32
 
	$e1000_wrôe_nvm_ìwr_82571
(
e1000_hw
 *
hw
, 
u16
 
off£t
,

834 
u16
 
w‹ds
, u16 *
d©a
)

836 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

837 
u32
 
i
, 
ìwr
 = 0;

838 
s32
 
ªt_vÆ
 = 0;

843 i‡((
off£t
 >
nvm
->
w‹d_size
Ë|| (
w‹ds
 > (nvm->word_size - offset)) ||

844 (
w‹ds
 == 0)) {

845 
	`e_dbg
("nvmÖarameter(s) out of bounds\n");

846  -
E1000_ERR_NVM
;

849 
i
 = 0; i < 
w‹ds
; i++) {

850 
ìwr
 = ((
d©a
[
i
] << 
E1000_NVM_RW_REG_DATA
) |

851 ((
off£t
 + 
i
Ë<< 
E1000_NVM_RW_ADDR_SHIFT
) |

852 
E1000_NVM_RW_REG_START
);

854 
ªt_vÆ
 = 
	`e1000e_pﬁl_ìrd_ìwr_d⁄e
(
hw
, 
E1000_NVM_POLL_WRITE
);

855 i‡(
ªt_vÆ
)

858 
	`ew32
(
EEWR
, 
ìwr
);

860 
ªt_vÆ
 = 
	`e1000e_pﬁl_ìrd_ìwr_d⁄e
(
hw
, 
E1000_NVM_POLL_WRITE
);

861 i‡(
ªt_vÆ
)

865  
ªt_vÆ
;

866 
	}
}

874 
s32
 
	$e1000_gë_cfg_d⁄e_82571
(
e1000_hw
 *
hw
)

876 
s32
 
timeout
 = 
PHY_CFG_TIMEOUT
;

878 
timeout
) {

879 i‡(
	`î32
(
EEMNGCTL
Ë& 
E1000_NVM_CFG_DONE_PORT_0
)

881 
	`u¶ìp_ønge
(1000, 2000);

882 
timeout
--;

884 i‡(!
timeout
) {

885 
	`e_dbg
("MNG configuration cycle hasÇot completed.\n");

886  -
E1000_ERR_RESET
;

890 
	}
}

903 
s32
 
	$e1000_£t_d0_Õlu_°©e_82571
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

905 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

906 
s32
 
ªt_vÆ
;

907 
u16
 
d©a
;

909 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, &
d©a
);

910 i‡(
ªt_vÆ
)

911  
ªt_vÆ
;

913 i‡(
a˘ive
) {

914 
d©a
 |
IGP02E1000_PM_D0_LPLU
;

915 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, 
d©a
);

916 i‡(
ªt_vÆ
)

917  
ªt_vÆ
;

920 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

921 i‡(
ªt_vÆ
)

922  
ªt_vÆ
;

923 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

924 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

925 i‡(
ªt_vÆ
)

926  
ªt_vÆ
;

928 
d©a
 &~
IGP02E1000_PM_D0_LPLU
;

929 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, 
d©a
);

935 i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_⁄
) {

936 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

937 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

938 i‡(
ªt_vÆ
)

939  
ªt_vÆ
;

941 
d©a
 |
IGP01E1000_PSCFR_SMART_SPEED
;

942 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

943 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

944 i‡(
ªt_vÆ
)

945  
ªt_vÆ
;

946 } i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_off
) {

947 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

948 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

949 i‡(
ªt_vÆ
)

950  
ªt_vÆ
;

952 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

953 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

954 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

955 i‡(
ªt_vÆ
)

956  
ªt_vÆ
;

961 
	}
}

969 
s32
 
	$e1000_ª£t_hw_82571
(
e1000_hw
 *
hw
)

971 
u32
 
˘æ
, 
˘æ_ext
, 
ìcd
, 
t˘l
;

972 
s32
 
ªt_vÆ
;

977 
ªt_vÆ
 = 
	`e1000e_dißbÀ_pcõ_ma°î
(
hw
);

978 i‡(
ªt_vÆ
)

979 
	`e_dbg
("PCI-E Master disableÖolling has failed.\n");

981 
	`e_dbg
("Masking offáll interrupts\n");

982 
	`ew32
(
IMC
, 0xffffffff);

984 
	`ew32
(
RCTL
, 0);

985 
t˘l
 = 
	`î32
(
TCTL
);

986 
t˘l
 &~
E1000_TCTL_EN
;

987 
	`ew32
(
TCTL
, 
t˘l
);

988 
	`e1e_Êush
();

990 
	`u¶ìp_ønge
(10000, 20000);

995 
hw
->
mac
.
ty≥
) {

996 
e1000_82573
:

997 
ªt_vÆ
 = 
	`e1000_gë_hw_£m≠h‹e_82573
(
hw
);

999 
e1000_82574
:

1000 
e1000_82583
:

1001 
ªt_vÆ
 = 
	`e1000_gë_hw_£m≠h‹e_82574
(
hw
);

1007 
˘æ
 = 
	`î32
(
CTRL
);

1009 
	`e_dbg
("Issuingá globalÑesetÅo MAC\n");

1010 
	`ew32
(
CTRL
, 
˘æ
 | 
E1000_CTRL_RST
);

1013 
hw
->
mac
.
ty≥
) {

1014 
e1000_82574
:

1015 
e1000_82583
:

1017 i‡(!
ªt_vÆ
)

1018 
	`e1000_put_hw_£m≠h‹e_82574
(
hw
);

1024 i‡(
hw
->
nvm
.
ty≥
 =
e1000_nvm_Êash_hw
) {

1025 
	`u¶ìp_ønge
(10, 20);

1026 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

1027 
˘æ_ext
 |
E1000_CTRL_EXT_EE_RST
;

1028 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

1029 
	`e1e_Êush
();

1032 
ªt_vÆ
 = 
	`e1000e_gë_auto_rd_d⁄e
(
hw
);

1033 i‡(
ªt_vÆ
)

1035  
ªt_vÆ
;

1042 
hw
->
mac
.
ty≥
) {

1043 
e1000_82571
:

1044 
e1000_82572
:

1048 
ìcd
 = 
	`î32
(
EECD
);

1049 
ìcd
 &~(
E1000_EECD_REQ
 | 
E1000_EECD_GNT
);

1050 
	`ew32
(
EECD
, 
ìcd
);

1052 
e1000_82573
:

1053 
e1000_82574
:

1054 
e1000_82583
:

1055 
	`m¶ìp
(25);

1062 
	`ew32
(
IMC
, 0xffffffff);

1063 
	`î32
(
ICR
);

1065 i‡(
hw
->
mac
.
ty≥
 =
e1000_82571
) {

1067 
ªt_vÆ
 = 
	`e1000_check_Æt_mac_addr_gíîic
(
hw
);

1068 i‡(
ªt_vÆ
)

1069  
ªt_vÆ
;

1071 
	`e1000e_£t_œa_°©e_82571
(
hw
, 
åue
);

1075 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
)

1076 
hw
->
mac
.
£rdes_lök_°©e
 = 
e1000_£rdes_lök_down
;

1079 
	}
}

1087 
s32
 
	$e1000_öô_hw_82571
(
e1000_hw
 *
hw
)

1089 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1090 
u32
 
ªg_d©a
;

1091 
s32
 
ªt_vÆ
;

1092 
u16
 
i
, 
ør_cou¡
 = 
mac
->
ør_íåy_cou¡
;

1094 
	`e1000_öôülize_hw_bôs_82571
(
hw
);

1097 
ªt_vÆ
 = 
mac
->
›s
.
	`id_Àd_öô
(
hw
);

1099 i‡(
ªt_vÆ
)

1100 
	`e_dbg
("Error initializing identification LED\n");

1103 
	`e_dbg
("InitializingÅhe IEEE VLAN\n");

1104 
mac
->
›s
.
	`˛ór_v·a
(
hw
);

1111 i‡(
	`e1000e_gë_œa_°©e_82571
(
hw
))

1112 
ør_cou¡
--;

1113 
	`e1000e_öô_rx_addrs
(
hw
, 
ør_cou¡
);

1116 
	`e_dbg
("ZeroingÅhe MTA\n");

1117 
i
 = 0; i < 
mac
->
mè_ªg_cou¡
; i++)

1118 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_MTA
, 
i
, 0);

1121 
ªt_vÆ
 = 
mac
->
›s
.
	`£tup_lök
(
hw
);

1124 
ªg_d©a
 = 
	`î32
(
	`TXDCTL
(0));

1125 
ªg_d©a
 = (‘eg_d©®& ~
E1000_TXDCTL_WTHRESH
) |

1126 
E1000_TXDCTL_FULL_TX_DESC_WB
 | 
E1000_TXDCTL_COUNT_DESC
);

1127 
	`ew32
(
	`TXDCTL
(0), 
ªg_d©a
);

1130 
mac
->
ty≥
) {

1131 
e1000_82573
:

1132 
	`e1000e_íabÀ_tx_pkt_fûãrög
(
hw
);

1134 
e1000_82574
:

1135 
e1000_82583
:

1136 
ªg_d©a
 = 
	`î32
(
GCR
);

1137 
ªg_d©a
 |
E1000_GCR_L1_ACT_WITHOUT_L0S_RX
;

1138 
	`ew32
(
GCR
, 
ªg_d©a
);

1141 
ªg_d©a
 = 
	`î32
(
	`TXDCTL
(1));

1142 
ªg_d©a
 = (‘eg_d©®& ~
E1000_TXDCTL_WTHRESH
) |

1143 
E1000_TXDCTL_FULL_TX_DESC_WB
 |

1144 
E1000_TXDCTL_COUNT_DESC
);

1145 
	`ew32
(
	`TXDCTL
(1), 
ªg_d©a
);

1154 
	`e1000_˛ór_hw_˙ås_82571
(
hw
);

1156  
ªt_vÆ
;

1157 
	}
}

1165 
	$e1000_öôülize_hw_bôs_82571
(
e1000_hw
 *
hw
)

1167 
u32
 
ªg
;

1170 
ªg
 = 
	`î32
(
	`TXDCTL
(0));

1171 
ªg
 |= (1 << 22);

1172 
	`ew32
(
	`TXDCTL
(0), 
ªg
);

1175 
ªg
 = 
	`î32
(
	`TXDCTL
(1));

1176 
ªg
 |= (1 << 22);

1177 
	`ew32
(
	`TXDCTL
(1), 
ªg
);

1180 
ªg
 = 
	`î32
(
	`TARC
(0));

1181 
ªg
 &= ~(0xF << 27);

1182 
hw
->
mac
.
ty≥
) {

1183 
e1000_82571
:

1184 
e1000_82572
:

1185 
ªg
 |= (1 << 23) | (1 << 24) | (1 << 25) | (1 << 26);

1187 
e1000_82574
:

1188 
e1000_82583
:

1189 
ªg
 |= (1 << 26);

1194 
	`ew32
(
	`TARC
(0), 
ªg
);

1197 
ªg
 = 
	`î32
(
	`TARC
(1));

1198 
hw
->
mac
.
ty≥
) {

1199 
e1000_82571
:

1200 
e1000_82572
:

1201 
ªg
 &= ~((1 << 29) | (1 << 30));

1202 
ªg
 |= (1 << 22) | (1 << 24) | (1 << 25) | (1 << 26);

1203 i‡(
	`î32
(
TCTL
Ë& 
E1000_TCTL_MULR
)

1204 
ªg
 &= ~(1 << 28);

1206 
ªg
 |= (1 << 28);

1207 
	`ew32
(
	`TARC
(1), 
ªg
);

1214 
hw
->
mac
.
ty≥
) {

1215 
e1000_82573
:

1216 
e1000_82574
:

1217 
e1000_82583
:

1218 
ªg
 = 
	`î32
(
CTRL
);

1219 
ªg
 &= ~(1 << 29);

1220 
	`ew32
(
CTRL
, 
ªg
);

1227 
hw
->
mac
.
ty≥
) {

1228 
e1000_82573
:

1229 
e1000_82574
:

1230 
e1000_82583
:

1231 
ªg
 = 
	`î32
(
CTRL_EXT
);

1232 
ªg
 &= ~(1 << 23);

1233 
ªg
 |= (1 << 22);

1234 
	`ew32
(
CTRL_EXT
, 
ªg
);

1240 i‡(
hw
->
mac
.
ty≥
 =
e1000_82571
) {

1241 
ªg
 = 
	`î32
(
PBA_ECC
);

1242 
ªg
 |
E1000_PBA_ECC_CORR_EN
;

1243 
	`ew32
(
PBA_ECC
, 
ªg
);

1249 i‡((
hw
->
mac
.
ty≥
 =
e1000_82571
Ë|| (hw->mac.ty≥ =
e1000_82572
)) {

1250 
ªg
 = 
	`î32
(
CTRL_EXT
);

1251 
ªg
 &~
E1000_CTRL_EXT_DMA_DYN_CLK_EN
;

1252 
	`ew32
(
CTRL_EXT
, 
ªg
);

1258 i‡(
hw
->
mac
.
ty≥
 <
e1000_82573
) {

1259 
ªg
 = 
	`î32
(
RFCTL
);

1260 
ªg
 |(
E1000_RFCTL_IPV6_EX_DIS
 | 
E1000_RFCTL_NEW_IPV6_EXT_DIS
);

1261 
	`ew32
(
RFCTL
, 
ªg
);

1265 
hw
->
mac
.
ty≥
) {

1266 
e1000_82574
:

1267 
e1000_82583
:

1268 
ªg
 = 
	`î32
(
GCR
);

1269 
ªg
 |= (1 << 22);

1270 
	`ew32
(
GCR
, 
ªg
);

1278 
ªg
 = 
	`î32
(
GCR2
);

1279 
ªg
 |= 1;

1280 
	`ew32
(
GCR2
, 
ªg
);

1285 
	}
}

1294 
	$e1000_˛ór_v·a_82571
(
e1000_hw
 *
hw
)

1296 
u32
 
off£t
;

1297 
u32
 
v·a_vÆue
 = 0;

1298 
u32
 
v·a_off£t
 = 0;

1299 
u32
 
v·a_bô_ö_ªg
 = 0;

1301 
hw
->
mac
.
ty≥
) {

1302 
e1000_82573
:

1303 
e1000_82574
:

1304 
e1000_82583
:

1305 i‡(
hw
->
mng_cookõ
.
vœn_id
 != 0) {

1312 
v·a_off£t
 = (
hw
->
mng_cookõ
.
vœn_id
 >>

1313 
E1000_VFTA_ENTRY_SHIFT
) &

1314 
E1000_VFTA_ENTRY_MASK
;

1315 
v·a_bô_ö_ªg
 =

1316 1 << (
hw
->
mng_cookõ
.
vœn_id
 &

1317 
E1000_VFTA_ENTRY_BIT_SHIFT_MASK
);

1323 
off£t
 = 0; off£à< 
E1000_VLAN_FILTER_TBL_SIZE
; offset++) {

1328 
v·a_vÆue
 = (
off£t
 =
v·a_off£t
Ë? 
v·a_bô_ö_ªg
 : 0;

1329 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_VFTA
, 
off£t
, 
v·a_vÆue
);

1330 
	`e1e_Êush
();

1332 
	}
}

1341 
boﬁ
 
	$e1000_check_mng_mode_82574
(
e1000_hw
 *
hw
)

1343 
u16
 
d©a
;

1345 
	`e1000_ªad_nvm
(
hw
, 
NVM_INIT_CONTROL2_REG
, 1, &
d©a
);

1346  (
d©a
 & 
E1000_NVM_INIT_CTRL2_MNGM
) != 0;

1347 
	}
}

1355 
s32
 
	$e1000_Àd_⁄_82574
(
e1000_hw
 *
hw
)

1357 
u32
 
˘æ
;

1358 
u32
 
i
;

1360 
˘æ
 = 
hw
->
mac
.
Àd˘l_mode2
;

1361 i‡(!(
E1000_STATUS_LU
 & 
	`î32
(
STATUS
))) {

1365 
i
 = 0; i < 4; i++)

1366 i‡(((
hw
->
mac
.
Àd˘l_mode2
 >> (
i
 * 8)) & 0xFF) ==

1367 
E1000_LEDCTL_MODE_LED_ON
)

1368 
˘æ
 |(
E1000_LEDCTL_LED0_IVRT
 << (
i
 * 8));

1370 
	`ew32
(
LEDCTL
, 
˘æ
);

1373 
	}
}

1381 
boﬁ
 
	$e1000_check_phy_82574
(
e1000_hw
 *
hw
)

1383 
u16
 
°©us_1kbt
 = 0;

1384 
u16
 
ª˚ive_îr‹s
 = 0;

1385 
s32
 
ªt_vÆ
;

1390 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
E1000_RECEIVE_ERROR_COUNTER
, &
ª˚ive_îr‹s
);

1391 i‡(
ªt_vÆ
)

1392  
Ál£
;

1393 i‡(
ª˚ive_îr‹s
 =
E1000_RECEIVE_ERROR_MAX
) {

1394 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
E1000_BASE1000T_STATUS
, &
°©us_1kbt
);

1395 i‡(
ªt_vÆ
)

1396  
Ál£
;

1397 i‡((
°©us_1kbt
 & 
E1000_IDLE_ERROR_COUNT_MASK
) ==

1398 
E1000_IDLE_ERROR_COUNT_MASK
)

1399  
åue
;

1402  
Ál£
;

1403 
	}
}

1415 
s32
 
	$e1000_£tup_lök_82571
(
e1000_hw
 *
hw
)

1421 
hw
->
mac
.
ty≥
) {

1422 
e1000_82573
:

1423 
e1000_82574
:

1424 
e1000_82583
:

1425 i‡(
hw
->
fc
.
ªque°ed_mode
 =
e1000_fc_deÁu…
)

1426 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_fuŒ
;

1432  
	`e1000e_£tup_lök_gíîic
(
hw
);

1433 
	}
}

1443 
s32
 
	$e1000_£tup_c›≥r_lök_82571
(
e1000_hw
 *
hw
)

1445 
u32
 
˘æ
;

1446 
s32
 
ªt_vÆ
;

1448 
˘æ
 = 
	`î32
(
CTRL
);

1449 
˘æ
 |
E1000_CTRL_SLU
;

1450 
˘æ
 &~(
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
);

1451 
	`ew32
(
CTRL
, 
˘æ
);

1453 
hw
->
phy
.
ty≥
) {

1454 
e1000_phy_m88
:

1455 
e1000_phy_bm
:

1456 
ªt_vÆ
 = 
	`e1000e_c›≥r_lök_£tup_m88
(
hw
);

1458 
e1000_phy_igp_2
:

1459 
ªt_vÆ
 = 
	`e1000e_c›≥r_lök_£tup_igp
(
hw
);

1462  -
E1000_ERR_PHY
;

1466 i‡(
ªt_vÆ
)

1467  
ªt_vÆ
;

1469  
	`e1000e_£tup_c›≥r_lök
(
hw
);

1470 
	}
}

1479 
s32
 
	$e1000_£tup_fibî_£rdes_lök_82571
(
e1000_hw
 *
hw
)

1481 
hw
->
mac
.
ty≥
) {

1482 
e1000_82571
:

1483 
e1000_82572
:

1490 
	`ew32
(
SCTL
, 
E1000_SCTL_DISABLE_SERDES_LOOPBACK
);

1496  
	`e1000e_£tup_fibî_£rdes_lök
(
hw
);

1497 
	}
}

1518 
s32
 
	$e1000_check_f‹_£rdes_lök_82571
(
e1000_hw
 *
hw
)

1520 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1521 
u32
 
rxcw
;

1522 
u32
 
˘æ
;

1523 
u32
 
°©us
;

1524 
u32
 
txcw
;

1525 
u32
 
i
;

1526 
s32
 
ªt_vÆ
 = 0;

1528 
˘æ
 = 
	`î32
(
CTRL
);

1529 
°©us
 = 
	`î32
(
STATUS
);

1530 
	`î32
(
RXCW
);

1532 
	`u¶ìp_ønge
(10, 20);

1533 
rxcw
 = 
	`î32
(
RXCW
);

1535 i‡((
rxcw
 & 
E1000_RXCW_SYNCH
Ë&& !‘xcw & 
E1000_RXCW_IV
)) {

1537 
mac
->
£rdes_lök_°©e
) {

1538 
e1000_£rdes_lök_aut⁄eg_com∂ëe
:

1539 i‡(!(
°©us
 & 
E1000_STATUS_LU
)) {

1543 
mac
->
£rdes_lök_°©e
 =

1544 
e1000_£rdes_lök_aut⁄eg_¥ogªss
;

1545 
mac
->
£rdes_has_lök
 = 
Ál£
;

1546 
	`e_dbg
("AN_UP -> AN_PROG\n");

1548 
mac
->
£rdes_has_lök
 = 
åue
;

1552 
e1000_£rdes_lök_f‹˚d_up
:

1558 i‡(
rxcw
 & 
E1000_RXCW_C
) {

1560 
	`ew32
(
TXCW
, 
mac
->
txcw
);

1561 
	`ew32
(
CTRL
, (
˘æ
 & ~
E1000_CTRL_SLU
));

1562 
mac
->
£rdes_lök_°©e
 =

1563 
e1000_£rdes_lök_aut⁄eg_¥ogªss
;

1564 
mac
->
£rdes_has_lök
 = 
Ál£
;

1565 
	`e_dbg
("FORCED_UP -> AN_PROG\n");

1567 
mac
->
£rdes_has_lök
 = 
åue
;

1571 
e1000_£rdes_lök_aut⁄eg_¥ogªss
:

1572 i‡(
rxcw
 & 
E1000_RXCW_C
) {

1577 i‡(
°©us
 & 
E1000_STATUS_LU
) {

1578 
mac
->
£rdes_lök_°©e
 =

1579 
e1000_£rdes_lök_aut⁄eg_com∂ëe
;

1580 
	`e_dbg
("AN_PROG -> AN_UP\n");

1581 
mac
->
£rdes_has_lök
 = 
åue
;

1584 
mac
->
£rdes_lök_°©e
 =

1585 
e1000_£rdes_lök_down
;

1586 
	`e_dbg
("AN_PROG -> DOWN\n");

1593 
	`ew32
(
TXCW
, (
mac
->
txcw
 & ~
E1000_TXCW_ANE
));

1594 
˘æ
 |(
E1000_CTRL_SLU
 | 
E1000_CTRL_FD
);

1595 
	`ew32
(
CTRL
, 
˘æ
);

1598 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

1599 i‡(
ªt_vÆ
) {

1600 
	`e_dbg
("Error config flow control\n");

1603 
mac
->
£rdes_lök_°©e
 =

1604 
e1000_£rdes_lök_f‹˚d_up
;

1605 
mac
->
£rdes_has_lök
 = 
åue
;

1606 
	`e_dbg
("AN_PROG -> FORCED_UP\n");

1610 
e1000_£rdes_lök_down
:

1616 
	`ew32
(
TXCW
, 
mac
->
txcw
);

1617 
	`ew32
(
CTRL
, (
˘æ
 & ~
E1000_CTRL_SLU
));

1618 
mac
->
£rdes_lök_°©e
 =

1619 
e1000_£rdes_lök_aut⁄eg_¥ogªss
;

1620 
mac
->
£rdes_has_lök
 = 
Ál£
;

1621 
	`e_dbg
("DOWN -> AN_PROG\n");

1625 i‡(!(
rxcw
 & 
E1000_RXCW_SYNCH
)) {

1626 
mac
->
£rdes_has_lök
 = 
Ál£
;

1627 
mac
->
£rdes_lök_°©e
 = 
e1000_£rdes_lök_down
;

1628 
	`e_dbg
("ANYSTATE -> DOWN\n");

1634 
i
 = 0; i < 
AN_RETRY_COUNT
; i++) {

1635 
	`u¶ìp_ønge
(10, 20);

1636 
rxcw
 = 
	`î32
(
RXCW
);

1637 i‡((
rxcw
 & 
E1000_RXCW_SYNCH
) &&

1638 (
rxcw
 & 
E1000_RXCW_C
))

1641 i‡(
rxcw
 & 
E1000_RXCW_IV
) {

1642 
mac
->
£rdes_has_lök
 = 
Ál£
;

1643 
mac
->
£rdes_lök_°©e
 =

1644 
e1000_£rdes_lök_down
;

1645 
	`e_dbg
("ANYSTATE -> DOWN\n");

1650 i‡(
i
 =
AN_RETRY_COUNT
) {

1651 
txcw
 = 
	`î32
(
TXCW
);

1652 
txcw
 |
E1000_TXCW_ANE
;

1653 
	`ew32
(
TXCW
, 
txcw
);

1654 
mac
->
£rdes_lök_°©e
 =

1655 
e1000_£rdes_lök_aut⁄eg_¥ogªss
;

1656 
mac
->
£rdes_has_lök
 = 
Ál£
;

1657 
	`e_dbg
("ANYSTATE -> AN_PROG\n");

1662  
ªt_vÆ
;

1663 
	}
}

1673 
s32
 
	$e1000_vÆid_Àd_deÁu…_82571
(
e1000_hw
 *
hw
, 
u16
 *
d©a
)

1675 
s32
 
ªt_vÆ
;

1677 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_ID_LED_SETTINGS
, 1, 
d©a
);

1678 i‡(
ªt_vÆ
) {

1679 
	`e_dbg
("NVM Read Error\n");

1680  
ªt_vÆ
;

1683 
hw
->
mac
.
ty≥
) {

1684 
e1000_82573
:

1685 
e1000_82574
:

1686 
e1000_82583
:

1687 i‡(*
d©a
 =
ID_LED_RESERVED_F746
)

1688 *
d©a
 = 
ID_LED_DEFAULT_82573
;

1691 i‡(*
d©a
 =
ID_LED_RESERVED_0000
 ||

1692 *
d©a
 =
ID_LED_RESERVED_FFFF
)

1693 *
d©a
 = 
ID_LED_DEFAULT
;

1698 
	}
}

1706 
boﬁ
 
	$e1000e_gë_œa_°©e_82571
(
e1000_hw
 *
hw
)

1708 i‡(
hw
->
mac
.
ty≥
 !
e1000_82571
)

1709  
Ál£
;

1711  
hw
->
dev_•ec
.
e82571
.
œa_is_¥e£¡
;

1712 
	}
}

1721 
	$e1000e_£t_œa_°©e_82571
(
e1000_hw
 *
hw
, 
boﬁ
 
°©e
)

1723 i‡(
hw
->
mac
.
ty≥
 !
e1000_82571
)

1726 
hw
->
dev_•ec
.
e82571
.
œa_is_¥e£¡
 = 
°©e
;

1729 i‡(
°©e
)

1736 
hw
->
mac
.
›s
.
	`ør_£t
(hw, hw->mac.
addr
,

1737 
hw
->
mac
.
ør_íåy_cou¡
 - 1);

1738 
	}
}

1750 
s32
 
	$e1000_fix_nvm_checksum_82571
(
e1000_hw
 *
hw
)

1752 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

1753 
s32
 
ªt_vÆ
;

1754 
u16
 
d©a
;

1756 i‡(
nvm
->
ty≥
 !
e1000_nvm_Êash_hw
)

1762 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 0x10, 1, &
d©a
);

1763 i‡(
ªt_vÆ
)

1764  
ªt_vÆ
;

1766 i‡(!(
d©a
 & 0x10)) {

1774 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 0x23, 1, &
d©a
);

1775 i‡(
ªt_vÆ
)

1776  
ªt_vÆ
;

1778 i‡(!(
d©a
 & 0x8000)) {

1779 
d©a
 |= 0x8000;

1780 
ªt_vÆ
 = 
	`e1000_wrôe_nvm
(
hw
, 0x23, 1, &
d©a
);

1781 i‡(
ªt_vÆ
)

1782  
ªt_vÆ
;

1783 
ªt_vÆ
 = 
	`e1000e_upd©e_nvm_checksum
(
hw
);

1784 i‡(
ªt_vÆ
)

1785  
ªt_vÆ
;

1790 
	}
}

1796 
s32
 
	$e1000_ªad_mac_addr_82571
(
e1000_hw
 *
hw
)

1798 i‡(
hw
->
mac
.
ty≥
 =
e1000_82571
) {

1799 
s32
 
ªt_vÆ
;

1805 
ªt_vÆ
 = 
	`e1000_check_Æt_mac_addr_gíîic
(
hw
);

1806 i‡(
ªt_vÆ
)

1807  
ªt_vÆ
;

1810  
	`e1000_ªad_mac_addr_gíîic
(
hw
);

1811 
	}
}

1820 
	$e1000_powî_down_phy_c›≥r_82571
(
e1000_hw
 *
hw
)

1822 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1823 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1825 i‡(!
phy
->
›s
.
check_ª£t_block
)

1829 i‡(!(
mac
->
›s
.
	`check_mng_mode
(
hw
Ë|| 
phy
->›s.
	`check_ª£t_block
(hw)))

1830 
	`e1000_powî_down_phy_c›≥r
(
hw
);

1831 
	}
}

1839 
	$e1000_˛ór_hw_˙ås_82571
(
e1000_hw
 *
hw
)

1841 
	`e1000e_˛ór_hw_˙ås_ba£
(
hw
);

1843 
	`î32
(
PRC64
);

1844 
	`î32
(
PRC127
);

1845 
	`î32
(
PRC255
);

1846 
	`î32
(
PRC511
);

1847 
	`î32
(
PRC1023
);

1848 
	`î32
(
PRC1522
);

1849 
	`î32
(
PTC64
);

1850 
	`î32
(
PTC127
);

1851 
	`î32
(
PTC255
);

1852 
	`î32
(
PTC511
);

1853 
	`î32
(
PTC1023
);

1854 
	`î32
(
PTC1522
);

1856 
	`î32
(
ALGNERRC
);

1857 
	`î32
(
RXERRC
);

1858 
	`î32
(
TNCRS
);

1859 
	`î32
(
CEXTERR
);

1860 
	`î32
(
TSCTC
);

1861 
	`î32
(
TSCTFC
);

1863 
	`î32
(
MGTPRC
);

1864 
	`î32
(
MGTPDC
);

1865 
	`î32
(
MGTPTC
);

1867 
	`î32
(
IAC
);

1868 
	`î32
(
ICRXOC
);

1870 
	`î32
(
ICRXPTC
);

1871 
	`î32
(
ICRXATC
);

1872 
	`î32
(
ICTXPTC
);

1873 
	`î32
(
ICTXATC
);

1874 
	`î32
(
ICTXQEC
);

1875 
	`î32
(
ICTXQMTC
);

1876 
	`î32
(
ICRXDMTC
);

1877 
	}
}

1879 c⁄° 
e1000_mac_›î©i⁄s
 
	ge82571_mac_›s
 = {

1882 .
id_Àd_öô
 = 
e1000e_id_Àd_öô_gíîic
,

1883 .
	g˛ónup_Àd
 = 
e1000e_˛ónup_Àd_gíîic
,

1884 .
	g˛ór_hw_˙ås
 = 
e1000_˛ór_hw_˙ås_82571
,

1885 .
	ggë_bus_öfo
 = 
e1000e_gë_bus_öfo_pcõ
,

1886 .
	g£t_œn_id
 = 
e1000_£t_œn_id_mu…i_p‹t_pcõ
,

1889 .
	gÀd_off
 = 
e1000e_Àd_off_gíîic
,

1890 .
	gupd©e_mc_addr_li°
 = 
e1000e_upd©e_mc_addr_li°_gíîic
,

1891 .
	gwrôe_v·a
 = 
e1000_wrôe_v·a_gíîic
,

1892 .
	g˛ór_v·a
 = 
e1000_˛ór_v·a_82571
,

1893 .
	gª£t_hw
 = 
e1000_ª£t_hw_82571
,

1894 .
	göô_hw
 = 
e1000_öô_hw_82571
,

1895 .
	g£tup_lök
 = 
e1000_£tup_lök_82571
,

1897 .
	g£tup_Àd
 = 
e1000e_£tup_Àd_gíîic
,

1898 .
	gc⁄fig_cﬁlisi⁄_di°
 = 
e1000e_c⁄fig_cﬁlisi⁄_di°_gíîic
,

1899 .
	gªad_mac_addr
 = 
e1000_ªad_mac_addr_82571
,

1900 .
	gør_£t
 = 
e1000e_ør_£t_gíîic
,

1901 .
	gvÆid©e_mdi_£âög
 = 
e1000e_vÆid©e_mdi_£âög_gíîic
,

1904 c⁄° 
e1000_phy_›î©i⁄s
 
	ge82_phy_›s_igp
 = {

1905 .
acquúe
 = 
e1000_gë_hw_£m≠h‹e_82571
,

1906 .
	gcheck_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_igp
,

1907 .
	gcheck_ª£t_block
 = 
e1000e_check_ª£t_block_gíîic
,

1908 .
	gcommô
 = 
NULL
,

1909 .
	gf‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_igp
,

1910 .
	ggë_cfg_d⁄e
 = 
e1000_gë_cfg_d⁄e_82571
,

1911 .
	ggë_ˇbÀ_Àngth
 = 
e1000e_gë_ˇbÀ_Àngth_igp_2
,

1912 .
	ggë_öfo
 = 
e1000e_gë_phy_öfo_igp
,

1913 .
	gªad_ªg
 = 
e1000e_ªad_phy_ªg_igp
,

1914 .
	gªÀa£
 = 
e1000_put_hw_£m≠h‹e_82571
,

1915 .
	gª£t
 = 
e1000e_phy_hw_ª£t_gíîic
,

1916 .
	g£t_d0_Õlu_°©e
 = 
e1000_£t_d0_Õlu_°©e_82571
,

1917 .
	g£t_d3_Õlu_°©e
 = 
e1000e_£t_d3_Õlu_°©e
,

1918 .
	gwrôe_ªg
 = 
e1000e_wrôe_phy_ªg_igp
,

1919 .
	gcfg_⁄_lök_up
 = 
NULL
,

1922 c⁄° 
e1000_phy_›î©i⁄s
 
	ge82_phy_›s_m88
 = {

1923 .
acquúe
 = 
e1000_gë_hw_£m≠h‹e_82571
,

1924 .
	gcheck_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_m88
,

1925 .
	gcheck_ª£t_block
 = 
e1000e_check_ª£t_block_gíîic
,

1926 .
	gcommô
 = 
e1000e_phy_sw_ª£t
,

1927 .
	gf‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_m88
,

1928 .
	ggë_cfg_d⁄e
 = 
e1000e_gë_cfg_d⁄e_gíîic
,

1929 .
	ggë_ˇbÀ_Àngth
 = 
e1000e_gë_ˇbÀ_Àngth_m88
,

1930 .
	ggë_öfo
 = 
e1000e_gë_phy_öfo_m88
,

1931 .
	gªad_ªg
 = 
e1000e_ªad_phy_ªg_m88
,

1932 .
	gªÀa£
 = 
e1000_put_hw_£m≠h‹e_82571
,

1933 .
	gª£t
 = 
e1000e_phy_hw_ª£t_gíîic
,

1934 .
	g£t_d0_Õlu_°©e
 = 
e1000_£t_d0_Õlu_°©e_82571
,

1935 .
	g£t_d3_Õlu_°©e
 = 
e1000e_£t_d3_Õlu_°©e
,

1936 .
	gwrôe_ªg
 = 
e1000e_wrôe_phy_ªg_m88
,

1937 .
	gcfg_⁄_lök_up
 = 
NULL
,

1940 c⁄° 
e1000_phy_›î©i⁄s
 
	ge82_phy_›s_bm
 = {

1941 .
acquúe
 = 
e1000_gë_hw_£m≠h‹e_82571
,

1942 .
	gcheck_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_m88
,

1943 .
	gcheck_ª£t_block
 = 
e1000e_check_ª£t_block_gíîic
,

1944 .
	gcommô
 = 
e1000e_phy_sw_ª£t
,

1945 .
	gf‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_m88
,

1946 .
	ggë_cfg_d⁄e
 = 
e1000e_gë_cfg_d⁄e_gíîic
,

1947 .
	ggë_ˇbÀ_Àngth
 = 
e1000e_gë_ˇbÀ_Àngth_m88
,

1948 .
	ggë_öfo
 = 
e1000e_gë_phy_öfo_m88
,

1949 .
	gªad_ªg
 = 
e1000e_ªad_phy_ªg_bm2
,

1950 .
	gªÀa£
 = 
e1000_put_hw_£m≠h‹e_82571
,

1951 .
	gª£t
 = 
e1000e_phy_hw_ª£t_gíîic
,

1952 .
	g£t_d0_Õlu_°©e
 = 
e1000_£t_d0_Õlu_°©e_82571
,

1953 .
	g£t_d3_Õlu_°©e
 = 
e1000e_£t_d3_Õlu_°©e
,

1954 .
	gwrôe_ªg
 = 
e1000e_wrôe_phy_ªg_bm2
,

1955 .
	gcfg_⁄_lök_up
 = 
NULL
,

1958 c⁄° 
e1000_nvm_›î©i⁄s
 
	ge82571_nvm_›s
 = {

1959 .
acquúe
 = 
e1000_acquúe_nvm_82571
,

1960 .
	gªad
 = 
e1000e_ªad_nvm_ìrd
,

1961 .
	gªÀa£
 = 
e1000_ªÀa£_nvm_82571
,

1962 .
	gªlﬂd
 = 
e1000e_ªlﬂd_nvm_gíîic
,

1963 .
	gupd©e
 = 
e1000_upd©e_nvm_checksum_82571
,

1964 .
	gvÆid_Àd_deÁu…
 = 
e1000_vÆid_Àd_deÁu…_82571
,

1965 .
	gvÆid©e
 = 
e1000_vÆid©e_nvm_checksum_82571
,

1966 .
	gwrôe
 = 
e1000_wrôe_nvm_82571
,

1969 c⁄° 
e1000_öfo
 
	ge1000_82571_öfo
 = {

1970 .
mac
 = 
e1000_82571
,

1971 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


1972 | 
FLAG_HAS_JUMBO_FRAMES


1973 | 
FLAG_HAS_WOL


1974 | 
FLAG_APME_IN_CTRL3


1975 #i‚de‡
HAVE_NDO_SET_FEATURES


1976 | 
FLAG_RX_CSUM_ENABLED


1978 | 
FLAG_HAS_CTRLEXT_ON_LOAD


1979 | 
FLAG_HAS_SMART_POWER_DOWN


1980 | 
FLAG_RESET_OVERWRITES_LAA


1981 | 
FLAG_TARC_SPEED_MODE_BIT


1982 | 
FLAG_APME_CHECK_PORT_B
,

1983 .
	gÊags2
 = 
FLAG2_DISABLE_ASPM_L1


1984 | 
FLAG2_DMA_BURST
,

1985 .
	gpba
 = 38,

1986 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

1987 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_82571
,

1988 .
	gmac_›s
 = &
e82571_mac_›s
,

1989 .
	gphy_›s
 = &
e82_phy_›s_igp
,

1990 .
	gnvm_›s
 = &
e82571_nvm_›s
,

1993 c⁄° 
e1000_öfo
 
	ge1000_82572_öfo
 = {

1994 .
mac
 = 
e1000_82572
,

1995 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


1996 | 
FLAG_HAS_JUMBO_FRAMES


1997 | 
FLAG_HAS_WOL


1998 | 
FLAG_APME_IN_CTRL3


1999 #i‚de‡
HAVE_NDO_SET_FEATURES


2000 | 
FLAG_RX_CSUM_ENABLED


2002 | 
FLAG_HAS_CTRLEXT_ON_LOAD


2003 | 
FLAG_TARC_SPEED_MODE_BIT
,

2004 .
	gÊags2
 = 
FLAG2_DISABLE_ASPM_L1


2005 | 
FLAG2_DMA_BURST
,

2006 .
	gpba
 = 38,

2007 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

2008 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_82571
,

2009 .
	gmac_›s
 = &
e82571_mac_›s
,

2010 .
	gphy_›s
 = &
e82_phy_›s_igp
,

2011 .
	gnvm_›s
 = &
e82571_nvm_›s
,

2014 c⁄° 
e1000_öfo
 
	ge1000_82573_öfo
 = {

2015 .
mac
 = 
e1000_82573
,

2016 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


2017 | 
FLAG_HAS_WOL


2018 | 
FLAG_APME_IN_CTRL3


2019 #i‚de‡
HAVE_NDO_SET_FEATURES


2020 | 
FLAG_RX_CSUM_ENABLED


2022 | 
FLAG_HAS_SMART_POWER_DOWN


2023 | 
FLAG_HAS_AMT


2024 | 
FLAG_HAS_SWSM_ON_LOAD
,

2025 .
	gÊags2
 = 
FLAG2_DISABLE_ASPM_L1


2026 | 
FLAG2_DISABLE_ASPM_L0S
,

2027 .
	gpba
 = 20,

2028 .
	gmax_hw_‰ame_size
 = 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
,

2029 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_82571
,

2030 .
	gmac_›s
 = &
e82571_mac_›s
,

2031 .
	gphy_›s
 = &
e82_phy_›s_m88
,

2032 .
	gnvm_›s
 = &
e82571_nvm_›s
,

2035 c⁄° 
e1000_öfo
 
	ge1000_82574_öfo
 = {

2036 .
mac
 = 
e1000_82574
,

2037 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


2038 | 
FLAG_HAS_MSIX


2039 | 
FLAG_HAS_JUMBO_FRAMES


2040 | 
FLAG_HAS_WOL


2041 | 
FLAG_HAS_HW_TIMESTAMP


2042 | 
FLAG_APME_IN_CTRL3


2043 #i‚de‡
HAVE_NDO_SET_FEATURES


2044 | 
FLAG_RX_CSUM_ENABLED


2046 | 
FLAG_HAS_SMART_POWER_DOWN


2047 | 
FLAG_HAS_AMT


2048 | 
FLAG_HAS_CTRLEXT_ON_LOAD
,

2049 .
	gÊags2
 = 
FLAG2_CHECK_PHY_HANG


2050 | 
FLAG2_DISABLE_ASPM_L0S


2051 | 
FLAG2_DISABLE_ASPM_L1


2052 | 
FLAG2_NO_DISABLE_RX


2053 | 
FLAG2_DMA_BURST
,

2054 .
	gpba
 = 32,

2055 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

2056 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_82571
,

2057 .
	gmac_›s
 = &
e82571_mac_›s
,

2058 .
	gphy_›s
 = &
e82_phy_›s_bm
,

2059 .
	gnvm_›s
 = &
e82571_nvm_›s
,

2062 c⁄° 
e1000_öfo
 
	ge1000_82583_öfo
 = {

2063 .
mac
 = 
e1000_82583
,

2064 .
	gÊags
 = 
FLAG_HAS_HW_VLAN_FILTER


2065 | 
FLAG_HAS_WOL


2066 | 
FLAG_HAS_HW_TIMESTAMP


2067 | 
FLAG_APME_IN_CTRL3


2068 #i‚de‡
HAVE_NDO_SET_FEATURES


2069 | 
FLAG_RX_CSUM_ENABLED


2071 | 
FLAG_HAS_SMART_POWER_DOWN


2072 | 
FLAG_HAS_AMT


2073 | 
FLAG_HAS_JUMBO_FRAMES


2074 | 
FLAG_HAS_CTRLEXT_ON_LOAD
,

2075 .
	gÊags2
 = 
FLAG2_DISABLE_ASPM_L0S


2076 | 
FLAG2_DISABLE_ASPM_L1


2077 | 
FLAG2_NO_DISABLE_RX
,

2078 .
	gpba
 = 32,

2079 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

2080 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_82571
,

2081 .
	gmac_›s
 = &
e82571_mac_›s
,

2082 .
	gphy_›s
 = &
e82_phy_›s_bm
,

2083 .
	gnvm_›s
 = &
e82571_nvm_›s
,

	@82571.h

29 #i‚de‡
_E1000E_82571_H_


30 
	#_E1000E_82571_H_


	)

32 
	#ID_LED_RESERVED_F746
 0xF746

	)

33 
	#ID_LED_DEFAULT_82573
 ((
ID_LED_DEF1_DEF2
 << 12) | \

34 (
ID_LED_OFF1_ON2
 << 8) | \

35 (
ID_LED_DEF1_DEF2
 << 4) | \

36 (
ID_LED_DEF1_DEF2
))

	)

38 
	#E1000_GCR_L1_ACT_WITHOUT_L0S_RX
 0x08000000

	)

39 
	#AN_RETRY_COUNT
 5

	)

42 
	#E1000_EITR_82574
(
_n
Ë(0x000E8 + (0x4 * (_n)))

	)

44 
	#E1000_EIAC_82574
 0x000DC

	)

45 
	#E1000_EIAC_MASK_82574
 0x01F00000

	)

47 
	#E1000_IVAR_INT_ALLOC_VALID
 0x8

	)

50 
	#E1000_NVM_INIT_CTRL2_MNGM
 0x6000

	)

52 
	#E1000_BASE1000T_STATUS
 10

	)

53 
	#E1000_IDLE_ERROR_COUNT_MASK
 0xFF

	)

54 
	#E1000_RECEIVE_ERROR_COUNTER
 21

	)

55 
	#E1000_RECEIVE_ERROR_MAX
 0xFFFF

	)

56 
boﬁ
 
e1000_check_phy_82574
(
e1000_hw
 *
hw
);

57 
boﬁ
 
e1000e_gë_œa_°©e_82571
(
e1000_hw
 *
hw
);

58 
e1000e_£t_œa_°©e_82571
(
e1000_hw
 *
hw
, 
boﬁ
 
°©e
);

	@defines.h

29 #i‚de‡
_E1000E_DEFINES_H_


30 
	#_E1000E_DEFINES_H_


	)

33 
	#REQ_TX_DESCRIPTOR_MULTIPLE
 8

	)

34 
	#REQ_RX_DESCRIPTOR_MULTIPLE
 8

	)

38 
	#E1000_WUC_APME
 0x00000001

	)

39 
	#E1000_WUC_PME_EN
 0x00000002

	)

40 
	#E1000_WUC_PME_STATUS
 0x00000004

	)

41 
	#E1000_WUC_APMPME
 0x00000008

	)

42 
	#E1000_WUC_PHY_WAKE
 0x00000100

	)

45 
	#E1000_WUFC_LNKC
 0x00000001

	)

46 
	#E1000_WUFC_MAG
 0x00000002

	)

47 
	#E1000_WUFC_EX
 0x00000004

	)

48 
	#E1000_WUFC_MC
 0x00000008

	)

49 
	#E1000_WUFC_BC
 0x00000010

	)

50 
	#E1000_WUFC_ARP
 0x00000020

	)

53 
	#E1000_WUS_LNKC
 
E1000_WUFC_LNKC


	)

54 
	#E1000_WUS_MAG
 
E1000_WUFC_MAG


	)

55 
	#E1000_WUS_EX
 
E1000_WUFC_EX


	)

56 
	#E1000_WUS_MC
 
E1000_WUFC_MC


	)

57 
	#E1000_WUS_BC
 
E1000_WUFC_BC


	)

60 
	#E1000_CTRL_EXT_LPCD
 0x00000004

	)

61 
	#E1000_CTRL_EXT_SDP3_DATA
 0x00000080

	)

62 
	#E1000_CTRL_EXT_FORCE_SMBUS
 0x00000800

	)

63 
	#E1000_CTRL_EXT_EE_RST
 0x00002000

	)

64 
	#E1000_CTRL_EXT_SPD_BYPS
 0x00008000

	)

65 
	#E1000_CTRL_EXT_RO_DIS
 0x00020000

	)

66 
	#E1000_CTRL_EXT_DMA_DYN_CLK_EN
 0x00080000

	)

67 
	#E1000_CTRL_EXT_LINK_MODE_MASK
 0x00C00000

	)

68 
	#E1000_CTRL_EXT_LINK_MODE_PCIE_SERDES
 0x00C00000

	)

69 
	#E1000_CTRL_EXT_EIAME
 0x01000000

	)

70 
	#E1000_CTRL_EXT_DRV_LOAD
 0x10000000

	)

71 
	#E1000_CTRL_EXT_IAME
 0x08000000

	)

72 
	#E1000_CTRL_EXT_PBA_CLR
 0x80000000

	)

73 
	#E1000_CTRL_EXT_LSECCK
 0x00001000

	)

74 
	#E1000_CTRL_EXT_PHYPDEN
 0x00100000

	)

77 
	#E1000_RXD_STAT_DD
 0x01

	)

78 
	#E1000_RXD_STAT_EOP
 0x02

	)

79 
	#E1000_RXD_STAT_IXSM
 0x04

	)

80 
	#E1000_RXD_STAT_VP
 0x08

	)

81 
	#E1000_RXD_STAT_UDPCS
 0x10

	)

82 
	#E1000_RXD_STAT_TCPCS
 0x20

	)

83 
	#E1000_RXD_ERR_CE
 0x01

	)

84 
	#E1000_RXD_ERR_SE
 0x02

	)

85 
	#E1000_RXD_ERR_SEQ
 0x04

	)

86 
	#E1000_RXD_ERR_CXE
 0x10

	)

87 
	#E1000_RXD_ERR_TCPE
 0x20

	)

88 
	#E1000_RXD_ERR_IPE
 0x40

	)

89 
	#E1000_RXD_ERR_RXE
 0x80

	)

90 
	#E1000_RXD_SPC_VLAN_MASK
 0x0FFF

	)

92 
	#E1000_RXDEXT_STATERR_TST
 0x00000100

	)

93 
	#E1000_RXDEXT_STATERR_CE
 0x01000000

	)

94 
	#E1000_RXDEXT_STATERR_SE
 0x02000000

	)

95 
	#E1000_RXDEXT_STATERR_SEQ
 0x04000000

	)

96 
	#E1000_RXDEXT_STATERR_CXE
 0x10000000

	)

97 
	#E1000_RXDEXT_STATERR_RXE
 0x80000000

	)

100 
	#E1000_RXD_ERR_FRAME_ERR_MASK
 ( \

101 
E1000_RXD_ERR_CE
 | \

102 
E1000_RXD_ERR_SE
 | \

103 
E1000_RXD_ERR_SEQ
 | \

104 
E1000_RXD_ERR_CXE
 | \

105 
E1000_RXD_ERR_RXE
)

	)

108 
	#E1000_RXDEXT_ERR_FRAME_ERR_MASK
 ( \

109 
E1000_RXDEXT_STATERR_CE
 | \

110 
E1000_RXDEXT_STATERR_SE
 | \

111 
E1000_RXDEXT_STATERR_SEQ
 | \

112 
E1000_RXDEXT_STATERR_CXE
 | \

113 
E1000_RXDEXT_STATERR_RXE
)

	)

115 
	#E1000_MRQC_RSS_FIELD_MASK
 0xFFFF0000

	)

116 
	#E1000_MRQC_RSS_FIELD_IPV4_TCP
 0x00010000

	)

117 
	#E1000_MRQC_RSS_FIELD_IPV4
 0x00020000

	)

118 
	#E1000_MRQC_RSS_FIELD_IPV6_TCP_EX
 0x00040000

	)

119 
	#E1000_MRQC_RSS_FIELD_IPV6
 0x00100000

	)

120 
	#E1000_MRQC_RSS_FIELD_IPV6_TCP
 0x00200000

	)

122 
	#E1000_RXDPS_HDRSTAT_HDRSP
 0x00008000

	)

125 
	#E1000_MANC_SMBUS_EN
 0x00000001

	)

126 
	#E1000_MANC_ASF_EN
 0x00000002

	)

127 
	#E1000_MANC_ARP_EN
 0x00002000

	)

128 
	#E1000_MANC_RCV_TCO_EN
 0x00020000

	)

129 
	#E1000_MANC_BLK_PHY_RST_ON_IDE
 0x00040000

	)

131 
	#E1000_MANC_EN_MAC_ADDR_FILTER
 0x00100000

	)

133 
	#E1000_MANC_EN_MNG2HOST
 0x00200000

	)

135 
	#E1000_MANC2H_PORT_623
 0x00000020

	)

136 
	#E1000_MANC2H_PORT_664
 0x00000040

	)

137 
	#E1000_MDEF_PORT_623
 0x00000800

	)

138 
	#E1000_MDEF_PORT_664
 0x00000400

	)

141 
	#E1000_RCTL_EN
 0x00000002

	)

142 
	#E1000_RCTL_SBP
 0x00000004

	)

143 
	#E1000_RCTL_UPE
 0x00000008

	)

144 
	#E1000_RCTL_MPE
 0x00000010

	)

145 
	#E1000_RCTL_LPE
 0x00000020

	)

146 
	#E1000_RCTL_LBM_NO
 0x00000000

	)

147 
	#E1000_RCTL_LBM_MAC
 0x00000040

	)

148 
	#E1000_RCTL_LBM_TCVR
 0x000000C0

	)

149 
	#E1000_RCTL_DTYP_PS
 0x00000400

	)

150 
	#E1000_RCTL_RDMTS_HALF
 0x00000000

	)

151 
	#E1000_RCTL_MO_SHIFT
 12

	)

152 
	#E1000_RCTL_MO_3
 0x00003000

	)

153 
	#E1000_RCTL_BAM
 0x00008000

	)

155 
	#E1000_RCTL_SZ_2048
 0x00000000

	)

156 
	#E1000_RCTL_SZ_1024
 0x00010000

	)

157 
	#E1000_RCTL_SZ_512
 0x00020000

	)

158 
	#E1000_RCTL_SZ_256
 0x00030000

	)

160 
	#E1000_RCTL_SZ_16384
 0x00010000

	)

161 
	#E1000_RCTL_SZ_8192
 0x00020000

	)

162 
	#E1000_RCTL_SZ_4096
 0x00030000

	)

163 
	#E1000_RCTL_VFE
 0x00040000

	)

164 
	#E1000_RCTL_CFIEN
 0x00080000

	)

165 
	#E1000_RCTL_CFI
 0x00100000

	)

166 
	#E1000_RCTL_DPF
 0x00400000

	)

167 
	#E1000_RCTL_PMCF
 0x00800000

	)

168 
	#E1000_RCTL_BSEX
 0x02000000

	)

169 
	#E1000_RCTL_SECRC
 0x04000000

	)

187 
	#E1000_PSRCTL_BSIZE0_MASK
 0x0000007F

	)

188 
	#E1000_PSRCTL_BSIZE1_MASK
 0x00003F00

	)

189 
	#E1000_PSRCTL_BSIZE2_MASK
 0x003F0000

	)

190 
	#E1000_PSRCTL_BSIZE3_MASK
 0x3F000000

	)

192 
	#E1000_PSRCTL_BSIZE0_SHIFT
 7

	)

193 
	#E1000_PSRCTL_BSIZE1_SHIFT
 2

	)

194 
	#E1000_PSRCTL_BSIZE2_SHIFT
 6

	)

195 
	#E1000_PSRCTL_BSIZE3_SHIFT
 14

	)

198 
	#E1000_SWFW_EEP_SM
 0x01

	)

199 
	#E1000_SWFW_PHY0_SM
 0x02

	)

200 
	#E1000_SWFW_PHY1_SM
 0x04

	)

201 
	#E1000_SWFW_CSR_SM
 0x08

	)

204 
	#E1000_CTRL_FD
 0x00000001

	)

205 
	#E1000_CTRL_GIO_MASTER_DISABLE
 0x00000004

	)

206 
	#E1000_CTRL_LRST
 0x00000008

	)

207 
	#E1000_CTRL_ASDE
 0x00000020

	)

208 
	#E1000_CTRL_SLU
 0x00000040

	)

209 
	#E1000_CTRL_ILOS
 0x00000080

	)

210 
	#E1000_CTRL_SPD_SEL
 0x00000300

	)

211 
	#E1000_CTRL_SPD_10
 0x00000000

	)

212 
	#E1000_CTRL_SPD_100
 0x00000100

	)

213 
	#E1000_CTRL_SPD_1000
 0x00000200

	)

214 
	#E1000_CTRL_FRCSPD
 0x00000800

	)

215 
	#E1000_CTRL_FRCDPX
 0x00001000

	)

216 
	#E1000_CTRL_LANPHYPC_OVERRIDE
 0x00010000

	)

217 
	#E1000_CTRL_LANPHYPC_VALUE
 0x00020000

	)

218 
	#E1000_CTRL_MEHE
 0x00080000

	)

219 
	#E1000_CTRL_SWDPIN0
 0x00040000

	)

220 
	#E1000_CTRL_SWDPIN1
 0x00080000

	)

221 
	#E1000_CTRL_ADVD3WUC
 0x00100000

	)

222 
	#E1000_CTRL_EN_PHY_PWR_MGMT
 0x00200000

	)

223 
	#E1000_CTRL_SWDPIO0
 0x00400000

	)

224 
	#E1000_CTRL_RST
 0x04000000

	)

225 
	#E1000_CTRL_RFCE
 0x08000000

	)

226 
	#E1000_CTRL_TFCE
 0x10000000

	)

227 
	#E1000_CTRL_VME
 0x40000000

	)

228 
	#E1000_CTRL_PHY_RST
 0x80000000

	)

230 
	#E1000_PCS_LCTL_FORCE_FCTRL
 0x80

	)

232 
	#E1000_PCS_LSTS_AN_COMPLETE
 0x10000

	)

235 
	#E1000_STATUS_FD
 0x00000001

	)

236 
	#E1000_STATUS_LU
 0x00000002

	)

237 
	#E1000_STATUS_FUNC_MASK
 0x0000000C

	)

238 
	#E1000_STATUS_FUNC_SHIFT
 2

	)

239 
	#E1000_STATUS_FUNC_1
 0x00000004

	)

240 
	#E1000_STATUS_TXOFF
 0x00000010

	)

241 
	#E1000_STATUS_SPEED_MASK
 0x000000C0

	)

242 
	#E1000_STATUS_SPEED_10
 0x00000000

	)

243 
	#E1000_STATUS_SPEED_100
 0x00000040

	)

244 
	#E1000_STATUS_SPEED_1000
 0x00000080

	)

245 
	#E1000_STATUS_LAN_INIT_DONE
 0x00000200

	)

246 
	#E1000_STATUS_PHYRA
 0x00000400

	)

247 
	#E1000_STATUS_GIO_MASTER_ENABLE
 0x00080000

	)

249 
	#HALF_DUPLEX
 1

	)

250 
	#FULL_DUPLEX
 2

	)

252 
	#ADVERTISE_10_HALF
 0x0001

	)

253 
	#ADVERTISE_10_FULL
 0x0002

	)

254 
	#ADVERTISE_100_HALF
 0x0004

	)

255 
	#ADVERTISE_100_FULL
 0x0008

	)

256 
	#ADVERTISE_1000_HALF
 0x0010

	)

257 
	#ADVERTISE_1000_FULL
 0x0020

	)

260 
	#E1000_ALL_SPEED_DUPLEX
 ( \

261 
ADVERTISE_10_HALF
 | 
ADVERTISE_10_FULL
 | 
ADVERTISE_100_HALF
 | \

262 
ADVERTISE_100_FULL
 | 
ADVERTISE_1000_FULL
)

	)

263 
	#E1000_ALL_NOT_GIG
 ( \

264 
ADVERTISE_10_HALF
 | 
ADVERTISE_10_FULL
 | 
ADVERTISE_100_HALF
 | \

265 
ADVERTISE_100_FULL
)

	)

266 
	#E1000_ALL_100_SPEED
 (
ADVERTISE_100_HALF
 | 
ADVERTISE_100_FULL
)

	)

267 
	#E1000_ALL_10_SPEED
 (
ADVERTISE_10_HALF
 | 
ADVERTISE_10_FULL
)

	)

268 
	#E1000_ALL_HALF_DUPLEX
 (
ADVERTISE_10_HALF
 | 
ADVERTISE_100_HALF
)

	)

270 
	#AUTONEG_ADVERTISE_SPEED_DEFAULT
 
E1000_ALL_SPEED_DUPLEX


	)

273 
	#E1000_PHY_LED0_MODE_MASK
 0x00000007

	)

274 
	#E1000_PHY_LED0_IVRT
 0x00000008

	)

275 
	#E1000_PHY_LED0_MASK
 0x0000001F

	)

277 
	#E1000_LEDCTL_LED0_MODE_MASK
 0x0000000F

	)

278 
	#E1000_LEDCTL_LED0_MODE_SHIFT
 0

	)

279 
	#E1000_LEDCTL_LED0_IVRT
 0x00000040

	)

280 
	#E1000_LEDCTL_LED0_BLINK
 0x00000080

	)

282 
	#E1000_LEDCTL_MODE_LINK_UP
 0x2

	)

283 
	#E1000_LEDCTL_MODE_LED_ON
 0xE

	)

284 
	#E1000_LEDCTL_MODE_LED_OFF
 0xF

	)

287 
	#E1000_TXD_DTYP_D
 0x00100000

	)

288 
	#E1000_TXD_POPTS_IXSM
 0x01

	)

289 
	#E1000_TXD_POPTS_TXSM
 0x02

	)

290 
	#E1000_TXD_CMD_EOP
 0x01000000

	)

291 
	#E1000_TXD_CMD_IFCS
 0x02000000

	)

292 
	#E1000_TXD_CMD_IC
 0x04000000

	)

293 
	#E1000_TXD_CMD_RS
 0x08000000

	)

294 
	#E1000_TXD_CMD_RPS
 0x10000000

	)

295 
	#E1000_TXD_CMD_DEXT
 0x20000000

	)

296 
	#E1000_TXD_CMD_VLE
 0x40000000

	)

297 
	#E1000_TXD_CMD_IDE
 0x80000000

	)

298 
	#E1000_TXD_STAT_DD
 0x00000001

	)

299 
	#E1000_TXD_STAT_EC
 0x00000002

	)

300 
	#E1000_TXD_STAT_LC
 0x00000004

	)

301 
	#E1000_TXD_STAT_TU
 0x00000008

	)

302 
	#E1000_TXD_CMD_TCP
 0x01000000

	)

303 
	#E1000_TXD_CMD_IP
 0x02000000

	)

304 
	#E1000_TXD_CMD_TSE
 0x04000000

	)

305 
	#E1000_TXD_STAT_TC
 0x00000004

	)

306 
	#E1000_TXD_EXTCMD_TSTAMP
 0x00000010

	)

309 
	#E1000_TCTL_EN
 0x00000002

	)

310 
	#E1000_TCTL_PSP
 0x00000008

	)

311 
	#E1000_TCTL_CT
 0x00000ff0

	)

312 
	#E1000_TCTL_COLD
 0x003ff000

	)

313 
	#E1000_TCTL_RTLC
 0x01000000

	)

314 
	#E1000_TCTL_MULR
 0x10000000

	)

317 
	#E1000_SCTL_DISABLE_SERDES_LOOPBACK
 0x0400

	)

318 
	#E1000_SCTL_ENABLE_SERDES_LOOPBACK
 0x0410

	)

321 
	#E1000_RXCSUM_TUOFL
 0x00000200

	)

322 
	#E1000_RXCSUM_IPPCSE
 0x00001000

	)

323 
	#E1000_RXCSUM_PCSD
 0x00002000

	)

326 
	#E1000_RFCTL_NFSW_DIS
 0x00000040

	)

327 
	#E1000_RFCTL_NFSR_DIS
 0x00000080

	)

328 
	#E1000_RFCTL_ACK_DIS
 0x00001000

	)

329 
	#E1000_RFCTL_EXTEN
 0x00008000

	)

330 
	#E1000_RFCTL_IPV6_EX_DIS
 0x00010000

	)

331 
	#E1000_RFCTL_NEW_IPV6_EXT_DIS
 0x00020000

	)

334 
	#E1000_COLLISION_THRESHOLD
 15

	)

335 
	#E1000_CT_SHIFT
 4

	)

336 
	#E1000_COLLISION_DISTANCE
 63

	)

337 
	#E1000_COLD_SHIFT
 12

	)

340 
	#DEFAULT_82543_TIPG_IPGT_COPPER
 8

	)

342 
	#E1000_TIPG_IPGT_MASK
 0x000003FF

	)

344 
	#DEFAULT_82543_TIPG_IPGR1
 8

	)

345 
	#E1000_TIPG_IPGR1_SHIFT
 10

	)

347 
	#DEFAULT_82543_TIPG_IPGR2
 6

	)

348 
	#DEFAULT_80003ES2LAN_TIPG_IPGR2
 7

	)

349 
	#E1000_TIPG_IPGR2_SHIFT
 20

	)

351 
	#MAX_JUMBO_FRAME_SIZE
 0x3F00

	)

354 
	#E1000_EXTCNF_CTRL_MDIO_SW_OWNERSHIP
 0x00000020

	)

355 
	#E1000_EXTCNF_CTRL_LCD_WRITE_ENABLE
 0x00000001

	)

356 
	#E1000_EXTCNF_CTRL_OEM_WRITE_ENABLE
 0x00000008

	)

357 
	#E1000_EXTCNF_CTRL_SWFLAG
 0x00000020

	)

358 
	#E1000_EXTCNF_CTRL_GATE_PHY_CFG
 0x00000080

	)

359 
	#E1000_EXTCNF_SIZE_EXT_PCIE_LENGTH_MASK
 0x00FF0000

	)

360 
	#E1000_EXTCNF_SIZE_EXT_PCIE_LENGTH_SHIFT
 16

	)

361 
	#E1000_EXTCNF_CTRL_EXT_CNF_POINTER_MASK
 0x0FFF0000

	)

362 
	#E1000_EXTCNF_CTRL_EXT_CNF_POINTER_SHIFT
 16

	)

364 
	#E1000_PHY_CTRL_D0A_LPLU
 0x00000002

	)

365 
	#E1000_PHY_CTRL_NOND0A_LPLU
 0x00000004

	)

366 
	#E1000_PHY_CTRL_NOND0A_GBE_DISABLE
 0x00000008

	)

367 
	#E1000_PHY_CTRL_GBE_DISABLE
 0x00000040

	)

369 
	#E1000_KABGTXD_BGSQLBIAS
 0x00050000

	)

372 
	#E1000_LPIC_LPIET_SHIFT
 24

	)

375 
	#E1000_PBA_8K
 0x0008

	)

376 
	#E1000_PBA_16K
 0x0010

	)

378 
	#E1000_PBA_RXA_MASK
 0xFFFF

	)

380 
	#E1000_PBS_16K
 
E1000_PBA_16K


	)

383 
	#E1000_PBECCSTS_CORR_ERR_CNT_MASK
 0x000000FF

	)

384 
	#E1000_PBECCSTS_UNCORR_ERR_CNT_MASK
 0x0000FF00

	)

385 
	#E1000_PBECCSTS_UNCORR_ERR_CNT_SHIFT
 8

	)

386 
	#E1000_PBECCSTS_ECC_ENABLE
 0x00010000

	)

388 
	#IFS_MAX
 80

	)

389 
	#IFS_MIN
 40

	)

390 
	#IFS_RATIO
 4

	)

391 
	#IFS_STEP
 10

	)

392 
	#MIN_NUM_XMITS
 1000

	)

395 
	#E1000_SWSM_SMBI
 0x00000001

	)

396 
	#E1000_SWSM_SWESMBI
 0x00000002

	)

397 
	#E1000_SWSM_DRV_LOAD
 0x00000008

	)

399 
	#E1000_SWSM2_LOCK
 0x00000002

	)

402 
	#E1000_ICR_TXDW
 0x00000001

	)

403 
	#E1000_ICR_LSC
 0x00000004

	)

404 
	#E1000_ICR_RXSEQ
 0x00000008

	)

405 
	#E1000_ICR_RXDMT0
 0x00000010

	)

406 
	#E1000_ICR_RXT0
 0x00000080

	)

407 
	#E1000_ICR_ECCER
 0x00400000

	)

409 
	#E1000_ICR_INT_ASSERTED
 0x80000000

	)

410 
	#E1000_ICR_RXQ0
 0x00100000

	)

411 
	#E1000_ICR_RXQ1
 0x00200000

	)

412 
	#E1000_ICR_TXQ0
 0x00400000

	)

413 
	#E1000_ICR_TXQ1
 0x00800000

	)

414 
	#E1000_ICR_OTHER
 0x01000000

	)

417 
	#E1000_PBA_ECC_COUNTER_MASK
 0xFFF00000

	)

418 
	#E1000_PBA_ECC_COUNTER_SHIFT
 20

	)

419 
	#E1000_PBA_ECC_CORR_EN
 0x00000001

	)

420 
	#E1000_PBA_ECC_STAT_CLR
 0x00000002

	)

421 
	#E1000_PBA_ECC_INT_EN
 0x00000004

	)

431 
	#IMS_ENABLE_MASK
 ( \

432 
E1000_IMS_RXT0
 | \

433 
E1000_IMS_TXDW
 | \

434 
E1000_IMS_RXDMT0
 | \

435 
E1000_IMS_RXSEQ
 | \

436 
E1000_IMS_LSC
)

	)

439 
	#E1000_IMS_TXDW
 
E1000_ICR_TXDW


	)

440 
	#E1000_IMS_LSC
 
E1000_ICR_LSC


	)

441 
	#E1000_IMS_RXSEQ
 
E1000_ICR_RXSEQ


	)

442 
	#E1000_IMS_RXDMT0
 
E1000_ICR_RXDMT0


	)

443 
	#E1000_IMS_RXT0
 
E1000_ICR_RXT0


	)

444 
	#E1000_IMS_ECCER
 
E1000_ICR_ECCER


	)

445 
	#E1000_IMS_RXQ0
 
E1000_ICR_RXQ0


	)

446 
	#E1000_IMS_RXQ1
 
E1000_ICR_RXQ1


	)

447 
	#E1000_IMS_TXQ0
 
E1000_ICR_TXQ0


	)

448 
	#E1000_IMS_TXQ1
 
E1000_ICR_TXQ1


	)

449 
	#E1000_IMS_OTHER
 
E1000_ICR_OTHER


	)

452 
	#E1000_ICS_LSC
 
E1000_ICR_LSC


	)

453 
	#E1000_ICS_RXSEQ
 
E1000_ICR_RXSEQ


	)

454 
	#E1000_ICS_RXDMT0
 
E1000_ICR_RXDMT0


	)

457 
	#E1000_TXDCTL_PTHRESH
 0x0000003F

	)

458 
	#E1000_TXDCTL_HTHRESH
 0x00003F00

	)

459 
	#E1000_TXDCTL_WTHRESH
 0x003F0000

	)

460 
	#E1000_TXDCTL_GRAN
 0x01000000

	)

461 
	#E1000_TXDCTL_FULL_TX_DESC_WB
 0x01010000

	)

462 
	#E1000_TXDCTL_MAX_TX_DESC_PREFETCH
 0x0100001F

	)

464 
	#E1000_TXDCTL_COUNT_DESC
 0x00400000

	)

467 
	#FLOW_CONTROL_ADDRESS_LOW
 0x00C28001

	)

468 
	#FLOW_CONTROL_ADDRESS_HIGH
 0x00000100

	)

469 
	#FLOW_CONTROL_TYPE
 0x8808

	)

472 
	#E1000_VLAN_FILTER_TBL_SIZE
 128

	)

481 
	#E1000_RAR_ENTRIES
 15

	)

482 
	#E1000_RAH_AV
 0x80000000

	)

483 
	#E1000_RAL_MAC_ADDR_LEN
 4

	)

484 
	#E1000_RAH_MAC_ADDR_LEN
 2

	)

487 
	#E1000_ERR_NVM
 1

	)

488 
	#E1000_ERR_PHY
 2

	)

489 
	#E1000_ERR_CONFIG
 3

	)

490 
	#E1000_ERR_PARAM
 4

	)

491 
	#E1000_ERR_MAC_INIT
 5

	)

492 
	#E1000_ERR_PHY_TYPE
 6

	)

493 
	#E1000_ERR_RESET
 9

	)

494 
	#E1000_ERR_MASTER_REQUESTS_PENDING
 10

	)

495 
	#E1000_ERR_HOST_INTERFACE_COMMAND
 11

	)

496 
	#E1000_BLK_PHY_RESET
 12

	)

497 
	#E1000_ERR_SWFW_SYNC
 13

	)

498 
	#E1000_NOT_IMPLEMENTED
 14

	)

499 
	#E1000_ERR_INVALID_ARGUMENT
 16

	)

500 
	#E1000_ERR_NO_SPACE
 17

	)

501 
	#E1000_ERR_NVM_PBA_SECTION
 18

	)

504 
	#FIBER_LINK_UP_LIMIT
 50

	)

505 
	#COPPER_LINK_UP_LIMIT
 10

	)

506 
	#PHY_AUTO_NEG_LIMIT
 45

	)

507 
	#PHY_FORCE_LIMIT
 20

	)

509 
	#MASTER_DISABLE_TIMEOUT
 800

	)

511 
	#PHY_CFG_TIMEOUT
 100

	)

513 
	#MDIO_OWNERSHIP_TIMEOUT
 10

	)

515 
	#AUTO_READ_DONE_TIMEOUT
 10

	)

518 
	#E1000_FCRTH_RTH
 0x0000FFF8

	)

519 
	#E1000_FCRTL_RTL
 0x0000FFF8

	)

520 
	#E1000_FCRTL_XONE
 0x80000000

	)

523 
	#E1000_TXCW_FD
 0x00000020

	)

524 
	#E1000_TXCW_PAUSE
 0x00000080

	)

525 
	#E1000_TXCW_ASM_DIR
 0x00000100

	)

526 
	#E1000_TXCW_PAUSE_MASK
 0x00000180

	)

527 
	#E1000_TXCW_ANE
 0x80000000

	)

530 
	#E1000_RXCW_CW
 0x0000fff‡

	)

531 
	#E1000_RXCW_IV
 0x08000000

	)

532 
	#E1000_RXCW_C
 0x20000000

	)

533 
	#E1000_RXCW_SYNCH
 0x40000000

	)

535 
	#E1000_TSYNCTXCTL_VALID
 0x00000001

	)

536 
	#E1000_TSYNCTXCTL_ENABLED
 0x00000010

	)

538 
	#E1000_TSYNCRXCTL_VALID
 0x00000001

	)

539 
	#E1000_TSYNCRXCTL_TYPE_MASK
 0x0000000E

	)

540 
	#E1000_TSYNCRXCTL_TYPE_L2_V2
 0x00

	)

541 
	#E1000_TSYNCRXCTL_TYPE_L4_V1
 0x02

	)

542 
	#E1000_TSYNCRXCTL_TYPE_L2_L4_V2
 0x04

	)

543 
	#E1000_TSYNCRXCTL_TYPE_ALL
 0x08

	)

544 
	#E1000_TSYNCRXCTL_TYPE_EVENT_V2
 0x0A

	)

545 
	#E1000_TSYNCRXCTL_ENABLED
 0x00000010

	)

546 
	#E1000_TSYNCRXCTL_SYSCFI
 0x00000020

	)

548 
	#E1000_RXMTRL_PTP_V1_SYNC_MESSAGE
 0x00000000

	)

549 
	#E1000_RXMTRL_PTP_V1_DELAY_REQ_MESSAGE
 0x00010000

	)

551 
	#E1000_RXMTRL_PTP_V2_SYNC_MESSAGE
 0x00000000

	)

552 
	#E1000_RXMTRL_PTP_V2_DELAY_REQ_MESSAGE
 0x01000000

	)

554 
	#E1000_TIMINCA_INCPERIOD_SHIFT
 24

	)

555 
	#E1000_TIMINCA_INCVALUE_MASK
 0x00FFFFFF

	)

558 
	#E1000_GCR_RXD_NO_SNOOP
 0x00000001

	)

559 
	#E1000_GCR_RXDSCW_NO_SNOOP
 0x00000002

	)

560 
	#E1000_GCR_RXDSCR_NO_SNOOP
 0x00000004

	)

561 
	#E1000_GCR_TXD_NO_SNOOP
 0x00000008

	)

562 
	#E1000_GCR_TXDSCW_NO_SNOOP
 0x00000010

	)

563 
	#E1000_GCR_TXDSCR_NO_SNOOP
 0x00000020

	)

565 
	#PCIE_NO_SNOOP_ALL
 (
E1000_GCR_RXD_NO_SNOOP
 | \

566 
E1000_GCR_RXDSCW_NO_SNOOP
 | \

567 
E1000_GCR_RXDSCR_NO_SNOOP
 | \

568 
E1000_GCR_TXD_NO_SNOOP
 | \

569 
E1000_GCR_TXDSCW_NO_SNOOP
 | \

570 
E1000_GCR_TXDSCR_NO_SNOOP
)

	)

573 
	#E1000_EECD_SK
 0x00000001

	)

574 
	#E1000_EECD_CS
 0x00000002

	)

575 
	#E1000_EECD_DI
 0x00000004

	)

576 
	#E1000_EECD_DO
 0x00000008

	)

577 
	#E1000_EECD_REQ
 0x00000040

	)

578 
	#E1000_EECD_GNT
 0x00000080

	)

579 
	#E1000_EECD_PRES
 0x00000100

	)

580 
	#E1000_EECD_SIZE
 0x00000200

	)

582 
	#E1000_EECD_ADDR_BITS
 0x00000400

	)

583 
	#E1000_NVM_GRANT_ATTEMPTS
 1000

	)

584 
	#E1000_EECD_AUTO_RD
 0x00000200

	)

585 
	#E1000_EECD_SIZE_EX_MASK
 0x00007800

	)

586 
	#E1000_EECD_SIZE_EX_SHIFT
 11

	)

587 
	#E1000_EECD_FLUPD
 0x00080000

	)

588 
	#E1000_EECD_AUPDEN
 0x00100000

	)

589 
	#E1000_EECD_SEC1VAL
 0x00400000

	)

590 
	#E1000_EECD_SEC1VAL_VALID_MASK
 (
E1000_EECD_AUTO_RD
 | 
E1000_EECD_PRES
)

	)

592 
	#E1000_NVM_RW_REG_DATA
 16

	)

593 
	#E1000_NVM_RW_REG_DONE
 2

	)

594 
	#E1000_NVM_RW_REG_START
 1

	)

595 
	#E1000_NVM_RW_ADDR_SHIFT
 2

	)

596 
	#E1000_NVM_POLL_WRITE
 1

	)

597 
	#E1000_NVM_POLL_READ
 0

	)

598 
	#E1000_FLASH_UPDATES
 2000

	)

601 
	#NVM_COMPAT
 0x0003

	)

602 
	#NVM_ID_LED_SETTINGS
 0x0004

	)

603 
	#NVM_FUTURE_INIT_WORD1
 0x0019

	)

604 
	#NVM_COMPAT_VALID_CSUM
 0x0001

	)

605 
	#NVM_FUTURE_INIT_WORD1_VALID_CSUM
 0x0040

	)

607 
	#NVM_INIT_CONTROL2_REG
 0x000F

	)

608 
	#NVM_INIT_CONTROL3_PORT_B
 0x0014

	)

609 
	#NVM_INIT_3GIO_3
 0x001A

	)

610 
	#NVM_INIT_CONTROL3_PORT_A
 0x0024

	)

611 
	#NVM_CFG
 0x0012

	)

612 
	#NVM_ALT_MAC_ADDR_PTR
 0x0037

	)

613 
	#NVM_CHECKSUM_REG
 0x003F

	)

615 
	#E1000_NVM_CFG_DONE_PORT_0
 0x040000

	)

616 
	#E1000_NVM_CFG_DONE_PORT_1
 0x080000

	)

619 
	#NVM_WORD0F_PAUSE_MASK
 0x3000

	)

620 
	#NVM_WORD0F_PAUSE
 0x1000

	)

621 
	#NVM_WORD0F_ASM_DIR
 0x2000

	)

624 
	#NVM_WORD1A_ASPM_MASK
 0x000C

	)

627 
	#NVM_COMPAT_LOM
 0x0800

	)

630 
	#E1000_PBANUM_LENGTH
 11

	)

633 
	#NVM_SUM
 0xBABA

	)

636 
	#NVM_PBA_OFFSET_0
 8

	)

637 
	#NVM_PBA_OFFSET_1
 9

	)

638 
	#NVM_PBA_PTR_GUARD
 0xFAFA

	)

639 
	#NVM_WORD_SIZE_BASE_SHIFT
 6

	)

642 
	#NVM_MAX_RETRY_SPI
 5000

	)

643 
	#NVM_READ_OPCODE_SPI
 0x03

	)

644 
	#NVM_WRITE_OPCODE_SPI
 0x02

	)

645 
	#NVM_A8_OPCODE_SPI
 0x08

	)

646 
	#NVM_WREN_OPCODE_SPI
 0x06

	)

647 
	#NVM_RDSR_OPCODE_SPI
 0x05

	)

650 
	#NVM_STATUS_RDY_SPI
 0x01

	)

653 
	#ID_LED_RESERVED_0000
 0x0000

	)

654 
	#ID_LED_RESERVED_FFFF
 0xFFFF

	)

655 
	#ID_LED_DEFAULT
 ((
ID_LED_OFF1_ON2
 << 12) | \

656 (
ID_LED_OFF1_OFF2
 << 8) | \

657 (
ID_LED_DEF1_DEF2
 << 4) | \

658 (
ID_LED_DEF1_DEF2
))

	)

659 
	#ID_LED_DEF1_DEF2
 0x1

	)

660 
	#ID_LED_DEF1_ON2
 0x2

	)

661 
	#ID_LED_DEF1_OFF2
 0x3

	)

662 
	#ID_LED_ON1_DEF2
 0x4

	)

663 
	#ID_LED_ON1_ON2
 0x5

	)

664 
	#ID_LED_ON1_OFF2
 0x6

	)

665 
	#ID_LED_OFF1_DEF2
 0x7

	)

666 
	#ID_LED_OFF1_ON2
 0x8

	)

667 
	#ID_LED_OFF1_OFF2
 0x9

	)

669 
	#IGP_ACTIVITY_LED_MASK
 0xFFFFF0FF

	)

670 
	#IGP_ACTIVITY_LED_ENABLE
 0x0300

	)

671 
	#IGP_LED3_MODE
 0x07000000

	)

674 
	#PCI_HEADER_TYPE_REGISTER
 0x0E

	)

675 
	#PCIE_LINK_STATUS
 0x12

	)

677 
	#PCI_HEADER_TYPE_MULTIFUNC
 0x80

	)

678 
	#PCIE_LINK_WIDTH_MASK
 0x3F0

	)

679 
	#PCIE_LINK_WIDTH_SHIFT
 4

	)

681 
	#PHY_REVISION_MASK
 0xFFFFFFF0

	)

682 
	#MAX_PHY_REG_ADDRESS
 0x1F

	)

683 
	#MAX_PHY_MULTI_PAGE_REG
 0xF

	)

689 
	#M88E1000_E_PHY_ID
 0x01410C50

	)

690 
	#M88E1000_I_PHY_ID
 0x01410C30

	)

691 
	#M88E1011_I_PHY_ID
 0x01410C20

	)

692 
	#IGP01E1000_I_PHY_ID
 0x02A80380

	)

693 
	#M88E1111_I_PHY_ID
 0x01410CC0

	)

694 
	#GG82563_E_PHY_ID
 0x01410CA0

	)

695 
	#IGP03E1000_E_PHY_ID
 0x02A80390

	)

696 
	#IFE_E_PHY_ID
 0x02A80330

	)

697 
	#IFE_PLUS_E_PHY_ID
 0x02A80320

	)

698 
	#IFE_C_E_PHY_ID
 0x02A80310

	)

699 
	#BME1000_E_PHY_ID
 0x01410CB0

	)

700 
	#BME1000_E_PHY_ID_R2
 0x01410CB1

	)

701 
	#I82577_E_PHY_ID
 0x01540050

	)

702 
	#I82578_E_PHY_ID
 0x004DD040

	)

703 
	#I82579_E_PHY_ID
 0x01540090

	)

704 
	#I217_E_PHY_ID
 0x015400A0

	)

707 
	#M88E1000_PHY_SPEC_CTRL
 0x10

	)

708 
	#M88E1000_PHY_SPEC_STATUS
 0x11

	)

709 
	#M88E1000_EXT_PHY_SPEC_CTRL
 0x14

	)

711 
	#M88E1000_PHY_PAGE_SELECT
 0x1D

	)

712 
	#M88E1000_PHY_GEN_CONTROL
 0x1E

	)

715 
	#M88E1000_PSCR_POLARITY_REVERSAL
 0x0002

	)

717 
	#M88E1000_PSCR_MDI_MANUAL_MODE
 0x0000

	)

718 
	#M88E1000_PSCR_MDIX_MANUAL_MODE
 0x0020

	)

720 
	#M88E1000_PSCR_AUTO_X_1000T
 0x0040

	)

722 
	#M88E1000_PSCR_AUTO_X_MODE
 0x0060

	)

723 
	#M88E1000_PSCR_ASSERT_CRS_ON_TX
 0x0800

	)

726 
	#M88E1000_PSSR_REV_POLARITY
 0x0002

	)

727 
	#M88E1000_PSSR_DOWNSHIFT
 0x0020

	)

728 
	#M88E1000_PSSR_MDIX
 0x0040

	)

735 
	#M88E1000_PSSR_CABLE_LENGTH
 0x0380

	)

736 
	#M88E1000_PSSR_SPEED
 0xC000

	)

737 
	#M88E1000_PSSR_1000MBS
 0x8000

	)

739 
	#M88E1000_PSSR_CABLE_LENGTH_SHIFT
 7

	)

744 
	#M88E1000_EPSCR_MASTER_DOWNSHIFT_MASK
 0x0C00

	)

745 
	#M88E1000_EPSCR_MASTER_DOWNSHIFT_1X
 0x0000

	)

749 
	#M88E1000_EPSCR_SLAVE_DOWNSHIFT_MASK
 0x0300

	)

750 
	#M88E1000_EPSCR_SLAVE_DOWNSHIFT_1X
 0x0100

	)

751 
	#M88E1000_EPSCR_TX_CLK_25
 0x0070

	)

754 
	#M88EC018_EPSCR_DOWNSHIFT_COUNTER_MASK
 0x0E00

	)

755 
	#M88EC018_EPSCR_DOWNSHIFT_COUNTER_5X
 0x0800

	)

757 
	#I82578_EPSCR_DOWNSHIFT_ENABLE
 0x0020

	)

758 
	#I82578_EPSCR_DOWNSHIFT_COUNTER_MASK
 0x001C

	)

761 
	#BME1000_PSCR_ENABLE_DOWNSHIFT
 0x0800

	)

767 
	#GG82563_PAGE_SHIFT
 5

	)

768 
	#GG82563_REG
(
∑ge
, 
ªg
) \

769 (((
∑ge
Ë<< 
GG82563_PAGE_SHIFT
Ë| ((
ªg
Ë& 
MAX_PHY_REG_ADDRESS
))

	)

770 
	#GG82563_MIN_ALT_REG
 30

	)

773 
	#GG82563_PHY_SPEC_CTRL
 
	`GG82563_REG
(0, 16Ë

	)

774 
	#GG82563_PHY_PAGE_SELECT
 
	`GG82563_REG
(0, 22Ë

	)

775 
	#GG82563_PHY_SPEC_CTRL_2
 
	`GG82563_REG
(0, 26Ë

	)

776 
	#GG82563_PHY_PAGE_SELECT_ALT
 
	`GG82563_REG
(0, 29Ë

	)

779 
	#GG82563_PHY_MAC_SPEC_CTRL
 
	`GG82563_REG
(2, 21)

	)

781 
	#GG82563_PHY_DSP_DISTANCE
 
	`GG82563_REG
(5, 26Ë

	)

785 
	#GG82563_PHY_KMRN_MODE_CTRL
 
	`GG82563_REG
(193, 16)

	)

786 
	#GG82563_PHY_PWR_MGMT_CTRL
 
	`GG82563_REG
(193, 20Ë

	)

789 
	#GG82563_PHY_INBAND_CTRL
 
	`GG82563_REG
(194, 18Ë

	)

792 
	#E1000_MDIC_REG_MASK
 0x001F0000

	)

793 
	#E1000_MDIC_REG_SHIFT
 16

	)

794 
	#E1000_MDIC_PHY_SHIFT
 21

	)

795 
	#E1000_MDIC_OP_WRITE
 0x04000000

	)

796 
	#E1000_MDIC_OP_READ
 0x08000000

	)

797 
	#E1000_MDIC_READY
 0x10000000

	)

798 
	#E1000_MDIC_ERROR
 0x40000000

	)

801 
	#E1000_GEN_POLL_TIMEOUT
 640

	)

	@e1000.h

31 #i‚de‡
_E1000_H_


32 
	#_E1000_H_


	)

34 
	~<löux/bô›s.h
>

35 
	~<löux/ty≥s.h
>

36 
	~<löux/√tdevi˚.h
>

37 
	~<löux/pci.h
>

38 
	~<löux/if_vœn.h
>

39 
	~"kcom∑t.h
"

40 #ifde‡
HAVE_HW_TIME_STAMP


41 
	~<löux/˛ocksour˚.h
>

42 
	~<löux/√t_t°amp.h
>

44 #ifde‡
HAVE_PTP_1588_CLOCK


45 
	~<löux/±p_˛ock_kî√l.h
>

46 
	~<löux/±p_˛assify.h
>

48 
	~<löux/mii.h
>

49 #ifde‡
ETHTOOL_GEEE


50 
	~<löux/mdio.h
>

52 
	~"hw.h
"

54 
	ge1000_öfo
;

56 
	#e_dbg
(
f‹m©
, 
¨g
...) \

57 
	`√tdev_dbg
(
hw
->
ad≠ãr
->
√tdev
, 
f‹m©
, ## 
¨g
)

	)

58 
	#e_îr
(
f‹m©
, 
¨g
...) \

59 
	`√tdev_îr
(
ad≠ãr
->
√tdev
, 
f‹m©
, ## 
¨g
)

	)

60 
	#e_öfo
(
f‹m©
, 
¨g
...) \

61 
	`√tdev_öfo
(
ad≠ãr
->
√tdev
, 
f‹m©
, ## 
¨g
)

	)

62 
	#e_w¨n
(
f‹m©
, 
¨g
...) \

63 
	`√tdev_w¨n
(
ad≠ãr
->
√tdev
, 
f‹m©
, ## 
¨g
)

	)

64 
	#e_nŸi˚
(
f‹m©
, 
¨g
...) \

65 
	`√tdev_nŸi˚
(
ad≠ãr
->
√tdev
, 
f‹m©
, ## 
¨g
)

	)

68 
	#E1000E_INT_MODE_LEGACY
 0

	)

69 
	#E1000E_INT_MODE_MSI
 1

	)

70 
	#E1000E_INT_MODE_MSIX
 2

	)

72 #i‚de‡
CONFIG_E1000E_NAPI


73 
	#E1000_MAX_INTR
 10

	)

77 
	#E1000_DEFAULT_TXD
 256

	)

78 
	#E1000_MAX_TXD
 4096

	)

79 
	#E1000_MIN_TXD
 64

	)

81 
	#E1000_DEFAULT_RXD
 256

	)

82 
	#E1000_MAX_RXD
 4096

	)

83 
	#E1000_MIN_RXD
 64

	)

85 
	#E1000_MIN_ITR_USECS
 10

	)

86 
	#E1000_MAX_ITR_USECS
 10000

	)

88 
	#E1000_FC_PAUSE_TIME
 0x0680

	)

92 
	#E1000_RX_BUFFER_WRITE
 16

	)

94 
	#AUTO_ALL_MODES
 0

	)

95 
	#E1000_EEPROM_APME
 0x0400

	)

97 
	#E1000_MNG_VLAN_NONE
 (-1)

	)

100 
	#PS_PAGE_BUFFERS
 (
MAX_PS_BUFFERS
 - 1)

	)

102 
	#DEFAULT_JUMBO
 9234

	)

105 
	#LINK_TIMEOUT
 100

	)

110 
	#E1000_CHECK_RESET_COUNT
 25

	)

112 
	#DEFAULT_RDTR
 0

	)

113 
	#DEFAULT_RADV
 8

	)

114 
	#BURST_RDTR
 0x20

	)

115 
	#BURST_RADV
 0x20

	)

122 
	#E1000_TXDCTL_DMA_BURST_ENABLE
 \

123 (
E1000_TXDCTL_GRAN
 | \

124 
E1000_TXDCTL_COUNT_DESC
 | \

127 0x1fË

	)

129 
	#E1000_RXDCTL_DMA_BURST_ENABLE
 \

133 0x20Ë

	)

135 
	#E1000_TIDV_FPD
 (1 << 31)

	)

136 
	#E1000_RDTR_FPD
 (1 << 31)

	)

138 
	ee1000_bﬂrds
 {

139 
	mbﬂrd_82571
,

140 
	mbﬂrd_82572
,

141 
	mbﬂrd_82573
,

142 
	mbﬂrd_82574
,

143 
	mbﬂrd_82583
,

144 
	mbﬂrd_80003es2œn
,

145 
	mbﬂrd_ich8œn
,

146 
	mbﬂrd_ich9œn
,

147 
	mbﬂrd_ich10œn
,

148 
	mbﬂrd_pchœn
,

149 
	mbﬂrd_pch2œn
,

150 
	mbﬂrd_pch_Õt
,

153 
	se1000_ps_∑ge
 {

154 
∑ge
 *
	m∑ge
;

155 
u64
 
	mdma
;

161 
	se1000_buf„r
 {

162 
dma_addr_t
 
	mdma
;

163 
sk_buff
 *
	mskb
;

167 
	mtime_°amp
;

168 
u16
 
	mÀngth
;

169 
u16
 
	m√xt_to_w©ch
;

170 
	m£gs
;

171 
	mbyãcou¡
;

172 
u16
 
	mm≠≥d_as_∑ge
;

177 
e1000_ps_∑ge
 *
	mps_∑ges
;

178 
∑ge
 *
	m∑ge
;

183 
	se1000_rög
 {

184 
e1000_ad≠ãr
 *
	mad≠ãr
;

185 *
	mdesc
;

186 
dma_addr_t
 
	mdma
;

187 
	msize
;

188 
	mcou¡
;

190 
u16
 
	m√xt_to_u£
;

191 
u16
 
	m√xt_to_˛ón
;

193 
__iomem
 *
	mhód
;

194 
__iomem
 *
	mèû
;

197 
e1000_buf„r
 *
	mbuf„r_öfo
;

199 
	m«me
[
IFNAMSIZ
 + 5];

200 
u32
 
	mims_vÆ
;

201 
u32
 
	môr_vÆ
;

202 
__iomem
 *
	môr_ªgi°î
;

203 
	m£t_ôr
;

205 
sk_buff
 *
	mrx_skb_t›
;

208 #ifde‡
SIOCGMIIPHY


210 
	se1000_phy_ªgs
 {

211 
u16
 
	mbm¸
;

212 
u16
 
	mbm§
;

213 
u16
 
	madvîti£
;

214 
u16
 
	mÕa
;

215 
u16
 
	mex∑nsi⁄
;

216 
u16
 
	m˘æ1000
;

217 
u16
 
	m°©1000
;

218 
u16
 
	me°©us
;

223 
	se1000_ad≠ãr
 {

224 
timî_li°
 
	mw©chdog_timî
;

225 
timî_li°
 
	mphy_öfo_timî
;

226 
timî_li°
 
	mblök_timî
;

228 
w‹k_°ru˘
 
	mª£t_èsk
;

229 
w‹k_°ru˘
 
	mw©chdog_èsk
;

231 c⁄° 
e1000_öfo
 *
	mei
;

233 #ifde‡
HAVE_VLAN_RX_REGISTER


234 
vœn_group
 *
	mvlgΩ
;

236 
	ma˘ive_vœns
[
BITS_TO_LONGS
(
VLAN_N_VID
)];

238 
u32
 
	mbd_numbî
;

239 
u32
 
	mrx_buf„r_Àn
;

240 
u16
 
	mmng_vœn_id
;

241 
u16
 
	mlök_•ìd
;

242 
u16
 
	mlök_du∂ex
;

243 
u16
 
	mì¥om_vîs
;

246 
	m°©e
;

249 
u32
 
	môr
;

250 
u32
 
	môr_£âög
;

251 
u16
 
	mtx_ôr
;

252 
u16
 
	mrx_ôr
;

255 
e1000_rög
 *
tx_rög
 
	m____ˇchñöe_Æig√d_ö_smp
;

256 
u32
 
	mtx_fifo_limô
;

258 #ifde‡
CONFIG_E1000E_NAPI


259 
«pi_°ru˘
 
	m«pi
;

262 
	munc‹r_îr‹s
;

263 
	mc‹r_îr‹s
;

264 
	mª°¨t_queue
;

265 
u32
 
	mtxd_cmd
;

267 
boﬁ
 
	mdëe˘_tx_hung
;

268 
boﬁ
 
	mtx_h™g_ªcheck
;

269 
u8
 
	mtx_timeout_Á˘‹
;

271 
u32
 
	mtx_öt_dñay
;

272 
u32
 
	mtx_abs_öt_dñay
;

274 
	mtŸÆ_tx_byãs
;

275 
	mtŸÆ_tx_∑ckës
;

276 
	mtŸÆ_rx_byãs
;

277 
	mtŸÆ_rx_∑ckës
;

280 
u64
 
	mçt_ﬁd
;

281 
u64
 
	mcﬁc_ﬁd
;

282 
u32
 
	mgŸc
;

283 
u64
 
	mgŸc_ﬁd
;

284 
u32
 
	mtx_timeout_cou¡
;

285 
u32
 
	mtx_fifo_hód
;

286 
u32
 
	mtx_hód_addr
;

287 
u32
 
	mtx_fifo_size
;

288 
u32
 
	mtx_dma_Áûed
;

291 #ifde‡
CONFIG_E1000E_NAPI


292 
boﬁ
 (*
˛ón_rx
Ë(
e1000_rög
 *
	mrög
, *
	mw‹k_d⁄e
,

293 
	mw‹k_to_do
Ë
	m____ˇchñöe_Æig√d_ö_smp
;

295 
boﬁ
 (*
˛ón_rx
Ë(
e1000_rög
 *
	mrög
Ë
	m____ˇchñöe_Æig√d_ö_smp
;

297 (*
	mÆloc_rx_buf
Ë(
e1000_rög
 *
	mrög
, 
	m˛ó√d_cou¡
,

298 
gÂ_t
 
	mgÂ
);

299 
e1000_rög
 *
	mrx_rög
;

301 
u32
 
	mrx_öt_dñay
;

302 
u32
 
	mrx_abs_öt_dñay
;

305 
u64
 
	mhw_csum_îr
;

306 
u64
 
	mhw_csum_good
;

307 
u64
 
	mrx_hdr_•lô
;

308 
u32
 
	mg‹c
;

309 
u64
 
	mg‹c_ﬁd
;

310 
u32
 
	mÆloc_rx_buff_Áûed
;

311 
u32
 
	mrx_dma_Áûed
;

312 #ifde‡
HAVE_HW_TIME_STAMP


313 
u32
 
	mrx_hwt°amp_˛óªd
;

316 
	mrx_ps_∑ges
;

317 
u16
 
	mrx_ps_bsize0
;

318 #i‚de‡
CONFIG_E1000E_NAPI


319 
u64
 
	mrx_dr›≥d_backlog
;

321 
u32
 
	mmax_‰ame_size
;

322 
u32
 
	mmö_‰ame_size
;

325 
√t_devi˚
 *
	m√tdev
;

326 
pci_dev
 *
	mpdev
;

327 #i‚de‡
HAVE_NETDEV_STATS_IN_NETDEV


328 
√t_devi˚_°©s
 
	m√t_°©s
;

332 
e1000_hw
 
	mhw
;

334 #ifde‡
HAVE_NDO_GET_STATS64


335 
•ölock_t
 
	m°©s64_lock
;

337 
e1000_hw_°©s
 
	m°©s
;

338 
e1000_phy_öfo
 
	mphy_öfo
;

339 
e1000_phy_°©s
 
	mphy_°©s
;

341 #ifde‡
SIOCGMIIPHY


343 
e1000_phy_ªgs
 
	mphy_ªgs
;

346 
e1000_rög
 
	mã°_tx_rög
;

347 
e1000_rög
 
	mã°_rx_rög
;

348 
u32
 
	mã°_i¸
;

350 
u32
 
	mmsg_íabÀ
;

351 
	mnum_ve˘‹s
;

352 
msix_íåy
 *
	mmsix_íåõs
;

353 
	möt_mode
;

354 
u32
 
	meüc_mask
;

356 
u32
 
	mì¥om_wﬁ
;

357 
u32
 
	mwﬁ
;

358 
u32
 
	mpba
;

359 
u32
 
	mmax_hw_‰ame_size
;

361 
boﬁ
 
	mfc_aut⁄eg
;

363 #i‚de‡
HAVE_ETHTOOL_SET_PHYS_ID


364 
	mÀd_°©us
;

367 
	mÊags
;

368 
	mÊags2
;

369 
w‹k_°ru˘
 
	mdownshi·_èsk
;

370 
w‹k_°ru˘
 
	mupd©e_phy_èsk
;

371 #i‚de‡
HAVE_ETHTOOL_SET_PHYS_ID


372 
w‹k_°ru˘
 
	mÀd_blök_èsk
;

374 
w‹k_°ru˘
 
	m¥öt_h™g_èsk
;

375 
u32
 *
	mc⁄fig_•a˚
;

377 
	mnode
;

378 
	mphy_h™g_cou¡
;

380 
u16
 
	mtx_rög_cou¡
;

381 
u16
 
	mrx_rög_cou¡
;

382 
u8
 
	mªvisi⁄_id
;

384 #ifde‡
HAVE_HW_TIME_STAMP


385 
hwt°amp_c⁄fig
 
	mhwt°amp_c⁄fig
;

386 
dñayed_w‹k
 
	msy°im_ovîÊow_w‹k
;

387 
sk_buff
 *
	mtx_hwt°amp_skb
;

388 
w‹k_°ru˘
 
	mtx_hwt°amp_w‹k
;

389 
•ölock_t
 
	msy°im_lock
;

390 
cy˛ecou¡î
 
	mcc
;

391 
timecou¡î
 
	mtc
;

393 #ifde‡
HAVE_PTP_1588_CLOCK


394 
±p_˛ock
 *
	m±p_˛ock
;

395 
±p_˛ock_öfo
 
	m±p_˛ock_öfo
;

398 
u16
 
	mìe_advît
;

401 
	se1000_öfo
 {

402 
e1000_mac_ty≥
 
	mmac
;

403 
	mÊags
;

404 
	mÊags2
;

405 
u32
 
	mpba
;

406 
u32
 
	mmax_hw_‰ame_size
;

407 
s32
 (*
gë_v¨ü¡s
)(
	me1000_ad≠ãr
 *);

408 c⁄° 
e1000_mac_›î©i⁄s
 *
	mmac_›s
;

409 c⁄° 
e1000_phy_›î©i⁄s
 *
	mphy_›s
;

410 c⁄° 
e1000_nvm_›î©i⁄s
 *
	mnvm_›s
;

413 #ifde‡
HAVE_HW_TIME_STAMP


414 #ifde‡
HAVE_PTP_1588_CLOCK


415 
s32
 
e1000e_gë_ba£_timöˇ
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 *
timöˇ
);

430 
	#INCVALUE_96MHz
 125

	)

431 
	#INCVALUE_SHIFT_96MHz
 17

	)

432 
	#INCPERIOD_SHIFT_96MHz
 2

	)

433 
	#INCPERIOD_96MHz
 (12 >> 
INCPERIOD_SHIFT_96MHz
)

	)

435 
	#INCVALUE_25MHz
 40

	)

436 
	#INCVALUE_SHIFT_25MHz
 18

	)

437 
	#INCPERIOD_25MHz
 1

	)

448 
	#E1000_SYSTIM_OVERFLOW_PERIOD
 (
HZ
 * 60 * 60 * 4)

	)

452 
	#FLAG_HAS_AMT
 (1 << 0)

	)

453 
	#FLAG_HAS_FLASH
 (1 << 1)

	)

454 
	#FLAG_HAS_HW_VLAN_FILTER
 (1 << 2)

	)

455 
	#FLAG_HAS_WOL
 (1 << 3)

	)

457 
	#FLAG_HAS_CTRLEXT_ON_LOAD
 (1 << 5)

	)

458 
	#FLAG_HAS_SWSM_ON_LOAD
 (1 << 6)

	)

459 
	#FLAG_HAS_JUMBO_FRAMES
 (1 << 7)

	)

461 
	#FLAG_IS_ICH
 (1 << 9)

	)

462 
	#FLAG_HAS_MSIX
 (1 << 10)

	)

463 
	#FLAG_HAS_SMART_POWER_DOWN
 (1 << 11)

	)

464 
	#FLAG_IS_QUAD_PORT_A
 (1 << 12)

	)

465 
	#FLAG_IS_QUAD_PORT
 (1 << 13)

	)

466 
	#FLAG_HAS_HW_TIMESTAMP
 (1 << 14)

	)

467 
	#FLAG_APME_IN_WUC
 (1 << 15)

	)

468 
	#FLAG_APME_IN_CTRL3
 (1 << 16)

	)

469 
	#FLAG_APME_CHECK_PORT_B
 (1 << 17)

	)

470 
	#FLAG_DISABLE_FC_PAUSE_TIME
 (1 << 18)

	)

471 
	#FLAG_NO_WAKE_UCAST
 (1 << 19)

	)

472 
	#FLAG_MNG_PT_ENABLED
 (1 << 20)

	)

473 
	#FLAG_RESET_OVERWRITES_LAA
 (1 << 21)

	)

474 
	#FLAG_TARC_SPEED_MODE_BIT
 (1 << 22)

	)

475 
	#FLAG_TARC_SET_BIT_ZERO
 (1 << 23)

	)

476 
	#FLAG_RX_NEEDS_RESTART
 (1 << 24)

	)

477 
	#FLAG_LSC_GIG_SPEED_DROP
 (1 << 25)

	)

478 
	#FLAG_SMART_POWER_DOWN
 (1 << 26)

	)

479 
	#FLAG_MSI_ENABLED
 (1 << 27)

	)

480 #i‚de‡
HAVE_NDO_SET_FEATURES


481 
	#FLAG_RX_CSUM_ENABLED
 (1 << 28)

	)

485 
	#FLAG_TSO_FORCE
 (1 << 29)

	)

486 
	#FLAG_RESTART_NOW
 (1 << 30)

	)

487 
	#FLAG_MSI_TEST_FAILED
 (1 << 31)

	)

489 
	#FLAG2_CRC_STRIPPING
 (1 << 0)

	)

490 
	#FLAG2_HAS_PHY_WAKEUP
 (1 << 1)

	)

491 
	#FLAG2_IS_DISCARDING
 (1 << 2)

	)

492 
	#FLAG2_DISABLE_ASPM_L1
 (1 << 3)

	)

493 
	#FLAG2_HAS_PHY_STATS
 (1 << 4)

	)

494 
	#FLAG2_HAS_EEE
 (1 << 5)

	)

495 
	#FLAG2_DMA_BURST
 (1 << 6)

	)

496 
	#FLAG2_DISABLE_ASPM_L0S
 (1 << 7)

	)

497 
	#FLAG2_DISABLE_AIM
 (1 << 8)

	)

498 
	#FLAG2_CHECK_PHY_HANG
 (1 << 9)

	)

499 
	#FLAG2_NO_DISABLE_RX
 (1 << 10)

	)

500 
	#FLAG2_PCIM2PCI_ARBITER_WA
 (1 << 11)

	)

501 
	#FLAG2_DFLT_CRC_STRIPPING
 (1 << 12)

	)

502 
	#FLAG2_CHECK_RX_HWTSTAMP
 (1 << 13)

	)

504 
	#E1000_RX_DESC_PS
(
R
, 
i
) \

505 (&(((
e1000_rx_desc_∑ckë_•lô
 *)((
R
).
desc
))[
i
]))

	)

506 
	#E1000_RX_DESC_EXT
(
R
, 
i
) \

507 (&(((
e1000_rx_desc_exãnded
 *)((
R
).
desc
))[
i
]))

	)

508 
	#E1000_GET_DESC
(
R
, 
i
, 
ty≥
Ë(&(((ty≥ *)((R).
desc
))[i]))

	)

509 
	#E1000_TX_DESC
(
R
, 
i
Ë
	`E1000_GET_DESC
(R, i, 
e1000_tx_desc
)

	)

510 
	#E1000_CONTEXT_DESC
(
R
, 
i
Ë
	`E1000_GET_DESC
(R, i, 
e1000_c⁄ãxt_desc
)

	)

512 
	ee1000_°©e_t
 {

513 
	m__E1000_OBFF_DISABLED
,

514 
	m__E1000_SHUTDOWN
,

515 
	m__E1000_TESTING
,

516 
	m__E1000_RESETTING
,

517 
	m__E1000_ACCESS_SHARED_RESOURCE
,

518 
	m__E1000_DOWN


521 
	eœãncy_ønge
 {

522 
	mlowe°_œãncy
 = 0,

523 
	mlow_œãncy
 = 1,

524 
	mbulk_œãncy
 = 2,

525 
	mœãncy_övÆid
 = 255

528 
e1000e_drivî_«me
[];

529 c⁄° 
e1000e_drivî_vîsi⁄
[];

531 
e1000e_check_›ti⁄s
(
e1000_ad≠ãr
 *
ad≠ãr
);

532 
e1000e_£t_ëhtoﬁ_›s
(
√t_devi˚
 *
√tdev
);

533 #i‚de‡
HAVE_ETHTOOL_SET_PHYS_ID


534 
e1000e_Àd_blök_èsk
(
w‹k_°ru˘
 *
w‹k
);

536 #ifde‡
ETHTOOL_OPS_COMPAT


537 
ëhtoﬁ_io˘l
(
i‰eq
 *
i‰
);

540 
e1000e_up
(
e1000_ad≠ãr
 *
ad≠ãr
);

541 
e1000e_down
(
e1000_ad≠ãr
 *
ad≠ãr
, 
boﬁ
 
ª£t
);

542 
e1000e_ªöô_locked
(
e1000_ad≠ãr
 *
ad≠ãr
);

543 
e1000e_ª£t
(
e1000_ad≠ãr
 *
ad≠ãr
);

544 
e1000e_powî_up_phy
(
e1000_ad≠ãr
 *
ad≠ãr
);

545 
e1000e_£tup_rx_ªsour˚s
(
e1000_rög
 *
rög
);

546 
e1000e_£tup_tx_ªsour˚s
(
e1000_rög
 *
rög
);

547 
e1000e_‰ì_rx_ªsour˚s
(
e1000_rög
 *
rög
);

548 
e1000e_‰ì_tx_ªsour˚s
(
e1000_rög
 *
rög
);

549 #ifde‡
HAVE_NDO_GET_STATS64


550 
π∆_lök_°©s64
 *
e1000e_gë_°©s64
(
√t_devi˚
 *
√tdev
,

551 
π∆_lök_°©s64


552 *
°©s
);

554 
e1000e_upd©e_°©s
(
e1000_ad≠ãr
 *
ad≠ãr
);

556 
e1000e_£t_öãºu±_ˇ∑bûôy
(
e1000_ad≠ãr
 *
ad≠ãr
);

557 
e1000e_ª£t_öãºu±_ˇ∑bûôy
(
e1000_ad≠ãr
 *
ad≠ãr
);

558 
e1000e_gë_hw_c⁄åﬁ
(
e1000_ad≠ãr
 *
ad≠ãr
);

559 
e1000e_ªÀa£_hw_c⁄åﬁ
(
e1000_ad≠ãr
 *
ad≠ãr
);

560 
e1000e_wrôe_ôr
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
ôr
);

562 
c›ybªak
;

564 c⁄° 
e1000_öfo
 
e1000_82571_öfo
;

565 c⁄° 
e1000_öfo
 
e1000_82572_öfo
;

566 c⁄° 
e1000_öfo
 
e1000_82573_öfo
;

567 c⁄° 
e1000_öfo
 
e1000_82574_öfo
;

568 c⁄° 
e1000_öfo
 
e1000_82583_öfo
;

569 c⁄° 
e1000_öfo
 
e1000_ich8_öfo
;

570 c⁄° 
e1000_öfo
 
e1000_ich9_öfo
;

571 c⁄° 
e1000_öfo
 
e1000_ich10_öfo
;

572 c⁄° 
e1000_öfo
 
e1000_pch_öfo
;

573 c⁄° 
e1000_öfo
 
e1000_pch2_öfo
;

574 c⁄° 
e1000_öfo
 
e1000_pch_Õt_öfo
;

575 c⁄° 
e1000_öfo
 
e1000_es2_öfo
;

577 #ifde‡
HAVE_PTP_1588_CLOCK


578 
e1000e_±p_öô
(
e1000_ad≠ãr
 *
ad≠ãr
);

579 
e1000e_±p_ªmove
(
e1000_ad≠ãr
 *
ad≠ãr
);

581 
	#e1000e_±p_öô
(
ad≠ãr
Ëdÿ{} 0)

	)

582 
	#e1000e_±p_ªmove
(
ad≠ãr
Ëdÿ{} 0)

	)

585 
ölöe
 
s32
 
	$e1000_phy_hw_ª£t
(
e1000_hw
 *
hw
)

587  
hw
->
phy
.
›s
.
	`ª£t
(hw);

588 
	}
}

590 
ölöe
 
s32
 
	$e1e_Ωhy
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

592  
hw
->
phy
.
›s
.
	`ªad_ªg
(hw, 
off£t
, 
d©a
);

593 
	}
}

595 
ölöe
 
s32
 
	$e1e_Ωhy_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

597  
hw
->
phy
.
›s
.
	`ªad_ªg_locked
(hw, 
off£t
, 
d©a
);

598 
	}
}

600 
ölöe
 
s32
 
	$e1e_wphy
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

602  
hw
->
phy
.
›s
.
	`wrôe_ªg
(hw, 
off£t
, 
d©a
);

603 
	}
}

605 
ölöe
 
s32
 
	$e1e_wphy_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

607  
hw
->
phy
.
›s
.
	`wrôe_ªg_locked
(hw, 
off£t
, 
d©a
);

608 
	}
}

610 
e1000e_ªlﬂd_nvm_gíîic
(
e1000_hw
 *
hw
);

612 
ölöe
 
s32
 
	$e1000e_ªad_mac_addr
(
e1000_hw
 *
hw
)

614 i‡(
hw
->
mac
.
›s
.
ªad_mac_addr
)

615  
hw
->
mac
.
›s
.
	`ªad_mac_addr
(hw);

617  
	`e1000_ªad_mac_addr_gíîic
(
hw
);

618 
	}
}

620 
ölöe
 
s32
 
	$e1000_vÆid©e_nvm_checksum
(
e1000_hw
 *
hw
)

622  
hw
->
nvm
.
›s
.
	`vÆid©e
(hw);

623 
	}
}

625 
ölöe
 
s32
 
	$e1000e_upd©e_nvm_checksum
(
e1000_hw
 *
hw
)

627  
hw
->
nvm
.
›s
.
	`upd©e
(hw);

628 
	}
}

630 
ölöe
 
s32
 
	$e1000_ªad_nvm
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
,

631 
u16
 *
d©a
)

633  
hw
->
nvm
.
›s
.
	`ªad
(hw, 
off£t
, 
w‹ds
, 
d©a
);

634 
	}
}

636 
ölöe
 
s32
 
	$e1000_wrôe_nvm
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
,

637 
u16
 *
d©a
)

639  
hw
->
nvm
.
›s
.
	`wrôe
(hw, 
off£t
, 
w‹ds
, 
d©a
);

640 
	}
}

642 
ölöe
 
s32
 
	$e1000_gë_phy_öfo
(
e1000_hw
 *
hw
)

644  
hw
->
phy
.
›s
.
	`gë_öfo
(hw);

645 
	}
}

647 
ölöe
 
u32
 
	$__î32
(
e1000_hw
 *
hw
, 
ªg
)

649  
	`ªadl
(
hw
->
hw_addr
 + 
ªg
);

650 
	}
}

652 
	#î32
(
ªg
Ë
	`__î32
(
hw
, 
E1000_
##ªg)

	)

666 
ölöe
 
s32
 
	$__ew32_¥ï¨e
(
e1000_hw
 *
hw
)

668 
s32
 
i
 = 
E1000_ICH_FWSM_PCIM2PCI_COUNT
;

670 (
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_PCIM2PCI
Ë&& --
i
)

671 
	`udñay
(50);

673  
i
;

674 
	}
}

676 
ölöe
 
	$__ew32
(
e1000_hw
 *
hw
, 
ªg
, 
u32
 
vÆ
)

678 i‡(
hw
->
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

679 
	`__ew32_¥ï¨e
(
hw
);

681 
	`wrôñ
(
vÆ
, 
hw
->
hw_addr
 + 
ªg
);

682 
	}
}

684 
	#ew32
(
ªg
, 
vÆ
Ë
	`__ew32
(
hw
, 
E1000_
##ªg, (vÆ))

	)

686 
	#e1e_Êush
(Ë
	`î32
(
STATUS
)

	)

688 
	#E1000_WRITE_REG_ARRAY
(
a
, 
ªg
, 
off£t
, 
vÆue
) \

689 (
	`__ew32
((
a
), (
ªg
 + ((
off£t
Ë<< 2)), (
vÆue
)))

	)

691 
	#E1000_READ_REG_ARRAY
(
a
, 
ªg
, 
off£t
) \

692 (
	`ªadl
((
a
)->
hw_addr
 + 
ªg
 + ((
off£t
Ë<< 2)))

	)

	@ethtool.c

31 
	~<löux/√tdevi˚.h
>

32 
	~<löux/öãºu±.h
>

33 #ifde‡
SIOCETHTOOL


34 
	~<löux/ëhtoﬁ.h
>

35 
	~<löux/pci.h
>

36 
	~<löux/¶ab.h
>

37 
	~<löux/dñay.h
>

38 
	~<löux/vmÆloc.h
>

40 
	~"e1000.h
"

41 #i‚de‡
HAVE_NETDEV_VLAN_FEATURES


42 
	~<löux/if_vœn.h
>

44 #ifde‡
ETHTOOL_OPS_COMPAT


45 
	~"kcom∑t_ëhtoﬁ.c
"

48 íum { 
	mNETDEV_STATS
, 
	mE1000_STATS
 };

50 
	se1000_°©s
 {

51 
	m°©_°rög
[
ETH_GSTRING_LEN
];

52 
	mty≥
;

53 
	msizeof_°©
;

54 
	m°©_off£t
;

57 
	#E1000_STAT
(
°r
, 
m
) { \

58 .
°©_°rög
 = 
°r
, \

59 .
ty≥
 = 
E1000_STATS
, \

60 .
sizeof_°©
 = (((
e1000_ad≠ãr
 *)0)->
m
), \

61 .
°©_off£t
 = 
	`off£tof
(
e1000_ad≠ãr
, 
m
Ë}

	)

62 #ifde‡
HAVE_NDO_GET_STATS64


63 
	#E1000_NETDEV_STAT
(
°r
, 
m
) { \

64 .
°©_°rög
 = 
°r
, \

65 .
ty≥
 = 
NETDEV_STATS
, \

66 .
sizeof_°©
 = (((
π∆_lök_°©s64
 *)0)->
m
), \

67 .
°©_off£t
 = 
	`off£tof
(
π∆_lök_°©s64
, 
m
Ë}

	)

68 #ñi‡
deföed
(
HAVE_NETDEV_STATS_IN_NETDEV
)

69 
	#E1000_NETDEV_STAT
(
°r
, 
m
) { \

70 .
°©_°rög
 = 
°r
, \

71 .
ty≥
 = 
NETDEV_STATS
, \

72 .
sizeof_°©
 = (((
√t_devi˚
 *)0)->
m
), \

73 .
°©_off£t
 = 
	`off£tof
(
√t_devi˚
, 
m
Ë}

	)

75 
	#E1000_NETDEV_STAT
(
°r
, 
m
Ë
	`E1000_STAT
(°r, 
√t_
##m)

	)

78 c⁄° 
e1000_°©s
 
	ge1000_g°rögs_°©s
[] = {

79 
E1000_STAT
("rx_∑ckës", 
°©s
.
g¥c
),

80 
E1000_STAT
("tx_∑ckës", 
°©s
.
g±c
),

81 
E1000_STAT
("rx_byãs", 
°©s
.
g‹c
),

82 
E1000_STAT
("tx_byãs", 
°©s
.
gŸc
),

83 
E1000_STAT
("rx_brﬂdˇ°", 
°©s
.
b¥c
),

84 
E1000_STAT
("tx_brﬂdˇ°", 
°©s
.
b±c
),

85 
E1000_STAT
("rx_mu…iˇ°", 
°©s
.
m¥c
),

86 
E1000_STAT
("tx_mu…iˇ°", 
°©s
.
m±c
),

87 #ifde‡
HAVE_NDO_GET_STATS64


88 
E1000_NETDEV_STAT
("rx_îr‹s", 
rx_îr‹s
),

89 
E1000_NETDEV_STAT
("tx_îr‹s", 
tx_îr‹s
),

91 
E1000_NETDEV_STAT
("rx_îr‹s", 
°©s
.
rx_îr‹s
),

92 
E1000_NETDEV_STAT
("tx_îr‹s", 
°©s
.
tx_îr‹s
),

94 #i‚de‡
CONFIG_E1000E_NAPI


95 
E1000_STAT
("rx_dr›≥d_backlog", 
rx_dr›≥d_backlog
),

97 #ifde‡
HAVE_NDO_GET_STATS64


98 
E1000_NETDEV_STAT
("tx_dr›≥d", 
tx_dr›≥d
),

100 
E1000_NETDEV_STAT
("tx_dr›≥d", 
°©s
.
tx_dr›≥d
),

102 
E1000_STAT
("mu…iˇ°", 
°©s
.
m¥c
),

103 
E1000_STAT
("cﬁlisi⁄s", 
°©s
.
cﬁc
),

104 #ifde‡
HAVE_NDO_GET_STATS64


105 
E1000_NETDEV_STAT
("rx_Àngth_îr‹s", 
rx_Àngth_îr‹s
),

106 
E1000_NETDEV_STAT
("rx_ovî_îr‹s", 
rx_ovî_îr‹s
),

108 
E1000_NETDEV_STAT
("rx_Àngth_îr‹s", 
°©s
.
rx_Àngth_îr‹s
),

109 
E1000_NETDEV_STAT
("rx_ovî_îr‹s", 
°©s
.
rx_ovî_îr‹s
),

111 
E1000_STAT
("rx_¸c_îr‹s", 
°©s
.
¸˚ºs
),

112 #ifde‡
HAVE_NDO_GET_STATS64


113 
E1000_NETDEV_STAT
("rx_‰ame_îr‹s", 
rx_‰ame_îr‹s
),

115 
E1000_NETDEV_STAT
("rx_‰ame_îr‹s", 
°©s
.
rx_‰ame_îr‹s
),

117 
E1000_STAT
("rx_no_buf„r_cou¡", 
°©s
.
∫bc
),

118 
E1000_STAT
("rx_mis£d_îr‹s", 
°©s
.
mpc
),

119 
E1000_STAT
("tx_ab‹ãd_îr‹s", 
°©s
.
ecﬁ
),

120 
E1000_STAT
("tx_ˇºõr_îr‹s", 
°©s
.
ä¸s
),

121 #ifde‡
HAVE_NDO_GET_STATS64


122 
E1000_NETDEV_STAT
("tx_fifo_îr‹s", 
tx_fifo_îr‹s
),

123 
E1000_NETDEV_STAT
("tx_hóπbót_îr‹s", 
tx_hóπbót_îr‹s
),

125 
E1000_NETDEV_STAT
("tx_fifo_îr‹s", 
°©s
.
tx_fifo_îr‹s
),

126 
E1000_NETDEV_STAT
("tx_hóπbót_îr‹s", 
°©s
.
tx_hóπbót_îr‹s
),

128 
E1000_STAT
("tx_wödow_îr‹s", 
°©s
.
œãcﬁ
),

129 
E1000_STAT
("tx_ab‹t_œã_cﬁl", 
°©s
.
œãcﬁ
),

130 
E1000_STAT
("tx_de„ºed_ok", 
°©s
.
dc
),

131 
E1000_STAT
("tx_sögÀ_cﬁl_ok", 
°©s
.
scc
),

132 
E1000_STAT
("tx_mu…i_cﬁl_ok", 
°©s
.
mcc
),

133 
E1000_STAT
("tx_timeout_cou¡", 
tx_timeout_cou¡
),

134 
E1000_STAT
("tx_ª°¨t_queue", 
ª°¨t_queue
),

135 
E1000_STAT
("rx_l⁄g_Àngth_îr‹s", 
°©s
.
roc
),

136 
E1000_STAT
("rx_sh‹t_Àngth_îr‹s", 
°©s
.
ruc
),

137 
E1000_STAT
("rx_Æign_îr‹s", 
°©s
.
Æg√ºc
),

138 
E1000_STAT
("tx_t˝_£g_good", 
°©s
.
ts˘c
),

139 
E1000_STAT
("tx_t˝_£g_Áûed", 
°©s
.
ts˘fc
),

140 
E1000_STAT
("rx_Êow_c⁄åﬁ_x⁄", 
°©s
.
x⁄rxc
),

141 
E1000_STAT
("rx_Êow_c⁄åﬁ_xoff", 
°©s
.
xof‰xc
),

142 
E1000_STAT
("tx_Êow_c⁄åﬁ_x⁄", 
°©s
.
x⁄txc
),

143 
E1000_STAT
("tx_Êow_c⁄åﬁ_xoff", 
°©s
.
xof·xc
),

144 
E1000_STAT
("rx_csum_ofÊﬂd_good", 
hw_csum_good
),

145 
E1000_STAT
("rx_csum_ofÊﬂd_îr‹s", 
hw_csum_îr
),

146 
E1000_STAT
("rx_hódî_•lô", 
rx_hdr_•lô
),

147 
E1000_STAT
("Æloc_rx_buff_Áûed", 
Æloc_rx_buff_Áûed
),

148 
E1000_STAT
("tx_smbus", 
°©s
.
mg±c
),

149 
E1000_STAT
("rx_smbus", 
°©s
.
mg¥c
),

150 
E1000_STAT
("dr›≥d_smbus", 
°©s
.
mgpdc
),

151 
E1000_STAT
("rx_dma_Áûed", 
rx_dma_Áûed
),

152 
E1000_STAT
("tx_dma_Áûed", 
tx_dma_Áûed
),

153 #ifde‡
HAVE_HW_TIME_STAMP


154 
E1000_STAT
("rx_hwt°amp_˛óªd", 
rx_hwt°amp_˛óªd
),

156 
E1000_STAT
("unc‹r_ecc_îr‹s", 
unc‹r_îr‹s
),

157 
E1000_STAT
("c‹r_ecc_îr‹s", 
c‹r_îr‹s
),

160 
	#E1000_GLOBAL_STATS_LEN
 
	`ARRAY_SIZE
(
e1000_g°rögs_°©s
)

	)

161 
	#E1000_STATS_LEN
 (
E1000_GLOBAL_STATS_LEN
)

	)

162 c⁄° 
	ge1000_g°rögs_ã°
[][
ETH_GSTRING_LEN
] = {

168 
	#E1000_TEST_LEN
 
	`ARRAY_SIZE
(
e1000_g°rögs_ã°
)

	)

170 
	$e1000_gë_£âögs
(
√t_devi˚
 *
√tdev
,

171 
ëhtoﬁ_cmd
 *
ecmd
)

173 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

174 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

175 
u32
 
•ìd
;

177 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

178 
ecmd
->
suµ‹ãd
 = (
SUPPORTED_10ba£T_HÆf
 |

179 
SUPPORTED_10ba£T_FuŒ
 |

180 
SUPPORTED_100ba£T_HÆf
 |

181 
SUPPORTED_100ba£T_FuŒ
 |

182 
SUPPORTED_1000ba£T_FuŒ
 |

183 
SUPPORTED_Aut⁄eg
 |

184 
SUPPORTED_TP
);

185 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

186 
ecmd
->
suµ‹ãd
 &~
SUPPORTED_1000ba£T_FuŒ
;

187 
ecmd
->
advîtisög
 = 
ADVERTISED_TP
;

189 i‡(
hw
->
mac
.
aut⁄eg
 == 1) {

190 
ecmd
->
advîtisög
 |
ADVERTISED_Aut⁄eg
;

192 
ecmd
->
advîtisög
 |
hw
->
phy
.
aut⁄eg_advîti£d
;

195 
ecmd
->
p‹t
 = 
PORT_TP
;

196 
ecmd
->
phy_addªss
 = 
hw
->
phy
.
addr
;

197 
ecmd
->
å™s˚ivî
 = 
XCVR_INTERNAL
;

200 
ecmd
->
suµ‹ãd
 = (
SUPPORTED_1000ba£T_FuŒ
 |

201 
SUPPORTED_FIBRE
 |

202 
SUPPORTED_Aut⁄eg
);

204 
ecmd
->
advîtisög
 = (
ADVERTISED_1000ba£T_FuŒ
 |

205 
ADVERTISED_FIBRE
 |

206 
ADVERTISED_Aut⁄eg
);

208 
ecmd
->
p‹t
 = 
PORT_FIBRE
;

209 
ecmd
->
å™s˚ivî
 = 
XCVR_EXTERNAL
;

212 
•ìd
 = -1;

213 
ecmd
->
du∂ex
 = -1;

215 i‡(
	`√tif_ru¬ög
(
√tdev
)) {

216 i‡(
	`√tif_ˇºõr_ok
(
√tdev
)) {

217 
•ìd
 = 
ad≠ãr
->
lök_•ìd
;

218 
ecmd
->
du∂ex
 = 
ad≠ãr
->
lök_du∂ex
 - 1;

220 } i‡(!
	`pm_ru¡ime_su•íded
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
)) {

221 
u32
 
°©us
 = 
	`î32
(
STATUS
);

222 i‡(
°©us
 & 
E1000_STATUS_LU
) {

223 i‡(
°©us
 & 
E1000_STATUS_SPEED_1000
)

224 
•ìd
 = 
SPEED_1000
;

225 i‡(
°©us
 & 
E1000_STATUS_SPEED_100
)

226 
•ìd
 = 
SPEED_100
;

228 
•ìd
 = 
SPEED_10
;

230 i‡(
°©us
 & 
E1000_STATUS_FD
)

231 
ecmd
->
du∂ex
 = 
DUPLEX_FULL
;

233 
ecmd
->
du∂ex
 = 
DUPLEX_HALF
;

237 
	`ëhtoﬁ_cmd_•ìd_£t
(
ecmd
, 
•ìd
);

238 
ecmd
->
aut⁄eg
 = ((
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
) ||

239 
hw
->
mac
.
aut⁄eg
Ë? 
AUTONEG_ENABLE
 : 
AUTONEG_DISABLE
;

241 #ifde‡
ETH_TP_MDI_X


243 i‡((
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) &&

244 
	`√tif_ˇºõr_ok
(
√tdev
))

245 
ecmd
->
ëh_ç_mdix
 = 
hw
->
phy
.
is_mdix
 ? 
ETH_TP_MDI_X
 : 
ETH_TP_MDI
;

247 
ecmd
->
ëh_ç_mdix
 = 
ETH_TP_MDI_INVALID
;

249 #ifde‡
ETH_TP_MDI_AUTO


250 i‡(
hw
->
phy
.
mdix
 =
AUTO_ALL_MODES
)

251 
ecmd
->
ëh_ç_mdix_˘æ
 = 
ETH_TP_MDI_AUTO
;

253 
ecmd
->
ëh_ç_mdix_˘æ
 = 
hw
->
phy
.
mdix
;

258 
	}
}

260 
	$e1000_£t_•d_d∂x
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
•d
, 
u8
 
d∂x
)

262 
e1000_mac_öfo
 *
mac
 = &
ad≠ãr
->
hw
.mac;

264 
mac
->
aut⁄eg
 = 0;

269 i‡((
•d
 & 1Ë|| (
d∂x
 & ~1))

270 
îr_övÆ
;

273 i‡((
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
) &&

274 (
•d
 !
SPEED_1000
Ë&& (
d∂x
 !
DUPLEX_FULL
)) {

275 
îr_övÆ
;

278 
•d
 + 
d∂x
) {

279 
SPEED_10
 + 
DUPLEX_HALF
:

280 
mac
->
f‹˚d_•ìd_du∂ex
 = 
ADVERTISE_10_HALF
;

282 
SPEED_10
 + 
DUPLEX_FULL
:

283 
mac
->
f‹˚d_•ìd_du∂ex
 = 
ADVERTISE_10_FULL
;

285 
SPEED_100
 + 
DUPLEX_HALF
:

286 
mac
->
f‹˚d_•ìd_du∂ex
 = 
ADVERTISE_100_HALF
;

288 
SPEED_100
 + 
DUPLEX_FULL
:

289 
mac
->
f‹˚d_•ìd_du∂ex
 = 
ADVERTISE_100_FULL
;

291 
SPEED_1000
 + 
DUPLEX_FULL
:

292 
mac
->
aut⁄eg
 = 1;

293 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_advîti£d
 = 
ADVERTISE_1000_FULL
;

295 
SPEED_1000
 + 
DUPLEX_HALF
:

297 
îr_övÆ
;

301 
ad≠ãr
->
hw
.
phy
.
mdix
 = 
AUTO_ALL_MODES
;

305 
îr_övÆ
:

306 
	`e_îr
("Unsupported Speed/Duplex configuration\n");

307  -
EINVAL
;

308 
	}
}

310 
	$e1000_£t_£âögs
(
√t_devi˚
 *
√tdev
,

311 
ëhtoﬁ_cmd
 *
ecmd
)

313 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

314 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

315 
ªt_vÆ
 = 0;

317 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

322 i‡(
hw
->
phy
.
›s
.
check_ª£t_block
 &&

323 
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) {

324 
	`e_îr
("Cannot changeÜink characteristics when SoL/IDER isáctive.\n");

325 
ªt_vÆ
 = -
EINVAL
;

326 
out
;

329 #ifde‡
ETH_TP_MDI_AUTO


334 i‡(
ecmd
->
ëh_ç_mdix_˘æ
) {

335 i‡(
hw
->
phy
.
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
) {

336 
ªt_vÆ
 = -
EOPNOTSUPP
;

337 
out
;

340 i‡((
ecmd
->
ëh_ç_mdix_˘æ
 !
ETH_TP_MDI_AUTO
) &&

341 (
ecmd
->
aut⁄eg
 !
AUTONEG_ENABLE
)) {

342 
	`e_îr
("forcing MDI/MDI-X state isÇot supported whenÜink speedánd/or duplexáre forced\n");

343 
ªt_vÆ
 = -
EINVAL
;

344 
out
;

348 
	`ã°_™d_£t_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
))

349 
	`u¶ìp_ønge
(1000, 2000);

351 i‡(
ecmd
->
aut⁄eg
 =
AUTONEG_ENABLE
) {

352 
hw
->
mac
.
aut⁄eg
 = 1;

353 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
)

354 
hw
->
phy
.
aut⁄eg_advîti£d
 = 
ADVERTISED_1000ba£T_FuŒ
 |

355 
ADVERTISED_FIBRE
 | 
ADVERTISED_Aut⁄eg
;

357 
hw
->
phy
.
aut⁄eg_advîti£d
 = 
ecmd
->
advîtisög
 |

358 
ADVERTISED_TP
 | 
ADVERTISED_Aut⁄eg
;

359 
ecmd
->
advîtisög
 = 
hw
->
phy
.
aut⁄eg_advîti£d
;

360 i‡(
ad≠ãr
->
fc_aut⁄eg
)

361 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_deÁu…
;

363 
u32
 
•ìd
 = 
	`ëhtoﬁ_cmd_•ìd
(
ecmd
);

365 i‡(
	`e1000_£t_•d_d∂x
(
ad≠ãr
, 
•ìd
, 
ecmd
->
du∂ex
)) {

366 
ªt_vÆ
 = -
EINVAL
;

367 
out
;

371 #ifde‡
ETH_TP_MDI_AUTO


373 i‡(
ecmd
->
ëh_ç_mdix_˘æ
) {

377 i‡(
ecmd
->
ëh_ç_mdix_˘æ
 =
ETH_TP_MDI_AUTO
)

378 
hw
->
phy
.
mdix
 = 
AUTO_ALL_MODES
;

380 
hw
->
phy
.
mdix
 = 
ecmd
->
ëh_ç_mdix_˘æ
;

384 i‡(
	`√tif_ru¬ög
(
ad≠ãr
->
√tdev
)) {

385 
	`e1000e_down
(
ad≠ãr
, 
åue
);

386 
	`e1000e_up
(
ad≠ãr
);

388 
	`e1000e_ª£t
(
ad≠ãr
);

391 
out
:

392 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

393 
	`˛ór_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
);

394  
ªt_vÆ
;

395 
	}
}

397 
	$e1000_gë_∑u£∑øm
(
√t_devi˚
 *
√tdev
,

398 
ëhtoﬁ_∑u£∑øm
 *
∑u£
)

400 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

401 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

403 
∑u£
->
aut⁄eg
 =

404 (
ad≠ãr
->
fc_aut⁄eg
 ? 
AUTONEG_ENABLE
 : 
AUTONEG_DISABLE
);

406 i‡(
hw
->
fc
.
cuºít_mode
 =
e1000_fc_rx_∑u£
) {

407 
∑u£
->
rx_∑u£
 = 1;

408 } i‡(
hw
->
fc
.
cuºít_mode
 =
e1000_fc_tx_∑u£
) {

409 
∑u£
->
tx_∑u£
 = 1;

410 } i‡(
hw
->
fc
.
cuºít_mode
 =
e1000_fc_fuŒ
) {

411 
∑u£
->
rx_∑u£
 = 1;

412 
∑u£
->
tx_∑u£
 = 1;

414 
	}
}

416 
	$e1000_£t_∑u£∑øm
(
√t_devi˚
 *
√tdev
,

417 
ëhtoﬁ_∑u£∑øm
 *
∑u£
)

419 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

420 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

421 
ªtvÆ
 = 0;

423 
ad≠ãr
->
fc_aut⁄eg
 = 
∑u£
->
aut⁄eg
;

425 
	`ã°_™d_£t_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
))

426 
	`u¶ìp_ønge
(1000, 2000);

428 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

430 i‡(
ad≠ãr
->
fc_aut⁄eg
 =
AUTONEG_ENABLE
) {

431 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_deÁu…
;

432 i‡(
	`√tif_ru¬ög
(
ad≠ãr
->
√tdev
)) {

433 
	`e1000e_down
(
ad≠ãr
, 
åue
);

434 
	`e1000e_up
(
ad≠ãr
);

436 
	`e1000e_ª£t
(
ad≠ãr
);

439 i‡(
∑u£
->
rx_∑u£
 &&Öau£->
tx_∑u£
)

440 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_fuŒ
;

441 i‡(
∑u£
->
rx_∑u£
 && !∑u£->
tx_∑u£
)

442 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_rx_∑u£
;

443 i‡(!
∑u£
->
rx_∑u£
 &&Öau£->
tx_∑u£
)

444 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_tx_∑u£
;

445 i‡(!
∑u£
->
rx_∑u£
 && !∑u£->
tx_∑u£
)

446 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_n⁄e
;

448 
hw
->
fc
.
cuºít_mode
 = hw->fc.
ªque°ed_mode
;

450 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
) {

451 
ªtvÆ
 = 
hw
->
mac
.
›s
.
	`£tup_lök
(hw);

454 
ªtvÆ
 = 
	`e1000e_f‹˚_mac_fc
(
hw
);

455 i‡(
ªtvÆ
)

456 
out
;

457 
	`e1000e_£t_fc_w©îm¨ks
(
hw
);

461 
out
:

462 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

463 
	`˛ór_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
);

464  
ªtvÆ
;

465 
	}
}

467 #i‚de‡
HAVE_NDO_SET_FEATURES


468 
u32
 
	$e1000_gë_rx_csum
(
√t_devi˚
 *
√tdev
)

470 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

471  
ad≠ãr
->
Êags
 & 
FLAG_RX_CSUM_ENABLED
;

472 
	}
}

474 
	$e1000_£t_rx_csum
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

476 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

478 i‡(
d©a
)

479 
ad≠ãr
->
Êags
 |
FLAG_RX_CSUM_ENABLED
;

481 
ad≠ãr
->
Êags
 &~
FLAG_RX_CSUM_ENABLED
;

483 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

485 i‡(
	`√tif_ru¬ög
(
√tdev
))

486 
	`e1000e_ªöô_locked
(
ad≠ãr
);

488 
	`e1000e_ª£t
(
ad≠ãr
);

490 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

493 
	}
}

495 
u32
 
	$e1000_gë_tx_csum
(
√t_devi˚
 *
√tdev
)

497  (
√tdev
->
„©uªs
 & 
NETIF_F_HW_CSUM
) != 0;

498 
	}
}

500 
	$e1000_£t_tx_csum
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

502 i‡(
d©a
)

503 
√tdev
->
„©uªs
 |
NETIF_F_HW_CSUM
;

505 
√tdev
->
„©uªs
 &~
NETIF_F_HW_CSUM
;

508 
	}
}

510 #ifde‡
NETIF_F_TSO


511 
	$e1000_£t_tso
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

513 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

514 #i‚de‡
HAVE_NETDEV_VLAN_FEATURES


515 
i
;

516 
√t_devi˚
 *
v_√tdev
;

519 i‡(
d©a
) {

520 
√tdev
->
„©uªs
 |
NETIF_F_TSO
;

521 #ifde‡
NETIF_F_TSO6


522 
√tdev
->
„©uªs
 |
NETIF_F_TSO6
;

525 
√tdev
->
„©uªs
 &~
NETIF_F_TSO
;

526 #ifde‡
NETIF_F_TSO6


527 
√tdev
->
„©uªs
 &~
NETIF_F_TSO6
;

529 #i‚de‡
HAVE_NETDEV_VLAN_FEATURES


531 i‡(!
ad≠ãr
->
vlgΩ
)

532 
tso_out
;

533 
i
 = 0; i < 
VLAN_GROUP_ARRAY_LEN
; i++) {

534 
v_√tdev
 = 
	`vœn_group_gë_devi˚
(
ad≠ãr
->
vlgΩ
, 
i
);

535 i‡(!
v_√tdev
)

538 
v_√tdev
->
„©uªs
 &~
NETIF_F_TSO
;

539 #ifde‡
NETIF_F_TSO6


540 
v_√tdev
->
„©uªs
 &~
NETIF_F_TSO6
;

542 
	`vœn_group_£t_devi˚
(
ad≠ãr
->
vlgΩ
, 
i
, 
v_√tdev
);

547 #i‚de‡
HAVE_NETDEV_VLAN_FEATURES


548 
tso_out
:

550 
ad≠ãr
->
Êags
 |
FLAG_TSO_FORCE
;

552 
	}
}

555 #i‡
deföed
(
ETHTOOL_SFLAGS
Ë&& (deföed(
NETIF_F_RXHASH
Ë|| !deföed(
HAVE_VLAN_RX_REGISTER
))

556 
	$e1000e_£t_Êags
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

558 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

559 
u32
 
suµ‹ãd
 = 0, 
ch™ged
 = 
√tdev
->
„©uªs
 ^ 
d©a
;

560 
rc
;

562 #ifde‡
NETIF_F_RXHASH


563 
suµ‹ãd
 |
ETH_FLAG_RXHASH
;

565 #i‚de‡
HAVE_VLAN_RX_REGISTER


566 
suµ‹ãd
 |
ETH_FLAG_RXVLAN
 | 
ETH_FLAG_TXVLAN
;

569 
rc
 = 
	`ëhtoﬁ_›_£t_Êags
(
√tdev
, 
d©a
, 
suµ‹ãd
);

570 i‡(
rc
)

571  
rc
;

573 i‡(
ch™ged
 & 
suµ‹ãd
) {

574 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

576 i‡(
	`√tif_ru¬ög
(
√tdev
))

577 
	`e1000e_ªöô_locked
(
ad≠ãr
);

579 
	`e1000e_ª£t
(
ad≠ãr
);

581 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

585 
	}
}

589 
u32
 
	$e1000_gë_msgÀvñ
(
√t_devi˚
 *
√tdev
)

591 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

592  
ad≠ãr
->
msg_íabÀ
;

593 
	}
}

595 
	$e1000_£t_msgÀvñ
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

597 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

598 
ad≠ãr
->
msg_íabÀ
 = 
d©a
;

599 
	}
}

601 
	$e1000_gë_ªgs_Àn
(
√t_devi˚
 
__Æways_unu£d
 *
√tdev
)

603 
	#E1000_REGS_LEN
 32

	)

604  
E1000_REGS_LEN
 * (
u32
);

605 
	}
}

607 
	$e1000_gë_ªgs
(
√t_devi˚
 *
√tdev
,

608 
ëhtoﬁ_ªgs
 *
ªgs
, *
p
)

610 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

611 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

612 
u32
 *
ªgs_buff
 = 
p
;

613 
u16
 
phy_d©a
;

614 
u8
 
ªvisi⁄_id
;

616 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

618 
	`mem£t
(
p
, 0, 
E1000_REGS_LEN
 * (
u32
));

620 
	`pci_ªad_c⁄fig_byã
(
ad≠ãr
->
pdev
, 
PCI_REVISION_ID
, &
ªvisi⁄_id
);

622 
ªgs
->
vîsi⁄
 = (1 << 24Ë| (
ªvisi⁄_id
 << 16Ë| 
ad≠ãr
->
pdev
->
devi˚
;

624 
ªgs_buff
[0] = 
	`î32
(
CTRL
);

625 
ªgs_buff
[1] = 
	`î32
(
STATUS
);

627 
ªgs_buff
[2] = 
	`î32
(
RCTL
);

628 
ªgs_buff
[3] = 
	`î32
(
	`RDLEN
(0));

629 
ªgs_buff
[4] = 
	`î32
(
	`RDH
(0));

630 
ªgs_buff
[5] = 
	`î32
(
	`RDT
(0));

631 
ªgs_buff
[6] = 
	`î32
(
RDTR
);

633 
ªgs_buff
[7] = 
	`î32
(
TCTL
);

634 
ªgs_buff
[8] = 
	`î32
(
	`TDLEN
(0));

635 
ªgs_buff
[9] = 
	`î32
(
	`TDH
(0));

636 
ªgs_buff
[10] = 
	`î32
(
	`TDT
(0));

637 
ªgs_buff
[11] = 
	`î32
(
TIDV
);

639 
ªgs_buff
[12] = 
ad≠ãr
->
hw
.
phy
.
ty≥
;

644 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_m88
) {

645 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_STATUS
, &
phy_d©a
);

646 
ªgs_buff
[13] = (
u32
)
phy_d©a
;

647 
ªgs_buff
[14] = 0;

648 
ªgs_buff
[15] = 0;

649 
ªgs_buff
[16] = 0;

650 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

651 
ªgs_buff
[17] = (
u32
)
phy_d©a
;

652 
ªgs_buff
[18] =Ñegs_buff[13];

653 
ªgs_buff
[19] = 0;

654 
ªgs_buff
[20] =Ñegs_buff[17];

656 
ªgs_buff
[22] = 
ad≠ãr
->
phy_°©s
.
ª˚ive_îr‹s
;

657 
ªgs_buff
[23] =Ñegs_buff[13];

659 
ªgs_buff
[21] = 0;

660 
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
phy_d©a
);

661 
ªgs_buff
[24] = (
u32
)
phy_d©a
;

662 
ªgs_buff
[25] =Ñegs_buff[24];

664 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

665 
	}
}

667 
	$e1000_gë_ì¥om_Àn
(
√t_devi˚
 *
√tdev
)

669 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

670  
ad≠ãr
->
hw
.
nvm
.
w‹d_size
 * 2;

671 
	}
}

673 
	$e1000_gë_ì¥om
(
√t_devi˚
 *
√tdev
,

674 
ëhtoﬁ_ì¥om
 *
ì¥om
, 
u8
 *
byãs
)

676 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

677 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

678 
u16
 *
ì¥om_buff
;

679 
fú°_w‹d
;

680 
œ°_w‹d
;

681 
ªt_vÆ
 = 0;

682 
u16
 
i
;

684 i‡(
ì¥om
->
Àn
 == 0)

685  -
EINVAL
;

687 
ì¥om
->
magic
 = 
ad≠ãr
->
pdev
->
víd‹
 | (ad≠ãr->pdev->
devi˚
 << 16);

689 
fú°_w‹d
 = 
ì¥om
->
off£t
 >> 1;

690 
œ°_w‹d
 = (
ì¥om
->
off£t
 +Éïrom->
Àn
 - 1) >> 1;

692 
ì¥om_buff
 = 
	`kmÆloc
((
u16
Ë* (
œ°_w‹d
 - 
fú°_w‹d
 + 1),

693 
GFP_KERNEL
);

694 i‡(!
ì¥om_buff
)

695  -
ENOMEM
;

697 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

699 i‡(
hw
->
nvm
.
ty≥
 =
e1000_nvm_ì¥om_•i
) {

700 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
fú°_w‹d
,

701 
œ°_w‹d
 - 
fú°_w‹d
 + 1,

702 
ì¥om_buff
);

704 
i
 = 0; i < 
œ°_w‹d
 - 
fú°_w‹d
 + 1; i++) {

705 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
fú°_w‹d
 + 
i
, 1,

706 &
ì¥om_buff
[
i
]);

707 i‡(
ªt_vÆ
)

712 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

714 i‡(
ªt_vÆ
) {

716 
	`mem£t
(
ì¥om_buff
, 0xff, (
u16
) *

717 (
œ°_w‹d
 - 
fú°_w‹d
 + 1));

720 
i
 = 0; i < 
œ°_w‹d
 - 
fú°_w‹d
 + 1; i++)

721 
	`À16_to_˝us
(&
ì¥om_buff
[
i
]);

724 
	`mem˝y
(
byãs
, (
u8
 *)
ì¥om_buff
 + (
ì¥om
->
off£t
 & 1),Éïrom->
Àn
);

725 
	`k‰ì
(
ì¥om_buff
);

727  
ªt_vÆ
;

728 
	}
}

730 
	$e1000_£t_ì¥om
(
√t_devi˚
 *
√tdev
,

731 
ëhtoﬁ_ì¥om
 *
ì¥om
, 
u8
 *
byãs
)

733 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

734 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

735 
u16
 *
ì¥om_buff
;

736 *
±r
;

737 
max_Àn
;

738 
fú°_w‹d
;

739 
œ°_w‹d
;

740 
ªt_vÆ
 = 0;

741 
u16
 
i
;

743 i‡(
ì¥om
->
Àn
 == 0)

744  -
EOPNOTSUPP
;

746 i‡(
ì¥om
->
magic
 !=

747 (
ad≠ãr
->
pdev
->
víd‹
 | (ad≠ãr->pdev->
devi˚
 << 16)))

748  -
EFAULT
;

750 
max_Àn
 = 
hw
->
nvm
.
w‹d_size
 * 2;

752 
fú°_w‹d
 = 
ì¥om
->
off£t
 >> 1;

753 
œ°_w‹d
 = (
ì¥om
->
off£t
 +Éïrom->
Àn
 - 1) >> 1;

754 
ì¥om_buff
 = 
	`kmÆloc
(
max_Àn
, 
GFP_KERNEL
);

755 i‡(!
ì¥om_buff
)

756  -
ENOMEM
;

758 
±r
 = (*)
ì¥om_buff
;

760 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

762 i‡(
ì¥om
->
off£t
 & 1) {

765 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
fú°_w‹d
, 1, &
ì¥om_buff
[0]);

766 
±r
++;

768 i‡(((
ì¥om
->
off£t
 +Éïrom->
Àn
Ë& 1Ë&& (!
ªt_vÆ
))

771 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
œ°_w‹d
, 1,

772 &
ì¥om_buff
[
œ°_w‹d
 - 
fú°_w‹d
]);

774 i‡(
ªt_vÆ
)

775 
out
;

778 
i
 = 0; i < 
œ°_w‹d
 - 
fú°_w‹d
 + 1; i++)

779 
	`À16_to_˝us
(&
ì¥om_buff
[
i
]);

781 
	`mem˝y
(
±r
, 
byãs
, 
ì¥om
->
Àn
);

783 
i
 = 0; i < 
œ°_w‹d
 - 
fú°_w‹d
 + 1; i++)

784 
	`˝u_to_À16s
(&
ì¥om_buff
[
i
]);

786 
ªt_vÆ
 = 
	`e1000_wrôe_nvm
(
hw
, 
fú°_w‹d
,

787 
œ°_w‹d
 - 
fú°_w‹d
 + 1, 
ì¥om_buff
);

789 i‡(
ªt_vÆ
)

790 
out
;

795 i‡((
fú°_w‹d
 <
NVM_CHECKSUM_REG
) ||

796 (
hw
->
mac
.
ty≥
 =
e1000_82583
) ||

797 (
hw
->
mac
.
ty≥
 =
e1000_82574
) ||

798 (
hw
->
mac
.
ty≥
 =
e1000_82573
))

799 
ªt_vÆ
 = 
	`e1000e_upd©e_nvm_checksum
(
hw
);

801 
out
:

802 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

803 
	`k‰ì
(
ì¥om_buff
);

804  
ªt_vÆ
;

805 
	}
}

807 
	$e1000_gë_drvöfo
(
√t_devi˚
 *
√tdev
,

808 
ëhtoﬁ_drvöfo
 *
drvöfo
)

810 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

812 
	`°æ˝y
(
drvöfo
->
drivî
, 
e1000e_drivî_«me
, (drvinfo->driver));

813 
	`°æ˝y
(
drvöfo
->
vîsi⁄
, 
e1000e_drivî_vîsi⁄
,

814 (
drvöfo
->
vîsi⁄
));

819 
	`¢¥ötf
(
drvöfo
->
fw_vîsi⁄
, (drvinfo->fw_version),

821 (
ad≠ãr
->
ì¥om_vîs
 & 0xF000) >> 12,

822 (
ad≠ãr
->
ì¥om_vîs
 & 0x0FF0) >> 4,

823 (
ad≠ãr
->
ì¥om_vîs
 & 0x000F));

825 
	`°æ˝y
(
drvöfo
->
bus_öfo
, 
	`pci_«me
(
ad≠ãr
->
pdev
),

826 (
drvöfo
->
bus_öfo
));

827 
drvöfo
->
ªgdump_Àn
 = 
	`e1000_gë_ªgs_Àn
(
√tdev
);

828 
drvöfo
->
ìdump_Àn
 = 
	`e1000_gë_ì¥om_Àn
(
√tdev
);

829 
	}
}

831 
	$e1000_gë_rög∑øm
(
√t_devi˚
 *
√tdev
,

832 
ëhtoﬁ_rög∑øm
 *
rög
)

834 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

836 
rög
->
rx_max_≥ndög
 = 
E1000_MAX_RXD
;

837 
rög
->
tx_max_≥ndög
 = 
E1000_MAX_TXD
;

838 
rög
->
rx_≥ndög
 = 
ad≠ãr
->
rx_rög_cou¡
;

839 
rög
->
tx_≥ndög
 = 
ad≠ãr
->
tx_rög_cou¡
;

840 
	}
}

842 
	$e1000_£t_rög∑øm
(
√t_devi˚
 *
√tdev
,

843 
ëhtoﬁ_rög∑øm
 *
rög
)

845 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

846 
e1000_rög
 *
ãmp_tx
 = 
NULL
, *
ãmp_rx
 = NULL;

847 
îr
 = 0, 
size
 = (
e1000_rög
);

848 
boﬁ
 
£t_tx
 = 
Ál£
, 
£t_rx
 = false;

849 
u16
 
√w_rx_cou¡
, 
√w_tx_cou¡
;

851 i‡((
rög
->
rx_möi_≥ndög
Ë|| (rög->
rx_jumbo_≥ndög
))

852  -
EINVAL
;

854 
√w_rx_cou¡
 = 
	`˛amp_t
(
u32
, 
rög
->
rx_≥ndög
, 
E1000_MIN_RXD
,

855 
E1000_MAX_RXD
);

856 
√w_rx_cou¡
 = 
	`ALIGN
“ew_rx_cou¡, 
REQ_RX_DESCRIPTOR_MULTIPLE
);

858 
√w_tx_cou¡
 = 
	`˛amp_t
(
u32
, 
rög
->
tx_≥ndög
, 
E1000_MIN_TXD
,

859 
E1000_MAX_TXD
);

860 
√w_tx_cou¡
 = 
	`ALIGN
“ew_tx_cou¡, 
REQ_TX_DESCRIPTOR_MULTIPLE
);

862 i‡((
√w_tx_cou¡
 =
ad≠ãr
->
tx_rög_cou¡
) &&

863 (
√w_rx_cou¡
 =
ad≠ãr
->
rx_rög_cou¡
))

867 
	`ã°_™d_£t_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
))

868 
	`u¶ìp_ønge
(1000, 2000);

870 i‡(!
	`√tif_ru¬ög
(
ad≠ãr
->
√tdev
)) {

872 
ad≠ãr
->
tx_rög
->
cou¡
 = 
√w_tx_cou¡
;

873 
ad≠ãr
->
rx_rög
->
cou¡
 = 
√w_rx_cou¡
;

874 
ad≠ãr
->
tx_rög_cou¡
 = 
√w_tx_cou¡
;

875 
ad≠ãr
->
rx_rög_cou¡
 = 
√w_rx_cou¡
;

876 
˛ór_ª£t
;

879 
£t_tx
 = (
√w_tx_cou¡
 !
ad≠ãr
->
tx_rög_cou¡
);

880 
£t_rx
 = (
√w_rx_cou¡
 !
ad≠ãr
->
rx_rög_cou¡
);

883 i‡(
£t_tx
) {

884 
ãmp_tx
 = 
	`vmÆloc
(
size
);

885 i‡(!
ãmp_tx
) {

886 
îr
 = -
ENOMEM
;

887 
‰ì_ãmp
;

890 i‡(
£t_rx
) {

891 
ãmp_rx
 = 
	`vmÆloc
(
size
);

892 i‡(!
ãmp_rx
) {

893 
îr
 = -
ENOMEM
;

894 
‰ì_ãmp
;

898 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

900 
	`e1000e_down
(
ad≠ãr
, 
åue
);

906 i‡(
£t_tx
) {

907 
	`mem˝y
(
ãmp_tx
, 
ad≠ãr
->
tx_rög
, 
size
);

908 
ãmp_tx
->
cou¡
 = 
√w_tx_cou¡
;

909 
îr
 = 
	`e1000e_£tup_tx_ªsour˚s
(
ãmp_tx
);

910 i‡(
îr
)

911 
îr_£tup
;

913 i‡(
£t_rx
) {

914 
	`mem˝y
(
ãmp_rx
, 
ad≠ãr
->
rx_rög
, 
size
);

915 
ãmp_rx
->
cou¡
 = 
√w_rx_cou¡
;

916 
îr
 = 
	`e1000e_£tup_rx_ªsour˚s
(
ãmp_rx
);

917 i‡(
îr
)

918 
îr_£tup_rx
;

922 i‡(
£t_tx
) {

923 
	`e1000e_‰ì_tx_ªsour˚s
(
ad≠ãr
->
tx_rög
);

924 
	`mem˝y
(
ad≠ãr
->
tx_rög
, 
ãmp_tx
, 
size
);

925 
ad≠ãr
->
tx_rög_cou¡
 = 
√w_tx_cou¡
;

927 i‡(
£t_rx
) {

928 
	`e1000e_‰ì_rx_ªsour˚s
(
ad≠ãr
->
rx_rög
);

929 
	`mem˝y
(
ad≠ãr
->
rx_rög
, 
ãmp_rx
, 
size
);

930 
ad≠ãr
->
rx_rög_cou¡
 = 
√w_rx_cou¡
;

933 
îr_£tup_rx
:

934 i‡(
îr
 && 
£t_tx
)

935 
	`e1000e_‰ì_tx_ªsour˚s
(
ãmp_tx
);

936 
îr_£tup
:

937 
	`e1000e_up
(
ad≠ãr
);

938 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

939 
‰ì_ãmp
:

940 
	`v‰ì
(
ãmp_tx
);

941 
	`v‰ì
(
ãmp_rx
);

942 
˛ór_ª£t
:

943 
	`˛ór_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
);

944  
îr
;

945 
	}
}

947 
boﬁ
 
	$ªg_∑âîn_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
,

948 
ªg
, 
off£t
, 
u32
 
mask
, u32 
wrôe
)

950 
u32
 
∑t
, 
vÆ
;

951 c⁄° 
u32
 
ã°
[] = {

954 
∑t
 = 0;Ö© < 
	`ARRAY_SIZE
(
ã°
);Öat++) {

955 
	`E1000_WRITE_REG_ARRAY
(&
ad≠ãr
->
hw
, 
ªg
, 
off£t
,

956 (
ã°
[
∑t
] & 
wrôe
));

957 
vÆ
 = 
	`E1000_READ_REG_ARRAY
(&
ad≠ãr
->
hw
, 
ªg
, 
off£t
);

958 i‡(
vÆ
 !(
ã°
[
∑t
] & 
wrôe
 & 
mask
)) {

959 
	`e_îr
("patternÅest failed (reg 0x%05X): got 0x%08XÉxpected 0x%08X\n",

960 
ªg
 + (
off£t
 << 2), 
vÆ
,

961 (
ã°
[
∑t
] & 
wrôe
 & 
mask
));

962 *
d©a
 = 
ªg
;

967 
	}
}

969 
boﬁ
 
	$ªg_£t_™d_check
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
,

970 
ªg
, 
u32
 
mask
, u32 
wrôe
)

972 
u32
 
vÆ
;

973 
	`__ew32
(&
ad≠ãr
->
hw
, 
ªg
, 
wrôe
 & 
mask
);

974 
vÆ
 = 
	`__î32
(&
ad≠ãr
->
hw
, 
ªg
);

975 i‡((
wrôe
 & 
mask
Ë!(
vÆ
 & mask)) {

976 
	`e_îr
("set/checkÅest failed (reg 0x%05X): got 0x%08XÉxpected 0x%08X\n",

977 
ªg
, (
vÆ
 & 
mask
), (
wrôe
 & mask));

978 *
d©a
 = 
ªg
;

982 
	}
}

984 
	#REG_PATTERN_TEST_ARRAY
(
ªg
, 
off£t
, 
mask
, 
wrôe
) \

986 i‡(
	`ªg_∑âîn_ã°
(
ad≠ãr
, 
d©a
, 
ªg
, 
off£t
, 
mask
, 
wrôe
)) \

988 } 0)

	)

989 
	#REG_PATTERN_TEST
(
ªg
, 
mask
, 
wrôe
) \

990 
	`REG_PATTERN_TEST_ARRAY
(
ªg
, 0, 
mask
, 
wrôe
)

	)

992 
	#REG_SET_AND_CHECK
(
ªg
, 
mask
, 
wrôe
) \

994 i‡(
	`ªg_£t_™d_check
(
ad≠ãr
, 
d©a
, 
ªg
, 
mask
, 
wrôe
)) \

996 } 0)

	)

998 
	$e1000_ªg_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
)

1000 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1001 
e1000_mac_öfo
 *
mac
 = &
ad≠ãr
->
hw
.mac;

1002 
u32
 
vÆue
;

1003 
u32
 
bef‹e
;

1004 
u32
 
a·î
;

1005 
u32
 
i
;

1006 
u32
 
toggÀ
;

1007 
u32
 
mask
;

1008 
u32
 
wlock_mac
 = 0;

1014 
mac
->
ty≥
) {

1015 
e1000_82571
:

1016 
e1000_82572
:

1017 
e1000_80003es2œn
:

1018 
toggÀ
 = 0x7FFFF3FF;

1021 
toggÀ
 = 0x7FFFF033;

1025 
bef‹e
 = 
	`î32
(
STATUS
);

1026 
vÆue
 = (
	`î32
(
STATUS
Ë& 
toggÀ
);

1027 
	`ew32
(
STATUS
, 
toggÀ
);

1028 
a·î
 = 
	`î32
(
STATUS
Ë& 
toggÀ
;

1029 i‡(
vÆue
 !
a·î
) {

1030 
	`e_îr
("failed STATUSÑegisterÅest got: 0x%08XÉxpected: 0x%08X\n",

1031 
a·î
, 
vÆue
);

1032 *
d©a
 = 1;

1036 
	`ew32
(
STATUS
, 
bef‹e
);

1038 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
)) {

1039 
	`REG_PATTERN_TEST
(
E1000_FCAL
, 0xFFFFFFFF, 0xFFFFFFFF);

1040 
	`REG_PATTERN_TEST
(
E1000_FCAH
, 0x0000FFFF, 0xFFFFFFFF);

1041 
	`REG_PATTERN_TEST
(
E1000_FCT
, 0x0000FFFF, 0xFFFFFFFF);

1042 
	`REG_PATTERN_TEST
(
E1000_VET
, 0x0000FFFF, 0xFFFFFFFF);

1045 
	`REG_PATTERN_TEST
(
E1000_RDTR
, 0x0000FFFF, 0xFFFFFFFF);

1046 
	`REG_PATTERN_TEST
(
	`E1000_RDBAH
(0), 0xFFFFFFFF, 0xFFFFFFFF);

1047 
	`REG_PATTERN_TEST
(
	`E1000_RDLEN
(0), 0x000FFF80, 0x000FFFFF);

1048 
	`REG_PATTERN_TEST
(
	`E1000_RDH
(0), 0x0000FFFF, 0x0000FFFF);

1049 
	`REG_PATTERN_TEST
(
	`E1000_RDT
(0), 0x0000FFFF, 0x0000FFFF);

1050 
	`REG_PATTERN_TEST
(
E1000_FCRTH
, 0x0000FFF8, 0x0000FFF8);

1051 
	`REG_PATTERN_TEST
(
E1000_FCTTV
, 0x0000FFFF, 0x0000FFFF);

1052 
	`REG_PATTERN_TEST
(
E1000_TIPG
, 0x3FFFFFFF, 0x3FFFFFFF);

1053 
	`REG_PATTERN_TEST
(
	`E1000_TDBAH
(0), 0xFFFFFFFF, 0xFFFFFFFF);

1054 
	`REG_PATTERN_TEST
(
	`E1000_TDLEN
(0), 0x000FFF80, 0x000FFFFF);

1056 
	`REG_SET_AND_CHECK
(
E1000_RCTL
, 0xFFFFFFFF, 0x00000000);

1058 
bef‹e
 = ((
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
) ? 0x06C3B33E : 0x06DFB3FE);

1059 
	`REG_SET_AND_CHECK
(
E1000_RCTL
, 
bef‹e
, 0x003FFFFB);

1060 
	`REG_SET_AND_CHECK
(
E1000_TCTL
, 0xFFFFFFFF, 0x00000000);

1062 
	`REG_SET_AND_CHECK
(
E1000_RCTL
, 
bef‹e
, 0xFFFFFFFF);

1063 
	`REG_PATTERN_TEST
(
	`E1000_RDBAL
(0), 0xFFFFFFF0, 0xFFFFFFFF);

1064 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
))

1065 
	`REG_PATTERN_TEST
(
E1000_TXCW
, 0xC000FFFF, 0x0000FFFF);

1066 
	`REG_PATTERN_TEST
(
	`E1000_TDBAL
(0), 0xFFFFFFF0, 0xFFFFFFFF);

1067 
	`REG_PATTERN_TEST
(
E1000_TIDV
, 0x0000FFFF, 0x0000FFFF);

1068 
mask
 = 0x8003FFFF;

1069 
mac
->
ty≥
) {

1070 
e1000_ich10œn
:

1071 
e1000_pchœn
:

1072 
e1000_pch2œn
:

1073 
e1000_pch_Õt
:

1074 
mask
 |= (1 << 18);

1080 i‡(
mac
->
ty≥
 =
e1000_pch_Õt
)

1081 
wlock_mac
 = (
	`î32
(
FWSM
Ë& 
E1000_FWSM_WLOCK_MAC_MASK
) >>

1082 
E1000_FWSM_WLOCK_MAC_SHIFT
;

1084 
i
 = 0; i < 
mac
->
ør_íåy_cou¡
; i++) {

1085 i‡(
mac
->
ty≥
 =
e1000_pch_Õt
) {

1087 i‡((
wlock_mac
 =1Ë|| (wlock_ma¯&& (
i
 > wlock_mac)))

1091 i‡(
i
 == 10)

1092 
mask
 |= (1 << 30);

1094 
mask
 &= ~(1 << 30);

1096 i‡(
mac
->
ty≥
 =
e1000_pch2œn
) {

1098 i‡(
i
 == 7)

1099 
mask
 &= 0xFFF4FFFF;

1101 i‡(
i
 == 10)

1102 
mask
 |= (1 << 30);

1105 
	`REG_PATTERN_TEST_ARRAY
(
E1000_RA
, ((
i
 << 1Ë+ 1), 
mask
,

1109 
i
 = 0; i < 
mac
->
mè_ªg_cou¡
; i++)

1110 
	`REG_PATTERN_TEST_ARRAY
(
E1000_MTA
, 
i
, 0xFFFFFFFF, 0xFFFFFFFF);

1112 *
d©a
 = 0;

1115 
	}
}

1117 
	$e1000_ì¥om_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
)

1119 
u16
 
ãmp
;

1120 
u16
 
checksum
 = 0;

1121 
u16
 
i
;

1123 *
d©a
 = 0;

1125 
i
 = 0; i < (
NVM_CHECKSUM_REG
 + 1); i++) {

1126 i‡((
	`e1000_ªad_nvm
(&
ad≠ãr
->
hw
, 
i
, 1, &
ãmp
)) < 0) {

1127 *
d©a
 = 1;

1128  *
d©a
;

1130 
checksum
 +
ãmp
;

1134 i‡((
checksum
 !(
u16
)
NVM_SUM
Ë&& !(*
d©a
))

1135 *
d©a
 = 2;

1137  *
d©a
;

1138 
	}
}

1140 
úqªtu∫_t
 
	$e1000_ã°_öå
(
__Æways_unu£d
 
úq
, *
d©a
)

1142 
√t_devi˚
 *
√tdev
 = (√t_devi˚ *)
d©a
;

1143 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1144 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1146 
ad≠ãr
->
ã°_i¸
 |
	`î32
(
ICR
);

1148  
IRQ_HANDLED
;

1149 
	}
}

1151 
	$e1000_öå_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
)

1153 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

1154 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1155 
u32
 
mask
;

1156 
u32
 
sh¨ed_öt
 = 1;

1157 
u32
 
úq
 = 
ad≠ãr
->
pdev
->irq;

1158 
i
;

1159 
ªt_vÆ
 = 0;

1160 
öt_mode
 = 
E1000E_INT_MODE_LEGACY
;

1162 *
d©a
 = 0;

1165 i‡(
ad≠ãr
->
öt_mode
 =
E1000E_INT_MODE_MSIX
) {

1166 
öt_mode
 = 
ad≠ãr
->int_mode;

1167 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

1168 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_LEGACY
;

1169 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

1172 i‡(!
	`ªque°_úq
(
úq
, 
e1000_ã°_öå
, 
IRQF_PROBE_SHARED
, 
√tdev
->
«me
,

1173 
√tdev
)) {

1174 
sh¨ed_öt
 = 0;

1175 } i‡(
	`ªque°_úq
(
úq
, 
e1000_ã°_öå
, 
IRQF_SHARED
, 
√tdev
->
«me
,

1176 
√tdev
)) {

1177 *
d©a
 = 1;

1178 
ªt_vÆ
 = -1;

1179 
out
;

1181 
	`e_öfo
("ã°ög %†öãºu±\n", (
sh¨ed_öt
 ? "shared" : "unshared"));

1184 
	`ew32
(
IMC
, 0xFFFFFFFF);

1185 
	`e1e_Êush
();

1186 
	`u¶ìp_ønge
(10000, 20000);

1189 
i
 = 0; i < 10; i++) {

1191 
mask
 = 1 << 
i
;

1193 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
) {

1194 
mask
) {

1195 
E1000_ICR_RXSEQ
:

1198 i‡(
ad≠ãr
->
hw
.
mac
.
ty≥
 =
e1000_ich8œn
 ||

1199 
ad≠ãr
->
hw
.
mac
.
ty≥
 =
e1000_ich9œn
)

1207 i‡(!
sh¨ed_öt
) {

1214 
ad≠ãr
->
ã°_i¸
 = 0;

1215 
	`ew32
(
IMC
, 
mask
);

1216 
	`ew32
(
ICS
, 
mask
);

1217 
	`e1e_Êush
();

1218 
	`u¶ìp_ønge
(10000, 20000);

1220 i‡(
ad≠ãr
->
ã°_i¸
 & 
mask
) {

1221 *
d©a
 = 3;

1232 
ad≠ãr
->
ã°_i¸
 = 0;

1233 
	`ew32
(
IMS
, 
mask
);

1234 
	`ew32
(
ICS
, 
mask
);

1235 
	`e1e_Êush
();

1236 
	`u¶ìp_ønge
(10000, 20000);

1238 i‡(!(
ad≠ãr
->
ã°_i¸
 & 
mask
)) {

1239 *
d©a
 = 4;

1243 i‡(!
sh¨ed_öt
) {

1250 
ad≠ãr
->
ã°_i¸
 = 0;

1251 
	`ew32
(
IMC
, ~
mask
 & 0x00007FFF);

1252 
	`ew32
(
ICS
, ~
mask
 & 0x00007FFF);

1253 
	`e1e_Êush
();

1254 
	`u¶ìp_ønge
(10000, 20000);

1256 i‡(
ad≠ãr
->
ã°_i¸
) {

1257 *
d©a
 = 5;

1264 
	`ew32
(
IMC
, 0xFFFFFFFF);

1265 
	`e1e_Êush
();

1266 
	`u¶ìp_ønge
(10000, 20000);

1269 
	`‰ì_úq
(
úq
, 
√tdev
);

1271 
out
:

1272 i‡(
öt_mode
 =
E1000E_INT_MODE_MSIX
) {

1273 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

1274 
ad≠ãr
->
öt_mode
 = int_mode;

1275 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

1278  
ªt_vÆ
;

1279 
	}
}

1281 
	$e1000_‰ì_desc_rögs
(
e1000_ad≠ãr
 *
ad≠ãr
)

1283 
e1000_rög
 *
tx_rög
 = &
ad≠ãr
->
ã°_tx_rög
;

1284 
e1000_rög
 *
rx_rög
 = &
ad≠ãr
->
ã°_rx_rög
;

1285 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1286 
e1000_buf„r
 *
buf„r_öfo
;

1287 
i
;

1289 i‡(
tx_rög
->
desc
 &&Åx_rög->
buf„r_öfo
) {

1290 
i
 = 0; i < 
tx_rög
->
cou¡
; i++) {

1291 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

1293 i‡(
buf„r_öfo
->
dma
)

1294 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
),

1295 
buf„r_öfo
->
dma
,

1296 
buf„r_öfo
->
Àngth
,

1297 
DMA_TO_DEVICE
);

1298 i‡(
buf„r_öfo
->
skb
)

1299 
	`dev_k‰ì_skb
(
buf„r_öfo
->
skb
);

1303 i‡(
rx_rög
->
desc
 &&Ñx_rög->
buf„r_öfo
) {

1304 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

1305 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

1307 i‡(
buf„r_öfo
->
dma
)

1308 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
),

1309 
buf„r_öfo
->
dma
,

1310 2048, 
DMA_FROM_DEVICE
);

1311 i‡(
buf„r_öfo
->
skb
)

1312 
	`dev_k‰ì_skb
(
buf„r_öfo
->
skb
);

1316 i‡(
tx_rög
->
desc
) {

1317 
	`dma_‰ì_cohîít
(
	`pci_dev_to_dev
(
pdev
), 
tx_rög
->
size
,

1318 
tx_rög
->
desc
,Åx_rög->
dma
);

1319 
tx_rög
->
desc
 = 
NULL
;

1321 i‡(
rx_rög
->
desc
) {

1322 
	`dma_‰ì_cohîít
(
	`pci_dev_to_dev
(
pdev
), 
rx_rög
->
size
,

1323 
rx_rög
->
desc
,Ñx_rög->
dma
);

1324 
rx_rög
->
desc
 = 
NULL
;

1327 
	`k‰ì
(
tx_rög
->
buf„r_öfo
);

1328 
tx_rög
->
buf„r_öfo
 = 
NULL
;

1329 
	`k‰ì
(
rx_rög
->
buf„r_öfo
);

1330 
rx_rög
->
buf„r_öfo
 = 
NULL
;

1331 
	}
}

1333 
	$e1000_£tup_desc_rögs
(
e1000_ad≠ãr
 *
ad≠ãr
)

1335 
e1000_rög
 *
tx_rög
 = &
ad≠ãr
->
ã°_tx_rög
;

1336 
e1000_rög
 *
rx_rög
 = &
ad≠ãr
->
ã°_rx_rög
;

1337 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1338 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1339 
u32
 
r˘l
;

1340 
i
;

1341 
ªt_vÆ
;

1345 i‡(!
tx_rög
->
cou¡
)

1346 
tx_rög
->
cou¡
 = 
E1000_DEFAULT_TXD
;

1348 
tx_rög
->
buf„r_öfo
 = 
	`kˇŒoc
—x_rög->
cou¡
,

1349 (
e1000_buf„r
), 
GFP_KERNEL
);

1350 i‡(!
tx_rög
->
buf„r_öfo
) {

1351 
ªt_vÆ
 = 1;

1352 
îr_nomem
;

1355 
tx_rög
->
size
 =Åx_rög->
cou¡
 * (
e1000_tx_desc
);

1356 
tx_rög
->
size
 = 
	`ALIGN
(tx_ring->size, 4096);

1357 
tx_rög
->
desc
 = 
	`dma_Æloc_cohîít
(
	`pci_dev_to_dev
(
pdev
),Åx_rög->
size
,

1358 &
tx_rög
->
dma
, 
GFP_KERNEL
);

1359 i‡(!
tx_rög
->
desc
) {

1360 
ªt_vÆ
 = 2;

1361 
îr_nomem
;

1363 
tx_rög
->
√xt_to_u£
 = 0;

1364 
tx_rög
->
√xt_to_˛ón
 = 0;

1366 
	`ew32
(
	`TDBAL
(0), ((
u64
)
tx_rög
->
dma
 & 0x00000000FFFFFFFF));

1367 
	`ew32
(
	`TDBAH
(0), ((
u64
)
tx_rög
->
dma
 >> 32));

1368 
	`ew32
(
	`TDLEN
(0), 
tx_rög
->
cou¡
 * (
e1000_tx_desc
));

1369 
	`ew32
(
	`TDH
(0), 0);

1370 
	`ew32
(
	`TDT
(0), 0);

1371 
	`ew32
(
TCTL
, 
E1000_TCTL_PSP
 | 
E1000_TCTL_EN
 | 
E1000_TCTL_MULR
 |

1372 
E1000_COLLISION_THRESHOLD
 << 
E1000_CT_SHIFT
 |

1373 
E1000_COLLISION_DISTANCE
 << 
E1000_COLD_SHIFT
);

1375 
i
 = 0; i < 
tx_rög
->
cou¡
; i++) {

1376 
e1000_tx_desc
 *
tx_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
i
);

1377 
sk_buff
 *
skb
;

1378 
skb_size
 = 1024;

1380 
skb
 = 
	`Æloc_skb
(
skb_size
, 
GFP_KERNEL
);

1381 i‡(!
skb
) {

1382 
ªt_vÆ
 = 3;

1383 
îr_nomem
;

1385 
	`skb_put
(
skb
, 
skb_size
);

1386 
tx_rög
->
buf„r_öfo
[
i
].
skb
 = skb;

1387 
tx_rög
->
buf„r_öfo
[
i
].
Àngth
 = 
skb
->
Àn
;

1388 
tx_rög
->
buf„r_öfo
[
i
].
dma
 =

1389 
	`dma_m≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
skb
->
d©a
, skb->
Àn
,

1390 
DMA_TO_DEVICE
);

1391 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
),

1392 
tx_rög
->
buf„r_öfo
[
i
].
dma
)) {

1393 
ªt_vÆ
 = 4;

1394 
îr_nomem
;

1396 
tx_desc
->
buf„r_addr
 = 
	`˝u_to_À64
(
tx_rög
->
buf„r_öfo
[
i
].
dma
);

1397 
tx_desc
->
lowî
.
d©a
 = 
	`˝u_to_À32
(
skb
->
Àn
);

1398 
tx_desc
->
lowî
.
d©a
 |
	`˝u_to_À32
(
E1000_TXD_CMD_EOP
 |

1399 
E1000_TXD_CMD_IFCS
 |

1400 
E1000_TXD_CMD_RS
);

1401 
tx_desc
->
uµî
.
d©a
 = 0;

1406 i‡(!
rx_rög
->
cou¡
)

1407 
rx_rög
->
cou¡
 = 
E1000_DEFAULT_RXD
;

1409 
rx_rög
->
buf„r_öfo
 = 
	`kˇŒoc
‘x_rög->
cou¡
,

1410 (
e1000_buf„r
), 
GFP_KERNEL
);

1411 i‡(!
rx_rög
->
buf„r_öfo
) {

1412 
ªt_vÆ
 = 5;

1413 
îr_nomem
;

1416 
rx_rög
->
size
 =Ñx_rög->
cou¡
 * (
e1000_rx_desc_exãnded
);

1417 
rx_rög
->
desc
 = 
	`dma_Æloc_cohîít
(
	`pci_dev_to_dev
(
pdev
),Ñx_rög->
size
,

1418 &
rx_rög
->
dma
, 
GFP_KERNEL
);

1419 i‡(!
rx_rög
->
desc
) {

1420 
ªt_vÆ
 = 6;

1421 
îr_nomem
;

1423 
rx_rög
->
√xt_to_u£
 = 0;

1424 
rx_rög
->
√xt_to_˛ón
 = 0;

1426 
r˘l
 = 
	`î32
(
RCTL
);

1427 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_NO_DISABLE_RX
))

1428 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

1429 
	`ew32
(
	`RDBAL
(0), ((
u64
)
rx_rög
->
dma
 & 0xFFFFFFFF));

1430 
	`ew32
(
	`RDBAH
(0), ((
u64
)
rx_rög
->
dma
 >> 32));

1431 
	`ew32
(
	`RDLEN
(0), 
rx_rög
->
size
);

1432 
	`ew32
(
	`RDH
(0), 0);

1433 
	`ew32
(
	`RDT
(0), 0);

1434 
r˘l
 = 
E1000_RCTL_EN
 | 
E1000_RCTL_BAM
 | 
E1000_RCTL_SZ_2048
 |

1435 
E1000_RCTL_UPE
 | 
E1000_RCTL_MPE
 | 
E1000_RCTL_LPE
 |

1436 
E1000_RCTL_SBP
 | 
E1000_RCTL_SECRC
 |

1437 
E1000_RCTL_LBM_NO
 | 
E1000_RCTL_RDMTS_HALF
 |

1438 (
ad≠ãr
->
hw
.
mac
.
mc_fûãr_ty≥
 << 
E1000_RCTL_MO_SHIFT
);

1439 
	`ew32
(
RCTL
, 
r˘l
);

1441 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

1442 
e1000_rx_desc_exãnded
 *
rx_desc
;

1443 
sk_buff
 *
skb
;

1445 
skb
 = 
	`Æloc_skb
(2048 + 
NET_IP_ALIGN
, 
GFP_KERNEL
);

1446 i‡(!
skb
) {

1447 
ªt_vÆ
 = 7;

1448 
îr_nomem
;

1450 
	`skb_ª£rve
(
skb
, 
NET_IP_ALIGN
);

1451 
rx_rög
->
buf„r_öfo
[
i
].
skb
 = skb;

1452 
rx_rög
->
buf„r_öfo
[
i
].
dma
 =

1453 
	`dma_m≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
skb
->
d©a
, 2048,

1454 
DMA_FROM_DEVICE
);

1455 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
),

1456 
rx_rög
->
buf„r_öfo
[
i
].
dma
)) {

1457 
ªt_vÆ
 = 8;

1458 
îr_nomem
;

1460 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

1461 
rx_desc
->
ªad
.
buf„r_addr
 =

1462 
	`˝u_to_À64
(
rx_rög
->
buf„r_öfo
[
i
].
dma
);

1463 
	`mem£t
(
skb
->
d©a
, 0x00, skb->
Àn
);

1468 
îr_nomem
:

1469 
	`e1000_‰ì_desc_rögs
(
ad≠ãr
);

1470  
ªt_vÆ
;

1471 
	}
}

1473 
	$e1000_phy_dißbÀ_ª˚ivî
(
e1000_ad≠ãr
 *
ad≠ãr
)

1476 
	`e1e_wphy
(&
ad≠ãr
->
hw
, 29, 0x001F);

1477 
	`e1e_wphy
(&
ad≠ãr
->
hw
, 30, 0x8FFC);

1478 
	`e1e_wphy
(&
ad≠ãr
->
hw
, 29, 0x001A);

1479 
	`e1e_wphy
(&
ad≠ãr
->
hw
, 30, 0x8FF0);

1480 
	}
}

1482 
	$e1000_öãgøãd_phy_lo›back
(
e1000_ad≠ãr
 *
ad≠ãr
)

1484 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1485 
u32
 
˘æ_ªg
 = 0;

1486 
u16
 
phy_ªg
 = 0;

1487 
s32
 
ªt_vÆ
 = 0;

1489 
hw
->
mac
.
aut⁄eg
 = 0;

1491 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
) {

1493 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 0x6100);

1496 
˘æ_ªg
 = 
	`î32
(
CTRL
);

1497 
˘æ_ªg
 &~
E1000_CTRL_SPD_SEL
;

1498 
˘æ_ªg
 |(
E1000_CTRL_FRCSPD
 |

1499 
E1000_CTRL_FRCDPX
 |

1500 
E1000_CTRL_SPD_100
 |

1501 
E1000_CTRL_FD
);

1503 
	`ew32
(
CTRL
, 
˘æ_ªg
);

1504 
	`e1e_Êush
();

1505 
	`u¶ìp_ønge
(500, 1000);

1511 
hw
->
phy
.
ty≥
) {

1512 
e1000_phy_m88
:

1514 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, 0x0808);

1516 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 0x9140);

1518 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 0x8140);

1520 
e1000_phy_gg82563
:

1521 
	`e1e_wphy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, 0x1CC);

1523 
e1000_phy_bm
:

1525 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(2, 21), &
phy_ªg
);

1526 
phy_ªg
 &= ~0x0007;

1527 
phy_ªg
 |= 0x006;

1528 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(2, 21), 
phy_ªg
);

1530 
hw
->
phy
.
›s
.
	`commô
(hw);

1531 
	`u¶ìp_ønge
(1000, 2000);

1533 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 16), &
phy_ªg
);

1534 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 16), 
phy_ªg
 | 0x000C);

1536 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(776, 16), &
phy_ªg
);

1537 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 16), 
phy_ªg
 | 0x0040);

1539 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 16), &
phy_ªg
);

1540 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 16), 
phy_ªg
 | 0x0040);

1542 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 20), &
phy_ªg
);

1543 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 20), 
phy_ªg
 | 0x0400);

1545 
e1000_phy_82577
:

1546 
e1000_phy_82578
:

1548 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1549 i‡(
ªt_vÆ
) {

1550 
	`e_îr
("Cannot setup 1GbpsÜoopback.\n");

1551  
ªt_vÆ
;

1553 
	`e1000_c⁄figuª_k1_ich8œn
(
hw
, 
Ál£
);

1554 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

1556 
e1000_phy_82579
:

1558 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(0, 21), &
phy_ªg
);

1559 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(0, 21), 
phy_ªg
 & ~(1 << 3));

1561 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(776, 18), &
phy_ªg
);

1562 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 18), 
phy_ªg
 | 1);

1564 
	`e1e_wphy
(
hw
, 
I82577_PHY_LBK_CTRL
, 0x8001);

1571 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 0x4140);

1572 
	`m¶ìp
(250);

1575 
˘æ_ªg
 = 
	`î32
(
CTRL
);

1576 
˘æ_ªg
 &~
E1000_CTRL_SPD_SEL
;

1577 
˘æ_ªg
 |(
E1000_CTRL_FRCSPD
 |

1578 
E1000_CTRL_FRCDPX
 |

1579 
E1000_CTRL_SPD_1000
 |

1580 
E1000_CTRL_FD
);

1582 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
)

1583 
˘æ_ªg
 |
E1000_CTRL_SLU
;

1585 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
 &&

1586 
hw
->
phy
.
ty≥
 =
e1000_phy_m88
) {

1587 
˘æ_ªg
 |
E1000_CTRL_ILOS
;

1592 i‡((
	`î32
(
STATUS
Ë& 
E1000_STATUS_FD
) == 0)

1593 
˘æ_ªg
 |(
E1000_CTRL_ILOS
 | 
E1000_CTRL_SLU
);

1596 
	`ew32
(
CTRL
, 
˘æ_ªg
);

1601 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_m88
)

1602 
	`e1000_phy_dißbÀ_ª˚ivî
(
ad≠ãr
);

1604 
	`u¶ìp_ønge
(500, 1000);

1607 
	}
}

1609 
	$e1000_£t_82571_fibî_lo›back
(
e1000_ad≠ãr
 *
ad≠ãr
)

1611 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1612 
u32
 
˘æ
 = 
	`î32
(
CTRL
);

1613 
lök
;

1620 
˘æ
 |
E1000_CTRL_SLU
;

1621 
	`ew32
(
CTRL
, 
˘æ
);

1624 
˘æ
 = 
	`î32
(
TXCW
);

1625 
˘æ
 &= ~(1 << 31);

1626 
	`ew32
(
TXCW
, 
˘æ
);

1628 
lök
 = (
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
);

1630 i‡(!
lök
) {

1632 
˘æ
 = 
	`î32
(
CTRL
);

1633 
˘æ
 |
E1000_CTRL_ILOS
;

1634 
	`ew32
(
CTRL
, 
˘æ
);

1640 
	`ew32
(
SCTL
, 
E1000_SCTL_ENABLE_SERDES_LOOPBACK
);

1641 
	`e1e_Êush
();

1642 
	`u¶ìp_ønge
(10000, 20000);

1645 
	}
}

1648 
	$e1000_£t_es2œn_mac_lo›back
(
e1000_ad≠ãr
 *
ad≠ãr
)

1650 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1651 
u32
 
˘æext
 = 
	`î32
(
CTRL_EXT
);

1652 
u32
 
˘æ
 = 
	`î32
(
CTRL
);

1657 
ad≠ãr
->
tx_fifo_hód
 = 
˘æext
;

1660 
˘æext
 &~
E1000_CTRL_EXT_LINK_MODE_PCIE_SERDES
;

1661 
	`ew32
(
CTRL_EXT
, 
˘æext
);

1664 
˘æ
 &~(
E1000_CTRL_SPD_1000
 | 
E1000_CTRL_SPD_100
);

1665 
˘æ
 |(
E1000_CTRL_SLU
 | 
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
 |

1666 
E1000_CTRL_SPD_1000
 | 
E1000_CTRL_FD
);

1667 
	`ew32
(
CTRL
, 
˘æ
);

1670 
˘æ
 = 
	`î32
(
RCTL
);

1671 
˘æ
 |
E1000_RCTL_LBM_MAC
;

1672 
	`ew32
(
RCTL
, 
˘æ
);

1675 
	#KMRNCTRLSTA_OPMODE
 (0x1F << 16)

	)

1676 
	#KMRNCTRLSTA_OPMODE_1GB_FD_GMII
 0x0582

	)

1677 
	`ew32
(
KMRNCTRLSTA
,

1678 (
KMRNCTRLSTA_OPMODE
 | 
KMRNCTRLSTA_OPMODE_1GB_FD_GMII
));

1681 
	}
}

1683 
	$e1000_£tup_lo›back_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
)

1685 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1686 
u32
 
r˘l
;

1688 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
 ||

1689 
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
) {

1690 
hw
->
mac
.
ty≥
) {

1691 
e1000_80003es2œn
:

1692  
	`e1000_£t_es2œn_mac_lo›back
(
ad≠ãr
);

1694 
e1000_82571
:

1695 
e1000_82572
:

1696  
	`e1000_£t_82571_fibî_lo›back
(
ad≠ãr
);

1699 
r˘l
 = 
	`î32
(
RCTL
);

1700 
r˘l
 |
E1000_RCTL_LBM_TCVR
;

1701 
	`ew32
(
RCTL
, 
r˘l
);

1704 } i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

1705  
	`e1000_öãgøãd_phy_lo›back
(
ad≠ãr
);

1709 
	}
}

1711 
	$e1000_lo›back_˛ónup
(
e1000_ad≠ãr
 *
ad≠ãr
)

1713 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1714 
u32
 
r˘l
;

1715 
u16
 
phy_ªg
;

1717 
r˘l
 = 
	`î32
(
RCTL
);

1718 
r˘l
 &~(
E1000_RCTL_LBM_TCVR
 | 
E1000_RCTL_LBM_MAC
);

1719 
	`ew32
(
RCTL
, 
r˘l
);

1721 
hw
->
mac
.
ty≥
) {

1722 
e1000_80003es2œn
:

1723 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
 ||

1724 
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
) {

1726 
	`ew32
(
CTRL_EXT
, 
ad≠ãr
->
tx_fifo_hód
);

1727 
ad≠ãr
->
tx_fifo_hód
 = 0;

1730 
e1000_82571
:

1731 
e1000_82572
:

1732 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
 ||

1733 
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
) {

1734 
	`ew32
(
SCTL
, 
E1000_SCTL_DISABLE_SERDES_LOOPBACK
);

1735 
	`e1e_Êush
();

1736 
	`u¶ìp_ønge
(10000, 20000);

1741 
hw
->
mac
.
aut⁄eg
 = 1;

1742 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_gg82563
)

1743 
	`e1e_wphy
(
hw
, 
GG82563_PHY_KMRN_MODE_CTRL
, 0x180);

1744 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_ªg
);

1745 i‡(
phy_ªg
 & 
BMCR_LOOPBACK
) {

1746 
phy_ªg
 &~
BMCR_LOOPBACK
;

1747 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_ªg
);

1748 i‡(
hw
->
phy
.
›s
.
commô
)

1749 
hw
->
phy
.
›s
.
	`commô
(hw);

1753 
	}
}

1755 
	$e1000_¸óã_lbã°_‰ame
(
sk_buff
 *
skb
,

1756 
‰ame_size
)

1758 
	`mem£t
(
skb
->
d©a
, 0xFF, 
‰ame_size
);

1759 
‰ame_size
 &= ~1;

1760 
	`mem£t
(&
skb
->
d©a
[
‰ame_size
 / 2], 0xAA, frame_size / 2 - 1);

1761 
	`mem£t
(&
skb
->
d©a
[
‰ame_size
 / 2 + 10], 0xBE, 1);

1762 
	`mem£t
(&
skb
->
d©a
[
‰ame_size
 / 2 + 12], 0xAF, 1);

1763 
	}
}

1765 
	$e1000_check_lbã°_‰ame
(
sk_buff
 *
skb
,

1766 
‰ame_size
)

1768 
‰ame_size
 &= ~1;

1769 i‡(*(
skb
->
d©a
 + 3) == 0xFF)

1770 i‡((*(
skb
->
d©a
 + 
‰ame_size
 / 2 + 10) == 0xBE) &&

1771 (*(
skb
->
d©a
 + 
‰ame_size
 / 2 + 12) == 0xAF))

1774 
	}
}

1776 
	$e1000_run_lo›back_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
)

1778 
e1000_rög
 *
tx_rög
 = &
ad≠ãr
->
ã°_tx_rög
;

1779 
e1000_rög
 *
rx_rög
 = &
ad≠ãr
->
ã°_rx_rög
;

1780 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1781 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1782 
e1000_buf„r
 *
buf„r_öfo
;

1783 
i
, 
j
, 
k
, 
l
;

1784 
lc
;

1785 
good_˙t
;

1786 
ªt_vÆ
 = 0;

1787 
time
;

1789 
	`ew32
(
	`RDT
(0), 
rx_rög
->
cou¡
 - 1);

1796 i‡(
rx_rög
->
cou¡
 <
tx_rög
->count)

1797 
lc
 = ((
tx_rög
->
cou¡
 / 64) * 2) + 1;

1799 
lc
 = ((
rx_rög
->
cou¡
 / 64) * 2) + 1;

1801 
k
 = 0;

1802 
l
 = 0;

1804 
j
 = 0; j <
lc
; j++) {

1806 
i
 = 0; i < 64; i++) {

1807 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
k
];

1809 
	`e1000_¸óã_lbã°_‰ame
(
buf„r_öfo
->
skb
, 1024);

1810 
	`dma_sync_sögÀ_f‹_devi˚
(
	`pci_dev_to_dev
(
pdev
),

1811 
buf„r_öfo
->
dma
,

1812 
buf„r_öfo
->
Àngth
,

1813 
DMA_TO_DEVICE
);

1814 
k
++;

1815 i‡(
k
 =
tx_rög
->
cou¡
)

1816 
k
 = 0;

1818 
	`ew32
(
	`TDT
(0), 
k
);

1819 
	`e1e_Êush
();

1820 
	`m¶ìp
(200);

1821 
time
 = 
jiffõs
;

1822 
good_˙t
 = 0;

1825 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
l
];

1827 
	`dma_sync_sögÀ_f‹_˝u
(
	`pci_dev_to_dev
(
pdev
),

1828 
buf„r_öfo
->
dma
, 2048,

1829 
DMA_FROM_DEVICE
);

1831 
ªt_vÆ
 = 
	`e1000_check_lbã°_‰ame
(
buf„r_öfo
->
skb
,

1833 i‡(!
ªt_vÆ
)

1834 
good_˙t
++;

1835 
l
++;

1836 i‡(
l
 =
rx_rög
->
cou¡
)

1837 
l
 = 0;

1842 } (
good_˙t
 < 64Ë&& !
	`time_a·î
(
jiffõs
, 
time
 + 20));

1843 i‡(
good_˙t
 != 64) {

1844 
ªt_vÆ
 = 13;

1847 i‡(
	`time_a·î
(
jiffõs
, 
time
 + 20)) {

1848 
ªt_vÆ
 = 14;

1852  
ªt_vÆ
;

1853 
	}
}

1855 
	$e1000_lo›back_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
)

1857 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1860 i‡(
hw
->
phy
.
›s
.
check_ª£t_block
 &&

1861 
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) {

1862 
	`e_îr
("Cannot do PHYÜoopbackÅest when SoL/IDER isáctive.\n");

1863 *
d©a
 = 0;

1864 
out
;

1867 *
d©a
 = 
	`e1000_£tup_desc_rögs
(
ad≠ãr
);

1868 i‡(*
d©a
)

1869 
out
;

1871 *
d©a
 = 
	`e1000_£tup_lo›back_ã°
(
ad≠ãr
);

1872 i‡(*
d©a
)

1873 
îr_lo›back
;

1875 *
d©a
 = 
	`e1000_run_lo›back_ã°
(
ad≠ãr
);

1876 
	`e1000_lo›back_˛ónup
(
ad≠ãr
);

1878 
îr_lo›back
:

1879 
	`e1000_‰ì_desc_rögs
(
ad≠ãr
);

1880 
out
:

1881  *
d©a
;

1882 
	}
}

1884 
	$e1000_lök_ã°
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u64
 *
d©a
)

1886 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1888 *
d©a
 = 0;

1889 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
) {

1890 
i
 = 0;

1891 
hw
->
mac
.
£rdes_has_lök
 = 
Ál£
;

1897 
hw
->
mac
.
›s
.
	`check_f‹_lök
(hw);

1898 i‡(
hw
->
mac
.
£rdes_has_lök
)

1899  *
d©a
;

1900 
	`m¶ìp
(20);

1901 } 
i
++ < 3750);

1903 *
d©a
 = 1;

1905 
hw
->
mac
.
›s
.
	`check_f‹_lök
(hw);

1906 i‡(
hw
->
mac
.
aut⁄eg
)

1910 
	`m¶ìp_öãºu±ibÀ
(5000);

1912 i‡(!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
))

1913 *
d©a
 = 1;

1915  *
d©a
;

1916 
	}
}

1918 #ifde‡
HAVE_ETHTOOL_GET_SSET_COUNT


1919 
	$e1000e_gë_s£t_cou¡
(
√t_devi˚
 
__Æways_unu£d
 *
√tdev
,

1920 
s£t
)

1922 
s£t
) {

1923 
ETH_SS_TEST
:

1924  
E1000_TEST_LEN
;

1925 
ETH_SS_STATS
:

1926  
E1000_STATS_LEN
;

1928  -
EOPNOTSUPP
;

1930 
	}
}

1932 
	$e1000_gë_£lf_ã°_cou¡
(
√t_devi˚
 
__Æways_unu£d
 *
√tdev
)

1934  
E1000_TEST_LEN
;

1935 
	}
}

1937 
	$e1000_gë_°©s_cou¡
(
√t_devi˚
 
__Æways_unu£d
 *
√tdev
)

1939  
E1000_STATS_LEN
;

1940 
	}
}

1943 
	$e1000_düg_ã°
(
√t_devi˚
 *
√tdev
,

1944 
ëhtoﬁ_ã°
 *
ëh_ã°
, 
u64
 *
d©a
)

1946 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1947 
u16
 
aut⁄eg_advîti£d
;

1948 
u8
 
f‹˚d_•ìd_du∂ex
;

1949 
u8
 
aut⁄eg
;

1950 
boﬁ
 
if_ru¬ög
 = 
	`√tif_ru¬ög
(
√tdev
);

1952 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

1954 
	`£t_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
);

1956 i‡(!
if_ru¬ög
) {

1958 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
)

1959 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

1961 
	`e1000e_powî_up_phy
(
ad≠ãr
);

1963 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_waô_to_com∂ëe
 = 1;

1964 
	`e1000e_ª£t
(
ad≠ãr
);

1965 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_waô_to_com∂ëe
 = 0;

1968 i‡(
ëh_ã°
->
Êags
 =
ETH_TEST_FL_OFFLINE
) {

1972 
aut⁄eg_advîti£d
 = 
ad≠ãr
->
hw
.
phy
.autoneg_advertised;

1973 
f‹˚d_•ìd_du∂ex
 = 
ad≠ãr
->
hw
.
mac
.forced_speed_duplex;

1974 
aut⁄eg
 = 
ad≠ãr
->
hw
.
mac
.autoneg;

1976 
	`e_öfo
("offlineÅesting starting\n");

1978 i‡(
if_ru¬ög
)

1980 
	`dev_˛o£
(
√tdev
);

1982 i‡(
	`e1000_ªg_ã°
(
ad≠ãr
, &
d©a
[0]))

1983 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

1985 
	`e1000e_ª£t
(
ad≠ãr
);

1986 i‡(
	`e1000_ì¥om_ã°
(
ad≠ãr
, &
d©a
[1]))

1987 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

1989 
	`e1000e_ª£t
(
ad≠ãr
);

1990 i‡(
	`e1000_öå_ã°
(
ad≠ãr
, &
d©a
[2]))

1991 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

1993 
	`e1000e_ª£t
(
ad≠ãr
);

1994 i‡(
	`e1000_lo›back_ã°
(
ad≠ãr
, &
d©a
[3]))

1995 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

1998 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_waô_to_com∂ëe
 = 1;

1999 
	`e1000e_ª£t
(
ad≠ãr
);

2000 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_waô_to_com∂ëe
 = 0;

2002 i‡(
	`e1000_lök_ã°
(
ad≠ãr
, &
d©a
[4]))

2003 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

2006 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_advîti£d
 =áutoneg_advertised;

2007 
ad≠ãr
->
hw
.
mac
.
f‹˚d_•ìd_du∂ex
 = forced_speed_duplex;

2008 
ad≠ãr
->
hw
.
mac
.
aut⁄eg
 =áutoneg;

2009 
	`e1000e_ª£t
(
ad≠ãr
);

2011 
	`˛ór_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
);

2012 i‡(
if_ru¬ög
)

2013 
	`dev_›í
(
√tdev
);

2017 
	`e_öfo
("onlineÅesting starting\n");

2020 
d©a
[0] = 0;

2021 
d©a
[1] = 0;

2022 
d©a
[2] = 0;

2023 
d©a
[3] = 0;

2025 i‡(
	`e1000_lök_ã°
(
ad≠ãr
, &
d©a
[4]))

2026 
ëh_ã°
->
Êags
 |
ETH_TEST_FL_FAILED
;

2028 
	`˛ór_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
);

2031 i‡(!
if_ru¬ög
) {

2032 
	`e1000e_ª£t
(
ad≠ãr
);

2034 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
)

2035 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

2038 
	`m¶ìp_öãºu±ibÀ
(4 * 1000);

2040 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2041 
	}
}

2043 
	$e1000_gë_wﬁ
(
√t_devi˚
 *
√tdev
,

2044 
ëhtoﬁ_wﬁöfo
 *
wﬁ
)

2046 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2048 
wﬁ
->
suµ‹ãd
 = 0;

2049 
wﬁ
->
wﬁ›ts
 = 0;

2051 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_WOL
) ||

2052 !
	`devi˚_ˇn_wakeup
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
)))

2055 
wﬁ
->
suµ‹ãd
 = 
WAKE_UCAST
 | 
WAKE_MCAST
 |

2056 
WAKE_BCAST
 | 
WAKE_MAGIC
 | 
WAKE_PHY
;

2059 i‡(
ad≠ãr
->
Êags
 & 
FLAG_NO_WAKE_UCAST
) {

2060 
wﬁ
->
suµ‹ãd
 &~
WAKE_UCAST
;

2062 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_EX
)

2063 
	`e_îr
("Interface doesÇot support directed (unicast) frame wake-upÖackets\n");

2066 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_EX
)

2067 
wﬁ
->
wﬁ›ts
 |
WAKE_UCAST
;

2068 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_MC
)

2069 
wﬁ
->
wﬁ›ts
 |
WAKE_MCAST
;

2070 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_BC
)

2071 
wﬁ
->
wﬁ›ts
 |
WAKE_BCAST
;

2072 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_MAG
)

2073 
wﬁ
->
wﬁ›ts
 |
WAKE_MAGIC
;

2074 i‡(
ad≠ãr
->
wﬁ
 & 
E1000_WUFC_LNKC
)

2075 
wﬁ
->
wﬁ›ts
 |
WAKE_PHY
;

2076 
	}
}

2078 
	$e1000_£t_wﬁ
(
√t_devi˚
 *
√tdev
, 
ëhtoﬁ_wﬁöfo
 *
wﬁ
)

2080 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2082 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_WOL
) ||

2083 !
	`devi˚_ˇn_wakeup
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
)) ||

2084 (
wﬁ
->
wﬁ›ts
 & ~(
WAKE_UCAST
 | 
WAKE_MCAST
 | 
WAKE_BCAST
 |

2085 
WAKE_MAGIC
 | 
WAKE_PHY
)))

2086  -
EOPNOTSUPP
;

2089 
ad≠ãr
->
wﬁ
 = 0;

2091 i‡(
wﬁ
->
wﬁ›ts
 & 
WAKE_UCAST
)

2092 
ad≠ãr
->
wﬁ
 |
E1000_WUFC_EX
;

2093 i‡(
wﬁ
->
wﬁ›ts
 & 
WAKE_MCAST
)

2094 
ad≠ãr
->
wﬁ
 |
E1000_WUFC_MC
;

2095 i‡(
wﬁ
->
wﬁ›ts
 & 
WAKE_BCAST
)

2096 
ad≠ãr
->
wﬁ
 |
E1000_WUFC_BC
;

2097 i‡(
wﬁ
->
wﬁ›ts
 & 
WAKE_MAGIC
)

2098 
ad≠ãr
->
wﬁ
 |
E1000_WUFC_MAG
;

2099 i‡(
wﬁ
->
wﬁ›ts
 & 
WAKE_PHY
)

2100 
ad≠ãr
->
wﬁ
 |
E1000_WUFC_LNKC
;

2102 
	`devi˚_£t_wakeup_íabÀ
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),ád≠ãr->
wﬁ
);

2105 
	}
}

2107 #ifde‡
HAVE_ETHTOOL_SET_PHYS_ID


2108 
	$e1000_£t_phys_id
(
√t_devi˚
 *
√tdev
,

2109 
ëhtoﬁ_phys_id_°©e
 
°©e
)

2111 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2112 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2114 
°©e
) {

2115 
ETHTOOL_ID_ACTIVE
:

2116 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2118 i‡(!
hw
->
mac
.
›s
.
blök_Àd
)

2121 
hw
->
mac
.
›s
.
	`blök_Àd
(hw);

2124 
ETHTOOL_ID_INACTIVE
:

2125 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

2126 
	`e1e_wphy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL_LED
, 0);

2127 
hw
->
mac
.
›s
.
	`Àd_off
(hw);

2128 
hw
->
mac
.
›s
.
	`˛ónup_Àd
(hw);

2129 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2132 
ETHTOOL_ID_ON
:

2133 
hw
->
mac
.
›s
.
	`Àd_⁄
(hw);

2136 
ETHTOOL_ID_OFF
:

2137 
hw
->
mac
.
›s
.
	`Àd_off
(hw);

2142 
	}
}

2145 
	#E1000_ID_INTERVAL
 (
HZ
/4)

	)

2148 
	#E1000_LED_ON
 0

	)

2150 
	$e1000e_Àd_blök_èsk
(
w‹k_°ru˘
 *
w‹k
)

2152 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
,

2153 
e1000_ad≠ãr
,

2154 
Àd_blök_èsk
);

2156 i‡(
	`ã°_™d_ch™ge_bô
(
E1000_LED_ON
, &
ad≠ãr
->
Àd_°©us
))

2157 
ad≠ãr
->
hw
.
mac
.
›s
.
	`Àd_off
(&adapter->hw);

2159 
ad≠ãr
->
hw
.
mac
.
›s
.
	`Àd_⁄
(&adapter->hw);

2160 
	}
}

2162 
	$e1000_Àd_blök_ˇŒback
(
d©a
)

2164 
e1000_ad≠ãr
 *
ad≠ãr
 = (e1000_ad≠ã∏*)
d©a
;

2166 
	`scheduÀ_w‹k
(&
ad≠ãr
->
Àd_blök_èsk
);

2167 
	`mod_timî
(&
ad≠ãr
->
blök_timî
, 
jiffõs
 + 
E1000_ID_INTERVAL
);

2168 
	}
}

2170 
	$e1000_phys_id
(
√t_devi˚
 *
√tdev
, 
u32
 
d©a
)

2172 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2173 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2175 i‡(!
d©a
)

2176 
d©a
 = 
INT_MAX
;

2178 i‡((
hw
->
phy
.
ty≥
 =
e1000_phy_i„
) ||

2179 (
hw
->
mac
.
ty≥
 =
e1000_pchœn
) ||

2180 (
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) ||

2181 (
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) ||

2182 (
hw
->
mac
.
ty≥
 =
e1000_82583
Ë|| (hw->mac.ty≥ =
e1000_82574
)) {

2183 i‡(!
ad≠ãr
->
blök_timî
.
fun˘i⁄
) {

2184 
	`öô_timî
(&
ad≠ãr
->
blök_timî
);

2185 
ad≠ãr
->
blök_timî
.
fun˘i⁄
 =

2186 
e1000_Àd_blök_ˇŒback
;

2187 
ad≠ãr
->
blök_timî
.
d©a
 = ()adapter;

2189 
	`mod_timî
(&
ad≠ãr
->
blök_timî
, 
jiffõs
);

2190 
	`m¶ìp_öãºu±ibÀ
(
d©a
 * 1000);

2191 
	`dñ_timî_sync
(&
ad≠ãr
->
blök_timî
);

2192 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

2193 
	`e1e_wphy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL_LED
, 0);

2195 
	`e1000e_blök_Àd_gíîic
(
hw
);

2196 
	`m¶ìp_öãºu±ibÀ
(
d©a
 * 1000);

2199 
hw
->
mac
.
›s
.
	`Àd_off
(hw);

2200 
	`˛ór_bô
(
E1000_LED_ON
, &
ad≠ãr
->
Àd_°©us
);

2201 
hw
->
mac
.
›s
.
	`˛ónup_Àd
(hw);

2204 
	}
}

2207 
	$e1000_gë_cﬂÀs˚
(
√t_devi˚
 *
√tdev
,

2208 
ëhtoﬁ_cﬂÀs˚
 *
ec
)

2210 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2212 i‡(
ad≠ãr
->
ôr_£âög
 <= 4)

2213 
ec
->
rx_cﬂÀs˚_u£cs
 = 
ad≠ãr
->
ôr_£âög
;

2215 
ec
->
rx_cﬂÀs˚_u£cs
 = 1000000 / 
ad≠ãr
->
ôr_£âög
;

2218 
	}
}

2220 
	$e1000_£t_cﬂÀs˚
(
√t_devi˚
 *
√tdev
,

2221 
ëhtoﬁ_cﬂÀs˚
 *
ec
)

2223 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2225 i‡((
ec
->
rx_cﬂÀs˚_u£cs
 > 
E1000_MAX_ITR_USECS
) ||

2226 ((
ec
->
rx_cﬂÀs˚_u£cs
 > 4) &&

2227 (
ec
->
rx_cﬂÀs˚_u£cs
 < 
E1000_MIN_ITR_USECS
)) ||

2228 (
ec
->
rx_cﬂÀs˚_u£cs
 == 2))

2229  -
EINVAL
;

2231 i‡(
ec
->
rx_cﬂÀs˚_u£cs
 == 4) {

2232 
ad≠ãr
->
ôr_£âög
 = 4;

2233 
ad≠ãr
->
ôr
 =ád≠ãr->
ôr_£âög
;

2234 } i‡(
ec
->
rx_cﬂÀs˚_u£cs
 <= 3) {

2235 
ad≠ãr
->
ôr
 = 20000;

2236 
ad≠ãr
->
ôr_£âög
 = 
ec
->
rx_cﬂÀs˚_u£cs
;

2238 
ad≠ãr
->
ôr
 = (1000000 / 
ec
->
rx_cﬂÀs˚_u£cs
);

2239 
ad≠ãr
->
ôr_£âög
 =ád≠ãr->
ôr
 & ~3;

2242 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2244 i‡(
ad≠ãr
->
ôr_£âög
 != 0)

2245 
	`e1000e_wrôe_ôr
(
ad≠ãr
,ád≠ãr->
ôr
);

2247 
	`e1000e_wrôe_ôr
(
ad≠ãr
, 0);

2249 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2252 
	}
}

2254 
	$e1000_nway_ª£t
(
√t_devi˚
 *
√tdev
)

2256 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2258 i‡(!
	`√tif_ru¬ög
(
√tdev
))

2259  -
EAGAIN
;

2261 i‡(!
ad≠ãr
->
hw
.
mac
.
aut⁄eg
)

2262  -
EINVAL
;

2264 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2265 
	`e1000e_ªöô_locked
(
ad≠ãr
);

2266 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2269 
	}
}

2271 
	$e1000_gë_ëhtoﬁ_°©s
(
√t_devi˚
 *
√tdev
,

2272 
ëhtoﬁ_°©s
 
__Æways_unu£d
 *
°©s
,

2273 
u64
 *
d©a
)

2275 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2276 #ifde‡
HAVE_NDO_GET_STATS64


2277 
π∆_lök_°©s64
 
√t_°©s
;

2279 
i
;

2280 *
p
 = 
NULL
;

2282 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2284 #ifde‡
HAVE_NDO_GET_STATS64


2285 
	`e1000e_gë_°©s64
(
√tdev
, &
√t_°©s
);

2287 
	`e1000e_upd©e_°©s
(
ad≠ãr
);

2290 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2292 
i
 = 0; i < 
E1000_GLOBAL_STATS_LEN
; i++) {

2293 
e1000_g°rögs_°©s
[
i
].
ty≥
) {

2294 
NETDEV_STATS
:

2295 #ifde‡
HAVE_NDO_GET_STATS64


2296 
p
 = (*)&
√t_°©s
 +

2298 
p
 = (*)
√tdev
 +

2300 
e1000_g°rögs_°©s
[
i
].
°©_off£t
;

2302 
E1000_STATS
:

2303 
p
 = (*)
ad≠ãr
 +

2304 
e1000_g°rögs_°©s
[
i
].
°©_off£t
;

2307 
d©a
[
i
] = 0;

2311 
d©a
[
i
] = (
e1000_g°rögs_°©s
[i].
sizeof_°©
 ==

2312 (
u64
)Ë? *(u64 *)
p
 : *(
u32
 *)p;

2314 
	}
}

2316 
	$e1000_gë_°rögs
(
√t_devi˚
 
__Æways_unu£d
 *
√tdev
,

2317 
u32
 
°rög£t
, 
u8
 *
d©a
)

2319 
u8
 *
p
 = 
d©a
;

2320 
i
;

2322 
°rög£t
) {

2323 
ETH_SS_TEST
:

2324 
	`mem˝y
(
d©a
, 
e1000_g°rögs_ã°
, (e1000_gstrings_test));

2326 
ETH_SS_STATS
:

2327 
i
 = 0; i < 
E1000_GLOBAL_STATS_LEN
; i++) {

2328 
	`mem˝y
(
p
, 
e1000_g°rögs_°©s
[
i
].
°©_°rög
,

2329 
ETH_GSTRING_LEN
);

2330 
p
 +
ETH_GSTRING_LEN
;

2334 
	}
}

2336 #ifde‡
ETHTOOL_GRXRINGS


2337 #ifde‡
HAVE_ETHTOOL_GET_RXNFC_VOID_RULE_LOCS


2338 
	$e1000_gë_rxnfc
(
√t_devi˚
 *
√tdev
,

2339 
ëhtoﬁ_rxnfc
 *
öfo
,

2340 
__Æways_unu£d
 *
ruÀ_locs
)

2342 
	$e1000_gë_rxnfc
(
√t_devi˚
 *
√tdev
,

2343 
ëhtoﬁ_rxnfc
 *
öfo
,

2344 
u32
 
__Æways_unu£d
 *
ruÀ_locs
)

2347 
öfo
->
d©a
 = 0;

2349 
öfo
->
cmd
) {

2350 
ETHTOOL_GRXFH
: {

2351 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2352 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2353 
u32
 
mrqc
;

2355 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2356 
mrqc
 = 
	`î32
(
MRQC
);

2357 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2359 i‡(!(
mrqc
 & 
E1000_MRQC_RSS_FIELD_MASK
))

2362 
öfo
->
Êow_ty≥
) {

2363 
TCP_V4_FLOW
:

2364 i‡(
mrqc
 & 
E1000_MRQC_RSS_FIELD_IPV4_TCP
)

2365 
öfo
->
d©a
 |
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

2367 
UDP_V4_FLOW
:

2368 
SCTP_V4_FLOW
:

2369 
AH_ESP_V4_FLOW
:

2370 
IPV4_FLOW
:

2371 i‡(
mrqc
 & 
E1000_MRQC_RSS_FIELD_IPV4
)

2372 
öfo
->
d©a
 |
RXH_IP_SRC
 | 
RXH_IP_DST
;

2374 
TCP_V6_FLOW
:

2375 i‡(
mrqc
 & 
E1000_MRQC_RSS_FIELD_IPV6_TCP
)

2376 
öfo
->
d©a
 |
RXH_L4_B_0_1
 | 
RXH_L4_B_2_3
;

2378 
UDP_V6_FLOW
:

2379 
SCTP_V6_FLOW
:

2380 
AH_ESP_V6_FLOW
:

2381 
IPV6_FLOW
:

2382 i‡(
mrqc
 & 
E1000_MRQC_RSS_FIELD_IPV6
)

2383 
öfo
->
d©a
 |
RXH_IP_SRC
 | 
RXH_IP_DST
;

2391  -
EOPNOTSUPP
;

2393 
	}
}

2396 #ifde‡
ETHTOOL_GEEE


2397 
	$e1000e_gë_ìe
(
√t_devi˚
 *
√tdev
, 
ëhtoﬁ_ìe
 *
ed©a
)

2399 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2400 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2401 
u16
 
ˇp_addr
, 
Õa_addr
, 
pcs_°©_addr
, 
phy_d©a
;

2402 
u32
 
ªt_vÆ
;

2404 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_EEE
))

2405  -
EOPNOTSUPP
;

2407 
hw
->
phy
.
ty≥
) {

2408 
e1000_phy_82579
:

2409 
ˇp_addr
 = 
I82579_EEE_CAPABILITY
;

2410 
Õa_addr
 = 
I82579_EEE_LP_ABILITY
;

2411 
pcs_°©_addr
 = 
I82579_EEE_PCS_STATUS
;

2413 
e1000_phy_i217
:

2414 
ˇp_addr
 = 
I217_EEE_CAPABILITY
;

2415 
Õa_addr
 = 
I217_EEE_LP_ABILITY
;

2416 
pcs_°©_addr
 = 
I217_EEE_PCS_STATUS
;

2419  -
EOPNOTSUPP
;

2422 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2424 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2425 i‡(
ªt_vÆ
) {

2426 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2427  -
EBUSY
;

2431 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
ˇp_addr
, &
phy_d©a
);

2432 i‡(
ªt_vÆ
)

2433 
ªÀa£
;

2434 
ed©a
->
suµ‹ãd
 = 
	`mmd_ìe_ˇp_to_ëhtoﬁ_sup_t
(
phy_d©a
);

2437 
ed©a
->
advîti£d
 = 
	`mmd_ìe_adv_to_ëhtoﬁ_adv_t
(
ad≠ãr
->
ìe_advît
);

2440 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
Õa_addr
, &
phy_d©a
);

2441 i‡(
ªt_vÆ
)

2442 
ªÀa£
;

2443 
ed©a
->
Õ_advîti£d
 = 
	`mmd_ìe_adv_to_ëhtoﬁ_adv_t
(
phy_d©a
);

2446 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
pcs_°©_addr
, &
phy_d©a
);

2447 i‡(
ªt_vÆ
)

2448 
ªÀa£
;

2449 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82579
)

2450 
phy_d©a
 <<= 8;

2456 i‡(
phy_d©a
 & (
E1000_EEE_TX_LPI_RCVD
 | 
E1000_EEE_RX_LPI_RCVD
))

2457 
ed©a
->
ìe_a˘ive
 = 
åue
;

2459 
ed©a
->
ìe_íabÀd
 = !
hw
->
dev_•ec
.
ich8œn
.
ìe_dißbÀ
;

2460 
ed©a
->
tx_Õi_íabÀd
 = 
åue
;

2461 
ed©a
->
tx_Õi_timî
 = 
	`î32
(
LPIC
Ë>> 
E1000_LPIC_LPIET_SHIFT
;

2463 
ªÀa£
:

2464 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2465 i‡(
ªt_vÆ
)

2466 
ªt_vÆ
 = -
ENODATA
;

2468 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2470  
ªt_vÆ
;

2471 
	}
}

2474 #ifde‡
ETHTOOL_SEEE


2475 
	$e1000e_£t_ìe
(
√t_devi˚
 *
√tdev
, 
ëhtoﬁ_ìe
 *
ed©a
)

2477 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2478 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2479 
ëhtoﬁ_ìe
 
ìe_cuº
;

2480 
s32
 
ªt_vÆ
;

2482 
ªt_vÆ
 = 
	`e1000e_gë_ìe
(
√tdev
, &
ìe_cuº
);

2483 i‡(
ªt_vÆ
)

2484  
ªt_vÆ
;

2486 i‡(
ìe_cuº
.
tx_Õi_íabÀd
 !
ed©a
->tx_lpi_enabled) {

2487 
	`e_îr
("Setting EEEÅx-lpi isÇot supported\n");

2488  -
EINVAL
;

2491 i‡(
ìe_cuº
.
tx_Õi_timî
 !
ed©a
->tx_lpi_timer) {

2492 
	`e_îr
("Setting EEE Tx LPIÅimer isÇot supported\n");

2493  -
EINVAL
;

2496 i‡(
ed©a
->
advîti£d
 & ~(
ADVERTISE_100_FULL
 | 
ADVERTISE_1000_FULL
)) {

2497 
	`e_îr
("EEEádvertisement supports only 100TXánd/or 1000T full-duplex\n");

2498  -
EINVAL
;

2501 
ad≠ãr
->
ìe_advît
 = 
	`ëhtoﬁ_adv_to_mmd_ìe_adv_t
(
ed©a
->
advîti£d
);

2503 
hw
->
dev_•ec
.
ich8œn
.
ìe_dißbÀ
 = !
ed©a
->
ìe_íabÀd
;

2505 
	`pm_ru¡ime_gë_sync
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
);

2508 i‡(
	`√tif_ru¬ög
(
√tdev
))

2509 
	`e1000e_ªöô_locked
(
ad≠ãr
);

2511 
	`e1000e_ª£t
(
ad≠ãr
);

2513 
	`pm_ru¡ime_put_sync
(
√tdev
->
dev
.
∑ª¡
);

2516 
	}
}

2519 #ifde‡
ETHTOOL_GET_TS_INFO


2520 
	$e1000e_gë_ts_öfo
(
√t_devi˚
 *
√tdev
,

2521 
ëhtoﬁ_ts_öfo
 *
öfo
)

2523 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2525 
	`ëhtoﬁ_›_gë_ts_öfo
(
√tdev
, 
öfo
);

2527 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
))

2530 #ifde‡
HAVE_HW_TIME_STAMP


2531 
öfo
->
so_time°ampög
 |(
SOF_TIMESTAMPING_TX_HARDWARE
 |

2532 
SOF_TIMESTAMPING_RX_HARDWARE
 |

2533 
SOF_TIMESTAMPING_RAW_HARDWARE
);

2535 
öfo
->
tx_ty≥s
 = (1 << 
HWTSTAMP_TX_OFF
Ë| (1 << 
HWTSTAMP_TX_ON
);

2537 
öfo
->
rx_fûãrs
 = ((1 << 
HWTSTAMP_FILTER_NONE
) |

2538 #ifde‡
HAVE_PTP_1588_CLOCK


2539 (1 << 
HWTSTAMP_FILTER_PTP_V1_L4_SYNC
) |

2540 (1 << 
HWTSTAMP_FILTER_PTP_V1_L4_DELAY_REQ
) |

2541 (1 << 
HWTSTAMP_FILTER_PTP_V2_L4_SYNC
) |

2542 (1 << 
HWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ
) |

2543 (1 << 
HWTSTAMP_FILTER_PTP_V2_L2_SYNC
) |

2544 (1 << 
HWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ
) |

2545 (1 << 
HWTSTAMP_FILTER_PTP_V2_EVENT
) |

2546 (1 << 
HWTSTAMP_FILTER_PTP_V2_SYNC
) |

2547 (1 << 
HWTSTAMP_FILTER_PTP_V2_DELAY_REQ
) |

2549 (1 << 
HWTSTAMP_FILTER_ALL
));

2551 #ifde‡
HAVE_PTP_1588_CLOCK


2552 i‡(
ad≠ãr
->
±p_˛ock
)

2553 
öfo
->
phc_ödex
 = 
	`±p_˛ock_ödex
(
ad≠ãr
->
±p_˛ock
);

2558 
	}
}

2561 c⁄° 
ëhtoﬁ_›s
 
	ge1000_ëhtoﬁ_›s
 = {

2562 .
gë_£âögs
 = 
e1000_gë_£âögs
,

2563 .
	g£t_£âögs
 = 
e1000_£t_£âögs
,

2564 .
	ggë_drvöfo
 = 
e1000_gë_drvöfo
,

2565 .
	ggë_ªgs_Àn
 = 
e1000_gë_ªgs_Àn
,

2566 .
	ggë_ªgs
 = 
e1000_gë_ªgs
,

2567 .
	ggë_wﬁ
 = 
e1000_gë_wﬁ
,

2568 .
	g£t_wﬁ
 = 
e1000_£t_wﬁ
,

2569 .
	ggë_msgÀvñ
 = 
e1000_gë_msgÀvñ
,

2570 .
	g£t_msgÀvñ
 = 
e1000_£t_msgÀvñ
,

2571 .
	gnway_ª£t
 = 
e1000_nway_ª£t
,

2572 .
	ggë_lök
 = 
ëhtoﬁ_›_gë_lök
,

2573 .
	ggë_ì¥om_Àn
 = 
e1000_gë_ì¥om_Àn
,

2574 .
	ggë_ì¥om
 = 
e1000_gë_ì¥om
,

2575 .
	g£t_ì¥om
 = 
e1000_£t_ì¥om
,

2576 .
	ggë_rög∑øm
 = 
e1000_gë_rög∑øm
,

2577 .
	g£t_rög∑øm
 = 
e1000_£t_rög∑øm
,

2578 .
	ggë_∑u£∑øm
 = 
e1000_gë_∑u£∑øm
,

2579 .
	g£t_∑u£∑øm
 = 
e1000_£t_∑u£∑øm
,

2580 #i‚de‡
HAVE_NDO_SET_FEATURES


2581 .
	ggë_rx_csum
 = 
e1000_gë_rx_csum
,

2582 .
	g£t_rx_csum
 = 
e1000_£t_rx_csum
,

2583 .
	ggë_tx_csum
 = 
e1000_gë_tx_csum
,

2584 .
	g£t_tx_csum
 = 
e1000_£t_tx_csum
,

2585 .
	ggë_sg
 = 
ëhtoﬁ_›_gë_sg
,

2586 .
	g£t_sg
 = 
ëhtoﬁ_›_£t_sg
,

2587 #ifde‡
NETIF_F_TSO


2588 .
	ggë_tso
 = 
ëhtoﬁ_›_gë_tso
,

2589 .
	g£t_tso
 = 
e1000_£t_tso
,

2591 #ifde‡
ETHTOOL_GFLAGS


2592 .
	ggë_Êags
 = 
ëhtoﬁ_›_gë_Êags
,

2594 #i‡
deföed
(
ETHTOOL_SFLAGS
Ë&& (deföed(
NETIF_F_RXHASH
Ë|| !deföed(
HAVE_VLAN_RX_REGISTER
))

2595 .
	g£t_Êags
 = 
e1000e_£t_Êags
,

2598 .
	g£lf_ã°
 = 
e1000_düg_ã°
,

2599 .
	ggë_°rögs
 = 
e1000_gë_°rögs
,

2600 #ifde‡
HAVE_ETHTOOL_SET_PHYS_ID


2601 #i‚de‡
HAVE_RHEL6_ETHTOOL_OPS_EXT_STRUCT


2602 .
	g£t_phys_id
 = 
e1000_£t_phys_id
,

2605 .
	gphys_id
 = 
e1000_phys_id
,

2607 .
	ggë_ëhtoﬁ_°©s
 = 
e1000_gë_ëhtoﬁ_°©s
,

2608 #ifde‡
HAVE_ETHTOOL_GET_SSET_COUNT


2609 .
	ggë_s£t_cou¡
 = 
e1000e_gë_s£t_cou¡
,

2611 .
	g£lf_ã°_cou¡
 = 
e1000_gë_£lf_ã°_cou¡
,

2612 .
	ggë_°©s_cou¡
 = 
e1000_gë_°©s_cou¡
,

2614 #ifde‡
HAVE_ETHTOOL_GET_PERM_ADDR


2615 .
	ggë_≥rm_addr
 = 
ëhtoﬁ_›_gë_≥rm_addr
,

2617 .
	ggë_cﬂÀs˚
 = 
e1000_gë_cﬂÀs˚
,

2618 .
	g£t_cﬂÀs˚
 = 
e1000_£t_cﬂÀs˚
,

2619 #ifde‡
ETHTOOL_GRXRINGS


2620 .
	ggë_rxnfc
 = 
e1000_gë_rxnfc
,

2622 #i‚de‡
HAVE_RHEL6_ETHTOOL_OPS_EXT_STRUCT


2623 #ifde‡
ETHTOOL_GET_TS_INFO


2624 .
	ggë_ts_öfo
 = 
e1000e_gë_ts_öfo
,

2626 #ifde‡
ETHTOOL_GEEE


2627 .
	ggë_ìe
 = 
e1000e_gë_ìe
,

2629 #ifde‡
ETHTOOL_SEEE


2630 .
	g£t_ìe
 = 
e1000e_£t_ìe
,

2635 #ifde‡
HAVE_RHEL6_ETHTOOL_OPS_EXT_STRUCT


2636 c⁄° 
ëhtoﬁ_›s_ext
 
	ge1000e_ëhtoﬁ_›s_ext
 = {

2637 .
size
 = (
ëhtoﬁ_›s_ext
),

2638 .
	g£t_phys_id
 = 
e1000_£t_phys_id
,

2639 .
	ggë_ts_öfo
 = 
e1000e_gë_ts_öfo
,

2640 .
	ggë_ìe
 = 
e1000e_gë_ìe
,

2641 .
	g£t_ìe
 = 
e1000e_£t_ìe
,

2645 
	$e1000e_£t_ëhtoﬁ_›s
(
√t_devi˚
 *
√tdev
)

2648 
	`SET_ETHTOOL_OPS
(
√tdev
, (
ëhtoﬁ_›s
 *)&
e1000_ëhtoﬁ_›s
);

2649 #ifde‡
HAVE_RHEL6_ETHTOOL_OPS_EXT_STRUCT


2650 
	`£t_ëhtoﬁ_›s_ext
(
√tdev
, &
e1000e_ëhtoﬁ_›s_ext
);

2652 
	}
}

	@hw.h

29 #i‚de‡
_E1000E_HW_H_


30 
	#_E1000E_HW_H_


	)

32 
	~"ªgs.h
"

33 
	~"deföes.h
"

35 
	ge1000_hw
;

37 
	#E1000_DEV_ID_82571EB_COPPER
 0x105E

	)

38 
	#E1000_DEV_ID_82571EB_FIBER
 0x105F

	)

39 
	#E1000_DEV_ID_82571EB_SERDES
 0x1060

	)

40 
	#E1000_DEV_ID_82571EB_QUAD_COPPER
 0x10A4

	)

41 
	#E1000_DEV_ID_82571PT_QUAD_COPPER
 0x10D5

	)

42 
	#E1000_DEV_ID_82571EB_QUAD_FIBER
 0x10A5

	)

43 
	#E1000_DEV_ID_82571EB_QUAD_COPPER_LP
 0x10BC

	)

44 
	#E1000_DEV_ID_82571EB_SERDES_DUAL
 0x10D9

	)

45 
	#E1000_DEV_ID_82571EB_SERDES_QUAD
 0x10DA

	)

46 
	#E1000_DEV_ID_82572EI_COPPER
 0x107D

	)

47 
	#E1000_DEV_ID_82572EI_FIBER
 0x107E

	)

48 
	#E1000_DEV_ID_82572EI_SERDES
 0x107F

	)

49 
	#E1000_DEV_ID_82572EI
 0x10B9

	)

50 
	#E1000_DEV_ID_82573E
 0x108B

	)

51 
	#E1000_DEV_ID_82573E_IAMT
 0x108C

	)

52 
	#E1000_DEV_ID_82573L
 0x109A

	)

53 
	#E1000_DEV_ID_82574L
 0x10D3

	)

54 
	#E1000_DEV_ID_82574LA
 0x10F6

	)

55 
	#E1000_DEV_ID_82583V
 0x150C

	)

56 
	#E1000_DEV_ID_80003ES2LAN_COPPER_DPT
 0x1096

	)

57 
	#E1000_DEV_ID_80003ES2LAN_SERDES_DPT
 0x1098

	)

58 
	#E1000_DEV_ID_80003ES2LAN_COPPER_SPT
 0x10BA

	)

59 
	#E1000_DEV_ID_80003ES2LAN_SERDES_SPT
 0x10BB

	)

60 
	#E1000_DEV_ID_ICH8_82567V_3
 0x1501

	)

61 
	#E1000_DEV_ID_ICH8_IGP_M_AMT
 0x1049

	)

62 
	#E1000_DEV_ID_ICH8_IGP_AMT
 0x104A

	)

63 
	#E1000_DEV_ID_ICH8_IGP_C
 0x104B

	)

64 
	#E1000_DEV_ID_ICH8_IFE
 0x104C

	)

65 
	#E1000_DEV_ID_ICH8_IFE_GT
 0x10C4

	)

66 
	#E1000_DEV_ID_ICH8_IFE_G
 0x10C5

	)

67 
	#E1000_DEV_ID_ICH8_IGP_M
 0x104D

	)

68 
	#E1000_DEV_ID_ICH9_IGP_AMT
 0x10BD

	)

69 
	#E1000_DEV_ID_ICH9_BM
 0x10E5

	)

70 
	#E1000_DEV_ID_ICH9_IGP_M_AMT
 0x10F5

	)

71 
	#E1000_DEV_ID_ICH9_IGP_M
 0x10BF

	)

72 
	#E1000_DEV_ID_ICH9_IGP_M_V
 0x10CB

	)

73 
	#E1000_DEV_ID_ICH9_IGP_C
 0x294C

	)

74 
	#E1000_DEV_ID_ICH9_IFE
 0x10C0

	)

75 
	#E1000_DEV_ID_ICH9_IFE_GT
 0x10C3

	)

76 
	#E1000_DEV_ID_ICH9_IFE_G
 0x10C2

	)

77 
	#E1000_DEV_ID_ICH10_R_BM_LM
 0x10CC

	)

78 
	#E1000_DEV_ID_ICH10_R_BM_LF
 0x10CD

	)

79 
	#E1000_DEV_ID_ICH10_R_BM_V
 0x10CE

	)

80 
	#E1000_DEV_ID_ICH10_D_BM_LM
 0x10DE

	)

81 
	#E1000_DEV_ID_ICH10_D_BM_LF
 0x10DF

	)

82 
	#E1000_DEV_ID_ICH10_D_BM_V
 0x1525

	)

83 
	#E1000_DEV_ID_PCH_M_HV_LM
 0x10EA

	)

84 
	#E1000_DEV_ID_PCH_M_HV_LC
 0x10EB

	)

85 
	#E1000_DEV_ID_PCH_D_HV_DM
 0x10EF

	)

86 
	#E1000_DEV_ID_PCH_D_HV_DC
 0x10F0

	)

87 
	#E1000_DEV_ID_PCH2_LV_LM
 0x1502

	)

88 
	#E1000_DEV_ID_PCH2_LV_V
 0x1503

	)

89 
	#E1000_DEV_ID_PCH_LPT_I217_LM
 0x153A

	)

90 
	#E1000_DEV_ID_PCH_LPT_I217_V
 0x153B

	)

91 
	#E1000_DEV_ID_PCH_LPTLP_I218_LM
 0x155A

	)

92 
	#E1000_DEV_ID_PCH_LPTLP_I218_V
 0x1559

	)

93 
	#E1000_DEV_ID_PCH_I218_LM2
 0x15A0

	)

94 
	#E1000_DEV_ID_PCH_I218_V2
 0x15A1

	)

95 
	#E1000_DEV_ID_PCH_I218_LM3
 0x15A2

	)

96 
	#E1000_DEV_ID_PCH_I218_V3
 0x15A3

	)

98 
	#E1000_REVISION_4
 4

	)

100 
	#E1000_FUNC_1
 1

	)

102 
	#E1000_ALT_MAC_ADDRESS_OFFSET_LAN0
 0

	)

103 
	#E1000_ALT_MAC_ADDRESS_OFFSET_LAN1
 3

	)

105 
	ee1000_mac_ty≥
 {

106 
	me1000_82571
,

107 
	me1000_82572
,

108 
	me1000_82573
,

109 
	me1000_82574
,

110 
	me1000_82583
,

111 
	me1000_80003es2œn
,

112 
	me1000_ich8œn
,

113 
	me1000_ich9œn
,

114 
	me1000_ich10œn
,

115 
	me1000_pchœn
,

116 
	me1000_pch2œn
,

117 
	me1000_pch_Õt
,

120 
	ee1000_medü_ty≥
 {

121 
	me1000_medü_ty≥_unknown
 = 0,

122 
	me1000_medü_ty≥_c›≥r
 = 1,

123 
	me1000_medü_ty≥_fibî
 = 2,

124 
	me1000_medü_ty≥_öã∫Æ_£rdes
 = 3,

125 
	me1000_num_medü_ty≥s


128 
	ee1000_nvm_ty≥
 {

129 
	me1000_nvm_unknown
 = 0,

130 
	me1000_nvm_n⁄e
,

131 
	me1000_nvm_ì¥om_•i
,

132 
	me1000_nvm_Êash_hw
,

133 
	me1000_nvm_Êash_sw


136 
	ee1000_nvm_ovîride
 {

137 
	me1000_nvm_ovîride_n⁄e
 = 0,

138 
	me1000_nvm_ovîride_•i_smÆl
,

139 
	me1000_nvm_ovîride_•i_œrge


142 
	ee1000_phy_ty≥
 {

143 
	me1000_phy_unknown
 = 0,

144 
	me1000_phy_n⁄e
,

145 
	me1000_phy_m88
,

146 
	me1000_phy_igp
,

147 
	me1000_phy_igp_2
,

148 
	me1000_phy_gg82563
,

149 
	me1000_phy_igp_3
,

150 
	me1000_phy_i„
,

151 
	me1000_phy_bm
,

152 
	me1000_phy_82578
,

153 
	me1000_phy_82577
,

154 
	me1000_phy_82579
,

155 
	me1000_phy_i217
,

158 
	ee1000_bus_width
 {

159 
	me1000_bus_width_unknown
 = 0,

160 
	me1000_bus_width_pcõ_x1
,

161 
	me1000_bus_width_pcõ_x2
,

162 
	me1000_bus_width_pcõ_x4
 = 4,

163 
	me1000_bus_width_pcõ_x8
 = 8,

164 
	me1000_bus_width_32
,

165 
	me1000_bus_width_64
,

166 
	me1000_bus_width_ª£rved


169 
	ee1000_1000t_rx_°©us
 {

170 
	me1000_1000t_rx_°©us_nŸ_ok
 = 0,

171 
	me1000_1000t_rx_°©us_ok
,

172 
	me1000_1000t_rx_°©us_undeföed
 = 0xFF

175 
	ee1000_ªv_pﬁ¨ôy
 {

176 
	me1000_ªv_pﬁ¨ôy_n‹mÆ
 = 0,

177 
	me1000_ªv_pﬁ¨ôy_ªvî£d
,

178 
	me1000_ªv_pﬁ¨ôy_undeföed
 = 0xFF

181 
	ee1000_fc_mode
 {

182 
	me1000_fc_n⁄e
 = 0,

183 
	me1000_fc_rx_∑u£
,

184 
	me1000_fc_tx_∑u£
,

185 
	me1000_fc_fuŒ
,

186 
	me1000_fc_deÁu…
 = 0xFF

189 
	ee1000_ms_ty≥
 {

190 
	me1000_ms_hw_deÁu…
 = 0,

191 
	me1000_ms_f‹˚_ma°î
,

192 
	me1000_ms_f‹˚_¶ave
,

193 
	me1000_ms_auto


196 
	ee1000_sm¨t_•ìd
 {

197 
	me1000_sm¨t_•ìd_deÁu…
 = 0,

198 
	me1000_sm¨t_•ìd_⁄
,

199 
	me1000_sm¨t_•ìd_off


202 
	ee1000_£rdes_lök_°©e
 {

203 
	me1000_£rdes_lök_down
 = 0,

204 
	me1000_£rdes_lök_aut⁄eg_¥ogªss
,

205 
	me1000_£rdes_lök_aut⁄eg_com∂ëe
,

206 
	me1000_£rdes_lök_f‹˚d_up


209 #i‚de‡
__À16


210 
	#__À16
 
u16


	)

212 #i‚de‡
__À32


213 
	#__À32
 
u32


	)

215 #i‚de‡
__À64


216 
	#__À64
 
u64


	)

219 
	ue1000_rx_desc_exãnded
 {

221 
__À64
 
	mbuf„r_addr
;

222 
__À64
 
	mª£rved
;

223 } 
	mªad
;

226 
__À32
 
	mmrq
;

228 
__À32
 
	mrss
;

230 
__À16
 
	mù_id
;

231 
__À16
 
	mcsum
;

232 } 
	mcsum_ù
;

233 } 
	mhi_dw‹d
;

234 } 
	mlowî
;

236 
__À32
 
	m°©us_îr‹
;

237 
__À16
 
	mÀngth
;

238 
__À16
 
	mvœn
;

239 } 
	muµî
;

240 } 
	mwb
;

243 
	#MAX_PS_BUFFERS
 4

	)

246 
	#PS_PAGE_BUFFERS
 (
MAX_PS_BUFFERS
 - 1)

	)

249 
	ue1000_rx_desc_∑ckë_•lô
 {

252 
__À64
 
	mbuf„r_addr
[
MAX_PS_BUFFERS
];

253 } 
	mªad
;

256 
__À32
 
	mmrq
;

258 
__À32
 
	mrss
;

260 
__À16
 
	mù_id
;

261 
__À16
 
	mcsum
;

262 } 
	mcsum_ù
;

263 } 
	mhi_dw‹d
;

264 } 
	mlowî
;

266 
__À32
 
	m°©us_îr‹
;

267 
__À16
 
	mÀngth0
;

268 
__À16
 
	mvœn
;

269 } 
	mmiddÀ
;

271 
__À16
 
	mhódî_°©us
;

273 
__À16
 
	mÀngth
[
PS_PAGE_BUFFERS
];

274 } 
	muµî
;

275 
__À64
 
	mª£rved
;

276 } 
	mwb
;

280 
	se1000_tx_desc
 {

281 
__À64
 
	mbuf„r_addr
;

283 
__À32
 
	md©a
;

285 
__À16
 
	mÀngth
;

286 
u8
 
	mcso
;

287 
u8
 
	mcmd
;

288 } 
	mÊags
;

289 } 
	mlowî
;

291 
__À32
 
	md©a
;

293 
u8
 
	m°©us
;

294 
u8
 
	mcss
;

295 
__À16
 
	m•ecül
;

296 } 
	mfõlds
;

297 } 
	muµî
;

301 
	se1000_c⁄ãxt_desc
 {

303 
__À32
 
	mù_c⁄fig
;

305 
u8
 
	mùcss
;

306 
u8
 
	mùcso
;

307 
__À16
 
	mùc£
;

308 } 
	mù_fõlds
;

309 } 
	mlowî_£tup
;

311 
__À32
 
	mt˝_c⁄fig
;

313 
u8
 
	mtucss
;

314 
u8
 
	mtucso
;

315 
__À16
 
	mtuc£
;

316 } 
	mt˝_fõlds
;

317 } 
	muµî_£tup
;

318 
__À32
 
	mcmd_™d_Àngth
;

320 
__À32
 
	md©a
;

322 
u8
 
	m°©us
;

323 
u8
 
	mhdr_Àn
;

324 
__À16
 
	mmss
;

325 } 
	mfõlds
;

326 } 
	mt˝_£g_£tup
;

330 
	se1000_d©a_desc
 {

331 
__À64
 
	mbuf„r_addr
;

333 
__À32
 
	md©a
;

335 
__À16
 
	mÀngth
;

336 
u8
 
	mtyp_Àn_ext
;

337 
u8
 
	mcmd
;

338 } 
	mÊags
;

339 } 
	mlowî
;

341 
__À32
 
	md©a
;

343 
u8
 
	m°©us
;

344 
u8
 
	mp›ts
;

345 
__À16
 
	m•ecül
;

346 } 
	mfõlds
;

347 } 
	muµî
;

351 
	se1000_hw_°©s
 {

352 
u64
 
	m¸˚ºs
;

353 
u64
 
	mÆg√ºc
;

354 
u64
 
	msymîrs
;

355 
u64
 
	mrxîrc
;

356 
u64
 
	mmpc
;

357 
u64
 
	mscc
;

358 
u64
 
	mecﬁ
;

359 
u64
 
	mmcc
;

360 
u64
 
	mœãcﬁ
;

361 
u64
 
	mcﬁc
;

362 
u64
 
	mdc
;

363 
u64
 
	mä¸s
;

364 
u64
 
	m£c
;

365 
u64
 
	m˚xãº
;

366 
u64
 
	mæec
;

367 
u64
 
	mx⁄rxc
;

368 
u64
 
	mx⁄txc
;

369 
u64
 
	mxof‰xc
;

370 
u64
 
	mxof·xc
;

371 
u64
 
	mf¸uc
;

372 
u64
 
	m¥c64
;

373 
u64
 
	m¥c127
;

374 
u64
 
	m¥c255
;

375 
u64
 
	m¥c511
;

376 
u64
 
	m¥c1023
;

377 
u64
 
	m¥c1522
;

378 
u64
 
	mg¥c
;

379 
u64
 
	mb¥c
;

380 
u64
 
	mm¥c
;

381 
u64
 
	mg±c
;

382 
u64
 
	mg‹c
;

383 
u64
 
	mgŸc
;

384 
u64
 
	m∫bc
;

385 
u64
 
	mruc
;

386 
u64
 
	mrfc
;

387 
u64
 
	mroc
;

388 
u64
 
	mrjc
;

389 
u64
 
	mmg¥c
;

390 
u64
 
	mmgpdc
;

391 
u64
 
	mmg±c
;

392 
u64
 
	mt‹
;

393 
u64
 
	mtŸ
;

394 
u64
 
	mçr
;

395 
u64
 
	mçt
;

396 
u64
 
	m±c64
;

397 
u64
 
	m±c127
;

398 
u64
 
	m±c255
;

399 
u64
 
	m±c511
;

400 
u64
 
	m±c1023
;

401 
u64
 
	m±c1522
;

402 
u64
 
	mm±c
;

403 
u64
 
	mb±c
;

404 
u64
 
	mts˘c
;

405 
u64
 
	mts˘fc
;

406 
u64
 
	müc
;

407 
u64
 
	mi¸x±c
;

408 
u64
 
	mi¸x©c
;

409 
u64
 
	mi˘x±c
;

410 
u64
 
	mi˘x©c
;

411 
u64
 
	mi˘xqec
;

412 
u64
 
	mi˘xqmtc
;

413 
u64
 
	mi¸xdmtc
;

414 
u64
 
	mi¸xoc
;

417 
	se1000_phy_°©s
 {

418 
u32
 
	midÀ_îr‹s
;

419 
u32
 
	mª˚ive_îr‹s
;

422 
	se1000_ho°_mng_dh˝_cookõ
 {

423 
u32
 
	msig«tuª
;

424 
u8
 
	m°©us
;

425 
u8
 
	mª£rved0
;

426 
u16
 
	mvœn_id
;

427 
u32
 
	mª£rved1
;

428 
u16
 
	mª£rved2
;

429 
u8
 
	mª£rved3
;

430 
u8
 
	mchecksum
;

434 
	se1000_ho°_comm™d_hódî
 {

435 
u8
 
	mcomm™d_id
;

436 
u8
 
	mcomm™d_Àngth
;

437 
u8
 
	mcomm™d_›ti⁄s
;

438 
u8
 
	mchecksum
;

441 
	#E1000_HI_MAX_DATA_LENGTH
 252

	)

442 
	se1000_ho°_comm™d_öfo
 {

443 
e1000_ho°_comm™d_hódî
 
	mcomm™d_hódî
;

444 
u8
 
	mcomm™d_d©a
[
E1000_HI_MAX_DATA_LENGTH
];

448 
	se1000_ho°_mng_comm™d_hódî
 {

449 
u8
 
	mcomm™d_id
;

450 
u8
 
	mchecksum
;

451 
u16
 
	mª£rved1
;

452 
u16
 
	mª£rved2
;

453 
u16
 
	mcomm™d_Àngth
;

456 
	#E1000_HI_MAX_MNG_DATA_LENGTH
 0x6F8

	)

457 
	se1000_ho°_mng_comm™d_öfo
 {

458 
e1000_ho°_mng_comm™d_hódî
 
	mcomm™d_hódî
;

459 
u8
 
	mcomm™d_d©a
[
E1000_HI_MAX_MNG_DATA_LENGTH
];

462 
	~"mac.h
"

463 
	~"phy.h
"

464 
	~"nvm.h
"

465 
	~"m™age.h
"

468 
	se1000_mac_›î©i⁄s
 {

469 
s32
(*
id_Àd_öô
Ë(
	me1000_hw
 *);

470 
s32
(*
blök_Àd
Ë(
	me1000_hw
 *);

471 
boﬁ
 (*
check_mng_mode
Ë(
	me1000_hw
 *);

472 
s32
(*
check_f‹_lök
Ë(
	me1000_hw
 *);

473 
s32
(*
˛ónup_Àd
Ë(
	me1000_hw
 *);

474 (*
	m˛ór_hw_˙ås
Ë(
	me1000_hw
 *);

475 (*
	m˛ór_v·a
Ë(
	me1000_hw
 *);

476 
s32
(*
gë_bus_öfo
Ë(
	me1000_hw
 *);

477 (*
	m£t_œn_id
Ë(
	me1000_hw
 *);

478 
s32
(*
gë_lök_up_öfo
Ë(
	me1000_hw
 *, 
	mu16
 *, u16 *);

479 
s32
(*
Àd_⁄
Ë(
	me1000_hw
 *);

480 
s32
(*
Àd_off
Ë(
	me1000_hw
 *);

481 (*
	mupd©e_mc_addr_li°
Ë(
	me1000_hw
 *, 
	mu8
 *, 
	mu32
);

482 
s32
(*
ª£t_hw
Ë(
	me1000_hw
 *);

483 
s32
(*
öô_hw
Ë(
	me1000_hw
 *);

484 
s32
(*
£tup_lök
Ë(
	me1000_hw
 *);

485 
s32
(*
£tup_physiˇl_öãrÁ˚
Ë(
	me1000_hw
 *);

486 
s32
(*
£tup_Àd
Ë(
	me1000_hw
 *);

487 (*
	mwrôe_v·a
Ë(
	me1000_hw
 *, 
	mu32
, u32);

488 (*
	mc⁄fig_cﬁlisi⁄_di°
Ë(
	me1000_hw
 *);

489 (*
	mør_£t
Ë(
	me1000_hw
 *, 
	mu8
 *, 
	mu32
);

490 
s32
(*
ªad_mac_addr
Ë(
	me1000_hw
 *);

491 
s32
(*
vÆid©e_mdi_£âög
Ë(
	me1000_hw
 *);

508 
	se1000_phy_›î©i⁄s
 {

509 
s32
(*
acquúe
Ë(
	me1000_hw
 *);

510 
s32
(*
cfg_⁄_lök_up
Ë(
	me1000_hw
 *);

511 
s32
(*
check_pﬁ¨ôy
Ë(
	me1000_hw
 *);

512 
s32
(*
check_ª£t_block
Ë(
	me1000_hw
 *);

513 
s32
(*
commô
Ë(
	me1000_hw
 *);

514 
s32
(*
f‹˚_•ìd_du∂ex
Ë(
	me1000_hw
 *);

515 
s32
(*
gë_cfg_d⁄e
Ë(
e1000_hw
 *
	mhw
);

516 
s32
(*
gë_ˇbÀ_Àngth
Ë(
	me1000_hw
 *);

517 
s32
(*
gë_öfo
Ë(
	me1000_hw
 *);

518 
s32
(*
£t_∑ge
Ë(
	me1000_hw
 *, 
	mu16
);

519 
s32
(*
ªad_ªg
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
 *);

520 
s32
(*
ªad_ªg_locked
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
 *);

521 
s32
(*
ªad_ªg_∑ge
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
 *);

522 (*
	mªÀa£
Ë(
	me1000_hw
 *);

523 
s32
(*
ª£t
Ë(
	me1000_hw
 *);

524 
s32
(*
£t_d0_Õlu_°©e
Ë(
	me1000_hw
 *, 
	mboﬁ
);

525 
s32
(*
£t_d3_Õlu_°©e
Ë(
	me1000_hw
 *, 
	mboﬁ
);

526 
s32
(*
wrôe_ªg
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
);

527 
s32
(*
wrôe_ªg_locked
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
);

528 
s32
(*
wrôe_ªg_∑ge
Ë(
	me1000_hw
 *, 
	mu32
, 
	mu16
);

529 (*
	mpowî_up
Ë(
	me1000_hw
 *);

530 (*
	mpowî_down
Ë(
	me1000_hw
 *);

534 
	se1000_nvm_›î©i⁄s
 {

535 
s32
(*
acquúe
Ë(
	me1000_hw
 *);

536 
s32
(*
ªad
Ë(
	me1000_hw
 *, 
	mu16
, u16, u16 *);

537 (*
	mªÀa£
Ë(
	me1000_hw
 *);

538 (*
	mªlﬂd
Ë(
	me1000_hw
 *);

539 
s32
(*
upd©e
Ë(
	me1000_hw
 *);

540 
s32
(*
vÆid_Àd_deÁu…
Ë(
	me1000_hw
 *, 
	mu16
 *);

541 
s32
(*
vÆid©e
Ë(
	me1000_hw
 *);

542 
s32
(*
wrôe
Ë(
	me1000_hw
 *, 
	mu16
, u16, u16 *);

545 
	se1000_mac_öfo
 {

546 
e1000_mac_›î©i⁄s
 
	m›s
;

547 
u8
 
	maddr
[
ETH_ALEN
];

548 
u8
 
	m≥rm_addr
[
ETH_ALEN
];

550 
e1000_mac_ty≥
 
	mty≥
;

552 
u32
 
	mcﬁlisi⁄_dñè
;

553 
u32
 
	mÀd˘l_deÁu…
;

554 
u32
 
	mÀd˘l_mode1
;

555 
u32
 
	mÀd˘l_mode2
;

556 
u32
 
	mmc_fûãr_ty≥
;

557 
u32
 
	mtx_∑ckë_dñè
;

558 
u32
 
	mtxcw
;

560 
u16
 
	mcuºít_ifs_vÆ
;

561 
u16
 
	mifs_max_vÆ
;

562 
u16
 
	mifs_mö_vÆ
;

563 
u16
 
	mifs_øtio
;

564 
u16
 
	mifs_°ï_size
;

565 
u16
 
	mmè_ªg_cou¡
;

568 
	#MAX_MTA_REG
 128

	)

569 
u32
 
	mmè_shadow
[
MAX_MTA_REG
];

570 
u16
 
	mør_íåy_cou¡
;

572 
u8
 
	mf‹˚d_•ìd_du∂ex
;

574 
boﬁ
 
	mad≠tive_ifs
;

575 
boﬁ
 
	mhas_fwsm
;

576 
boﬁ
 
	m¨c_subsy°em_vÆid
;

577 
boﬁ
 
	maut⁄eg
;

578 
boﬁ
 
	maut⁄eg_Áûed
;

579 
boﬁ
 
	mgë_lök_°©us
;

580 
boﬁ
 
	mö_ifs_mode
;

581 
boﬁ
 
	m£rdes_has_lök
;

582 
boﬁ
 
	mtx_pkt_fûãrög
;

583 
e1000_£rdes_lök_°©e
 
	m£rdes_lök_°©e
;

586 
	se1000_phy_öfo
 {

587 
e1000_phy_›î©i⁄s
 
	m›s
;

589 
e1000_phy_ty≥
 
	mty≥
;

591 
e1000_1000t_rx_°©us
 
	mloˇl_rx
;

592 
e1000_1000t_rx_°©us
 
	mªmŸe_rx
;

593 
e1000_ms_ty≥
 
	mms_ty≥
;

594 
e1000_ms_ty≥
 
	m‹igöÆ_ms_ty≥
;

595 
e1000_ªv_pﬁ¨ôy
 
	mˇbÀ_pﬁ¨ôy
;

596 
e1000_sm¨t_•ìd
 
	msm¨t_•ìd
;

598 
u32
 
	maddr
;

599 
u32
 
	mid
;

600 
u32
 
	mª£t_dñay_us
;

601 
u32
 
	mªvisi⁄
;

603 
e1000_medü_ty≥
 
	mmedü_ty≥
;

605 
u16
 
	maut⁄eg_advîti£d
;

606 
u16
 
	maut⁄eg_mask
;

607 
u16
 
	mˇbÀ_Àngth
;

608 
u16
 
	mmax_ˇbÀ_Àngth
;

609 
u16
 
	mmö_ˇbÀ_Àngth
;

611 
u8
 
	mmdix
;

613 
boﬁ
 
	mdißbÀ_pﬁ¨ôy_c‹ª˘i⁄
;

614 
boﬁ
 
	mis_mdix
;

615 
boﬁ
 
	mpﬁ¨ôy_c‹ª˘i⁄
;

616 
boﬁ
 
	m•ìd_downgøded
;

617 
boﬁ
 
	maut⁄eg_waô_to_com∂ëe
;

620 
	se1000_nvm_öfo
 {

621 
e1000_nvm_›î©i⁄s
 
	m›s
;

623 
e1000_nvm_ty≥
 
	mty≥
;

624 
e1000_nvm_ovîride
 
	movîride
;

626 
u32
 
	mÊash_b™k_size
;

627 
u32
 
	mÊash_ba£_addr
;

629 
u16
 
	mw‹d_size
;

630 
u16
 
	mdñay_u£c
;

631 
u16
 
	maddªss_bôs
;

632 
u16
 
	m›code_bôs
;

633 
u16
 
	m∑ge_size
;

636 
	se1000_bus_öfo
 {

637 
e1000_bus_width
 
	mwidth
;

639 
u16
 
	mfunc
;

642 
	se1000_fc_öfo
 {

643 
u32
 
	mhigh_w©î
;

644 
u32
 
	mlow_w©î
;

645 
u16
 
	m∑u£_time
;

646 
u16
 
	mª‰esh_time
;

647 
boﬁ
 
	m£nd_x⁄
;

648 
boﬁ
 
	m°ri˘_õì
;

649 
e1000_fc_mode
 
	mcuºít_mode
;

650 
e1000_fc_mode
 
	mªque°ed_mode
;

653 
	se1000_dev_•ec_82571
 {

654 
boﬁ
 
	mœa_is_¥e£¡
;

655 
u32
 
	msmb_cou¡î
;

658 
	se1000_dev_•ec_80003es2œn
 {

659 
boﬁ
 
	mmdic_wa_íabÀ
;

662 
	se1000_shadow_øm
 {

663 
u16
 
	mvÆue
;

664 
boﬁ
 
	mmodifõd
;

667 
	#E1000_ICH8_SHADOW_RAM_WORDS
 2048

	)

670 
	ee1000_uÕ_°©e
 {

671 
	me1000_uÕ_°©e_unknown
,

672 
	me1000_uÕ_°©e_off
,

673 
	me1000_uÕ_°©e_⁄
,

676 
	se1000_dev_•ec_ich8œn
 {

677 
boﬁ
 
	mkm∫_lock_loss_w‹k¨ound_íabÀd
;

678 
e1000_shadow_øm
 
	mshadow_øm
[
E1000_ICH8_SHADOW_RAM_WORDS
];

679 
boﬁ
 
	mnvm_k1_íabÀd
;

680 
boﬁ
 
	mìe_dißbÀ
;

681 
u16
 
	mìe_Õ_abûôy
;

682 
e1000_uÕ_°©e
 
	muÕ_°©e
;

685 
	se1000_hw
 {

686 
e1000_ad≠ãr
 *
	mad≠ãr
;

688 
__iomem
 *
	mhw_addr
;

689 
__iomem
 *
	mÊash_addªss
;

691 
e1000_mac_öfo
 
	mmac
;

692 
e1000_fc_öfo
 
	mfc
;

693 
e1000_phy_öfo
 
	mphy
;

694 
e1000_nvm_öfo
 
	mnvm
;

695 
e1000_bus_öfo
 
	mbus
;

696 
e1000_ho°_mng_dh˝_cookõ
 
	mmng_cookõ
;

699 
e1000_dev_•ec_82571
 
	me82571
;

700 
e1000_dev_•ec_80003es2œn
 
	me80003es2œn
;

701 
e1000_dev_•ec_ich8œn
 
	mich8œn
;

702 } 
	mdev_•ec
;

705 
	~"82571.h
"

706 
	~"80003es2œn.h
"

707 
	~"ich8œn.h
"

	@ich8lan.c

66 
	~"e1000.h
"

70 
	uich8_hws_Êash_°©us
 {

71 
	sich8_hsf°s
 {

72 
u16
 
	mÊcd⁄e
:1;

73 
u16
 
	mÊ˚º
:1;

74 
u16
 
	md´l
:1;

75 
u16
 
	mbîa£sz
:2;

76 
u16
 
	mÊcö¥og
:1;

77 
u16
 
	mª£rved1
:2;

78 
u16
 
	mª£rved2
:6;

79 
u16
 
	mÊdesvÆid
:1;

80 
u16
 
	mÊockdn
:1;

81 } 
	mhsf_°©us
;

82 
u16
 
	mªgvÆ
;

87 
	uich8_hws_Êash_˘æ
 {

88 
	sich8_hsÊ˘l
 {

89 
u16
 
	mÊcgo
:1;

90 
u16
 
	mÊcy˛e
:2;

91 
u16
 
	mª£rved
:5;

92 
u16
 
	mÊdbcou¡
:2;

93 
u16
 
	mÊockdn
:6;

94 } 
	mhsf_˘æ
;

95 
u16
 
	mªgvÆ
;

99 
	uich8_hws_Êash_ªgacc
 {

100 
	sich8_Êøcc
 {

101 
u32
 
	mgºa
:8;

102 
u32
 
	mgrwa
:8;

103 
u32
 
	mgmøg
:8;

104 
u32
 
	mgmwag
:8;

105 } 
	mhsf_Êªgacc
;

106 
u16
 
	mªgvÆ
;

109 
e1000_˛ór_hw_˙ås_ich8œn
(
e1000_hw
 *
hw
);

110 
e1000_öôülize_hw_bôs_ich8œn
(
e1000_hw
 *
hw
);

111 
s32
 
e1000_îa£_Êash_b™k_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
b™k
);

112 
s32
 
e1000_ªåy_wrôe_Êash_byã_ich8œn
(
e1000_hw
 *
hw
,

113 
u32
 
off£t
, 
u8
 
byã
);

114 
s32
 
e1000_ªad_Êash_byã_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

115 
u8
 *
d©a
);

116 
s32
 
e1000_ªad_Êash_w‹d_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

117 
u16
 *
d©a
);

118 
s32
 
e1000_ªad_Êash_d©a_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

119 
u8
 
size
, 
u16
 *
d©a
);

120 
s32
 
e1000_km∫_lock_loss_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
);

121 
s32
 
e1000_˛ónup_Àd_ich8œn
(
e1000_hw
 *
hw
);

122 
s32
 
e1000_Àd_⁄_ich8œn
(
e1000_hw
 *
hw
);

123 
s32
 
e1000_Àd_off_ich8œn
(
e1000_hw
 *
hw
);

124 
s32
 
e1000_id_Àd_öô_pchœn
(
e1000_hw
 *
hw
);

125 
s32
 
e1000_£tup_Àd_pchœn
(
e1000_hw
 *
hw
);

126 
s32
 
e1000_˛ónup_Àd_pchœn
(
e1000_hw
 *
hw
);

127 
s32
 
e1000_Àd_⁄_pchœn
(
e1000_hw
 *
hw
);

128 
s32
 
e1000_Àd_off_pchœn
(
e1000_hw
 *
hw
);

129 
s32
 
e1000_£t_Õlu_°©e_pchœn
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
);

130 
e1000_powî_down_phy_c›≥r_ich8œn
(
e1000_hw
 *
hw
);

131 
e1000_œn_öô_d⁄e_ich8œn
(
e1000_hw
 *
hw
);

132 
s32
 
e1000_k1_gig_w‹k¨ound_hv
(
e1000_hw
 *
hw
, 
boﬁ
 
lök
);

133 
s32
 
e1000_£t_mdio_¶ow_mode_hv
(
e1000_hw
 *
hw
);

134 
boﬁ
 
e1000_check_mng_mode_ich8œn
(
e1000_hw
 *
hw
);

135 
boﬁ
 
e1000_check_mng_mode_pchœn
(
e1000_hw
 *
hw
);

136 
e1000_ør_£t_pch2œn
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
);

137 
e1000_ør_£t_pch_Õt
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
);

138 
s32
 
e1000_k1_w‹k¨ound_lv
(
e1000_hw
 *
hw
);

139 
e1000_g©e_hw_phy_c⁄fig_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
g©e
);

140 
s32
 
e1000_£tup_c›≥r_lök_pch_Õt
(
e1000_hw
 *
hw
);

141 
s32
 
e1000_€m_bôs_c⁄fig_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
d0_°©e
);

143 
ölöe
 
u16
 
	$__î16Êash
(
e1000_hw
 *
hw
, 
ªg
)

145  
	`ªadw
(
hw
->
Êash_addªss
 + 
ªg
);

146 
	}
}

148 
ölöe
 
u32
 
	$__î32Êash
(
e1000_hw
 *
hw
, 
ªg
)

150  
	`ªadl
(
hw
->
Êash_addªss
 + 
ªg
);

151 
	}
}

153 
ölöe
 
	$__ew16Êash
(
e1000_hw
 *
hw
, 
ªg
, 
u16
 
vÆ
)

155 
	`wrôew
(
vÆ
, 
hw
->
Êash_addªss
 + 
ªg
);

156 
	}
}

158 
ölöe
 
	$__ew32Êash
(
e1000_hw
 *
hw
, 
ªg
, 
u32
 
vÆ
)

160 
	`wrôñ
(
vÆ
, 
hw
->
Êash_addªss
 + 
ªg
);

161 
	}
}

163 
	#î16Êash
(
ªg
Ë
	`__î16Êash
(
hw
, (ªg))

	)

164 
	#î32Êash
(
ªg
Ë
	`__î32Êash
(
hw
, (ªg))

	)

165 
	#ew16Êash
(
ªg
, 
vÆ
Ë
	`__ew16Êash
(
hw
, (ªg), (vÆ))

	)

166 
	#ew32Êash
(
ªg
, 
vÆ
Ë
	`__ew32Êash
(
hw
, (ªg), (vÆ))

	)

178 
boﬁ
 
	$e1000_phy_is_ac˚ssibÀ_pchœn
(
e1000_hw
 *
hw
)

180 
u16
 
phy_ªg
 = 0;

181 
u32
 
phy_id
 = 0;

182 
s32
 
ªt_vÆ
 = 0;

183 
u16
 
ªåy_cou¡
;

184 
u32
 
mac_ªg
 = 0;

186 
ªåy_cou¡
 = 0;Ñetry_count < 2;Ñetry_count++) {

187 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
MII_PHYSID1
, &
phy_ªg
);

188 i‡(
ªt_vÆ
 || (
phy_ªg
 == 0xFFFF))

190 
phy_id
 = (
u32
)(
phy_ªg
 << 16);

192 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
MII_PHYSID2
, &
phy_ªg
);

193 i‡(
ªt_vÆ
 || (
phy_ªg
 == 0xFFFF)) {

194 
phy_id
 = 0;

197 
phy_id
 |(
u32
)(
phy_ªg
 & 
PHY_REVISION_MASK
);

201 i‡(
hw
->
phy
.
id
) {

202 i‡(
hw
->
phy
.
id
 =
phy_id
)

203 
out
;

204 } i‡(
phy_id
) {

205 
hw
->
phy
.
id
 = 
phy_id
;

206 
hw
->
phy
.
ªvisi⁄
 = (
u32
)(
phy_ªg
 & ~
PHY_REVISION_MASK
);

207 
out
;

213 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pch_Õt
) {

214 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

215 
ªt_vÆ
 = 
	`e1000_£t_mdio_¶ow_mode_hv
(
hw
);

216 i‡(!
ªt_vÆ
)

217 
ªt_vÆ
 = 
	`e1000e_gë_phy_id
(
hw
);

218 
hw
->
phy
.
›s
.
	`acquúe
(hw);

221 i‡(
ªt_vÆ
)

222  
Ál£
;

223 
out
:

224 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

226 
	`e1e_Ωhy_locked
(
hw
, 
CV_SMB_CTRL
, &
phy_ªg
);

227 
phy_ªg
 &~
CV_SMB_CTRL_FORCE_SMBUS
;

228 
	`e1e_wphy_locked
(
hw
, 
CV_SMB_CTRL
, 
phy_ªg
);

231 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

232 
mac_ªg
 &~
E1000_CTRL_EXT_FORCE_SMBUS
;

233 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

236  
åue
;

237 
	}
}

246 
	$e1000_toggÀ_œ≈hypc_pch_Õt
(
e1000_hw
 *
hw
)

248 
u32
 
mac_ªg
;

251 
mac_ªg
 = 
	`î32
(
FEXTNVM3
);

252 
mac_ªg
 &~
E1000_FEXTNVM3_PHY_CFG_COUNTER_MASK
;

253 
mac_ªg
 |
E1000_FEXTNVM3_PHY_CFG_COUNTER_50MSEC
;

254 
	`ew32
(
FEXTNVM3
, 
mac_ªg
);

257 
mac_ªg
 = 
	`î32
(
CTRL
);

258 
mac_ªg
 |
E1000_CTRL_LANPHYPC_OVERRIDE
;

259 
mac_ªg
 &~
E1000_CTRL_LANPHYPC_VALUE
;

260 
	`ew32
(
CTRL
, 
mac_ªg
);

261 
	`e1e_Êush
();

262 
	`u¶ìp_ønge
(10, 20);

263 
mac_ªg
 &~
E1000_CTRL_LANPHYPC_OVERRIDE
;

264 
	`ew32
(
CTRL
, 
mac_ªg
);

265 
	`e1e_Êush
();

267 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pch_Õt
) {

268 
	`m¶ìp
(50);

270 
u16
 
cou¡
 = 20;

273 
	`u¶ìp_ønge
(5000, 10000);

274 } !(
	`î32
(
CTRL_EXT
Ë& 
E1000_CTRL_EXT_LPCD
Ë&& 
cou¡
--);

276 
	`m¶ìp
(30);

278 
	}
}

287 
s32
 
	$e1000_öô_phy_w‹k¨ounds_pchœn
(
e1000_hw
 *
hw
)

289 
e1000_ad≠ãr
 *
ad≠ãr
 = 
hw
->adapter;

290 
u32
 
mac_ªg
, 
fwsm
 = 
	`î32
(
FWSM
);

291 
s32
 
ªt_vÆ
;

296 
	`e1000_g©e_hw_phy_c⁄fig_ich8œn
(
hw
, 
åue
);

301 
hw
->
dev_•ec
.
ich8œn
.
uÕ_°©e
 = 
e1000_uÕ_°©e_unknown
;

302 
	`e1000_dißbÀ_uÕ_Õt_Õ
(
hw
, 
åue
);

304 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

305 i‡(
ªt_vÆ
) {

306 
	`e_dbg
("FailedÅo initialize PHY flow\n");

307 
out
;

314 
hw
->
mac
.
ty≥
) {

315 
e1000_pch_Õt
:

316 i‡(
	`e1000_phy_is_ac˚ssibÀ_pchœn
(
hw
))

322 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

323 
mac_ªg
 |
E1000_CTRL_EXT_FORCE_SMBUS
;

324 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

330 
	`m¶ìp
(50);

333 
e1000_pch2œn
:

334 i‡(
	`e1000_phy_is_ac˚ssibÀ_pchœn
(
hw
))

338 
e1000_pchœn
:

339 i‡((
hw
->
mac
.
ty≥
 =
e1000_pchœn
) &&

340 (
fwsm
 & 
E1000_ICH_FWSM_FW_VALID
))

343 i‡(
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) {

344 
	`e_dbg
("Required LANPHYPCÅoggle blocked by ME\n");

345 
ªt_vÆ
 = -
E1000_ERR_PHY
;

350 
	`e1000_toggÀ_œ≈hypc_pch_Õt
(
hw
);

351 i‡(
hw
->
mac
.
ty≥
 >
e1000_pch_Õt
) {

352 i‡(
	`e1000_phy_is_ac˚ssibÀ_pchœn
(
hw
))

358 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

359 
mac_ªg
 &~
E1000_CTRL_EXT_FORCE_SMBUS
;

360 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

362 i‡(
	`e1000_phy_is_ac˚ssibÀ_pchœn
(
hw
))

365 
ªt_vÆ
 = -
E1000_ERR_PHY
;

372 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

373 i‡(!
ªt_vÆ
) {

374 
i
 = 0;

377 i‡(
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) {

378 
	`e_îr
("Reset blocked by ME\n");

379 
out
;

387 
ªt_vÆ
 = 
	`e1000e_phy_hw_ª£t_gíîic
(
hw
);

388 i‡(
ªt_vÆ
)

389 
out
;

397 (
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) &&

398 (
i
++ < 10))

399 
	`u¶ìp_ønge
(10000, 20000);

401 i‡(
ªt_vÆ
)

402 
	`e_îr
("ME blockedáccessÅo PHYáfterÑeset\n");

405 
out
:

407 i‡((
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) &&

408 !(
fwsm
 & 
E1000_ICH_FWSM_FW_VALID
)) {

409 
	`u¶ìp_ønge
(10000, 20000);

410 
	`e1000_g©e_hw_phy_c⁄fig_ich8œn
(
hw
, 
Ál£
);

413  
ªt_vÆ
;

414 
	}
}

422 
s32
 
	$e1000_öô_phy_∑øms_pchœn
(
e1000_hw
 *
hw
)

424 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

425 
s32
 
ªt_vÆ
;

427 
phy
->
addr
 = 1;

428 
phy
->
ª£t_dñay_us
 = 100;

430 
phy
->
›s
.
£t_∑ge
 = 
e1000_£t_∑ge_igp
;

431 
phy
->
›s
.
ªad_ªg
 = 
e1000_ªad_phy_ªg_hv
;

432 
phy
->
›s
.
ªad_ªg_locked
 = 
e1000_ªad_phy_ªg_hv_locked
;

433 
phy
->
›s
.
ªad_ªg_∑ge
 = 
e1000_ªad_phy_ªg_∑ge_hv
;

434 
phy
->
›s
.
£t_d0_Õlu_°©e
 = 
e1000_£t_Õlu_°©e_pchœn
;

435 
phy
->
›s
.
£t_d3_Õlu_°©e
 = 
e1000_£t_Õlu_°©e_pchœn
;

436 
phy
->
›s
.
wrôe_ªg
 = 
e1000_wrôe_phy_ªg_hv
;

437 
phy
->
›s
.
wrôe_ªg_locked
 = 
e1000_wrôe_phy_ªg_hv_locked
;

438 
phy
->
›s
.
wrôe_ªg_∑ge
 = 
e1000_wrôe_phy_ªg_∑ge_hv
;

439 
phy
->
›s
.
powî_up
 = 
e1000_powî_up_phy_c›≥r
;

440 
phy
->
›s
.
powî_down
 = 
e1000_powî_down_phy_c›≥r_ich8œn
;

441 
phy
->
aut⁄eg_mask
 = 
AUTONEG_ADVERTISE_SPEED_DEFAULT
;

443 
phy
->
id
 = 
e1000_phy_unknown
;

445 
ªt_vÆ
 = 
	`e1000_öô_phy_w‹k¨ounds_pchœn
(
hw
);

446 i‡(
ªt_vÆ
)

447  
ªt_vÆ
;

449 i‡(
phy
->
id
 =
e1000_phy_unknown
)

450 
hw
->
mac
.
ty≥
) {

452 
ªt_vÆ
 = 
	`e1000e_gë_phy_id
(
hw
);

453 i‡(
ªt_vÆ
)

454  
ªt_vÆ
;

455 i‡((
phy
->
id
 !0Ë&& (phy->id !
PHY_REVISION_MASK
))

458 
e1000_pch2œn
:

459 
e1000_pch_Õt
:

463 
ªt_vÆ
 = 
	`e1000_£t_mdio_¶ow_mode_hv
(
hw
);

464 i‡(
ªt_vÆ
)

465  
ªt_vÆ
;

466 
ªt_vÆ
 = 
	`e1000e_gë_phy_id
(
hw
);

467 i‡(
ªt_vÆ
)

468  
ªt_vÆ
;

471 
phy
->
ty≥
 = 
	`e1000e_gë_phy_ty≥_‰om_id
’hy->
id
);

473 
phy
->
ty≥
) {

474 
e1000_phy_82577
:

475 
e1000_phy_82579
:

476 
e1000_phy_i217
:

477 
phy
->
›s
.
check_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_82577
;

478 
phy
->
›s
.
f‹˚_•ìd_du∂ex
 =

479 
e1000_phy_f‹˚_•ìd_du∂ex_82577
;

480 
phy
->
›s
.
gë_ˇbÀ_Àngth
 = 
e1000_gë_ˇbÀ_Àngth_82577
;

481 
phy
->
›s
.
gë_öfo
 = 
e1000_gë_phy_öfo_82577
;

482 
phy
->
›s
.
commô
 = 
e1000e_phy_sw_ª£t
;

484 
e1000_phy_82578
:

485 
phy
->
›s
.
check_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_m88
;

486 
phy
->
›s
.
f‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_m88
;

487 
phy
->
›s
.
gë_ˇbÀ_Àngth
 = 
e1000e_gë_ˇbÀ_Àngth_m88
;

488 
phy
->
›s
.
gë_öfo
 = 
e1000e_gë_phy_öfo_m88
;

491 
ªt_vÆ
 = -
E1000_ERR_PHY
;

495  
ªt_vÆ
;

496 
	}
}

504 
s32
 
	$e1000_öô_phy_∑øms_ich8œn
(
e1000_hw
 *
hw
)

506 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

507 
s32
 
ªt_vÆ
;

508 
u16
 
i
 = 0;

510 
phy
->
addr
 = 1;

511 
phy
->
ª£t_dñay_us
 = 100;

513 
phy
->
›s
.
powî_up
 = 
e1000_powî_up_phy_c›≥r
;

514 
phy
->
›s
.
powî_down
 = 
e1000_powî_down_phy_c›≥r_ich8œn
;

519 
ªt_vÆ
 = 
	`e1000e_dëîmöe_phy_addªss
(
hw
);

520 i‡(
ªt_vÆ
) {

521 
phy
->
›s
.
wrôe_ªg
 = 
e1000e_wrôe_phy_ªg_bm
;

522 
phy
->
›s
.
ªad_ªg
 = 
e1000e_ªad_phy_ªg_bm
;

523 
ªt_vÆ
 = 
	`e1000e_dëîmöe_phy_addªss
(
hw
);

524 i‡(
ªt_vÆ
) {

525 
	`e_dbg
("Cannot determine PHYáddr. Erroring out\n");

526  
ªt_vÆ
;

530 
phy
->
id
 = 0;

531 (
e1000_phy_unknown
 =
	`e1000e_gë_phy_ty≥_‰om_id
(
phy
->
id
)) &&

532 (
i
++ < 100)) {

533 
	`u¶ìp_ønge
(1000, 2000);

534 
ªt_vÆ
 = 
	`e1000e_gë_phy_id
(
hw
);

535 i‡(
ªt_vÆ
)

536  
ªt_vÆ
;

540 
phy
->
id
) {

541 
IGP03E1000_E_PHY_ID
:

542 
phy
->
ty≥
 = 
e1000_phy_igp_3
;

543 
phy
->
aut⁄eg_mask
 = 
AUTONEG_ADVERTISE_SPEED_DEFAULT
;

544 
phy
->
›s
.
ªad_ªg_locked
 = 
e1000e_ªad_phy_ªg_igp_locked
;

545 
phy
->
›s
.
wrôe_ªg_locked
 = 
e1000e_wrôe_phy_ªg_igp_locked
;

546 
phy
->
›s
.
gë_öfo
 = 
e1000e_gë_phy_öfo_igp
;

547 
phy
->
›s
.
check_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_igp
;

548 
phy
->
›s
.
f‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_igp
;

550 
IFE_E_PHY_ID
:

551 
IFE_PLUS_E_PHY_ID
:

552 
IFE_C_E_PHY_ID
:

553 
phy
->
ty≥
 = 
e1000_phy_i„
;

554 
phy
->
aut⁄eg_mask
 = 
E1000_ALL_NOT_GIG
;

555 
phy
->
›s
.
gë_öfo
 = 
e1000_gë_phy_öfo_i„
;

556 
phy
->
›s
.
check_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_i„
;

557 
phy
->
›s
.
f‹˚_•ìd_du∂ex
 = 
e1000_phy_f‹˚_•ìd_du∂ex_i„
;

559 
BME1000_E_PHY_ID
:

560 
phy
->
ty≥
 = 
e1000_phy_bm
;

561 
phy
->
aut⁄eg_mask
 = 
AUTONEG_ADVERTISE_SPEED_DEFAULT
;

562 
phy
->
›s
.
ªad_ªg
 = 
e1000e_ªad_phy_ªg_bm
;

563 
phy
->
›s
.
wrôe_ªg
 = 
e1000e_wrôe_phy_ªg_bm
;

564 
phy
->
›s
.
commô
 = 
e1000e_phy_sw_ª£t
;

565 
phy
->
›s
.
gë_öfo
 = 
e1000e_gë_phy_öfo_m88
;

566 
phy
->
›s
.
check_pﬁ¨ôy
 = 
e1000_check_pﬁ¨ôy_m88
;

567 
phy
->
›s
.
f‹˚_•ìd_du∂ex
 = 
e1000e_phy_f‹˚_•ìd_du∂ex_m88
;

570  -
E1000_ERR_PHY
;

575 
	}
}

584 
s32
 
	$e1000_öô_nvm_∑øms_ich8œn
(
e1000_hw
 *
hw
)

586 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

587 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

588 
u32
 
gÂªg
, 
£˘‹_ba£_addr
, 
£˘‹_íd_addr
;

589 
u16
 
i
;

592 i‡(!
hw
->
Êash_addªss
) {

593 
	`e_dbg
("ERROR: FlashÑegistersÇot mapped\n");

594  -
E1000_ERR_CONFIG
;

597 
nvm
->
ty≥
 = 
e1000_nvm_Êash_sw
;

599 
gÂªg
 = 
	`î32Êash
(
ICH_FLASH_GFPREG
);

605 
£˘‹_ba£_addr
 = 
gÂªg
 & 
FLASH_GFPREG_BASE_MASK
;

606 
£˘‹_íd_addr
 = ((
gÂªg
 >> 16Ë& 
FLASH_GFPREG_BASE_MASK
) + 1;

609 
nvm
->
Êash_ba£_addr
 = 
£˘‹_ba£_addr
 << 
FLASH_SECTOR_ADDR_SHIFT
;

614 
nvm
->
Êash_b™k_size
 = ((
£˘‹_íd_addr
 - 
£˘‹_ba£_addr
)

615 << 
FLASH_SECTOR_ADDR_SHIFT
);

616 
nvm
->
Êash_b™k_size
 /= 2;

618 
nvm
->
Êash_b™k_size
 /(
u16
);

620 
nvm
->
w‹d_size
 = 
E1000_ICH8_SHADOW_RAM_WORDS
;

623 
i
 = 0; i < 
nvm
->
w‹d_size
; i++) {

624 
dev_•ec
->
shadow_øm
[
i
].
modifõd
 = 
Ál£
;

625 
dev_•ec
->
shadow_øm
[
i
].
vÆue
 = 0xFFFF;

629 
	}
}

638 
s32
 
	$e1000_öô_mac_∑øms_ich8œn
(
e1000_hw
 *
hw
)

640 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

641 
u16
 
pci_cfg
;

644 
hw
->
phy
.
medü_ty≥
 = 
e1000_medü_ty≥_c›≥r
;

647 
mac
->
mè_ªg_cou¡
 = 32;

649 
mac
->
ør_íåy_cou¡
 = 
E1000_ICH_RAR_ENTRIES
;

650 i‡(
mac
->
ty≥
 =
e1000_ich8œn
)

651 
mac
->
ør_íåy_cou¡
--;

653 
mac
->
has_fwsm
 = 
åue
;

655 
mac
->
¨c_subsy°em_vÆid
 = 
Ál£
;

657 
mac
->
ad≠tive_ifs
 = 
åue
;

660 
mac
->
ty≥
) {

661 
e1000_ich8œn
:

662 
e1000_ich9œn
:

663 
e1000_ich10œn
:

665 
mac
->
›s
.
check_mng_mode
 = 
e1000_check_mng_mode_ich8œn
;

667 
mac
->
›s
.
id_Àd_öô
 = 
e1000e_id_Àd_öô_gíîic
;

669 
mac
->
›s
.
blök_Àd
 = 
e1000e_blök_Àd_gíîic
;

671 
mac
->
›s
.
£tup_Àd
 = 
e1000e_£tup_Àd_gíîic
;

673 
mac
->
›s
.
˛ónup_Àd
 = 
e1000_˛ónup_Àd_ich8œn
;

675 
mac
->
›s
.
Àd_⁄
 = 
e1000_Àd_⁄_ich8œn
;

676 
mac
->
›s
.
Àd_off
 = 
e1000_Àd_off_ich8œn
;

678 
e1000_pch2œn
:

679 
mac
->
ør_íåy_cou¡
 = 
E1000_PCH2_RAR_ENTRIES
;

680 
mac
->
›s
.
ør_£t
 = 
e1000_ør_£t_pch2œn
;

682 
e1000_pch_Õt
:

683 
e1000_pchœn
:

685 
	`pci_ªad_c⁄fig_w‹d
(
hw
->
ad≠ãr
->
pdev
,

686 
E1000_PCI_REVISION_ID_REG
, &
pci_cfg
);

687 
hw
->
ad≠ãr
->
ªvisi⁄_id
 = (
u8
)(
pci_cfg
 &= 0x000F);

689 
mac
->
›s
.
check_mng_mode
 = 
e1000_check_mng_mode_pchœn
;

691 
mac
->
›s
.
id_Àd_öô
 = 
e1000_id_Àd_öô_pchœn
;

693 
mac
->
›s
.
£tup_Àd
 = 
e1000_£tup_Àd_pchœn
;

695 
mac
->
›s
.
˛ónup_Àd
 = 
e1000_˛ónup_Àd_pchœn
;

697 
mac
->
›s
.
Àd_⁄
 = 
e1000_Àd_⁄_pchœn
;

698 
mac
->
›s
.
Àd_off
 = 
e1000_Àd_off_pchœn
;

704 i‡(
mac
->
ty≥
 =
e1000_pch_Õt
) {

705 
mac
->
ør_íåy_cou¡
 = 
E1000_PCH_LPT_RAR_ENTRIES
;

706 
mac
->
›s
.
ør_£t
 = 
e1000_ør_£t_pch_Õt
;

707 
mac
->
›s
.
£tup_physiˇl_öãrÁ˚
 =

708 
e1000_£tup_c›≥r_lök_pch_Õt
;

712 i‡(
mac
->
ty≥
 =
e1000_ich8œn
)

713 
	`e1000e_£t_km∫_lock_loss_w‹k¨ound_ich8œn
(
hw
, 
åue
);

716 
	}
}

727 
s32
 
	$__e1000_ac˚ss_emi_ªg_locked
(
e1000_hw
 *
hw
, 
u16
 
addªss
,

728 
u16
 *
d©a
, 
boﬁ
 
ªad
)

730 
s32
 
ªt_vÆ
;

732 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
I82579_EMI_ADDR
, 
addªss
);

733 i‡(
ªt_vÆ
)

734  
ªt_vÆ
;

736 i‡(
ªad
)

737 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
I82579_EMI_DATA
, 
d©a
);

739 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
I82579_EMI_DATA
, *
d©a
);

741  
ªt_vÆ
;

742 
	}
}

752 
s32
 
	$e1000_ªad_emi_ªg_locked
(
e1000_hw
 *
hw
, 
u16
 
addr
, u16 *
d©a
)

754  
	`__e1000_ac˚ss_emi_ªg_locked
(
hw
, 
addr
, 
d©a
, 
åue
);

755 
	}
}

765 
s32
 
	$e1000_wrôe_emi_ªg_locked
(
e1000_hw
 *
hw
, 
u16
 
addr
, u16 
d©a
)

767  
	`__e1000_ac˚ss_emi_ªg_locked
(
hw
, 
addr
, &
d©a
, 
Ál£
);

768 
	}
}

784 
s32
 
	$e1000_£t_ìe_pchœn
(
e1000_hw
 *
hw
)

786 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

787 
s32
 
ªt_vÆ
;

788 
u16
 
Õa
, 
pcs_°©us
, 
adv
, 
adv_addr
, 
Õi_˘æ
, 
d©a
;

790 
hw
->
phy
.
ty≥
) {

791 
e1000_phy_82579
:

792 
Õa
 = 
I82579_EEE_LP_ABILITY
;

793 
pcs_°©us
 = 
I82579_EEE_PCS_STATUS
;

794 
adv_addr
 = 
I82579_EEE_ADVERTISEMENT
;

796 
e1000_phy_i217
:

797 
Õa
 = 
I217_EEE_LP_ABILITY
;

798 
pcs_°©us
 = 
I217_EEE_PCS_STATUS
;

799 
adv_addr
 = 
I217_EEE_ADVERTISEMENT
;

805 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

806 i‡(
ªt_vÆ
)

807  
ªt_vÆ
;

809 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
I82579_LPI_CTRL
, &
Õi_˘æ
);

810 i‡(
ªt_vÆ
)

811 
ªÀa£
;

814 
Õi_˘æ
 &~
I82579_LPI_CTRL_ENABLE_MASK
;

817 i‡(!
dev_•ec
->
ìe_dißbÀ
) {

819 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
Õa
,

820 &
dev_•ec
->
ìe_Õ_abûôy
);

821 i‡(
ªt_vÆ
)

822 
ªÀa£
;

825 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
adv_addr
, &
adv
);

826 i‡(
ªt_vÆ
)

827 
ªÀa£
;

832 i‡(
adv
 & 
dev_•ec
->
ìe_Õ_abûôy
 & 
I82579_EEE_1000_SUPPORTED
)

833 
Õi_˘æ
 |
I82579_LPI_CTRL_1000_ENABLE
;

835 i‡(
adv
 & 
dev_•ec
->
ìe_Õ_abûôy
 & 
I82579_EEE_100_SUPPORTED
) {

836 
	`e1e_Ωhy_locked
(
hw
, 
MII_LPA
, &
d©a
);

837 i‡(
d©a
 & 
LPA_100FULL
)

838 
Õi_˘æ
 |
I82579_LPI_CTRL_100_ENABLE
;

844 
dev_•ec
->
ìe_Õ_abûôy
 &=

845 ~
I82579_EEE_100_SUPPORTED
;

850 
ªt_vÆ
 = 
	`e1000_ªad_emi_ªg_locked
(
hw
, 
pcs_°©us
, &
d©a
);

851 i‡(
ªt_vÆ
)

852 
ªÀa£
;

854 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
I82579_LPI_CTRL
, 
Õi_˘æ
);

855 
ªÀa£
:

856 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

858  
ªt_vÆ
;

859 
	}
}

872 
s32
 
	$e1000_k1_w‹k¨ound_Õt_Õ
(
e1000_hw
 *
hw
, 
boﬁ
 
lök
)

874 
u32
 
„xävm6
 = 
	`î32
(
FEXTNVM6
);

875 
u32
 
°©us
 = 
	`î32
(
STATUS
);

876 
s32
 
ªt_vÆ
 = 0;

877 
u16
 
ªg
;

879 i‡(
lök
 && (
°©us
 & 
E1000_STATUS_SPEED_1000
)) {

880 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

881 i‡(
ªt_vÆ
)

882  
ªt_vÆ
;

884 
ªt_vÆ
 =

885 
	`e1000e_ªad_km∫_ªg_locked
(
hw
, 
E1000_KMRNCTRLSTA_K1_CONFIG
,

886 &
ªg
);

887 i‡(
ªt_vÆ
)

888 
ªÀa£
;

890 
ªt_vÆ
 =

891 
	`e1000e_wrôe_km∫_ªg_locked
(
hw
,

892 
E1000_KMRNCTRLSTA_K1_CONFIG
,

893 
ªg
 &

894 ~
E1000_KMRNCTRLSTA_K1_ENABLE
);

895 i‡(
ªt_vÆ
)

896 
ªÀa£
;

898 
	`u¶ìp_ønge
(10, 20);

900 
	`ew32
(
FEXTNVM6
, 
„xävm6
 | 
E1000_FEXTNVM6_REQ_PLL_CLK
);

902 
ªt_vÆ
 =

903 
	`e1000e_wrôe_km∫_ªg_locked
(
hw
,

904 
E1000_KMRNCTRLSTA_K1_CONFIG
,

905 
ªg
);

906 
ªÀa£
:

907 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

910 
„xävm6
 &~
E1000_FEXTNVM6_REQ_PLL_CLK
;

912 i‡(!
lök
 || ((
°©us
 & 
E1000_STATUS_SPEED_100
) &&

913 (
°©us
 & 
E1000_STATUS_FD
)))

914 
upd©e_„xävm6
;

916 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I217_INBAND_CTRL
, &
ªg
);

917 i‡(
ªt_vÆ
)

918  
ªt_vÆ
;

921 
ªg
 &~
I217_INBAND_CTRL_LINK_STAT_TX_TIMEOUT_MASK
;

923 i‡(
°©us
 & 
E1000_STATUS_SPEED_100
) {

925 
ªg
 |5 << 
I217_INBAND_CTRL_LINK_STAT_TX_TIMEOUT_SHIFT
;

928 
„xävm6
 &~
E1000_FEXTNVM6_ENABLE_K1_ENTRY_CONDITION
;

931 
ªg
 |= 50 <<

932 
I217_INBAND_CTRL_LINK_STAT_TX_TIMEOUT_SHIFT
;

935 
„xävm6
 |
E1000_FEXTNVM6_ENABLE_K1_ENTRY_CONDITION
;

938 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
I217_INBAND_CTRL
, 
ªg
);

939 i‡(
ªt_vÆ
)

940  
ªt_vÆ
;

942 
upd©e_„xävm6
:

943 
	`ew32
(
FEXTNVM6
, 
„xävm6
);

946  
ªt_vÆ
;

947 
	}
}

965 
s32
 
	$e1000_∂©f‹m_pm_pch_Õt
(
e1000_hw
 *
hw
, 
boﬁ
 
lök
)

967 
u32
 
ªg
 = 
lök
 << (
E1000_LTRV_REQ_SHIFT
 + 
E1000_LTRV_NOSNOOP_SHIFT
) |

968 
lök
 << 
E1000_LTRV_REQ_SHIFT
 | 
E1000_LTRV_SEND
;

969 
u16
 
œt_íc
 = 0;

971 i‡(
lök
) {

972 
u16
 
•ìd
, 
du∂ex
, 
sˇÀ
 = 0;

973 
u16
 
max_¢o›
, 
max_no¢o›
;

974 
u16
 
max_…r_íc
;

975 
s64
 
œt_ns
;

976 
s64
 
vÆue
;

977 
u32
 
rxa
;

979 i‡(!
hw
->
ad≠ãr
->
max_‰ame_size
) {

980 
	`e_dbg
("max_frame_sizeÇot set.\n");

981  -
E1000_ERR_CONFIG
;

984 
hw
->
mac
.
›s
.
	`gë_lök_up_öfo
(hw, &
•ìd
, &
du∂ex
);

985 i‡(!
•ìd
) {

986 
	`e_dbg
("SpeedÇot set.\n");

987  -
E1000_ERR_CONFIG
;

991 
rxa
 = 
	`î32
(
PBA
Ë& 
E1000_PBA_RXA_MASK
;

1001 
œt_ns
 = ((
s64
)
rxa
 * 1024 -

1002 (2 * (
s64
)
hw
->
ad≠ãr
->
max_‰ame_size
)) * 8 * 1000;

1003 i‡(
œt_ns
 < 0)

1004 
œt_ns
 = 0;

1006 
	`do_div
(
œt_ns
, 
•ìd
);

1008 
vÆue
 = 
œt_ns
;

1009 
vÆue
 > 
PCI_LTR_VALUE_MASK
) {

1010 
sˇÀ
++;

1011 
vÆue
 = 
	`DIV_ROUND_UP
(value, (1 << 5));

1013 i‡(
sˇÀ
 > 
E1000_LTRV_SCALE_MAX
) {

1014 
	`e_dbg
("InvÆid LTRÜ©ícy sˇÀ %d\n", 
sˇÀ
);

1015  -
E1000_ERR_CONFIG
;

1017 
œt_íc
 = (
u16
)((
sˇÀ
 << 
PCI_LTR_SCALE_SHIFT
Ë| 
vÆue
);

1020 
	`pci_ªad_c⁄fig_w‹d
(
hw
->
ad≠ãr
->
pdev
, 
E1000_PCI_LTR_CAP_LPT
,

1021 &
max_¢o›
);

1022 
	`pci_ªad_c⁄fig_w‹d
(
hw
->
ad≠ãr
->
pdev
,

1023 
E1000_PCI_LTR_CAP_LPT
 + 2, &
max_no¢o›
);

1024 
max_…r_íc
 = 
	`max_t
(
u16
, 
max_¢o›
, 
max_no¢o›
);

1026 i‡(
œt_íc
 > 
max_…r_íc
)

1027 
œt_íc
 = 
max_…r_íc
;

1031 
ªg
 |
œt_íc
 | (œt_í¯<< 
E1000_LTRV_NOSNOOP_SHIFT
);

1032 
	`ew32
(
LTRV
, 
ªg
);

1035 
	}
}

1047 
s32
 
	$e1000_íabÀ_uÕ_Õt_Õ
(
e1000_hw
 *
hw
, 
boﬁ
 
to_sx
)

1049 
u32
 
mac_ªg
;

1050 
s32
 
ªt_vÆ
 = 0;

1051 
u16
 
phy_ªg
;

1053 i‡((
hw
->
mac
.
ty≥
 < 
e1000_pch_Õt
) ||

1054 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPT_I217_LM
) ||

1055 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPT_I217_V
) ||

1056 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_LM2
) ||

1057 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_V2
) ||

1058 (
hw
->
dev_•ec
.
ich8œn
.
uÕ_°©e
 =
e1000_uÕ_°©e_⁄
))

1061 i‡(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
) {

1063 
mac_ªg
 = 
	`î32
(
H2ME
);

1064 
mac_ªg
 |
E1000_H2ME_ULP
 | 
E1000_H2ME_ENFORCE_SETTINGS
;

1065 
	`ew32
(
H2ME
, 
mac_ªg
);

1067 
out
;

1070 i‡(!
to_sx
) {

1071 
i
 = 0;

1074 !(
	`î32
(
FEXT
Ë& 
E1000_FEXT_PHY_CABLE_DISCONNECTED
)) {

1076 i‡(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
)

1077  -
E1000_ERR_PHY
;

1079 i‡(
i
++ == 100)

1082 
	`m¶ìp
(50);

1084 
	`e_dbg
("CABLE_DISCONNECTED %s setáfter %dmsec\n",

1085 (
	`î32
(
FEXT
) &

1086 
E1000_FEXT_PHY_CABLE_DISCONNECTED
Ë? "" : "nŸ", 
i
 * 50);

1089 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1090 i‡(
ªt_vÆ
)

1091 
out
;

1094 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
CV_SMB_CTRL
, &
phy_ªg
);

1095 i‡(
ªt_vÆ
)

1096 
ªÀa£
;

1097 
phy_ªg
 |
CV_SMB_CTRL_FORCE_SMBUS
;

1098 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
CV_SMB_CTRL
, 
phy_ªg
);

1101 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

1102 
mac_ªg
 |
E1000_CTRL_EXT_FORCE_SMBUS
;

1103 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

1108 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, &
phy_ªg
);

1109 i‡(
ªt_vÆ
)

1110 
ªÀa£
;

1111 
phy_ªg
 |(
I218_ULP_CONFIG1_RESET_TO_SMBUS
 |

1112 
I218_ULP_CONFIG1_DISABLE_SMB_PERST
);

1113 i‡(
to_sx
) {

1114 i‡(
	`î32
(
WUFC
Ë& 
E1000_WUFC_LNKC
)

1115 
phy_ªg
 |
I218_ULP_CONFIG1_WOL_HOST
;

1117 
phy_ªg
 |
I218_ULP_CONFIG1_STICKY_ULP
;

1119 
phy_ªg
 |
I218_ULP_CONFIG1_INBAND_EXIT
;

1121 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, 
phy_ªg
);

1124 
mac_ªg
 = 
	`î32
(
FEXTNVM7
);

1125 
mac_ªg
 |
E1000_FEXTNVM7_DISABLE_SMB_PERST
;

1126 
	`ew32
(
FEXTNVM7
, 
mac_ªg
);

1129 
phy_ªg
 |
I218_ULP_CONFIG1_START
;

1130 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, 
phy_ªg
);

1131 
ªÀa£
:

1132 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

1133 
out
:

1134 i‡(
ªt_vÆ
)

1135 
	`e_dbg
("Eº‹ i¿ULPÉ«bÀ flow: %d\n", 
ªt_vÆ
);

1137 
hw
->
dev_•ec
.
ich8œn
.
uÕ_°©e
 = 
e1000_uÕ_°©e_⁄
;

1139  
ªt_vÆ
;

1140 
	}
}

1157 
s32
 
	$e1000_dißbÀ_uÕ_Õt_Õ
(
e1000_hw
 *
hw
, 
boﬁ
 
f‹˚
)

1159 
s32
 
ªt_vÆ
 = 0;

1160 
u32
 
mac_ªg
;

1161 
u16
 
phy_ªg
;

1162 
i
 = 0;

1164 i‡((
hw
->
mac
.
ty≥
 < 
e1000_pch_Õt
) ||

1165 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPT_I217_LM
) ||

1166 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPT_I217_V
) ||

1167 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_LM2
) ||

1168 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_V2
) ||

1169 (
hw
->
dev_•ec
.
ich8œn
.
uÕ_°©e
 =
e1000_uÕ_°©e_off
))

1172 i‡(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
) {

1173 i‡(
f‹˚
) {

1175 
mac_ªg
 = 
	`î32
(
H2ME
);

1176 
mac_ªg
 &~
E1000_H2ME_ULP
;

1177 
mac_ªg
 |
E1000_H2ME_ENFORCE_SETTINGS
;

1178 
	`ew32
(
H2ME
, 
mac_ªg
);

1182 
	`î32
(
FWSM
Ë& 
E1000_FWSM_ULP_CFG_DONE
) {

1183 i‡(
i
++ == 10) {

1184 
ªt_vÆ
 = -
E1000_ERR_PHY
;

1185 
out
;

1188 
	`u¶ìp_ønge
(10000, 20000);

1190 
	`e_dbg
("ULP_CONFIG_DONE cÀ¨edá·î %dm£c\n", 
i
 * 10);

1192 i‡(
f‹˚
) {

1193 
mac_ªg
 = 
	`î32
(
H2ME
);

1194 
mac_ªg
 &~
E1000_H2ME_ENFORCE_SETTINGS
;

1195 
	`ew32
(
H2ME
, 
mac_ªg
);

1198 
mac_ªg
 = 
	`î32
(
H2ME
);

1199 
mac_ªg
 &~
E1000_H2ME_ULP
;

1200 
	`ew32
(
H2ME
, 
mac_ªg
);

1203 
out
;

1206 i‡(
f‹˚
)

1208 
	`e1000_toggÀ_œ≈hypc_pch_Õt
(
hw
);

1210 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1211 i‡(
ªt_vÆ
)

1212 
out
;

1215 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
CV_SMB_CTRL
, &
phy_ªg
);

1216 i‡(
ªt_vÆ
) {

1220 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

1221 
mac_ªg
 |
E1000_CTRL_EXT_FORCE_SMBUS
;

1222 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

1224 
	`m¶ìp
(50);

1226 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
CV_SMB_CTRL
,

1227 &
phy_ªg
);

1228 i‡(
ªt_vÆ
)

1229 
ªÀa£
;

1231 
phy_ªg
 &~
CV_SMB_CTRL_FORCE_SMBUS
;

1232 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
CV_SMB_CTRL
, 
phy_ªg
);

1235 
mac_ªg
 = 
	`î32
(
CTRL_EXT
);

1236 
mac_ªg
 &~
E1000_CTRL_EXT_FORCE_SMBUS
;

1237 
	`ew32
(
CTRL_EXT
, 
mac_ªg
);

1242 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
HV_PM_CTRL
, &
phy_ªg
);

1243 i‡(
ªt_vÆ
)

1244 
ªÀa£
;

1245 
phy_ªg
 |
HV_PM_CTRL_K1_ENABLE
;

1246 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
HV_PM_CTRL
, 
phy_ªg
);

1249 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, &
phy_ªg
);

1250 i‡(
ªt_vÆ
)

1251 
ªÀa£
;

1252 
phy_ªg
 &~(
I218_ULP_CONFIG1_IND
 |

1253 
I218_ULP_CONFIG1_STICKY_ULP
 |

1254 
I218_ULP_CONFIG1_RESET_TO_SMBUS
 |

1255 
I218_ULP_CONFIG1_WOL_HOST
 |

1256 
I218_ULP_CONFIG1_INBAND_EXIT
 |

1257 
I218_ULP_CONFIG1_DISABLE_SMB_PERST
);

1258 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, 
phy_ªg
);

1261 
phy_ªg
 |
I218_ULP_CONFIG1_START
;

1262 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
I218_ULP_CONFIG1
, 
phy_ªg
);

1265 
mac_ªg
 = 
	`î32
(
FEXTNVM7
);

1266 
mac_ªg
 &~
E1000_FEXTNVM7_DISABLE_SMB_PERST
;

1267 
	`ew32
(
FEXTNVM7
, 
mac_ªg
);

1269 
ªÀa£
:

1270 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

1271 i‡(
f‹˚
) {

1272 
	`e1000_phy_hw_ª£t
(
hw
);

1273 
	`m¶ìp
(50);

1275 
out
:

1276 i‡(
ªt_vÆ
)

1277 
	`e_dbg
("Eº‹ i¿ULP dißbÀ flow: %d\n", 
ªt_vÆ
);

1279 
hw
->
dev_•ec
.
ich8œn
.
uÕ_°©e
 = 
e1000_uÕ_°©e_off
;

1281  
ªt_vÆ
;

1282 
	}
}

1292 
s32
 
	$e1000_check_f‹_c›≥r_lök_ich8œn
(
e1000_hw
 *
hw
)

1294 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1295 
s32
 
ªt_vÆ
;

1296 
boﬁ
 
lök
;

1297 
u16
 
phy_ªg
;

1304 i‡(!
mac
->
gë_lök_°©us
)

1311 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

1312 i‡(
ªt_vÆ
)

1313  
ªt_vÆ
;

1315 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
) {

1316 
ªt_vÆ
 = 
	`e1000_k1_gig_w‹k¨ound_hv
(
hw
, 
lök
);

1317 i‡(
ªt_vÆ
)

1318  
ªt_vÆ
;

1325 i‡((
hw
->
mac
.
ty≥
 =
e1000_pch2œn
Ë&& 
lök
) {

1326 
u32
 
ªg
;

1327 
ªg
 = 
	`î32
(
STATUS
);

1328 i‡(!(
ªg
 & (
E1000_STATUS_FD
 | 
E1000_STATUS_SPEED_MASK
))) {

1329 
ªg
 = 
	`î32
(
TIPG
);

1330 
ªg
 &~
E1000_TIPG_IPGT_MASK
;

1331 
ªg
 |= 0xFF;

1332 
	`ew32
(
TIPG
, 
ªg
);

1335 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1336 i‡(
ªt_vÆ
)

1337  
ªt_vÆ
;

1339 
ªt_vÆ
 =

1340 
	`e1000_wrôe_emi_ªg_locked
(
hw
, 
I82579_RX_CONFIG
, 0);

1342 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

1344 i‡(
ªt_vÆ
)

1345  
ªt_vÆ
;

1350 i‡((
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPTLP_I218_LM
) ||

1351 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_LPTLP_I218_V
) ||

1352 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_LM3
) ||

1353 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_PCH_I218_V3
)) {

1354 
ªt_vÆ
 = 
	`e1000_k1_w‹k¨ound_Õt_Õ
(
hw
, 
lök
);

1355 i‡(
ªt_vÆ
)

1356  
ªt_vÆ
;

1358 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

1362 
ªt_vÆ
 = 
	`e1000_∂©f‹m_pm_pch_Õt
(
hw
, 
lök
);

1363 i‡(
ªt_vÆ
)

1364  
ªt_vÆ
;

1368 
hw
->
dev_•ec
.
ich8œn
.
ìe_Õ_abûôy
 = 0;

1370 i‡(!
lök
)

1373 
mac
->
gë_lök_°©us
 = 
Ál£
;

1375 
hw
->
mac
.
ty≥
) {

1376 
e1000_pch2œn
:

1377 
ªt_vÆ
 = 
	`e1000_k1_w‹k¨ound_lv
(
hw
);

1378 i‡(
ªt_vÆ
)

1379  
ªt_vÆ
;

1381 
e1000_pchœn
:

1382 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) {

1383 
ªt_vÆ
 = 
	`e1000_lök_°Æl_w‹k¨ound_hv
(
hw
);

1384 i‡(
ªt_vÆ
)

1385  
ªt_vÆ
;

1393 
	`e1e_Ωhy
(
hw
, 
HV_KMRN_FIFO_CTRLSTA
, &
phy_ªg
);

1394 
phy_ªg
 &~
HV_KMRN_FIFO_CTRLSTA_PREAMBLE_MASK
;

1396 i‡((
	`î32
(
STATUS
Ë& 
E1000_STATUS_FD
) != E1000_STATUS_FD)

1397 
phy_ªg
 |(1 << 
HV_KMRN_FIFO_CTRLSTA_PREAMBLE_SHIFT
);

1399 
	`e1e_wphy
(
hw
, 
HV_KMRN_FIFO_CTRLSTA
, 
phy_ªg
);

1408 
	`e1000e_check_downshi·
(
hw
);

1411 i‡(
hw
->
phy
.
ty≥
 > 
e1000_phy_82579
) {

1412 
ªt_vÆ
 = 
	`e1000_£t_ìe_pchœn
(
hw
);

1413 i‡(
ªt_vÆ
)

1414  
ªt_vÆ
;

1420 i‡(!
mac
->
aut⁄eg
)

1421  -
E1000_ERR_CONFIG
;

1427 
mac
->
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(
hw
);

1434 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

1435 i‡(
ªt_vÆ
)

1436 
	`e_dbg
("Error configuring flow control\n");

1438  
ªt_vÆ
;

1439 
	}
}

1441 
s32
 
	$e1000_gë_v¨ü¡s_ich8œn
(
e1000_ad≠ãr
 *
ad≠ãr
)

1443 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1444 
s32
 
rc
;

1446 
rc
 = 
	`e1000_öô_mac_∑øms_ich8œn
(
hw
);

1447 i‡(
rc
)

1448  
rc
;

1450 
rc
 = 
	`e1000_öô_nvm_∑øms_ich8œn
(
hw
);

1451 i‡(
rc
)

1452  
rc
;

1454 
hw
->
mac
.
ty≥
) {

1455 
e1000_ich8œn
:

1456 
e1000_ich9œn
:

1457 
e1000_ich10œn
:

1458 
rc
 = 
	`e1000_öô_phy_∑øms_ich8œn
(
hw
);

1460 
e1000_pchœn
:

1461 
e1000_pch2œn
:

1462 
e1000_pch_Õt
:

1463 
rc
 = 
	`e1000_öô_phy_∑øms_pchœn
(
hw
);

1468 i‡(
rc
)

1469  
rc
;

1474 i‡((
ad≠ãr
->
hw
.
phy
.
ty≥
 =
e1000_phy_i„
) ||

1475 ((
ad≠ãr
->
hw
.
mac
.
ty≥
 >
e1000_pch2œn
) &&

1476 (!(
	`î32
(
CTRL_EXT
Ë& 
E1000_CTRL_EXT_LSECCK
)))) {

1477 
ad≠ãr
->
Êags
 &~
FLAG_HAS_JUMBO_FRAMES
;

1478 
ad≠ãr
->
max_hw_‰ame_size
 = 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
;

1480 
hw
->
mac
.
›s
.
blök_Àd
 = 
NULL
;

1483 i‡((
ad≠ãr
->
hw
.
mac
.
ty≥
 =
e1000_ich8œn
) &&

1484 (
ad≠ãr
->
hw
.
phy
.
ty≥
 !
e1000_phy_i„
))

1485 
ad≠ãr
->
Êags
 |
FLAG_LSC_GIG_SPEED_DROP
;

1488 i‡((
ad≠ãr
->
hw
.
mac
.
ty≥
 =
e1000_pch2œn
) &&

1489 (
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
))

1490 
ad≠ãr
->
Êags2
 |
FLAG2_PCIM2PCI_ARBITER_WA
;

1493 
	}
}

1495 
DEFINE_MUTEX
(
nvm_muãx
);

1503 
s32
 
	$e1000_acquúe_nvm_ich8œn
(
e1000_hw
 
__Æways_unu£d
 *
hw
)

1505 
	`muãx_lock
(&
nvm_muãx
);

1508 
	}
}

1516 
	$e1000_ªÀa£_nvm_ich8œn
(
e1000_hw
 
__Æways_unu£d
 *
hw
)

1518 
	`muãx_u∆ock
(&
nvm_muãx
);

1519 
	}
}

1528 
s32
 
	$e1000_acquúe_swÊag_ich8œn
(
e1000_hw
 *
hw
)

1530 
u32
 
ext˙f_˘æ
, 
timeout
 = 
PHY_CFG_TIMEOUT
;

1531 
s32
 
ªt_vÆ
 = 0;

1533 i‡(
	`ã°_™d_£t_bô
(
__E1000_ACCESS_SHARED_RESOURCE
,

1534 &
hw
->
ad≠ãr
->
°©e
)) {

1535 
	`e_dbg
("contention for Phyáccess\n");

1536  -
E1000_ERR_PHY
;

1539 
timeout
) {

1540 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

1541 i‡(!(
ext˙f_˘æ
 & 
E1000_EXTCNF_CTRL_SWFLAG
))

1544 
	`mdñay
(1);

1545 
timeout
--;

1548 i‡(!
timeout
) {

1549 
	`e_dbg
("SW hasálreadyÜockedÅheÑesource.\n");

1550 
ªt_vÆ
 = -
E1000_ERR_CONFIG
;

1551 
out
;

1554 
timeout
 = 
SW_FLAG_TIMEOUT
;

1556 
ext˙f_˘æ
 |
E1000_EXTCNF_CTRL_SWFLAG
;

1557 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

1559 
timeout
) {

1560 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

1561 i‡(
ext˙f_˘æ
 & 
E1000_EXTCNF_CTRL_SWFLAG
)

1564 
	`mdñay
(1);

1565 
timeout
--;

1568 i‡(!
timeout
) {

1569 
	`e_dbg
("FailedÅoácquireÅhe semaphore, FW or HW has it: FWSM=0x%8.8x EXTCNF_CTRL=0x%8.8x)\n",

1570 
	`î32
(
FWSM
), 
ext˙f_˘æ
);

1571 
ext˙f_˘æ
 &~
E1000_EXTCNF_CTRL_SWFLAG
;

1572 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

1573 
ªt_vÆ
 = -
E1000_ERR_CONFIG
;

1574 
out
;

1577 
out
:

1578 i‡(
ªt_vÆ
)

1579 
	`˛ór_bô
(
__E1000_ACCESS_SHARED_RESOURCE
, &
hw
->
ad≠ãr
->
°©e
);

1581  
ªt_vÆ
;

1582 
	}
}

1591 
	$e1000_ªÀa£_swÊag_ich8œn
(
e1000_hw
 *
hw
)

1593 
u32
 
ext˙f_˘æ
;

1595 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

1597 i‡(
ext˙f_˘æ
 & 
E1000_EXTCNF_CTRL_SWFLAG
) {

1598 
ext˙f_˘æ
 &~
E1000_EXTCNF_CTRL_SWFLAG
;

1599 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

1601 
	`e_dbg
("Semaphore unexpectedlyÑeleased by sw/fw/hw\n");

1604 
	`˛ór_bô
(
__E1000_ACCESS_SHARED_RESOURCE
, &
hw
->
ad≠ãr
->
°©e
);

1605 
	}
}

1615 
boﬁ
 
	$e1000_check_mng_mode_ich8œn
(
e1000_hw
 *
hw
)

1617 
u32
 
fwsm
;

1619 
fwsm
 = 
	`î32
(
FWSM
);

1620  ((
fwsm
 & 
E1000_ICH_FWSM_FW_VALID
) &&

1621 ((
fwsm
 & 
E1000_FWSM_MODE_MASK
) ==

1622 (
E1000_ICH_MNG_IAMT_MODE
 << 
E1000_FWSM_MODE_SHIFT
)));

1623 
	}
}

1633 
boﬁ
 
	$e1000_check_mng_mode_pchœn
(
e1000_hw
 *
hw
)

1635 
u32
 
fwsm
;

1637 
fwsm
 = 
	`î32
(
FWSM
);

1638  (
fwsm
 & 
E1000_ICH_FWSM_FW_VALID
) &&

1639 (
fwsm
 & (
E1000_ICH_MNG_IAMT_MODE
 << 
E1000_FWSM_MODE_SHIFT
));

1640 
	}
}

1653 
	$e1000_ør_£t_pch2œn
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
)

1655 
u32
 
ør_low
, 
ør_high
;

1660 
ør_low
 = ((
u32
)
addr
[0] |

1661 ((
u32
)
addr
[1] << 8) |

1662 ((
u32
)
addr
[2] << 16) | ((u32)addr[3] << 24));

1664 
ør_high
 = ((
u32
)
addr
[4] | ((u32)addr[5] << 8));

1667 i‡(
ør_low
 || 
ør_high
)

1668 
ør_high
 |
E1000_RAH_AV
;

1670 i‡(
ödex
 == 0) {

1671 
	`ew32
(
	`RAL
(
ödex
), 
ør_low
);

1672 
	`e1e_Êush
();

1673 
	`ew32
(
	`RAH
(
ödex
), 
ør_high
);

1674 
	`e1e_Êush
();

1681 i‡(
ödex
 < (
u32
)(
hw
->
mac
.
ør_íåy_cou¡
 - 6)) {

1682 
s32
 
ªt_vÆ
;

1684 
ªt_vÆ
 = 
	`e1000_acquúe_swÊag_ich8œn
(
hw
);

1685 i‡(
ªt_vÆ
)

1686 
out
;

1688 
	`ew32
(
	`SHRAL
(
ödex
 - 1), 
ør_low
);

1689 
	`e1e_Êush
();

1690 
	`ew32
(
	`SHRAH
(
ödex
 - 1), 
ør_high
);

1691 
	`e1e_Êush
();

1693 
	`e1000_ªÀa£_swÊag_ich8œn
(
hw
);

1696 i‡((
	`î32
(
	`SHRAL
(
ödex
 - 1)Ë=
ør_low
) &&

1697 (
	`î32
(
	`SHRAH
(
ödex
 - 1)Ë=
ør_high
))

1700 
	`e_dbg
("SHRA[%d] might beÜocked by ME - FWSM=0x%8.8x\n",

1701 (
ödex
 - 1), 
	`î32
(
FWSM
));

1704 
out
:

1705 
	`e_dbg
("FaûedÅÿwrôêª˚ivêaddªs†© index %d\n", 
ödex
);

1706 
	}
}

1719 
	$e1000_ør_£t_pch_Õt
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
)

1721 
u32
 
ør_low
, 
ør_high
;

1722 
u32
 
wlock_mac
;

1727 
ør_low
 = ((
u32
)
addr
[0] | ((u32)addr[1] << 8) |

1728 ((
u32
)
addr
[2] << 16) | ((u32)addr[3] << 24));

1730 
ør_high
 = ((
u32
)
addr
[4] | ((u32)addr[5] << 8));

1733 i‡(
ør_low
 || 
ør_high
)

1734 
ør_high
 |
E1000_RAH_AV
;

1736 i‡(
ödex
 == 0) {

1737 
	`ew32
(
	`RAL
(
ödex
), 
ør_low
);

1738 
	`e1e_Êush
();

1739 
	`ew32
(
	`RAH
(
ödex
), 
ør_high
);

1740 
	`e1e_Êush
();

1747 i‡(
ödex
 < 
hw
->
mac
.
ør_íåy_cou¡
) {

1748 
wlock_mac
 = 
	`î32
(
FWSM
Ë& 
E1000_FWSM_WLOCK_MAC_MASK
;

1749 
wlock_mac
 >>
E1000_FWSM_WLOCK_MAC_SHIFT
;

1752 i‡(
wlock_mac
 == 1)

1753 
out
;

1755 i‡((
wlock_mac
 =0Ë|| (
ödex
 <= wlock_mac)) {

1756 
s32
 
ªt_vÆ
;

1758 
ªt_vÆ
 = 
	`e1000_acquúe_swÊag_ich8œn
(
hw
);

1760 i‡(
ªt_vÆ
)

1761 
out
;

1763 
	`ew32
(
	`SHRAL_PCH_LPT
(
ödex
 - 1), 
ør_low
);

1764 
	`e1e_Êush
();

1765 
	`ew32
(
	`SHRAH_PCH_LPT
(
ödex
 - 1), 
ør_high
);

1766 
	`e1e_Êush
();

1768 
	`e1000_ªÀa£_swÊag_ich8œn
(
hw
);

1771 i‡((
	`î32
(
	`SHRAL_PCH_LPT
(
ödex
 - 1)Ë=
ør_low
) &&

1772 (
	`î32
(
	`SHRAH_PCH_LPT
(
ödex
 - 1)Ë=
ør_high
))

1777 
out
:

1778 
	`e_dbg
("FaûedÅÿwrôêª˚ivêaddªs†© index %d\n", 
ödex
);

1779 
	}
}

1789 
s32
 
	$e1000_check_ª£t_block_ich8œn
(
e1000_hw
 *
hw
)

1791 
u32
 
fwsm
;

1793 
fwsm
 = 
	`î32
(
FWSM
);

1794  (
fwsm
 & 
E1000_ICH_FWSM_RSPCIPHY
Ë? 0 : 
E1000_BLK_PHY_RESET
;

1795 
	}
}

1804 
s32
 
	$e1000_wrôe_smbus_addr
(
e1000_hw
 *
hw
)

1806 
u16
 
phy_d©a
;

1807 
u32
 
°øp
 = 
	`î32
(
STRAP
);

1808 
u32
 
‰eq
 = (
°øp
 & 
E1000_STRAP_SMT_FREQ_MASK
) >>

1809 
E1000_STRAP_SMT_FREQ_SHIFT
;

1810 
s32
 
ªt_vÆ
;

1812 
°øp
 &
E1000_STRAP_SMBUS_ADDRESS_MASK
;

1814 
ªt_vÆ
 = 
	`e1000_ªad_phy_ªg_hv_locked
(
hw
, 
HV_SMB_ADDR
, &
phy_d©a
);

1815 i‡(
ªt_vÆ
)

1816  
ªt_vÆ
;

1818 
phy_d©a
 &~
HV_SMB_ADDR_MASK
;

1819 
phy_d©a
 |(
°øp
 >> 
E1000_STRAP_SMBUS_ADDRESS_SHIFT
);

1820 
phy_d©a
 |
HV_SMB_ADDR_PEC_EN
 | 
HV_SMB_ADDR_VALID
;

1822 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i217
) {

1824 i‡(
‰eq
--) {

1825 
phy_d©a
 &~
HV_SMB_ADDR_FREQ_MASK
;

1826 
phy_d©a
 |(
‰eq
 & (1 << 0)) <<

1827 
HV_SMB_ADDR_FREQ_LOW_SHIFT
;

1828 
phy_d©a
 |(
‰eq
 & (1 << 1)) <<

1829 (
HV_SMB_ADDR_FREQ_HIGH_SHIFT
 - 1);

1831 
	`e_dbg
("Unsupported SMB frequency in PHY\n");

1835  
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
HV_SMB_ADDR
, 
phy_d©a
);

1836 
	}
}

1845 
s32
 
	$e1000_sw_lcd_c⁄fig_ich8œn
(
e1000_hw
 *
hw
)

1847 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1848 
u32
 
i
, 
d©a
, 
˙f_size
, 
˙f_ba£_addr
, 
sw_cfg_mask
;

1849 
s32
 
ªt_vÆ
 = 0;

1850 
u16
 
w‹d_addr
, 
ªg_d©a
, 
ªg_addr
, 
phy_∑ge
 = 0;

1858 
hw
->
mac
.
ty≥
) {

1859 
e1000_ich8œn
:

1860 i‡(
phy
->
ty≥
 !
e1000_phy_igp_3
)

1861  
ªt_vÆ
;

1863 i‡((
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_ICH8_IGP_AMT
) ||

1864 (
hw
->
ad≠ãr
->
pdev
->
devi˚
 =
E1000_DEV_ID_ICH8_IGP_C
)) {

1865 
sw_cfg_mask
 = 
E1000_FEXTNVM_SW_CONFIG
;

1869 
e1000_pchœn
:

1870 
e1000_pch2œn
:

1871 
e1000_pch_Õt
:

1872 
sw_cfg_mask
 = 
E1000_FEXTNVM_SW_CONFIG_ICH8M
;

1875  
ªt_vÆ
;

1878 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1879 i‡(
ªt_vÆ
)

1880  
ªt_vÆ
;

1882 
d©a
 = 
	`î32
(
FEXTNVM
);

1883 i‡(!(
d©a
 & 
sw_cfg_mask
))

1884 
ªÀa£
;

1889 
d©a
 = 
	`î32
(
EXTCNF_CTRL
);

1890 i‡((
hw
->
mac
.
ty≥
 < 
e1000_pch2œn
) &&

1891 (
d©a
 & 
E1000_EXTCNF_CTRL_LCD_WRITE_ENABLE
))

1892 
ªÀa£
;

1894 
˙f_size
 = 
	`î32
(
EXTCNF_SIZE
);

1895 
˙f_size
 &
E1000_EXTCNF_SIZE_EXT_PCIE_LENGTH_MASK
;

1896 
˙f_size
 >>
E1000_EXTCNF_SIZE_EXT_PCIE_LENGTH_SHIFT
;

1897 i‡(!
˙f_size
)

1898 
ªÀa£
;

1900 
˙f_ba£_addr
 = 
d©a
 & 
E1000_EXTCNF_CTRL_EXT_CNF_POINTER_MASK
;

1901 
˙f_ba£_addr
 >>
E1000_EXTCNF_CTRL_EXT_CNF_POINTER_SHIFT
;

1903 i‡(((
hw
->
mac
.
ty≥
 =
e1000_pchœn
) &&

1904 !(
d©a
 & 
E1000_EXTCNF_CTRL_OEM_WRITE_ENABLE
)) ||

1905 (
hw
->
mac
.
ty≥
 > 
e1000_pchœn
)) {

1911 
ªt_vÆ
 = 
	`e1000_wrôe_smbus_addr
(
hw
);

1912 i‡(
ªt_vÆ
)

1913 
ªÀa£
;

1915 
d©a
 = 
	`î32
(
LEDCTL
);

1916 
ªt_vÆ
 = 
	`e1000_wrôe_phy_ªg_hv_locked
(
hw
, 
HV_LED_CONFIG
,

1917 (
u16
)
d©a
);

1918 i‡(
ªt_vÆ
)

1919 
ªÀa£
;

1925 
w‹d_addr
 = (
u16
)(
˙f_ba£_addr
 << 1);

1927 
i
 = 0; i < 
˙f_size
; i++) {

1928 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, (
w‹d_addr
 + 
i
 * 2), 1, &
ªg_d©a
);

1929 i‡(
ªt_vÆ
)

1930 
ªÀa£
;

1932 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, (
w‹d_addr
 + 
i
 * 2 + 1),

1933 1, &
ªg_addr
);

1934 i‡(
ªt_vÆ
)

1935 
ªÀa£
;

1938 i‡(
ªg_addr
 =
IGP01E1000_PHY_PAGE_SELECT
) {

1939 
phy_∑ge
 = 
ªg_d©a
;

1943 
ªg_addr
 &
PHY_REG_MASK
;

1944 
ªg_addr
 |
phy_∑ge
;

1946 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, (
u32
)
ªg_addr
, 
ªg_d©a
);

1947 i‡(
ªt_vÆ
)

1948 
ªÀa£
;

1951 
ªÀa£
:

1952 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

1953  
ªt_vÆ
;

1954 
	}
}

1966 
s32
 
	$e1000_k1_gig_w‹k¨ound_hv
(
e1000_hw
 *
hw
, 
boﬁ
 
lök
)

1968 
s32
 
ªt_vÆ
 = 0;

1969 
u16
 
°©us_ªg
 = 0;

1970 
boﬁ
 
k1_íabÀ
 = 
hw
->
dev_•ec
.
ich8œn
.
nvm_k1_íabÀd
;

1972 i‡(
hw
->
mac
.
ty≥
 !
e1000_pchœn
)

1976 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

1977 i‡(
ªt_vÆ
)

1978  
ªt_vÆ
;

1981 i‡(
lök
) {

1982 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) {

1983 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
BM_CS_STATUS
,

1984 &
°©us_ªg
);

1985 i‡(
ªt_vÆ
)

1986 
ªÀa£
;

1988 
°©us_ªg
 &(
BM_CS_STATUS_LINK_UP
 |

1989 
BM_CS_STATUS_RESOLVED
 |

1990 
BM_CS_STATUS_SPEED_MASK
);

1992 i‡(
°©us_ªg
 =(
BM_CS_STATUS_LINK_UP
 |

1993 
BM_CS_STATUS_RESOLVED
 |

1994 
BM_CS_STATUS_SPEED_1000
))

1995 
k1_íabÀ
 = 
Ál£
;

1998 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82577
) {

1999 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
HV_M_STATUS
, &
°©us_ªg
);

2000 i‡(
ªt_vÆ
)

2001 
ªÀa£
;

2003 
°©us_ªg
 &(
HV_M_STATUS_LINK_UP
 |

2004 
HV_M_STATUS_AUTONEG_COMPLETE
 |

2005 
HV_M_STATUS_SPEED_MASK
);

2007 i‡(
°©us_ªg
 =(
HV_M_STATUS_LINK_UP
 |

2008 
HV_M_STATUS_AUTONEG_COMPLETE
 |

2009 
HV_M_STATUS_SPEED_1000
))

2010 
k1_íabÀ
 = 
Ál£
;

2014 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
	`PHY_REG
(770, 19), 0x0100);

2015 i‡(
ªt_vÆ
)

2016 
ªÀa£
;

2020 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
	`PHY_REG
(770, 19), 0x4100);

2021 i‡(
ªt_vÆ
)

2022 
ªÀa£
;

2025 
ªt_vÆ
 = 
	`e1000_c⁄figuª_k1_ich8œn
(
hw
, 
k1_íabÀ
);

2027 
ªÀa£
:

2028 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2030  
ªt_vÆ
;

2031 
	}
}

2043 
s32
 
	$e1000_c⁄figuª_k1_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
k1_íabÀ
)

2045 
s32
 
ªt_vÆ
;

2046 
u32
 
˘æ_ªg
 = 0;

2047 
u32
 
˘æ_ext
 = 0;

2048 
u32
 
ªg
 = 0;

2049 
u16
 
km∫_ªg
 = 0;

2051 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg_locked
(
hw
, 
E1000_KMRNCTRLSTA_K1_CONFIG
,

2052 &
km∫_ªg
);

2053 i‡(
ªt_vÆ
)

2054  
ªt_vÆ
;

2056 i‡(
k1_íabÀ
)

2057 
km∫_ªg
 |
E1000_KMRNCTRLSTA_K1_ENABLE
;

2059 
km∫_ªg
 &~
E1000_KMRNCTRLSTA_K1_ENABLE
;

2061 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg_locked
(
hw
, 
E1000_KMRNCTRLSTA_K1_CONFIG
,

2062 
km∫_ªg
);

2063 i‡(
ªt_vÆ
)

2064  
ªt_vÆ
;

2066 
	`u¶ìp_ønge
(20, 40);

2067 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

2068 
˘æ_ªg
 = 
	`î32
(
CTRL
);

2070 
ªg
 = 
˘æ_ªg
 & ~(
E1000_CTRL_SPD_1000
 | 
E1000_CTRL_SPD_100
);

2071 
ªg
 |
E1000_CTRL_FRCSPD
;

2072 
	`ew32
(
CTRL
, 
ªg
);

2074 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
 | 
E1000_CTRL_EXT_SPD_BYPS
);

2075 
	`e1e_Êush
();

2076 
	`u¶ìp_ønge
(20, 40);

2077 
	`ew32
(
CTRL
, 
˘æ_ªg
);

2078 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

2079 
	`e1e_Êush
();

2080 
	`u¶ìp_ønge
(20, 40);

2083 
	}
}

2094 
s32
 
	$e1000_€m_bôs_c⁄fig_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
d0_°©e
)

2096 
s32
 
ªt_vÆ
 = 0;

2097 
u32
 
mac_ªg
;

2098 
u16
 
€m_ªg
;

2100 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pchœn
)

2101  
ªt_vÆ
;

2103 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2104 i‡(
ªt_vÆ
)

2105  
ªt_vÆ
;

2107 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
) {

2108 
mac_ªg
 = 
	`î32
(
EXTCNF_CTRL
);

2109 i‡(
mac_ªg
 & 
E1000_EXTCNF_CTRL_OEM_WRITE_ENABLE
)

2110 
ªÀa£
;

2113 
mac_ªg
 = 
	`î32
(
FEXTNVM
);

2114 i‡(!(
mac_ªg
 & 
E1000_FEXTNVM_SW_CONFIG_ICH8M
))

2115 
ªÀa£
;

2117 
mac_ªg
 = 
	`î32
(
PHY_CTRL
);

2119 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
HV_OEM_BITS
, &
€m_ªg
);

2120 i‡(
ªt_vÆ
)

2121 
ªÀa£
;

2123 
€m_ªg
 &~(
HV_OEM_BITS_GBE_DIS
 | 
HV_OEM_BITS_LPLU
);

2125 i‡(
d0_°©e
) {

2126 i‡(
mac_ªg
 & 
E1000_PHY_CTRL_GBE_DISABLE
)

2127 
€m_ªg
 |
HV_OEM_BITS_GBE_DIS
;

2129 i‡(
mac_ªg
 & 
E1000_PHY_CTRL_D0A_LPLU
)

2130 
€m_ªg
 |
HV_OEM_BITS_LPLU
;

2132 i‡(
mac_ªg
 & (
E1000_PHY_CTRL_GBE_DISABLE
 |

2133 
E1000_PHY_CTRL_NOND0A_GBE_DISABLE
))

2134 
€m_ªg
 |
HV_OEM_BITS_GBE_DIS
;

2136 i‡(
mac_ªg
 & (
E1000_PHY_CTRL_D0A_LPLU
 |

2137 
E1000_PHY_CTRL_NOND0A_LPLU
))

2138 
€m_ªg
 |
HV_OEM_BITS_LPLU
;

2142 i‡((
d0_°©e
 || (
hw
->
mac
.
ty≥
 !
e1000_pchœn
)) &&

2143 !
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw))

2144 
€m_ªg
 |
HV_OEM_BITS_RESTART_AN
;

2146 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
HV_OEM_BITS
, 
€m_ªg
);

2148 
ªÀa£
:

2149 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2151  
ªt_vÆ
;

2152 
	}
}

2158 
s32
 
	$e1000_£t_mdio_¶ow_mode_hv
(
e1000_hw
 *
hw
)

2160 
s32
 
ªt_vÆ
;

2161 
u16
 
d©a
;

2163 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
HV_KMRN_MODE_CTRL
, &
d©a
);

2164 i‡(
ªt_vÆ
)

2165  
ªt_vÆ
;

2167 
d©a
 |
HV_KMRN_MDIO_SLOW
;

2169 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_KMRN_MODE_CTRL
, 
d©a
);

2171  
ªt_vÆ
;

2172 
	}
}

2178 
s32
 
	$e1000_hv_phy_w‹k¨ounds_ich8œn
(
e1000_hw
 *
hw
)

2180 
s32
 
ªt_vÆ
 = 0;

2181 
u16
 
phy_d©a
;

2183 i‡(
hw
->
mac
.
ty≥
 !
e1000_pchœn
)

2187 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82577
) {

2188 
ªt_vÆ
 = 
	`e1000_£t_mdio_¶ow_mode_hv
(
hw
);

2189 i‡(
ªt_vÆ
)

2190  
ªt_vÆ
;

2193 i‡(((
hw
->
phy
.
ty≥
 =
e1000_phy_82577
) &&

2194 ((
hw
->
phy
.
ªvisi⁄
 == 1) || (hw->phy.revision == 2))) ||

2195 ((
hw
->
phy
.
ty≥
 =
e1000_phy_82578
Ë&& (hw->phy.
ªvisi⁄
 == 1))) {

2197 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 25), 0x4431);

2198 i‡(
ªt_vÆ
)

2199  
ªt_vÆ
;

2202 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_KMRN_FIFO_CTRLSTA
, 0xA204);

2203 i‡(
ªt_vÆ
)

2204  
ªt_vÆ
;

2207 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) {

2211 i‡(
hw
->
phy
.
ªvisi⁄
 < 2) {

2212 
	`e1000e_phy_sw_ª£t
(
hw
);

2213 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 0x3140);

2218 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2219 i‡(
ªt_vÆ
)

2220  
ªt_vÆ
;

2222 
hw
->
phy
.
addr
 = 1;

2223 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
IGP01E1000_PHY_PAGE_SELECT
, 0);

2224 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2225 i‡(
ªt_vÆ
)

2226  
ªt_vÆ
;

2231 
ªt_vÆ
 = 
	`e1000_k1_gig_w‹k¨ound_hv
(
hw
, 
åue
);

2232 i‡(
ªt_vÆ
)

2233  
ªt_vÆ
;

2236 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2237 i‡(
ªt_vÆ
)

2238  
ªt_vÆ
;

2239 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
BM_PORT_GEN_CFG
, &
phy_d©a
);

2240 i‡(
ªt_vÆ
)

2241 
ªÀa£
;

2242 
ªt_vÆ
 = 
	`e1e_wphy_locked
(
hw
, 
BM_PORT_GEN_CFG
, 
phy_d©a
 & 0x00FF);

2243 i‡(
ªt_vÆ
)

2244 
ªÀa£
;

2247 
ªt_vÆ
 = 
	`e1000_wrôe_emi_ªg_locked
(
hw
, 
I82577_MSE_THRESHOLD
, 0x0034);

2248 
ªÀa£
:

2249 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2251  
ªt_vÆ
;

2252 
	}
}

2258 
	$e1000_c›y_rx_addrs_to_phy_ich8œn
(
e1000_hw
 *
hw
)

2260 
u32
 
mac_ªg
;

2261 
u16
 
i
, 
phy_ªg
 = 0;

2262 
s32
 
ªt_vÆ
;

2264 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2265 i‡(
ªt_vÆ
)

2267 
ªt_vÆ
 = 
	`e1000_íabÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
phy_ªg
);

2268 i‡(
ªt_vÆ
)

2269 
ªÀa£
;

2272 
i
 = 0; i < (
hw
->
mac
.
ør_íåy_cou¡
); i++) {

2273 
mac_ªg
 = 
	`î32
(
	`RAL
(
i
));

2274 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_RAR_L
(
i
),

2275 (
u16
)(
mac_ªg
 & 0xFFFF));

2276 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_RAR_M
(
i
),

2277 (
u16
)((
mac_ªg
 >> 16) & 0xFFFF));

2279 
mac_ªg
 = 
	`î32
(
	`RAH
(
i
));

2280 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_RAR_H
(
i
),

2281 (
u16
)(
mac_ªg
 & 0xFFFF));

2282 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_RAR_CTRL
(
i
),

2283 (
u16
)((
mac_ªg
 & 
E1000_RAH_AV
)

2287 
	`e1000_dißbÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
phy_ªg
);

2289 
ªÀa£
:

2290 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2291 
	}
}

2299 
s32
 
	$e1000_lv_jumbo_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
íabÀ
)

2301 
s32
 
ªt_vÆ
 = 0;

2302 
u16
 
phy_ªg
, 
d©a
;

2303 
u32
 
mac_ªg
;

2304 
u16
 
i
;

2306 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pch2œn
)

2310 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 20), &
phy_ªg
);

2311 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 20), 
phy_ªg
 | (1 << 14));

2312 i‡(
ªt_vÆ
)

2313  
ªt_vÆ
;

2315 i‡(
íabÀ
) {

2319 
i
 = 0; i < 
hw
->
mac
.
ør_íåy_cou¡
; i++) {

2320 
u8
 
mac_addr
[
ETH_ALEN
] = { 0 };

2321 
u32
 
addr_high
, 
addr_low
;

2323 
addr_high
 = 
	`î32
(
	`RAH
(
i
));

2324 i‡(!(
addr_high
 & 
E1000_RAH_AV
))

2326 
addr_low
 = 
	`î32
(
	`RAL
(
i
));

2327 
mac_addr
[0] = (
addr_low
 & 0xFF);

2328 
mac_addr
[1] = ((
addr_low
 >> 8) & 0xFF);

2329 
mac_addr
[2] = ((
addr_low
 >> 16) & 0xFF);

2330 
mac_addr
[3] = ((
addr_low
 >> 24) & 0xFF);

2331 
mac_addr
[4] = (
addr_high
 & 0xFF);

2332 
mac_addr
[5] = ((
addr_high
 >> 8) & 0xFF);

2334 
	`ew32
(
	`PCH_RAICC
(
i
), ~
	`ëhî_¸c_À
(
ETH_ALEN
, 
mac_addr
));

2338 
	`e1000_c›y_rx_addrs_to_phy_ich8œn
(
hw
);

2341 
mac_ªg
 = 
	`î32
(
FFLT_DBG
);

2342 
mac_ªg
 &= ~(1 << 14);

2343 
mac_ªg
 |= (7 << 15);

2344 
	`ew32
(
FFLT_DBG
, 
mac_ªg
);

2346 
mac_ªg
 = 
	`î32
(
RCTL
);

2347 
mac_ªg
 |
E1000_RCTL_SECRC
;

2348 
	`ew32
(
RCTL
, 
mac_ªg
);

2350 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
,

2351 
E1000_KMRNCTRLSTA_CTRL_OFFSET
,

2352 &
d©a
);

2353 i‡(
ªt_vÆ
)

2354  
ªt_vÆ
;

2355 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

2356 
E1000_KMRNCTRLSTA_CTRL_OFFSET
,

2357 
d©a
 | (1 << 0));

2358 i‡(
ªt_vÆ
)

2359  
ªt_vÆ
;

2360 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
,

2361 
E1000_KMRNCTRLSTA_HD_CTRL
,

2362 &
d©a
);

2363 i‡(
ªt_vÆ
)

2364  
ªt_vÆ
;

2365 
d©a
 &= ~(0xF << 8);

2366 
d©a
 |= (0xB << 8);

2367 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

2368 
E1000_KMRNCTRLSTA_HD_CTRL
,

2369 
d©a
);

2370 i‡(
ªt_vÆ
)

2371  
ªt_vÆ
;

2374 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 23), &
d©a
);

2375 
d©a
 &= ~(0x7F << 5);

2376 
d©a
 |= (0x37 << 5);

2377 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 23), 
d©a
);

2378 i‡(
ªt_vÆ
)

2379  
ªt_vÆ
;

2380 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 16), &
d©a
);

2381 
d©a
 &= ~(1 << 13);

2382 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 16), 
d©a
);

2383 i‡(
ªt_vÆ
)

2384  
ªt_vÆ
;

2385 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(776, 20), &
d©a
);

2386 
d©a
 &= ~(0x3FF << 2);

2387 
d©a
 |= (0x1A << 2);

2388 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 20), 
d©a
);

2389 i‡(
ªt_vÆ
)

2390  
ªt_vÆ
;

2391 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 23), 0xF100);

2392 i‡(
ªt_vÆ
)

2393  
ªt_vÆ
;

2394 
	`e1e_Ωhy
(
hw
, 
HV_PM_CTRL
, &
d©a
);

2395 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_PM_CTRL
, 
d©a
 | (1 << 10));

2396 i‡(
ªt_vÆ
)

2397  
ªt_vÆ
;

2400 
mac_ªg
 = 
	`î32
(
FFLT_DBG
);

2401 
mac_ªg
 &= ~(0xF << 14);

2402 
	`ew32
(
FFLT_DBG
, 
mac_ªg
);

2404 
mac_ªg
 = 
	`î32
(
RCTL
);

2405 
mac_ªg
 &~
E1000_RCTL_SECRC
;

2406 
	`ew32
(
RCTL
, 
mac_ªg
);

2408 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
,

2409 
E1000_KMRNCTRLSTA_CTRL_OFFSET
,

2410 &
d©a
);

2411 i‡(
ªt_vÆ
)

2412  
ªt_vÆ
;

2413 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

2414 
E1000_KMRNCTRLSTA_CTRL_OFFSET
,

2415 
d©a
 & ~(1 << 0));

2416 i‡(
ªt_vÆ
)

2417  
ªt_vÆ
;

2418 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
,

2419 
E1000_KMRNCTRLSTA_HD_CTRL
,

2420 &
d©a
);

2421 i‡(
ªt_vÆ
)

2422  
ªt_vÆ
;

2423 
d©a
 &= ~(0xF << 8);

2424 
d©a
 |= (0xB << 8);

2425 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

2426 
E1000_KMRNCTRLSTA_HD_CTRL
,

2427 
d©a
);

2428 i‡(
ªt_vÆ
)

2429  
ªt_vÆ
;

2432 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 23), &
d©a
);

2433 
d©a
 &= ~(0x7F << 5);

2434 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 23), 
d©a
);

2435 i‡(
ªt_vÆ
)

2436  
ªt_vÆ
;

2437 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(769, 16), &
d©a
);

2438 
d©a
 |= (1 << 13);

2439 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 16), 
d©a
);

2440 i‡(
ªt_vÆ
)

2441  
ªt_vÆ
;

2442 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(776, 20), &
d©a
);

2443 
d©a
 &= ~(0x3FF << 2);

2444 
d©a
 |= (0x8 << 2);

2445 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 20), 
d©a
);

2446 i‡(
ªt_vÆ
)

2447  
ªt_vÆ
;

2448 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(776, 23), 0x7E00);

2449 i‡(
ªt_vÆ
)

2450  
ªt_vÆ
;

2451 
	`e1e_Ωhy
(
hw
, 
HV_PM_CTRL
, &
d©a
);

2452 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_PM_CTRL
, 
d©a
 & ~(1 << 10));

2453 i‡(
ªt_vÆ
)

2454  
ªt_vÆ
;

2458  
	`e1e_wphy
(
hw
, 
	`PHY_REG
(769, 20), 
phy_ªg
 & ~(1 << 14));

2459 
	}
}

2465 
s32
 
	$e1000_lv_phy_w‹k¨ounds_ich8œn
(
e1000_hw
 *
hw
)

2467 
s32
 
ªt_vÆ
 = 0;

2469 i‡(
hw
->
mac
.
ty≥
 !
e1000_pch2œn
)

2473 
ªt_vÆ
 = 
	`e1000_£t_mdio_¶ow_mode_hv
(
hw
);

2474 i‡(
ªt_vÆ
)

2475  
ªt_vÆ
;

2477 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2478 i‡(
ªt_vÆ
)

2479  
ªt_vÆ
;

2481 
ªt_vÆ
 = 
	`e1000_wrôe_emi_ªg_locked
(
hw
, 
I82579_MSE_THRESHOLD
, 0x0034);

2482 i‡(
ªt_vÆ
)

2483 
ªÀa£
;

2485 
ªt_vÆ
 = 
	`e1000_wrôe_emi_ªg_locked
(
hw
, 
I82579_MSE_LINK_DOWN
, 0x0005);

2486 
ªÀa£
:

2487 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2489  
ªt_vÆ
;

2490 
	}
}

2498 
s32
 
	$e1000_k1_w‹k¨ound_lv
(
e1000_hw
 *
hw
)

2500 
s32
 
ªt_vÆ
 = 0;

2501 
u16
 
°©us_ªg
 = 0;

2502 
u32
 
mac_ªg
;

2503 
u16
 
phy_ªg
;

2505 i‡(
hw
->
mac
.
ty≥
 !
e1000_pch2œn
)

2509 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
HV_M_STATUS
, &
°©us_ªg
);

2510 i‡(
ªt_vÆ
)

2511  
ªt_vÆ
;

2513 i‡((
°©us_ªg
 & (
HV_M_STATUS_LINK_UP
 | 
HV_M_STATUS_AUTONEG_COMPLETE
))

2514 =(
HV_M_STATUS_LINK_UP
 | 
HV_M_STATUS_AUTONEG_COMPLETE
)) {

2515 
mac_ªg
 = 
	`î32
(
FEXTNVM4
);

2516 
mac_ªg
 &~
E1000_FEXTNVM4_BEACON_DURATION_MASK
;

2518 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82579_LPI_CTRL
, &
phy_ªg
);

2519 i‡(
ªt_vÆ
)

2520  
ªt_vÆ
;

2522 i‡(
°©us_ªg
 & 
HV_M_STATUS_SPEED_1000
) {

2523 
u16
 
pm_phy_ªg
;

2525 
mac_ªg
 |
E1000_FEXTNVM4_BEACON_DURATION_8USEC
;

2526 
phy_ªg
 &~
I82579_LPI_CTRL_FORCE_PLL_LOCK_COUNT
;

2528 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
HV_PM_CTRL
, &
pm_phy_ªg
);

2529 i‡(
ªt_vÆ
)

2530  
ªt_vÆ
;

2531 
pm_phy_ªg
 &~
HV_PM_CTRL_PLL_STOP_IN_K1_GIGA
;

2532 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_PM_CTRL
, 
pm_phy_ªg
);

2533 i‡(
ªt_vÆ
)

2534  
ªt_vÆ
;

2536 
mac_ªg
 |
E1000_FEXTNVM4_BEACON_DURATION_16USEC
;

2537 
phy_ªg
 |
I82579_LPI_CTRL_FORCE_PLL_LOCK_COUNT
;

2539 
	`ew32
(
FEXTNVM4
, 
mac_ªg
);

2540 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
I82579_LPI_CTRL
, 
phy_ªg
);

2543  
ªt_vÆ
;

2544 
	}
}

2554 
	$e1000_g©e_hw_phy_c⁄fig_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
g©e
)

2556 
u32
 
ext˙f_˘æ
;

2558 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pch2œn
)

2561 
ext˙f_˘æ
 = 
	`î32
(
EXTCNF_CTRL
);

2563 i‡(
g©e
)

2564 
ext˙f_˘æ
 |
E1000_EXTCNF_CTRL_GATE_PHY_CFG
;

2566 
ext˙f_˘æ
 &~
E1000_EXTCNF_CTRL_GATE_PHY_CFG
;

2568 
	`ew32
(
EXTCNF_CTRL
, 
ext˙f_˘æ
);

2569 
	}
}

2578 
	$e1000_œn_öô_d⁄e_ich8œn
(
e1000_hw
 *
hw
)

2580 
u32
 
d©a
, 
lo›
 = 
E1000_ICH8_LAN_INIT_TIMEOUT
;

2584 
d©a
 = 
	`î32
(
STATUS
);

2585 
d©a
 &
E1000_STATUS_LAN_INIT_DONE
;

2586 
	`u¶ìp_ønge
(100, 200);

2587 } (!
d©a
Ë&& --
lo›
);

2593 i‡(
lo›
 == 0)

2594 
	`e_dbg
("LAN_INIT_DONEÇot set, increaseÅimeout\n");

2597 
d©a
 = 
	`î32
(
STATUS
);

2598 
d©a
 &~
E1000_STATUS_LAN_INIT_DONE
;

2599 
	`ew32
(
STATUS
, 
d©a
);

2600 
	}
}

2606 
s32
 
	$e1000_po°_phy_ª£t_ich8œn
(
e1000_hw
 *
hw
)

2608 
s32
 
ªt_vÆ
 = 0;

2609 
u16
 
ªg
;

2611 i‡(
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw))

2615 
	`u¶ìp_ønge
(10000, 20000);

2618 
hw
->
mac
.
ty≥
) {

2619 
e1000_pchœn
:

2620 
ªt_vÆ
 = 
	`e1000_hv_phy_w‹k¨ounds_ich8œn
(
hw
);

2621 i‡(
ªt_vÆ
)

2622  
ªt_vÆ
;

2624 
e1000_pch2œn
:

2625 
ªt_vÆ
 = 
	`e1000_lv_phy_w‹k¨ounds_ich8œn
(
hw
);

2626 i‡(
ªt_vÆ
)

2627  
ªt_vÆ
;

2634 i‡(
hw
->
mac
.
ty≥
 >
e1000_pchœn
) {

2635 
	`e1e_Ωhy
(
hw
, 
BM_PORT_GEN_CFG
, &
ªg
);

2636 
ªg
 &~
BM_WUC_HOST_WU_BIT
;

2637 
	`e1e_wphy
(
hw
, 
BM_PORT_GEN_CFG
, 
ªg
);

2641 
ªt_vÆ
 = 
	`e1000_sw_lcd_c⁄fig_ich8œn
(
hw
);

2642 i‡(
ªt_vÆ
)

2643  
ªt_vÆ
;

2646 
ªt_vÆ
 = 
	`e1000_€m_bôs_c⁄fig_ich8œn
(
hw
, 
åue
);

2648 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) {

2650 i‡(!(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
)) {

2651 
	`u¶ìp_ønge
(10000, 20000);

2652 
	`e1000_g©e_hw_phy_c⁄fig_ich8œn
(
hw
, 
Ál£
);

2656 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2657 i‡(
ªt_vÆ
)

2658  
ªt_vÆ
;

2659 
ªt_vÆ
 = 
	`e1000_wrôe_emi_ªg_locked
(
hw
,

2660 
I82579_LPI_UPDATE_TIMER
,

2662 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2665  
ªt_vÆ
;

2666 
	}
}

2676 
s32
 
	$e1000_phy_hw_ª£t_ich8œn
(
e1000_hw
 *
hw
)

2678 
s32
 
ªt_vÆ
 = 0;

2681 i‡((
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) &&

2682 !(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
))

2683 
	`e1000_g©e_hw_phy_c⁄fig_ich8œn
(
hw
, 
åue
);

2685 
ªt_vÆ
 = 
	`e1000e_phy_hw_ª£t_gíîic
(
hw
);

2686 i‡(
ªt_vÆ
)

2687  
ªt_vÆ
;

2689  
	`e1000_po°_phy_ª£t_ich8œn
(
hw
);

2690 
	}
}

2703 
s32
 
	$e1000_£t_Õlu_°©e_pchœn
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

2705 
s32
 
ªt_vÆ
;

2706 
u16
 
€m_ªg
;

2708 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
HV_OEM_BITS
, &
€m_ªg
);

2709 i‡(
ªt_vÆ
)

2710  
ªt_vÆ
;

2712 i‡(
a˘ive
)

2713 
€m_ªg
 |
HV_OEM_BITS_LPLU
;

2715 
€m_ªg
 &~
HV_OEM_BITS_LPLU
;

2717 i‡(!
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw))

2718 
€m_ªg
 |
HV_OEM_BITS_RESTART_AN
;

2720  
	`e1e_wphy
(
hw
, 
HV_OEM_BITS
, 
€m_ªg
);

2721 
	}
}

2736 
s32
 
	$e1000_£t_d0_Õlu_°©e_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

2738 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

2739 
u32
 
phy_˘æ
;

2740 
s32
 
ªt_vÆ
 = 0;

2741 
u16
 
d©a
;

2743 i‡(
phy
->
ty≥
 =
e1000_phy_i„
)

2746 
phy_˘æ
 = 
	`î32
(
PHY_CTRL
);

2748 i‡(
a˘ive
) {

2749 
phy_˘æ
 |
E1000_PHY_CTRL_D0A_LPLU
;

2750 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

2752 i‡(
phy
->
ty≥
 !
e1000_phy_igp_3
)

2758 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

2759 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
hw
);

2762 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2763 i‡(
ªt_vÆ
)

2764  
ªt_vÆ
;

2765 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

2766 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2767 i‡(
ªt_vÆ
)

2768  
ªt_vÆ
;

2770 
phy_˘æ
 &~
E1000_PHY_CTRL_D0A_LPLU
;

2771 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

2773 i‡(
phy
->
ty≥
 !
e1000_phy_igp_3
)

2781 i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_⁄
) {

2782 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

2783 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2784 i‡(
ªt_vÆ
)

2785  
ªt_vÆ
;

2787 
d©a
 |
IGP01E1000_PSCFR_SMART_SPEED
;

2788 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

2789 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2790 i‡(
ªt_vÆ
)

2791  
ªt_vÆ
;

2792 } i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_off
) {

2793 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

2794 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2795 i‡(
ªt_vÆ
)

2796  
ªt_vÆ
;

2798 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

2799 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

2800 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2801 i‡(
ªt_vÆ
)

2802  
ªt_vÆ
;

2807 
	}
}

2822 
s32
 
	$e1000_£t_d3_Õlu_°©e_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

2824 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

2825 
u32
 
phy_˘æ
;

2826 
s32
 
ªt_vÆ
 = 0;

2827 
u16
 
d©a
;

2829 
phy_˘æ
 = 
	`î32
(
PHY_CTRL
);

2831 i‡(!
a˘ive
) {

2832 
phy_˘æ
 &~
E1000_PHY_CTRL_NOND0A_LPLU
;

2833 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

2835 i‡(
phy
->
ty≥
 !
e1000_phy_igp_3
)

2843 i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_⁄
) {

2844 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

2845 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2846 i‡(
ªt_vÆ
)

2847  
ªt_vÆ
;

2849 
d©a
 |
IGP01E1000_PSCFR_SMART_SPEED
;

2850 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

2851 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2852 i‡(
ªt_vÆ
)

2853  
ªt_vÆ
;

2854 } i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_off
) {

2855 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

2856 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2857 i‡(
ªt_vÆ
)

2858  
ªt_vÆ
;

2860 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

2861 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

2862 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2863 i‡(
ªt_vÆ
)

2864  
ªt_vÆ
;

2866 } i‡((
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_SPEED_DUPLEX
) ||

2867 (
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_NOT_GIG
) ||

2868 (
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_10_SPEED
)) {

2869 
phy_˘æ
 |
E1000_PHY_CTRL_NOND0A_LPLU
;

2870 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

2872 i‡(
phy
->
ty≥
 !
e1000_phy_igp_3
)

2878 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

2879 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
hw
);

2882 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

2883 i‡(
ªt_vÆ
)

2884  
ªt_vÆ
;

2886 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

2887 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

2890  
ªt_vÆ
;

2891 
	}
}

2901 
s32
 
	$e1000_vÆid_nvm_b™k_dëe˘_ich8œn
(
e1000_hw
 *
hw
, 
u32
 *
b™k
)

2903 
u32
 
ìcd
;

2904 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

2905 
u32
 
b™k1_off£t
 = 
nvm
->
Êash_b™k_size
 * (
u16
);

2906 
u32
 
a˘_off£t
 = 
E1000_ICH_NVM_SIG_WORD
 * 2 + 1;

2907 
u8
 
sig_byã
 = 0;

2908 
s32
 
ªt_vÆ
;

2910 
hw
->
mac
.
ty≥
) {

2911 
e1000_ich8œn
:

2912 
e1000_ich9œn
:

2913 
ìcd
 = 
	`î32
(
EECD
);

2914 i‡((
ìcd
 & 
E1000_EECD_SEC1VAL_VALID_MASK
) ==

2915 
E1000_EECD_SEC1VAL_VALID_MASK
) {

2916 i‡(
ìcd
 & 
E1000_EECD_SEC1VAL
)

2917 *
b™k
 = 1;

2919 *
b™k
 = 0;

2923 
	`e_dbg
("UnableÅo determine valid NVM bank via EEC -Ñeading flash signature\n");

2927 *
b™k
 = 0;

2930 
ªt_vÆ
 = 
	`e1000_ªad_Êash_byã_ich8œn
(
hw
, 
a˘_off£t
,

2931 &
sig_byã
);

2932 i‡(
ªt_vÆ
)

2933  
ªt_vÆ
;

2934 i‡((
sig_byã
 & 
E1000_ICH_NVM_VALID_SIG_MASK
) ==

2935 
E1000_ICH_NVM_SIG_VALUE
) {

2936 *
b™k
 = 0;

2941 
ªt_vÆ
 = 
	`e1000_ªad_Êash_byã_ich8œn
(
hw
, 
a˘_off£t
 +

2942 
b™k1_off£t
,

2943 &
sig_byã
);

2944 i‡(
ªt_vÆ
)

2945  
ªt_vÆ
;

2946 i‡((
sig_byã
 & 
E1000_ICH_NVM_VALID_SIG_MASK
) ==

2947 
E1000_ICH_NVM_SIG_VALUE
) {

2948 *
b™k
 = 1;

2952 
	`e_dbg
("ERROR: No valid NVM bankÖresent\n");

2953  -
E1000_ERR_NVM
;

2955 
	}
}

2966 
s32
 
	$e1000_ªad_nvm_ich8œn
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
,

2967 
u16
 *
d©a
)

2969 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

2970 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

2971 
u32
 
a˘_off£t
;

2972 
s32
 
ªt_vÆ
 = 0;

2973 
u32
 
b™k
 = 0;

2974 
u16
 
i
, 
w‹d
;

2976 i‡((
off£t
 >
nvm
->
w‹d_size
Ë|| (
w‹ds
 >Çvm->word_size - offset) ||

2977 (
w‹ds
 == 0)) {

2978 
	`e_dbg
("nvmÖarameter(s) out of bounds\n");

2979 
ªt_vÆ
 = -
E1000_ERR_NVM
;

2980 
out
;

2983 
nvm
->
›s
.
	`acquúe
(
hw
);

2985 
ªt_vÆ
 = 
	`e1000_vÆid_nvm_b™k_dëe˘_ich8œn
(
hw
, &
b™k
);

2986 i‡(
ªt_vÆ
) {

2987 
	`e_dbg
("CouldÇot detect valid bank,ássuming bank 0\n");

2988 
b™k
 = 0;

2991 
a˘_off£t
 = (
b™k
Ë? 
nvm
->
Êash_b™k_size
 : 0;

2992 
a˘_off£t
 +
off£t
;

2994 
ªt_vÆ
 = 0;

2995 
i
 = 0; i < 
w‹ds
; i++) {

2996 i‡(
dev_•ec
->
shadow_øm
[
off£t
 + 
i
].
modifõd
) {

2997 
d©a
[
i
] = 
dev_•ec
->
shadow_øm
[
off£t
 + i].
vÆue
;

2999 
ªt_vÆ
 = 
	`e1000_ªad_Êash_w‹d_ich8œn
(
hw
,

3000 
a˘_off£t
 + 
i
,

3001 &
w‹d
);

3002 i‡(
ªt_vÆ
)

3004 
d©a
[
i
] = 
w‹d
;

3008 
nvm
->
›s
.
	`ªÀa£
(
hw
);

3010 
out
:

3011 i‡(
ªt_vÆ
)

3012 
	`e_dbg
("NVMÑódÉº‹: %d\n", 
ªt_vÆ
);

3014  
ªt_vÆ
;

3015 
	}
}

3024 
s32
 
	$e1000_Êash_cy˛e_öô_ich8œn
(
e1000_hw
 *
hw
)

3026 
ich8_hws_Êash_°©us
 
hsf°s
;

3027 
s32
 
ªt_vÆ
 = -
E1000_ERR_NVM
;

3029 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3032 i‡(!
hsf°s
.
hsf_°©us
.
ÊdesvÆid
) {

3033 
	`e_dbg
("Flash descriptor invalid. SW Sequencing must be used.\n");

3034  -
E1000_ERR_NVM
;

3038 
hsf°s
.
hsf_°©us
.
Ê˚º
 = 1;

3039 
hsf°s
.
hsf_°©us
.
d´l
 = 1;

3041 
	`ew16Êash
(
ICH_FLASH_HSFSTS
, 
hsf°s
.
ªgvÆ
);

3051 i‡(!
hsf°s
.
hsf_°©us
.
Êcö¥og
) {

3056 
hsf°s
.
hsf_°©us
.
Êcd⁄e
 = 1;

3057 
	`ew16Êash
(
ICH_FLASH_HSFSTS
, 
hsf°s
.
ªgvÆ
);

3058 
ªt_vÆ
 = 0;

3060 
s32
 
i
;

3065 
i
 = 0; i < 
ICH_FLASH_READ_COMMAND_TIMEOUT
; i++) {

3066 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3067 i‡(!
hsf°s
.
hsf_°©us
.
Êcö¥og
) {

3068 
ªt_vÆ
 = 0;

3071 
	`udñay
(1);

3073 i‡(!
ªt_vÆ
) {

3077 
hsf°s
.
hsf_°©us
.
Êcd⁄e
 = 1;

3078 
	`ew16Êash
(
ICH_FLASH_HSFSTS
, 
hsf°s
.
ªgvÆ
);

3080 
	`e_dbg
("Flash controller busy, cannot getáccess\n");

3084  
ªt_vÆ
;

3085 
	}
}

3094 
s32
 
	$e1000_Êash_cy˛e_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
timeout
)

3096 
ich8_hws_Êash_˘æ
 
hsÊ˘l
;

3097 
ich8_hws_Êash_°©us
 
hsf°s
;

3098 
u32
 
i
 = 0;

3101 
hsÊ˘l
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFCTL
);

3102 
hsÊ˘l
.
hsf_˘æ
.
Êcgo
 = 1;

3103 
	`ew16Êash
(
ICH_FLASH_HSFCTL
, 
hsÊ˘l
.
ªgvÆ
);

3107 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3108 i‡(
hsf°s
.
hsf_°©us
.
Êcd⁄e
)

3110 
	`udñay
(1);

3111 } 
i
++ < 
timeout
);

3113 i‡(
hsf°s
.
hsf_°©us
.
Êcd⁄e
 && !hsf°s.hsf_°©us.
Ê˚º
)

3116  -
E1000_ERR_NVM
;

3117 
	}
}

3128 
s32
 
	$e1000_ªad_Êash_w‹d_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3129 
u16
 *
d©a
)

3132 
off£t
 <<= 1;

3133  
	`e1000_ªad_Êash_d©a_ich8œn
(
hw
, 
off£t
, 2, 
d©a
);

3134 
	}
}

3144 
s32
 
	$e1000_ªad_Êash_byã_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3145 
u8
 *
d©a
)

3147 
s32
 
ªt_vÆ
;

3148 
u16
 
w‹d
 = 0;

3150 
ªt_vÆ
 = 
	`e1000_ªad_Êash_d©a_ich8œn
(
hw
, 
off£t
, 1, &
w‹d
);

3151 i‡(
ªt_vÆ
)

3152  
ªt_vÆ
;

3154 *
d©a
 = (
u8
)
w‹d
;

3157 
	}
}

3168 
s32
 
	$e1000_ªad_Êash_d©a_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3169 
u8
 
size
, 
u16
 *
d©a
)

3171 
ich8_hws_Êash_°©us
 
hsf°s
;

3172 
ich8_hws_Êash_˘æ
 
hsÊ˘l
;

3173 
u32
 
Êash_löór_addr
;

3174 
u32
 
Êash_d©a
 = 0;

3175 
s32
 
ªt_vÆ
 = -
E1000_ERR_NVM
;

3176 
u8
 
cou¡
 = 0;

3178 i‡(
size
 < 1 || sizê> 2 || 
off£t
 > 
ICH_FLASH_LINEAR_ADDR_MASK
)

3179  -
E1000_ERR_NVM
;

3180 
Êash_löór_addr
 = ((
ICH_FLASH_LINEAR_ADDR_MASK
 & 
off£t
) +

3181 
hw
->
nvm
.
Êash_ba£_addr
);

3184 
	`udñay
(1);

3186 
ªt_vÆ
 = 
	`e1000_Êash_cy˛e_öô_ich8œn
(
hw
);

3187 i‡(
ªt_vÆ
)

3190 
hsÊ˘l
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFCTL
);

3192 
hsÊ˘l
.
hsf_˘æ
.
Êdbcou¡
 = 
size
 - 1;

3193 
hsÊ˘l
.
hsf_˘æ
.
Êcy˛e
 = 
ICH_CYCLE_READ
;

3194 
	`ew16Êash
(
ICH_FLASH_HSFCTL
, 
hsÊ˘l
.
ªgvÆ
);

3196 
	`ew32Êash
(
ICH_FLASH_FADDR
, 
Êash_löór_addr
);

3198 
ªt_vÆ
 =

3199 
	`e1000_Êash_cy˛e_ich8œn
(
hw
,

3200 
ICH_FLASH_READ_COMMAND_TIMEOUT
);

3207 i‡(!
ªt_vÆ
) {

3208 
Êash_d©a
 = 
	`î32Êash
(
ICH_FLASH_FDATA0
);

3209 i‡(
size
 == 1)

3210 *
d©a
 = (
u8
)(
Êash_d©a
 & 0x000000FF);

3211 i‡(
size
 == 2)

3212 *
d©a
 = (
u16
)(
Êash_d©a
 & 0x0000FFFF);

3220 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3221 i‡(
hsf°s
.
hsf_°©us
.
Ê˚º
) {

3224 } i‡(!
hsf°s
.
hsf_°©us
.
Êcd⁄e
) {

3225 
	`e_dbg
("TimeoutÉrror - flash cycle didÇot complete.\n");

3229 } 
cou¡
++ < 
ICH_FLASH_CYCLE_REPEAT_COUNT
);

3231  
ªt_vÆ
;

3232 
	}
}

3243 
s32
 
	$e1000_wrôe_nvm_ich8œn
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
,

3244 
u16
 *
d©a
)

3246 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

3247 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

3248 
u16
 
i
;

3250 i‡((
off£t
 >
nvm
->
w‹d_size
Ë|| (
w‹ds
 >Çvm->word_size - offset) ||

3251 (
w‹ds
 == 0)) {

3252 
	`e_dbg
("nvmÖarameter(s) out of bounds\n");

3253  -
E1000_ERR_NVM
;

3256 
nvm
->
›s
.
	`acquúe
(
hw
);

3258 
i
 = 0; i < 
w‹ds
; i++) {

3259 
dev_•ec
->
shadow_øm
[
off£t
 + 
i
].
modifõd
 = 
åue
;

3260 
dev_•ec
->
shadow_øm
[
off£t
 + 
i
].
vÆue
 = 
d©a
[i];

3263 
nvm
->
›s
.
	`ªÀa£
(
hw
);

3266 
	}
}

3279 
s32
 
	$e1000_upd©e_nvm_checksum_ich8œn
(
e1000_hw
 *
hw
)

3281 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

3282 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

3283 
u32
 
i
, 
a˘_off£t
, 
√w_b™k_off£t
, 
ﬁd_b™k_off£t
, 
b™k
;

3284 
s32
 
ªt_vÆ
;

3285 
u16
 
d©a
;

3287 
ªt_vÆ
 = 
	`e1000e_upd©e_nvm_checksum_gíîic
(
hw
);

3288 i‡(
ªt_vÆ
)

3289 
out
;

3291 i‡(
nvm
->
ty≥
 !
e1000_nvm_Êash_sw
)

3292 
out
;

3294 
nvm
->
›s
.
	`acquúe
(
hw
);

3300 
ªt_vÆ
 = 
	`e1000_vÆid_nvm_b™k_dëe˘_ich8œn
(
hw
, &
b™k
);

3301 i‡(
ªt_vÆ
) {

3302 
	`e_dbg
("CouldÇot detect valid bank,ássuming bank 0\n");

3303 
b™k
 = 0;

3306 i‡(
b™k
 == 0) {

3307 
√w_b™k_off£t
 = 
nvm
->
Êash_b™k_size
;

3308 
ﬁd_b™k_off£t
 = 0;

3309 
ªt_vÆ
 = 
	`e1000_îa£_Êash_b™k_ich8œn
(
hw
, 1);

3310 i‡(
ªt_vÆ
)

3311 
ªÀa£
;

3313 
ﬁd_b™k_off£t
 = 
nvm
->
Êash_b™k_size
;

3314 
√w_b™k_off£t
 = 0;

3315 
ªt_vÆ
 = 
	`e1000_îa£_Êash_b™k_ich8œn
(
hw
, 0);

3316 i‡(
ªt_vÆ
)

3317 
ªÀa£
;

3320 
i
 = 0; i < 
E1000_ICH8_SHADOW_RAM_WORDS
; i++) {

3325 i‡(
dev_•ec
->
shadow_øm
[
i
].
modifõd
) {

3326 
d©a
 = 
dev_•ec
->
shadow_øm
[
i
].
vÆue
;

3328 
ªt_vÆ
 = 
	`e1000_ªad_Êash_w‹d_ich8œn
(
hw
, 
i
 +

3329 
ﬁd_b™k_off£t
,

3330 &
d©a
);

3331 i‡(
ªt_vÆ
)

3342 i‡(
i
 =
E1000_ICH_NVM_SIG_WORD
)

3343 
d©a
 |
E1000_ICH_NVM_SIG_MASK
;

3346 
a˘_off£t
 = (
i
 + 
√w_b™k_off£t
) << 1;

3348 
	`u¶ìp_ønge
(100, 200);

3350 
ªt_vÆ
 = 
	`e1000_ªåy_wrôe_Êash_byã_ich8œn
(
hw
,

3351 
a˘_off£t
,

3352 (
u8
)
d©a
);

3353 i‡(
ªt_vÆ
)

3356 
	`u¶ìp_ønge
(100, 200);

3357 
ªt_vÆ
 = 
	`e1000_ªåy_wrôe_Êash_byã_ich8œn
(
hw
,

3358 
a˘_off£t
 + 1,

3359 (
u8
)(
d©a
 >> 8));

3360 i‡(
ªt_vÆ
)

3367 i‡(
ªt_vÆ
) {

3368 
	`e_dbg
("Flash commit failed.\n");

3369 
ªÀa£
;

3377 
a˘_off£t
 = 
√w_b™k_off£t
 + 
E1000_ICH_NVM_SIG_WORD
;

3378 
ªt_vÆ
 = 
	`e1000_ªad_Êash_w‹d_ich8œn
(
hw
, 
a˘_off£t
, &
d©a
);

3379 i‡(
ªt_vÆ
)

3380 
ªÀa£
;

3382 
d©a
 &= 0xBFFF;

3383 
ªt_vÆ
 = 
	`e1000_ªåy_wrôe_Êash_byã_ich8œn
(
hw
,

3384 
a˘_off£t
 * 2 + 1,

3385 (
u8
)(
d©a
 >> 8));

3386 i‡(
ªt_vÆ
)

3387 
ªÀa£
;

3394 
a˘_off£t
 = (
ﬁd_b™k_off£t
 + 
E1000_ICH_NVM_SIG_WORD
) * 2 + 1;

3395 
ªt_vÆ
 = 
	`e1000_ªåy_wrôe_Êash_byã_ich8œn
(
hw
, 
a˘_off£t
, 0);

3396 i‡(
ªt_vÆ
)

3397 
ªÀa£
;

3400 
i
 = 0; i < 
E1000_ICH8_SHADOW_RAM_WORDS
; i++) {

3401 
dev_•ec
->
shadow_øm
[
i
].
modifõd
 = 
Ál£
;

3402 
dev_•ec
->
shadow_øm
[
i
].
vÆue
 = 0xFFFF;

3405 
ªÀa£
:

3406 
nvm
->
›s
.
	`ªÀa£
(
hw
);

3411 i‡(!
ªt_vÆ
) {

3412 
nvm
->
›s
.
	`ªlﬂd
(
hw
);

3413 
	`u¶ìp_ønge
(10000, 20000);

3416 
out
:

3417 i‡(
ªt_vÆ
)

3418 
	`e_dbg
("NVM upd©êîr‹: %d\n", 
ªt_vÆ
);

3420  
ªt_vÆ
;

3421 
	}
}

3431 
s32
 
	$e1000_vÆid©e_nvm_checksum_ich8œn
(
e1000_hw
 *
hw
)

3433 
s32
 
ªt_vÆ
;

3434 
u16
 
d©a
;

3435 
u16
 
w‹d
;

3436 
u16
 
vÆid_csum_mask
;

3443 
hw
->
mac
.
ty≥
) {

3444 
e1000_pch_Õt
:

3445 
w‹d
 = 
NVM_COMPAT
;

3446 
vÆid_csum_mask
 = 
NVM_COMPAT_VALID_CSUM
;

3449 
w‹d
 = 
NVM_FUTURE_INIT_WORD1
;

3450 
vÆid_csum_mask
 = 
NVM_FUTURE_INIT_WORD1_VALID_CSUM
;

3454 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
w‹d
, 1, &
d©a
);

3455 i‡(
ªt_vÆ
)

3456  
ªt_vÆ
;

3458 i‡(!(
d©a
 & 
vÆid_csum_mask
)) {

3459 
d©a
 |
vÆid_csum_mask
;

3460 
ªt_vÆ
 = 
	`e1000_wrôe_nvm
(
hw
, 
w‹d
, 1, &
d©a
);

3461 i‡(
ªt_vÆ
)

3462  
ªt_vÆ
;

3463 
ªt_vÆ
 = 
	`e1000e_upd©e_nvm_checksum
(
hw
);

3464 i‡(
ªt_vÆ
)

3465  
ªt_vÆ
;

3468  
	`e1000e_vÆid©e_nvm_checksum_gíîic
(
hw
);

3469 
	}
}

3480 
s32
 
	$e1000_wrôe_Êash_d©a_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3481 
u8
 
size
, 
u16
 
d©a
)

3483 
ich8_hws_Êash_°©us
 
hsf°s
;

3484 
ich8_hws_Êash_˘æ
 
hsÊ˘l
;

3485 
u32
 
Êash_löór_addr
;

3486 
u32
 
Êash_d©a
 = 0;

3487 
s32
 
ªt_vÆ
;

3488 
u8
 
cou¡
 = 0;

3490 i‡(
size
 < 1 || sizê> 2 || 
d©a
 > size * 0xff ||

3491 
off£t
 > 
ICH_FLASH_LINEAR_ADDR_MASK
)

3492  -
E1000_ERR_NVM
;

3494 
Êash_löór_addr
 = ((
ICH_FLASH_LINEAR_ADDR_MASK
 & 
off£t
) +

3495 
hw
->
nvm
.
Êash_ba£_addr
);

3498 
	`udñay
(1);

3500 
ªt_vÆ
 = 
	`e1000_Êash_cy˛e_öô_ich8œn
(
hw
);

3501 i‡(
ªt_vÆ
)

3504 
hsÊ˘l
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFCTL
);

3506 
hsÊ˘l
.
hsf_˘æ
.
Êdbcou¡
 = 
size
 - 1;

3507 
hsÊ˘l
.
hsf_˘æ
.
Êcy˛e
 = 
ICH_CYCLE_WRITE
;

3508 
	`ew16Êash
(
ICH_FLASH_HSFCTL
, 
hsÊ˘l
.
ªgvÆ
);

3510 
	`ew32Êash
(
ICH_FLASH_FADDR
, 
Êash_löór_addr
);

3512 i‡(
size
 == 1)

3513 
Êash_d©a
 = (
u32
)
d©a
 & 0x00FF;

3515 
Êash_d©a
 = (
u32
)
d©a
;

3517 
	`ew32Êash
(
ICH_FLASH_FDATA0
, 
Êash_d©a
);

3522 
ªt_vÆ
 =

3523 
	`e1000_Êash_cy˛e_ich8œn
(
hw
,

3524 
ICH_FLASH_WRITE_COMMAND_TIMEOUT
);

3525 i‡(!
ªt_vÆ
)

3533 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3534 i‡(
hsf°s
.
hsf_°©us
.
Ê˚º
)

3537 i‡(!
hsf°s
.
hsf_°©us
.
Êcd⁄e
) {

3538 
	`e_dbg
("TimeoutÉrror - flash cycle didÇot complete.\n");

3541 } 
cou¡
++ < 
ICH_FLASH_CYCLE_REPEAT_COUNT
);

3543  
ªt_vÆ
;

3544 
	}
}

3554 
s32
 
	$e1000_wrôe_Êash_byã_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3555 
u8
 
d©a
)

3557 
u16
 
w‹d
 = (u16)
d©a
;

3559  
	`e1000_wrôe_Êash_d©a_ich8œn
(
hw
, 
off£t
, 1, 
w‹d
);

3560 
	}
}

3571 
s32
 
	$e1000_ªåy_wrôe_Êash_byã_ich8œn
(
e1000_hw
 *
hw
,

3572 
u32
 
off£t
, 
u8
 
byã
)

3574 
s32
 
ªt_vÆ
;

3575 
u16
 
¥ogøm_ªåõs
;

3577 
ªt_vÆ
 = 
	`e1000_wrôe_Êash_byã_ich8œn
(
hw
, 
off£t
, 
byã
);

3578 i‡(!
ªt_vÆ
)

3579  
ªt_vÆ
;

3581 
¥ogøm_ªåõs
 = 0;Örogram_retries < 100;Örogram_retries++) {

3582 
	`e_dbg
("Rëryög Byã %2.2Xáàoff£à%u\n", 
byã
, 
off£t
);

3583 
	`u¶ìp_ønge
(100, 200);

3584 
ªt_vÆ
 = 
	`e1000_wrôe_Êash_byã_ich8œn
(
hw
, 
off£t
, 
byã
);

3585 i‡(!
ªt_vÆ
)

3588 i‡(
¥ogøm_ªåõs
 == 100)

3589  -
E1000_ERR_NVM
;

3592 
	}
}

3602 
s32
 
	$e1000_îa£_Êash_b™k_ich8œn
(
e1000_hw
 *
hw
, 
u32
 
b™k
)

3604 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

3605 
ich8_hws_Êash_°©us
 
hsf°s
;

3606 
ich8_hws_Êash_˘æ
 
hsÊ˘l
;

3607 
u32
 
Êash_löór_addr
;

3609 
u32
 
Êash_b™k_size
 = 
nvm
->flash_bank_size * 2;

3610 
s32
 
ªt_vÆ
;

3611 
s32
 
cou¡
 = 0;

3612 
s32
 
j
, 
ôî©i⁄
, 
£˘‹_size
;

3614 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3628 
hsf°s
.
hsf_°©us
.
bîa£sz
) {

3631 
£˘‹_size
 = 
ICH_FLASH_SEG_SIZE_256
;

3632 
ôî©i⁄
 = 
Êash_b™k_size
 / 
ICH_FLASH_SEG_SIZE_256
;

3635 
£˘‹_size
 = 
ICH_FLASH_SEG_SIZE_4K
;

3636 
ôî©i⁄
 = 1;

3639 
£˘‹_size
 = 
ICH_FLASH_SEG_SIZE_8K
;

3640 
ôî©i⁄
 = 1;

3643 
£˘‹_size
 = 
ICH_FLASH_SEG_SIZE_64K
;

3644 
ôî©i⁄
 = 1;

3647  -
E1000_ERR_NVM
;

3651 
Êash_löór_addr
 = 
hw
->
nvm
.
Êash_ba£_addr
;

3652 
Êash_löór_addr
 +(
b™k
Ë? 
Êash_b™k_size
 : 0;

3654 
j
 = 0; j < 
ôî©i⁄
; j++) {

3656 
u32
 
timeout
 = 
ICH_FLASH_ERASE_COMMAND_TIMEOUT
;

3659 
ªt_vÆ
 = 
	`e1000_Êash_cy˛e_öô_ich8œn
(
hw
);

3660 i‡(
ªt_vÆ
)

3661  
ªt_vÆ
;

3666 
hsÊ˘l
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFCTL
);

3667 
hsÊ˘l
.
hsf_˘æ
.
Êcy˛e
 = 
ICH_CYCLE_ERASE
;

3668 
	`ew16Êash
(
ICH_FLASH_HSFCTL
, 
hsÊ˘l
.
ªgvÆ
);

3674 
Êash_löór_addr
 +(
j
 * 
£˘‹_size
);

3675 
	`ew32Êash
(
ICH_FLASH_FADDR
, 
Êash_löór_addr
);

3677 
ªt_vÆ
 = 
	`e1000_Êash_cy˛e_ich8œn
(
hw
, 
timeout
);

3678 i‡(!
ªt_vÆ
)

3685 
hsf°s
.
ªgvÆ
 = 
	`î16Êash
(
ICH_FLASH_HSFSTS
);

3686 i‡(
hsf°s
.
hsf_°©us
.
Ê˚º
)

3689 i‡(!
hsf°s
.
hsf_°©us
.
Êcd⁄e
)

3690  
ªt_vÆ
;

3691 } ++
cou¡
 < 
ICH_FLASH_CYCLE_REPEAT_COUNT
);

3695 
	}
}

3706 
s32
 
	$e1000_vÆid_Àd_deÁu…_ich8œn
(
e1000_hw
 *
hw
, 
u16
 *
d©a
)

3708 
s32
 
ªt_vÆ
;

3710 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_ID_LED_SETTINGS
, 1, 
d©a
);

3711 i‡(
ªt_vÆ
) {

3712 
	`e_dbg
("NVM Read Error\n");

3713  
ªt_vÆ
;

3716 i‡(*
d©a
 =
ID_LED_RESERVED_0000
 || *d©®=
ID_LED_RESERVED_FFFF
)

3717 *
d©a
 = 
ID_LED_DEFAULT_ICH8LAN
;

3720 
	}
}

3735 
s32
 
	$e1000_id_Àd_öô_pchœn
(
e1000_hw
 *
hw
)

3737 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

3738 
s32
 
ªt_vÆ
;

3739 c⁄° 
u32
 
Àd˘l_⁄
 = 
E1000_LEDCTL_MODE_LINK_UP
;

3740 c⁄° 
u32
 
Àd˘l_off
 = 
E1000_LEDCTL_MODE_LINK_UP
 | 
E1000_PHY_LED0_IVRT
;

3741 
u16
 
d©a
, 
i
, 
ãmp
, 
shi·
;

3744 
ªt_vÆ
 = 
hw
->
nvm
.
›s
.
	`vÆid_Àd_deÁu…
(hw, &
d©a
);

3745 i‡(
ªt_vÆ
)

3746  
ªt_vÆ
;

3748 
mac
->
Àd˘l_deÁu…
 = 
	`î32
(
LEDCTL
);

3749 
mac
->
Àd˘l_mode1
 = mac->
Àd˘l_deÁu…
;

3750 
mac
->
Àd˘l_mode2
 = mac->
Àd˘l_deÁu…
;

3752 
i
 = 0; i < 4; i++) {

3753 
ãmp
 = (
d©a
 >> (
i
 << 2)Ë& 
E1000_LEDCTL_LED0_MODE_MASK
;

3754 
shi·
 = (
i
 * 5);

3755 
ãmp
) {

3756 
ID_LED_ON1_DEF2
:

3757 
ID_LED_ON1_ON2
:

3758 
ID_LED_ON1_OFF2
:

3759 
mac
->
Àd˘l_mode1
 &~(
E1000_PHY_LED0_MASK
 << 
shi·
);

3760 
mac
->
Àd˘l_mode1
 |(
Àd˘l_⁄
 << 
shi·
);

3762 
ID_LED_OFF1_DEF2
:

3763 
ID_LED_OFF1_ON2
:

3764 
ID_LED_OFF1_OFF2
:

3765 
mac
->
Àd˘l_mode1
 &~(
E1000_PHY_LED0_MASK
 << 
shi·
);

3766 
mac
->
Àd˘l_mode1
 |(
Àd˘l_off
 << 
shi·
);

3772 
ãmp
) {

3773 
ID_LED_DEF1_ON2
:

3774 
ID_LED_ON1_ON2
:

3775 
ID_LED_OFF1_ON2
:

3776 
mac
->
Àd˘l_mode2
 &~(
E1000_PHY_LED0_MASK
 << 
shi·
);

3777 
mac
->
Àd˘l_mode2
 |(
Àd˘l_⁄
 << 
shi·
);

3779 
ID_LED_DEF1_OFF2
:

3780 
ID_LED_ON1_OFF2
:

3781 
ID_LED_OFF1_OFF2
:

3782 
mac
->
Àd˘l_mode2
 &~(
E1000_PHY_LED0_MASK
 << 
shi·
);

3783 
mac
->
Àd˘l_mode2
 |(
Àd˘l_off
 << 
shi·
);

3792 
	}
}

3801 
s32
 
	$e1000_gë_bus_öfo_ich8œn
(
e1000_hw
 *
hw
)

3803 
e1000_bus_öfo
 *
bus
 = &
hw
->bus;

3804 
s32
 
ªt_vÆ
;

3806 
ªt_vÆ
 = 
	`e1000e_gë_bus_öfo_pcõ
(
hw
);

3813 i‡(
bus
->
width
 =
e1000_bus_width_unknown
)

3814 
bus
->
width
 = 
e1000_bus_width_pcõ_x1
;

3816  
ªt_vÆ
;

3817 
	}
}

3826 
s32
 
	$e1000_ª£t_hw_ich8œn
(
e1000_hw
 *
hw
)

3828 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

3829 
u16
 
kum_cfg
;

3830 
u32
 
˘æ
, 
ªg
;

3831 
s32
 
ªt_vÆ
;

3836 
ªt_vÆ
 = 
	`e1000e_dißbÀ_pcõ_ma°î
(
hw
);

3837 i‡(
ªt_vÆ
)

3838 
	`e_dbg
("PCI-E Master disableÖolling has failed.\n");

3840 
	`e_dbg
("Masking offáll interrupts\n");

3841 
	`ew32
(
IMC
, 0xffffffff);

3847 
	`ew32
(
RCTL
, 0);

3848 
	`ew32
(
TCTL
, 
E1000_TCTL_PSP
);

3849 
	`e1e_Êush
();

3851 
	`u¶ìp_ønge
(10000, 20000);

3854 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
) {

3856 
	`ew32
(
PBA
, 
E1000_PBA_8K
);

3858 
	`ew32
(
PBS
, 
E1000_PBS_16K
);

3861 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
) {

3863 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
E1000_NVM_K1_CONFIG
, 1, &
kum_cfg
);

3864 i‡(
ªt_vÆ
)

3865  
ªt_vÆ
;

3867 i‡(
kum_cfg
 & 
E1000_NVM_K1_ENABLE
)

3868 
dev_•ec
->
nvm_k1_íabÀd
 = 
åue
;

3870 
dev_•ec
->
nvm_k1_íabÀd
 = 
Ál£
;

3873 
˘æ
 = 
	`î32
(
CTRL
);

3875 i‡(!
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)) {

3880 
˘æ
 |
E1000_CTRL_PHY_RST
;

3885 i‡((
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) &&

3886 !(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
))

3887 
	`e1000_g©e_hw_phy_c⁄fig_ich8œn
(
hw
, 
åue
);

3889 
ªt_vÆ
 = 
	`e1000_acquúe_swÊag_ich8œn
(
hw
);

3890 
	`e_dbg
("Issuingá globalÑesetÅo ich8lan\n");

3891 
	`ew32
(
CTRL
, (
˘æ
 | 
E1000_CTRL_RST
));

3893 
	`m¶ìp
(20);

3896 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch2œn
) {

3897 
ªg
 = 
	`î32
(
FEXTNVM3
);

3898 
ªg
 &~
E1000_FEXTNVM3_PHY_CFG_COUNTER_MASK
;

3899 
ªg
 |
E1000_FEXTNVM3_PHY_CFG_COUNTER_50MSEC
;

3900 
	`ew32
(
FEXTNVM3
, 
ªg
);

3903 i‡(!
ªt_vÆ
)

3904 
	`˛ór_bô
(
__E1000_ACCESS_SHARED_RESOURCE
, &
hw
->
ad≠ãr
->
°©e
);

3906 i‡(
˘æ
 & 
E1000_CTRL_PHY_RST
) {

3907 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`gë_cfg_d⁄e
(hw);

3908 i‡(
ªt_vÆ
)

3909  
ªt_vÆ
;

3911 
ªt_vÆ
 = 
	`e1000_po°_phy_ª£t_ich8œn
(
hw
);

3912 i‡(
ªt_vÆ
)

3913  
ªt_vÆ
;

3920 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
)

3921 
	`ew32
(
CRC_OFFSET
, 0x65656565);

3923 
	`ew32
(
IMC
, 0xffffffff);

3924 
	`î32
(
ICR
);

3926 
ªg
 = 
	`î32
(
KABGTXD
);

3927 
ªg
 |
E1000_KABGTXD_BGSQLBIAS
;

3928 
	`ew32
(
KABGTXD
, 
ªg
);

3931 
	}
}

3945 
s32
 
	$e1000_öô_hw_ich8œn
(
e1000_hw
 *
hw
)

3947 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

3948 
u32
 
˘æ_ext
, 
txd˘l
, 
¢o›
;

3949 
s32
 
ªt_vÆ
;

3950 
u16
 
i
;

3952 
	`e1000_öôülize_hw_bôs_ich8œn
(
hw
);

3955 
ªt_vÆ
 = 
mac
->
›s
.
	`id_Àd_öô
(
hw
);

3957 i‡(
ªt_vÆ
)

3958 
	`e_dbg
("Error initializing identification LED\n");

3961 
	`e1000e_öô_rx_addrs
(
hw
, 
mac
->
ør_íåy_cou¡
);

3964 
	`e_dbg
("ZeroingÅhe MTA\n");

3965 
i
 = 0; i < 
mac
->
mè_ªg_cou¡
; i++)

3966 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_MTA
, 
i
, 0);

3972 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) {

3973 
	`e1e_Ωhy
(
hw
, 
BM_PORT_GEN_CFG
, &
i
);

3974 
i
 &~
BM_WUC_HOST_WU_BIT
;

3975 
	`e1e_wphy
(
hw
, 
BM_PORT_GEN_CFG
, 
i
);

3976 
ªt_vÆ
 = 
	`e1000_phy_hw_ª£t_ich8œn
(
hw
);

3977 i‡(
ªt_vÆ
)

3978  
ªt_vÆ
;

3982 
ªt_vÆ
 = 
mac
->
›s
.
	`£tup_lök
(
hw
);

3985 
txd˘l
 = 
	`î32
(
	`TXDCTL
(0));

3986 
txd˘l
 = (—xd˘»& ~
E1000_TXDCTL_WTHRESH
) |

3987 
E1000_TXDCTL_FULL_TX_DESC_WB
);

3988 
txd˘l
 = (—xd˘»& ~
E1000_TXDCTL_PTHRESH
) |

3989 
E1000_TXDCTL_MAX_TX_DESC_PREFETCH
);

3990 
	`ew32
(
	`TXDCTL
(0), 
txd˘l
);

3991 
txd˘l
 = 
	`î32
(
	`TXDCTL
(1));

3992 
txd˘l
 = (—xd˘»& ~
E1000_TXDCTL_WTHRESH
) |

3993 
E1000_TXDCTL_FULL_TX_DESC_WB
);

3994 
txd˘l
 = (—xd˘»& ~
E1000_TXDCTL_PTHRESH
) |

3995 
E1000_TXDCTL_MAX_TX_DESC_PREFETCH
);

3996 
	`ew32
(
	`TXDCTL
(1), 
txd˘l
);

4001 i‡(
mac
->
ty≥
 =
e1000_ich8œn
)

4002 
¢o›
 = 
PCIE_ICH8_SNOOP_ALL
;

4004 
¢o›
 = (
u32
)~(
PCIE_NO_SNOOP_ALL
);

4005 
	`e1000e_£t_pcõ_no_¢o›
(
hw
, 
¢o›
);

4007 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

4008 
˘æ_ext
 |
E1000_CTRL_EXT_RO_DIS
;

4009 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

4016 
	`e1000_˛ór_hw_˙ås_ich8œn
(
hw
);

4018  
ªt_vÆ
;

4019 
	}
}

4028 
	$e1000_öôülize_hw_bôs_ich8œn
(
e1000_hw
 *
hw
)

4030 
u32
 
ªg
;

4033 
ªg
 = 
	`î32
(
CTRL_EXT
);

4034 
ªg
 |= (1 << 22);

4036 i‡(
hw
->
mac
.
ty≥
 >
e1000_pchœn
)

4037 
ªg
 |
E1000_CTRL_EXT_PHYPDEN
;

4038 
	`ew32
(
CTRL_EXT
, 
ªg
);

4041 
ªg
 = 
	`î32
(
	`TXDCTL
(0));

4042 
ªg
 |= (1 << 22);

4043 
	`ew32
(
	`TXDCTL
(0), 
ªg
);

4046 
ªg
 = 
	`î32
(
	`TXDCTL
(1));

4047 
ªg
 |= (1 << 22);

4048 
	`ew32
(
	`TXDCTL
(1), 
ªg
);

4051 
ªg
 = 
	`î32
(
	`TARC
(0));

4052 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

4053 
ªg
 |= (1 << 28) | (1 << 29);

4054 
ªg
 |= (1 << 23) | (1 << 24) | (1 << 26) | (1 << 27);

4055 
	`ew32
(
	`TARC
(0), 
ªg
);

4058 
ªg
 = 
	`î32
(
	`TARC
(1));

4059 i‡(
	`î32
(
TCTL
Ë& 
E1000_TCTL_MULR
)

4060 
ªg
 &= ~(1 << 28);

4062 
ªg
 |= (1 << 28);

4063 
ªg
 |= (1 << 24) | (1 << 26) | (1 << 30);

4064 
	`ew32
(
	`TARC
(1), 
ªg
);

4067 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
) {

4068 
ªg
 = 
	`î32
(
STATUS
);

4069 
ªg
 &= ~(1 << 31);

4070 
	`ew32
(
STATUS
, 
ªg
);

4076 
ªg
 = 
	`î32
(
RFCTL
);

4077 
ªg
 |(
E1000_RFCTL_NFSW_DIS
 | 
E1000_RFCTL_NFSR_DIS
);

4082 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

4083 
ªg
 |(
E1000_RFCTL_IPV6_EX_DIS
 | 
E1000_RFCTL_NEW_IPV6_EXT_DIS
);

4084 
	`ew32
(
RFCTL
, 
ªg
);

4087 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

4088 
ªg
 = 
	`î32
(
PBECCSTS
);

4089 
ªg
 |
E1000_PBECCSTS_ECC_ENABLE
;

4090 
	`ew32
(
PBECCSTS
, 
ªg
);

4092 
ªg
 = 
	`î32
(
CTRL
);

4093 
ªg
 |
E1000_CTRL_MEHE
;

4094 
	`ew32
(
CTRL
, 
ªg
);

4096 
	}
}

4108 
s32
 
	$e1000_£tup_lök_ich8œn
(
e1000_hw
 *
hw
)

4110 
s32
 
ªt_vÆ
;

4112 i‡(
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw))

4119 i‡(
hw
->
fc
.
ªque°ed_mode
 =
e1000_fc_deÁu…
) {

4121 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
)

4122 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_rx_∑u£
;

4124 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_fuŒ
;

4130 
hw
->
fc
.
cuºít_mode
 = hw->fc.
ªque°ed_mode
;

4132 
	`e_dbg
("A·î fix-up†FlowC⁄åﬁ i†now = %x\n", 
hw
->
fc
.
cuºít_mode
);

4135 
ªt_vÆ
 = 
hw
->
mac
.
›s
.
	`£tup_physiˇl_öãrÁ˚
(hw);

4136 i‡(
ªt_vÆ
)

4137  
ªt_vÆ
;

4139 
	`ew32
(
FCTTV
, 
hw
->
fc
.
∑u£_time
);

4140 i‡((
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) ||

4141 (
hw
->
phy
.
ty≥
 =
e1000_phy_82579
) ||

4142 (
hw
->
phy
.
ty≥
 =
e1000_phy_i217
) ||

4143 (
hw
->
phy
.
ty≥
 =
e1000_phy_82577
)) {

4144 
	`ew32
(
FCRTV_PCH
, 
hw
->
fc
.
ª‰esh_time
);

4146 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

4147 
	`PHY_REG
(
BM_PORT_CTRL_PAGE
, 27),

4148 
hw
->
fc
.
∑u£_time
);

4149 i‡(
ªt_vÆ
)

4150  
ªt_vÆ
;

4153  
	`e1000e_£t_fc_w©îm¨ks
(
hw
);

4154 
	}
}

4164 
s32
 
	$e1000_£tup_c›≥r_lök_ich8œn
(
e1000_hw
 *
hw
)

4166 
u32
 
˘æ
;

4167 
s32
 
ªt_vÆ
;

4168 
u16
 
ªg_d©a
;

4170 
˘æ
 = 
	`î32
(
CTRL
);

4171 
˘æ
 |
E1000_CTRL_SLU
;

4172 
˘æ
 &~(
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
);

4173 
	`ew32
(
CTRL
, 
˘æ
);

4179 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
, 
E1000_KMRNCTRLSTA_TIMEOUTS
, 0xFFFF);

4180 i‡(
ªt_vÆ
)

4181  
ªt_vÆ
;

4182 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
,

4183 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

4184 &
ªg_d©a
);

4185 i‡(
ªt_vÆ
)

4186  
ªt_vÆ
;

4187 
ªg_d©a
 |= 0x3F;

4188 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

4189 
E1000_KMRNCTRLSTA_INBAND_PARAM
,

4190 
ªg_d©a
);

4191 i‡(
ªt_vÆ
)

4192  
ªt_vÆ
;

4194 
hw
->
phy
.
ty≥
) {

4195 
e1000_phy_igp_3
:

4196 
ªt_vÆ
 = 
	`e1000e_c›≥r_lök_£tup_igp
(
hw
);

4197 i‡(
ªt_vÆ
)

4198  
ªt_vÆ
;

4200 
e1000_phy_bm
:

4201 
e1000_phy_82578
:

4202 
ªt_vÆ
 = 
	`e1000e_c›≥r_lök_£tup_m88
(
hw
);

4203 i‡(
ªt_vÆ
)

4204  
ªt_vÆ
;

4206 
e1000_phy_82577
:

4207 
e1000_phy_82579
:

4208 
ªt_vÆ
 = 
	`e1000_c›≥r_lök_£tup_82577
(
hw
);

4209 i‡(
ªt_vÆ
)

4210  
ªt_vÆ
;

4212 
e1000_phy_i„
:

4213 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IFE_PHY_MDIX_CONTROL
, &
ªg_d©a
);

4214 i‡(
ªt_vÆ
)

4215  
ªt_vÆ
;

4217 
ªg_d©a
 &~
IFE_PMC_AUTO_MDIX
;

4219 
hw
->
phy
.
mdix
) {

4221 
ªg_d©a
 &~
IFE_PMC_FORCE_MDIX
;

4224 
ªg_d©a
 |
IFE_PMC_FORCE_MDIX
;

4228 
ªg_d©a
 |
IFE_PMC_AUTO_MDIX
;

4231 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IFE_PHY_MDIX_CONTROL
, 
ªg_d©a
);

4232 i‡(
ªt_vÆ
)

4233  
ªt_vÆ
;

4239  
	`e1000e_£tup_c›≥r_lök
(
hw
);

4240 
	}
}

4250 
s32
 
	$e1000_£tup_c›≥r_lök_pch_Õt
(
e1000_hw
 *
hw
)

4252 
u32
 
˘æ
;

4253 
s32
 
ªt_vÆ
;

4255 
˘æ
 = 
	`î32
(
CTRL
);

4256 
˘æ
 |
E1000_CTRL_SLU
;

4257 
˘æ
 &~(
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
);

4258 
	`ew32
(
CTRL
, 
˘æ
);

4260 
ªt_vÆ
 = 
	`e1000_c›≥r_lök_£tup_82577
(
hw
);

4261 i‡(
ªt_vÆ
)

4262  
ªt_vÆ
;

4264  
	`e1000e_£tup_c›≥r_lök
(
hw
);

4265 
	}
}

4277 
s32
 
	$e1000_gë_lök_up_öfo_ich8œn
(
e1000_hw
 *
hw
, 
u16
 *
•ìd
,

4278 
u16
 *
du∂ex
)

4280 
s32
 
ªt_vÆ
;

4282 
ªt_vÆ
 = 
	`e1000e_gë_•ìd_™d_du∂ex_c›≥r
(
hw
, 
•ìd
, 
du∂ex
);

4283 i‡(
ªt_vÆ
)

4284  
ªt_vÆ
;

4286 i‡((
hw
->
mac
.
ty≥
 =
e1000_ich8œn
) &&

4287 (
hw
->
phy
.
ty≥
 =
e1000_phy_igp_3
Ë&& (*
•ìd
 =
SPEED_1000
)) {

4288 
ªt_vÆ
 = 
	`e1000_km∫_lock_loss_w‹k¨ound_ich8œn
(
hw
);

4291  
ªt_vÆ
;

4292 
	}
}

4309 
s32
 
	$e1000_km∫_lock_loss_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
)

4311 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

4312 
u32
 
phy_˘æ
;

4313 
s32
 
ªt_vÆ
;

4314 
u16
 
i
, 
d©a
;

4315 
boﬁ
 
lök
;

4317 i‡(!
dev_•ec
->
km∫_lock_loss_w‹k¨ound_íabÀd
)

4324 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

4325 i‡(!
lök
)

4328 
i
 = 0; i < 10; i++) {

4330 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP3_KMRN_DIAG
, &
d©a
);

4331 i‡(
ªt_vÆ
)

4332  
ªt_vÆ
;

4334 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP3_KMRN_DIAG
, &
d©a
);

4335 i‡(
ªt_vÆ
)

4336  
ªt_vÆ
;

4339 i‡(!(
d©a
 & 
IGP3_KMRN_DIAG_PCS_LOCK_LOSS
))

4343 
	`e1000_phy_hw_ª£t
(
hw
);

4344 
	`mdñay
(5);

4347 
phy_˘æ
 = 
	`î32
(
PHY_CTRL
);

4348 
phy_˘æ
 |(
E1000_PHY_CTRL_GBE_DISABLE
 |

4349 
E1000_PHY_CTRL_NOND0A_GBE_DISABLE
);

4350 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

4355 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
hw
);

4358  -
E1000_ERR_PHY
;

4359 
	}
}

4369 
	$e1000e_£t_km∫_lock_loss_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
,

4370 
boﬁ
 
°©e
)

4372 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

4374 i‡(
hw
->
mac
.
ty≥
 !
e1000_ich8œn
) {

4375 
	`e_dbg
("WorkaroundáppliesÅo ICH8 only.\n");

4379 
dev_•ec
->
km∫_lock_loss_w‹k¨ound_íabÀd
 = 
°©e
;

4380 
	}
}

4392 
	$e1000e_igp3_phy_powîdown_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
)

4394 
u32
 
ªg
;

4395 
u16
 
d©a
;

4396 
u8
 
ªåy
 = 0;

4398 i‡(
hw
->
phy
.
ty≥
 !
e1000_phy_igp_3
)

4404 
ªg
 = 
	`î32
(
PHY_CTRL
);

4405 
ªg
 |(
E1000_PHY_CTRL_GBE_DISABLE
 |

4406 
E1000_PHY_CTRL_NOND0A_GBE_DISABLE
);

4407 
	`ew32
(
PHY_CTRL
, 
ªg
);

4412 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

4413 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
hw
);

4416 
	`e1e_Ωhy
(
hw
, 
IGP3_VR_CTRL
, &
d©a
);

4417 
d©a
 &~
IGP3_VR_CTRL_DEV_POWERDOWN_MODE_MASK
;

4418 
	`e1e_wphy
(
hw
, 
IGP3_VR_CTRL
, 
d©a
 | 
IGP3_VR_CTRL_MODE_SHUTDOWN
);

4421 
	`e1e_Ωhy
(
hw
, 
IGP3_VR_CTRL
, &
d©a
);

4422 
d©a
 &
IGP3_VR_CTRL_DEV_POWERDOWN_MODE_MASK
;

4423 i‡((
d©a
 =
IGP3_VR_CTRL_MODE_SHUTDOWN
Ë|| 
ªåy
)

4427 
ªg
 = 
	`î32
(
CTRL
);

4428 
	`ew32
(
CTRL
, 
ªg
 | 
E1000_CTRL_PHY_RST
);

4429 
ªåy
++;

4430 } 
ªåy
);

4431 
	}
}

4443 
	$e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
)

4445 
s32
 
ªt_vÆ
;

4446 
u16
 
ªg_d©a
;

4448 i‡((
hw
->
mac
.
ty≥
 !
e1000_ich8œn
Ë|| (hw->
phy
.ty≥ =
e1000_phy_i„
))

4451 
ªt_vÆ
 = 
	`e1000e_ªad_km∫_ªg
(
hw
, 
E1000_KMRNCTRLSTA_DIAG_OFFSET
,

4452 &
ªg_d©a
);

4453 i‡(
ªt_vÆ
)

4455 
ªg_d©a
 |
E1000_KMRNCTRLSTA_DIAG_NELPBK
;

4456 
ªt_vÆ
 = 
	`e1000e_wrôe_km∫_ªg
(
hw
,

4457 
E1000_KMRNCTRLSTA_DIAG_OFFSET
,

4458 
ªg_d©a
);

4459 i‡(
ªt_vÆ
)

4461 
ªg_d©a
 &~
E1000_KMRNCTRLSTA_DIAG_NELPBK
;

4462 
	`e1000e_wrôe_km∫_ªg
(
hw
, 
E1000_KMRNCTRLSTA_DIAG_OFFSET
, 
ªg_d©a
);

4463 
	}
}

4479 
	$e1000_su•íd_w‹k¨ounds_ich8œn
(
e1000_hw
 *
hw
)

4481 
e1000_dev_•ec_ich8œn
 *
dev_•ec
 = &
hw
->dev_•ec.
ich8œn
;

4482 
u32
 
phy_˘æ
;

4483 
s32
 
ªt_vÆ
;

4485 
phy_˘æ
 = 
	`î32
(
PHY_CTRL
);

4486 
phy_˘æ
 |
E1000_PHY_CTRL_GBE_DISABLE
;

4488 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i217
) {

4489 
u16
 
phy_ªg
, 
devi˚_id
 = 
hw
->
ad≠ãr
->
pdev
->
devi˚
;

4491 i‡((
devi˚_id
 =
E1000_DEV_ID_PCH_LPTLP_I218_LM
) ||

4492 (
devi˚_id
 =
E1000_DEV_ID_PCH_LPTLP_I218_V
) ||

4493 (
devi˚_id
 =
E1000_DEV_ID_PCH_I218_LM3
) ||

4494 (
devi˚_id
 =
E1000_DEV_ID_PCH_I218_V3
)) {

4495 
u32
 
„xävm6
 = 
	`î32
(
FEXTNVM6
);

4497 
	`ew32
(
FEXTNVM6
, 
„xävm6
 & ~
E1000_FEXTNVM6_REQ_PLL_CLK
);

4500 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

4501 i‡(
ªt_vÆ
)

4502 
out
;

4504 i‡(!
dev_•ec
->
ìe_dißbÀ
) {

4505 
u16
 
ìe_advît
;

4507 
ªt_vÆ
 =

4508 
	`e1000_ªad_emi_ªg_locked
(
hw
,

4509 
I217_EEE_ADVERTISEMENT
,

4510 &
ìe_advît
);

4511 i‡(
ªt_vÆ
)

4512 
ªÀa£
;

4519 i‡((
ìe_advît
 & 
I82579_EEE_100_SUPPORTED
) &&

4520 (
dev_•ec
->
ìe_Õ_abûôy
 &

4521 
I82579_EEE_100_SUPPORTED
) &&

4522 (
hw
->
phy
.
aut⁄eg_advîti£d
 & 
ADVERTISE_100_FULL
)) {

4523 
phy_˘æ
 &~(
E1000_PHY_CTRL_D0A_LPLU
 |

4524 
E1000_PHY_CTRL_NOND0A_LPLU
);

4527 
	`e1e_Ωhy_locked
(
hw
,

4528 
I217_LPI_GPIO_CTRL
, &
phy_ªg
);

4529 
phy_ªg
 |
I217_LPI_GPIO_CTRL_AUTO_EN_LPI
;

4530 
	`e1e_wphy_locked
(
hw
,

4531 
I217_LPI_GPIO_CTRL
, 
phy_ªg
);

4542 i‡(!(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
)) {

4544 
	`e1e_Ωhy_locked
(
hw
, 
I217_PROXY_CTRL
, &
phy_ªg
);

4545 
phy_ªg
 |
I217_PROXY_CTRL_AUTO_DISABLE
;

4546 
	`e1e_wphy_locked
(
hw
, 
I217_PROXY_CTRL
, 
phy_ªg
);

4551 
	`e1e_Ωhy_locked
(
hw
, 
I217_SxCTRL
, &
phy_ªg
);

4552 
phy_ªg
 |
I217_SxCTRL_ENABLE_LPI_RESET
;

4553 
	`e1e_wphy_locked
(
hw
, 
I217_SxCTRL
, 
phy_ªg
);

4556 
	`e1e_Ωhy_locked
(
hw
, 
I217_MEMPWR
, &
phy_ªg
);

4557 
phy_ªg
 &~
I217_MEMPWR_DISABLE_SMB_RELEASE
;

4558 
	`e1e_wphy_locked
(
hw
, 
I217_MEMPWR
, 
phy_ªg
);

4564 
	`e1e_Ωhy_locked
(
hw
, 
I217_CGFREG
, &
phy_ªg
);

4565 
phy_ªg
 |
I217_CGFREG_ENABLE_MTA_RESET
;

4566 
	`e1e_wphy_locked
(
hw
, 
I217_CGFREG
, 
phy_ªg
);

4568 
ªÀa£
:

4569 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

4571 
out
:

4572 
	`ew32
(
PHY_CTRL
, 
phy_˘æ
);

4574 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

4575 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
hw
);

4577 i‡(
hw
->
mac
.
ty≥
 >
e1000_pchœn
) {

4578 
	`e1000_€m_bôs_c⁄fig_ich8œn
(
hw
, 
Ál£
);

4581 i‡(
hw
->
mac
.
ty≥
 =
e1000_pchœn
)

4582 
	`e1000e_phy_hw_ª£t_gíîic
(
hw
);

4584 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

4585 i‡(
ªt_vÆ
)

4587 
	`e1000_wrôe_smbus_addr
(
hw
);

4588 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

4590 
	}
}

4602 
	$e1000_ªsume_w‹k¨ounds_pchœn
(
e1000_hw
 *
hw
)

4604 
s32
 
ªt_vÆ
;

4606 i‡(
hw
->
mac
.
ty≥
 < 
e1000_pch2œn
)

4609 
ªt_vÆ
 = 
	`e1000_öô_phy_w‹k¨ounds_pchœn
(
hw
);

4610 i‡(
ªt_vÆ
) {

4611 
	`e_dbg
("FaûedÅÿöô PHY flowÑë_vÆ=%d\n", 
ªt_vÆ
);

4620 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i217
) {

4621 
u16
 
phy_ªg
;

4623 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

4624 i‡(
ªt_vÆ
) {

4625 
	`e_dbg
("FailedÅo setup iRST\n");

4630 
	`e1e_Ωhy_locked
(
hw
, 
I217_LPI_GPIO_CTRL
, &
phy_ªg
);

4631 
phy_ªg
 &~
I217_LPI_GPIO_CTRL_AUTO_EN_LPI
;

4632 
	`e1e_wphy_locked
(
hw
, 
I217_LPI_GPIO_CTRL
, 
phy_ªg
);

4634 i‡(!(
	`î32
(
FWSM
Ë& 
E1000_ICH_FWSM_FW_VALID
)) {

4638 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
I217_MEMPWR
, &
phy_ªg
);

4639 i‡(
ªt_vÆ
)

4640 
ªÀa£
;

4641 
phy_ªg
 |
I217_MEMPWR_DISABLE_SMB_RELEASE
;

4642 
	`e1e_wphy_locked
(
hw
, 
I217_MEMPWR
, 
phy_ªg
);

4645 
	`e1e_wphy_locked
(
hw
, 
I217_PROXY_CTRL
, 0);

4648 
ªt_vÆ
 = 
	`e1e_Ωhy_locked
(
hw
, 
I217_CGFREG
, &
phy_ªg
);

4649 i‡(
ªt_vÆ
)

4650 
ªÀa£
;

4651 
phy_ªg
 &~
I217_CGFREG_ENABLE_MTA_RESET
;

4652 
	`e1e_wphy_locked
(
hw
, 
I217_CGFREG
, 
phy_ªg
);

4653 
ªÀa£
:

4654 i‡(
ªt_vÆ
)

4655 
	`e_dbg
("Eº‹ %d i¿ªsumêw‹k¨ounds\n", 
ªt_vÆ
);

4656 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

4658 
	}
}

4666 
s32
 
	$e1000_˛ónup_Àd_ich8œn
(
e1000_hw
 *
hw
)

4668 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

4669  
	`e1e_wphy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL_LED
, 0);

4671 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_deÁu…
);

4673 
	}
}

4681 
s32
 
	$e1000_Àd_⁄_ich8œn
(
e1000_hw
 *
hw
)

4683 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

4684  
	`e1e_wphy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL_LED
,

4685 (
IFE_PSCL_PROBE_MODE
 | 
IFE_PSCL_PROBE_LEDS_ON
));

4687 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_mode2
);

4689 
	}
}

4697 
s32
 
	$e1000_Àd_off_ich8œn
(
e1000_hw
 *
hw
)

4699 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_i„
)

4700  
	`e1e_wphy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL_LED
,

4701 (
IFE_PSCL_PROBE_MODE
 |

4702 
IFE_PSCL_PROBE_LEDS_OFF
));

4704 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_mode1
);

4706 
	}
}

4714 
s32
 
	$e1000_£tup_Àd_pchœn
(
e1000_hw
 *
hw
)

4716  
	`e1e_wphy
(
hw
, 
HV_LED_CONFIG
, (
u16
)hw->
mac
.
Àd˘l_mode1
);

4717 
	}
}

4725 
s32
 
	$e1000_˛ónup_Àd_pchœn
(
e1000_hw
 *
hw
)

4727  
	`e1e_wphy
(
hw
, 
HV_LED_CONFIG
, (
u16
)hw->
mac
.
Àd˘l_deÁu…
);

4728 
	}
}

4736 
s32
 
	$e1000_Àd_⁄_pchœn
(
e1000_hw
 *
hw
)

4738 
u16
 
d©a
 = (u16)
hw
->
mac
.
Àd˘l_mode2
;

4739 
u32
 
i
, 
Àd
;

4744 i‡(!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
)) {

4745 
i
 = 0; i < 3; i++) {

4746 
Àd
 = (
d©a
 >> (
i
 * 5)Ë& 
E1000_PHY_LED0_MASK
;

4747 i‡((
Àd
 & 
E1000_PHY_LED0_MODE_MASK
) !=

4748 
E1000_LEDCTL_MODE_LINK_UP
)

4750 i‡(
Àd
 & 
E1000_PHY_LED0_IVRT
)

4751 
d©a
 &~(
E1000_PHY_LED0_IVRT
 << (
i
 * 5));

4753 
d©a
 |(
E1000_PHY_LED0_IVRT
 << (
i
 * 5));

4757  
	`e1e_wphy
(
hw
, 
HV_LED_CONFIG
, 
d©a
);

4758 
	}
}

4766 
s32
 
	$e1000_Àd_off_pchœn
(
e1000_hw
 *
hw
)

4768 
u16
 
d©a
 = (u16)
hw
->
mac
.
Àd˘l_mode1
;

4769 
u32
 
i
, 
Àd
;

4774 i‡(!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
)) {

4775 
i
 = 0; i < 3; i++) {

4776 
Àd
 = (
d©a
 >> (
i
 * 5)Ë& 
E1000_PHY_LED0_MASK
;

4777 i‡((
Àd
 & 
E1000_PHY_LED0_MODE_MASK
) !=

4778 
E1000_LEDCTL_MODE_LINK_UP
)

4780 i‡(
Àd
 & 
E1000_PHY_LED0_IVRT
)

4781 
d©a
 &~(
E1000_PHY_LED0_IVRT
 << (
i
 * 5));

4783 
d©a
 |(
E1000_PHY_LED0_IVRT
 << (
i
 * 5));

4787  
	`e1e_wphy
(
hw
, 
HV_LED_CONFIG
, 
d©a
);

4788 
	}
}

4802 
s32
 
	$e1000_gë_cfg_d⁄e_ich8œn
(
e1000_hw
 *
hw
)

4804 
s32
 
ªt_vÆ
 = 0;

4805 
u32
 
b™k
 = 0;

4806 
u32
 
°©us
;

4808 
	`e1000e_gë_cfg_d⁄e_gíîic
(
hw
);

4811 i‡(
hw
->
mac
.
ty≥
 >
e1000_ich10œn
) {

4812 
	`e1000_œn_öô_d⁄e_ich8œn
(
hw
);

4814 
ªt_vÆ
 = 
	`e1000e_gë_auto_rd_d⁄e
(
hw
);

4815 i‡(
ªt_vÆ
) {

4820 
	`e_dbg
("Auto Read Done didÇot complete\n");

4821 
ªt_vÆ
 = 0;

4826 
°©us
 = 
	`î32
(
STATUS
);

4827 i‡(
°©us
 & 
E1000_STATUS_PHYRA
)

4828 
	`ew32
(
STATUS
, 
°©us
 & ~
E1000_STATUS_PHYRA
);

4830 
	`e_dbg
("PHY Reset AssertedÇot set -Çeeds delay\n");

4833 i‡(
hw
->
mac
.
ty≥
 <
e1000_ich9œn
) {

4834 i‡(!(
	`î32
(
EECD
Ë& 
E1000_EECD_PRES
) &&

4835 (
hw
->
phy
.
ty≥
 =
e1000_phy_igp_3
)) {

4836 
	`e1000e_phy_öô_s¸ùt_igp3
(
hw
);

4839 i‡(
	`e1000_vÆid_nvm_b™k_dëe˘_ich8œn
(
hw
, &
b™k
)) {

4841 
	`e_dbg
("EEPROMÇotÖresent\n");

4842 
ªt_vÆ
 = -
E1000_ERR_CONFIG
;

4846  
ªt_vÆ
;

4847 
	}
}

4856 
	$e1000_powî_down_phy_c›≥r_ich8œn
(
e1000_hw
 *
hw
)

4859 i‡(!(
hw
->
mac
.
›s
.
	`check_mng_mode
(hw) ||

4860 
hw
->
phy
.
›s
.
	`check_ª£t_block
(hw)))

4861 
	`e1000_powî_down_phy_c›≥r
(
hw
);

4862 
	}
}

4871 
	$e1000_˛ór_hw_˙ås_ich8œn
(
e1000_hw
 *
hw
)

4873 
u16
 
phy_d©a
;

4874 
s32
 
ªt_vÆ
;

4876 
	`e1000e_˛ór_hw_˙ås_ba£
(
hw
);

4878 
	`î32
(
ALGNERRC
);

4879 
	`î32
(
RXERRC
);

4880 
	`î32
(
TNCRS
);

4881 
	`î32
(
CEXTERR
);

4882 
	`î32
(
TSCTC
);

4883 
	`î32
(
TSCTFC
);

4885 
	`î32
(
MGTPRC
);

4886 
	`î32
(
MGTPDC
);

4887 
	`î32
(
MGTPTC
);

4889 
	`î32
(
IAC
);

4890 
	`î32
(
ICRXOC
);

4893 i‡((
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) ||

4894 (
hw
->
phy
.
ty≥
 =
e1000_phy_82579
) ||

4895 (
hw
->
phy
.
ty≥
 =
e1000_phy_i217
) ||

4896 (
hw
->
phy
.
ty≥
 =
e1000_phy_82577
)) {

4897 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

4898 i‡(
ªt_vÆ
)

4900 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`£t_∑ge
(hw,

4901 
HV_STATS_PAGE
 << 
IGP_PAGE_SHIFT
);

4902 i‡(
ªt_vÆ
)

4903 
ªÀa£
;

4904 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_SCC_UPPER
, &
phy_d©a
);

4905 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_SCC_LOWER
, &
phy_d©a
);

4906 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_ECOL_UPPER
, &
phy_d©a
);

4907 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_ECOL_LOWER
, &
phy_d©a
);

4908 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_MCC_UPPER
, &
phy_d©a
);

4909 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_MCC_LOWER
, &
phy_d©a
);

4910 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_LATECOL_UPPER
, &
phy_d©a
);

4911 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_LATECOL_LOWER
, &
phy_d©a
);

4912 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_COLC_UPPER
, &
phy_d©a
);

4913 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_COLC_LOWER
, &
phy_d©a
);

4914 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_DC_UPPER
, &
phy_d©a
);

4915 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_DC_LOWER
, &
phy_d©a
);

4916 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_TNCRS_UPPER
, &
phy_d©a
);

4917 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_TNCRS_LOWER
, &
phy_d©a
);

4918 
ªÀa£
:

4919 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

4921 
	}
}

4923 c⁄° 
e1000_mac_›î©i⁄s
 
	gich8_mac_›s
 = {

4925 .
check_f‹_lök
 = 
e1000_check_f‹_c›≥r_lök_ich8œn
,

4927 .
	g˛ór_hw_˙ås
 = 
e1000_˛ór_hw_˙ås_ich8œn
,

4928 .
	ggë_bus_öfo
 = 
e1000_gë_bus_öfo_ich8œn
,

4929 .
	g£t_œn_id
 = 
e1000_£t_œn_id_sögÀ_p‹t
,

4930 .
	ggë_lök_up_öfo
 = 
e1000_gë_lök_up_öfo_ich8œn
,

4933 .
	gupd©e_mc_addr_li°
 = 
e1000e_upd©e_mc_addr_li°_gíîic
,

4934 .
	gª£t_hw
 = 
e1000_ª£t_hw_ich8œn
,

4935 .
	göô_hw
 = 
e1000_öô_hw_ich8œn
,

4936 .
	g£tup_lök
 = 
e1000_£tup_lök_ich8œn
,

4937 .
	g£tup_physiˇl_öãrÁ˚
 = 
e1000_£tup_c›≥r_lök_ich8œn
,

4939 .
	gc⁄fig_cﬁlisi⁄_di°
 = 
e1000e_c⁄fig_cﬁlisi⁄_di°_gíîic
,

4940 .
	gør_£t
 = 
e1000e_ør_£t_gíîic
,

4941 .
	gvÆid©e_mdi_£âög
 = 
e1000e_vÆid©e_mdi_£âög_gíîic
,

4944 c⁄° 
e1000_phy_›î©i⁄s
 
	gich8_phy_›s
 = {

4945 .
acquúe
 = 
e1000_acquúe_swÊag_ich8œn
,

4946 .
	gcheck_ª£t_block
 = 
e1000_check_ª£t_block_ich8œn
,

4947 .
	gcommô
 = 
NULL
,

4948 .
	ggë_cfg_d⁄e
 = 
e1000_gë_cfg_d⁄e_ich8œn
,

4949 .
	ggë_ˇbÀ_Àngth
 = 
e1000e_gë_ˇbÀ_Àngth_igp_2
,

4950 .
	gªad_ªg
 = 
e1000e_ªad_phy_ªg_igp
,

4951 .
	gªÀa£
 = 
e1000_ªÀa£_swÊag_ich8œn
,

4952 .
	gª£t
 = 
e1000_phy_hw_ª£t_ich8œn
,

4953 .
	g£t_d0_Õlu_°©e
 = 
e1000_£t_d0_Õlu_°©e_ich8œn
,

4954 .
	g£t_d3_Õlu_°©e
 = 
e1000_£t_d3_Õlu_°©e_ich8œn
,

4955 .
	gwrôe_ªg
 = 
e1000e_wrôe_phy_ªg_igp
,

4958 c⁄° 
e1000_nvm_›î©i⁄s
 
	gich8_nvm_›s
 = {

4959 .
acquúe
 = 
e1000_acquúe_nvm_ich8œn
,

4960 .
	gªad
 = 
e1000_ªad_nvm_ich8œn
,

4961 .
	gªÀa£
 = 
e1000_ªÀa£_nvm_ich8œn
,

4962 .
	gªlﬂd
 = 
e1000e_ªlﬂd_nvm_gíîic
,

4963 .
	gupd©e
 = 
e1000_upd©e_nvm_checksum_ich8œn
,

4964 .
	gvÆid_Àd_deÁu…
 = 
e1000_vÆid_Àd_deÁu…_ich8œn
,

4965 .
	gvÆid©e
 = 
e1000_vÆid©e_nvm_checksum_ich8œn
,

4966 .
	gwrôe
 = 
e1000_wrôe_nvm_ich8œn
,

4969 c⁄° 
e1000_öfo
 
	ge1000_ich8_öfo
 = {

4970 .
mac
 = 
e1000_ich8œn
,

4971 .
	gÊags
 = 
FLAG_HAS_WOL


4972 | 
FLAG_IS_ICH


4973 #i‚de‡
HAVE_NDO_SET_FEATURES


4974 | 
FLAG_RX_CSUM_ENABLED


4976 | 
FLAG_HAS_CTRLEXT_ON_LOAD


4977 | 
FLAG_HAS_AMT


4978 | 
FLAG_HAS_FLASH


4979 | 
FLAG_APME_IN_WUC
,

4980 .
	gpba
 = 8,

4981 .
	gmax_hw_‰ame_size
 = 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
,

4982 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

4983 .
	gmac_›s
 = &
ich8_mac_›s
,

4984 .
	gphy_›s
 = &
ich8_phy_›s
,

4985 .
	gnvm_›s
 = &
ich8_nvm_›s
,

4988 c⁄° 
e1000_öfo
 
	ge1000_ich9_öfo
 = {

4989 .
mac
 = 
e1000_ich9œn
,

4990 .
	gÊags
 = 
FLAG_HAS_JUMBO_FRAMES


4991 | 
FLAG_IS_ICH


4992 | 
FLAG_HAS_WOL


4993 #i‚de‡
HAVE_NDO_SET_FEATURES


4994 | 
FLAG_RX_CSUM_ENABLED


4996 | 
FLAG_HAS_CTRLEXT_ON_LOAD


4997 | 
FLAG_HAS_AMT


4998 | 
FLAG_HAS_FLASH


4999 | 
FLAG_APME_IN_WUC
,

5000 .
	gpba
 = 18,

5001 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

5002 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

5003 .
	gmac_›s
 = &
ich8_mac_›s
,

5004 .
	gphy_›s
 = &
ich8_phy_›s
,

5005 .
	gnvm_›s
 = &
ich8_nvm_›s
,

5008 c⁄° 
e1000_öfo
 
	ge1000_ich10_öfo
 = {

5009 .
mac
 = 
e1000_ich10œn
,

5010 .
	gÊags
 = 
FLAG_HAS_JUMBO_FRAMES


5011 | 
FLAG_IS_ICH


5012 | 
FLAG_HAS_WOL


5013 #i‚de‡
HAVE_NDO_SET_FEATURES


5014 | 
FLAG_RX_CSUM_ENABLED


5016 | 
FLAG_HAS_CTRLEXT_ON_LOAD


5017 | 
FLAG_HAS_AMT


5018 | 
FLAG_HAS_FLASH


5019 | 
FLAG_APME_IN_WUC
,

5020 .
	gpba
 = 18,

5021 .
	gmax_hw_‰ame_size
 = 
DEFAULT_JUMBO
,

5022 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

5023 .
	gmac_›s
 = &
ich8_mac_›s
,

5024 .
	gphy_›s
 = &
ich8_phy_›s
,

5025 .
	gnvm_›s
 = &
ich8_nvm_›s
,

5028 c⁄° 
e1000_öfo
 
	ge1000_pch_öfo
 = {

5029 .
mac
 = 
e1000_pchœn
,

5030 .
	gÊags
 = 
FLAG_IS_ICH


5031 | 
FLAG_HAS_WOL


5032 #i‚de‡
HAVE_NDO_SET_FEATURES


5033 | 
FLAG_RX_CSUM_ENABLED


5035 | 
FLAG_HAS_CTRLEXT_ON_LOAD


5036 | 
FLAG_HAS_AMT


5037 | 
FLAG_HAS_FLASH


5038 | 
FLAG_HAS_JUMBO_FRAMES


5039 | 
FLAG_DISABLE_FC_PAUSE_TIME


5040 | 
FLAG_APME_IN_WUC
,

5041 .
	gÊags2
 = 
FLAG2_HAS_PHY_STATS
,

5042 .
	gpba
 = 26,

5043 .
	gmax_hw_‰ame_size
 = 4096,

5044 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

5045 .
	gmac_›s
 = &
ich8_mac_›s
,

5046 .
	gphy_›s
 = &
ich8_phy_›s
,

5047 .
	gnvm_›s
 = &
ich8_nvm_›s
,

5050 c⁄° 
e1000_öfo
 
	ge1000_pch2_öfo
 = {

5051 .
mac
 = 
e1000_pch2œn
,

5052 .
	gÊags
 = 
FLAG_IS_ICH


5053 | 
FLAG_HAS_WOL


5054 | 
FLAG_HAS_HW_TIMESTAMP


5055 #i‚de‡
HAVE_NDO_SET_FEATURES


5056 | 
FLAG_RX_CSUM_ENABLED


5058 | 
FLAG_HAS_CTRLEXT_ON_LOAD


5059 | 
FLAG_HAS_AMT


5060 | 
FLAG_HAS_FLASH


5061 | 
FLAG_HAS_JUMBO_FRAMES


5062 | 
FLAG_APME_IN_WUC
,

5063 .
	gÊags2
 = 
FLAG2_HAS_PHY_STATS


5064 | 
FLAG2_HAS_EEE
,

5065 .
	gpba
 = 26,

5066 .
	gmax_hw_‰ame_size
 = 9018,

5067 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

5068 .
	gmac_›s
 = &
ich8_mac_›s
,

5069 .
	gphy_›s
 = &
ich8_phy_›s
,

5070 .
	gnvm_›s
 = &
ich8_nvm_›s
,

5073 c⁄° 
e1000_öfo
 
	ge1000_pch_Õt_öfo
 = {

5074 .
mac
 = 
e1000_pch_Õt
,

5075 .
	gÊags
 = 
FLAG_IS_ICH


5076 | 
FLAG_HAS_WOL


5077 | 
FLAG_HAS_HW_TIMESTAMP


5078 #i‚de‡
HAVE_NDO_SET_FEATURES


5079 | 
FLAG_RX_CSUM_ENABLED


5081 | 
FLAG_HAS_CTRLEXT_ON_LOAD


5082 | 
FLAG_HAS_AMT


5083 | 
FLAG_HAS_FLASH


5084 | 
FLAG_HAS_JUMBO_FRAMES


5085 | 
FLAG_APME_IN_WUC
,

5086 .
	gÊags2
 = 
FLAG2_HAS_PHY_STATS


5087 | 
FLAG2_HAS_EEE
,

5088 .
	gpba
 = 26,

5089 .
	gmax_hw_‰ame_size
 = 9018,

5090 .
	ggë_v¨ü¡s
 = 
e1000_gë_v¨ü¡s_ich8œn
,

5091 .
	gmac_›s
 = &
ich8_mac_›s
,

5092 .
	gphy_›s
 = &
ich8_phy_›s
,

5093 .
	gnvm_›s
 = &
ich8_nvm_›s
,

	@ich8lan.h

29 #i‚de‡
_E1000E_ICH8LAN_H_


30 
	#_E1000E_ICH8LAN_H_


	)

32 
	#ICH_FLASH_GFPREG
 0x0000

	)

33 
	#ICH_FLASH_HSFSTS
 0x0004

	)

34 
	#ICH_FLASH_HSFCTL
 0x0006

	)

35 
	#ICH_FLASH_FADDR
 0x0008

	)

36 
	#ICH_FLASH_FDATA0
 0x0010

	)

39 
	#ICH_FLASH_READ_COMMAND_TIMEOUT
 10000000

	)

40 
	#ICH_FLASH_WRITE_COMMAND_TIMEOUT
 10000000

	)

41 
	#ICH_FLASH_ERASE_COMMAND_TIMEOUT
 10000000

	)

42 
	#ICH_FLASH_LINEAR_ADDR_MASK
 0x00FFFFFF

	)

43 
	#ICH_FLASH_CYCLE_REPEAT_COUNT
 10

	)

45 
	#ICH_CYCLE_READ
 0

	)

46 
	#ICH_CYCLE_WRITE
 2

	)

47 
	#ICH_CYCLE_ERASE
 3

	)

49 
	#FLASH_GFPREG_BASE_MASK
 0x1FFF

	)

50 
	#FLASH_SECTOR_ADDR_SHIFT
 12

	)

52 
	#ICH_FLASH_SEG_SIZE_256
 256

	)

53 
	#ICH_FLASH_SEG_SIZE_4K
 4096

	)

54 
	#ICH_FLASH_SEG_SIZE_8K
 8192

	)

55 
	#ICH_FLASH_SEG_SIZE_64K
 65536

	)

57 
	#E1000_ICH_FWSM_RSPCIPHY
 0x00000040

	)

59 
	#E1000_ICH_FWSM_FW_VALID
 0x00008000

	)

60 
	#E1000_ICH_FWSM_PCIM2PCI
 0x01000000

	)

61 
	#E1000_ICH_FWSM_PCIM2PCI_COUNT
 2000

	)

63 
	#E1000_ICH_MNG_IAMT_MODE
 0x2

	)

65 
	#E1000_FWSM_WLOCK_MAC_MASK
 0x0380

	)

66 
	#E1000_FWSM_WLOCK_MAC_SHIFT
 7

	)

67 
	#E1000_FWSM_ULP_CFG_DONE
 0x00000400

	)

70 
	#E1000_SHRAL_PCH_LPT
(
_i
Ë(0x05408 + ((_iË* 8))

	)

71 
	#E1000_SHRAH_PCH_LPT
(
_i
Ë(0x0540C + ((_iË* 8))

	)

73 
	#E1000_H2ME
 0x05B50

	)

74 
	#E1000_H2ME_ULP
 0x00000800

	)

75 
	#E1000_H2ME_ENFORCE_SETTINGS
 0x00001000

	)

77 
	#ID_LED_DEFAULT_ICH8LAN
 ((
ID_LED_DEF1_DEF2
 << 12) | \

78 (
ID_LED_OFF1_OFF2
 << 8) | \

79 (
ID_LED_OFF1_ON2
 << 4) | \

80 (
ID_LED_DEF1_DEF2
))

	)

82 
	#E1000_ICH_NVM_SIG_WORD
 0x13

	)

83 
	#E1000_ICH_NVM_SIG_MASK
 0xC000

	)

84 
	#E1000_ICH_NVM_VALID_SIG_MASK
 0xC0

	)

85 
	#E1000_ICH_NVM_SIG_VALUE
 0x80

	)

87 
	#E1000_ICH8_LAN_INIT_TIMEOUT
 1500

	)

90 
	#E1000_FEXT_PHY_CABLE_DISCONNECTED
 0x00000004

	)

92 
	#E1000_FEXTNVM_SW_CONFIG
 1

	)

93 
	#E1000_FEXTNVM_SW_CONFIG_ICH8M
 (1 << 27Ë

	)

95 
	#E1000_FEXTNVM3_PHY_CFG_COUNTER_MASK
 0x0C000000

	)

96 
	#E1000_FEXTNVM3_PHY_CFG_COUNTER_50MSEC
 0x08000000

	)

98 
	#E1000_FEXTNVM4_BEACON_DURATION_MASK
 0x7

	)

99 
	#E1000_FEXTNVM4_BEACON_DURATION_8USEC
 0x7

	)

100 
	#E1000_FEXTNVM4_BEACON_DURATION_16USEC
 0x3

	)

102 
	#E1000_FEXTNVM6_REQ_PLL_CLK
 0x00000100

	)

103 
	#E1000_FEXTNVM6_ENABLE_K1_ENTRY_CONDITION
 0x00000200

	)

105 
	#E1000_FEXTNVM7_DISABLE_SMB_PERST
 0x00000020

	)

107 
	#PCIE_ICH8_SNOOP_ALL
 
PCIE_NO_SNOOP_ALL


	)

109 
	#E1000_ICH_RAR_ENTRIES
 7

	)

110 
	#E1000_PCH2_RAR_ENTRIES
 11

	)

111 
	#E1000_PCH_LPT_RAR_ENTRIES
 12

	)

113 
	#PHY_PAGE_SHIFT
 5

	)

114 
	#PHY_REG
(
∑ge
, 
ªg
Ë((’ageË<< 
PHY_PAGE_SHIFT
) | \

115 ((
ªg
Ë& 
MAX_PHY_REG_ADDRESS
))

	)

116 
	#IGP3_KMRN_DIAG
 
	`PHY_REG
(770, 19Ë

	)

117 
	#IGP3_VR_CTRL
 
	`PHY_REG
(776, 18Ë

	)

119 
	#IGP3_KMRN_DIAG_PCS_LOCK_LOSS
 0x0002

	)

120 
	#IGP3_VR_CTRL_DEV_POWERDOWN_MODE_MASK
 0x0300

	)

121 
	#IGP3_VR_CTRL_MODE_SHUTDOWN
 0x0200

	)

124 
	#BM_PORT_GEN_CFG
 
	`PHY_REG
(
BM_PORT_CTRL_PAGE
, 17)

	)

125 
	#BM_RCTL
 
	`PHY_REG
(
BM_WUC_PAGE
, 0)

	)

126 
	#BM_WUC
 
	`PHY_REG
(
BM_WUC_PAGE
, 1)

	)

127 
	#BM_WUFC
 
	`PHY_REG
(
BM_WUC_PAGE
, 2)

	)

128 
	#BM_WUS
 
	`PHY_REG
(
BM_WUC_PAGE
, 3)

	)

129 
	#BM_RAR_L
(
_i
Ë(
	`BM_PHY_REG
(
BM_WUC_PAGE
, 16 + ((_iË<< 2)))

	)

130 
	#BM_RAR_M
(
_i
Ë(
	`BM_PHY_REG
(
BM_WUC_PAGE
, 17 + ((_iË<< 2)))

	)

131 
	#BM_RAR_H
(
_i
Ë(
	`BM_PHY_REG
(
BM_WUC_PAGE
, 18 + ((_iË<< 2)))

	)

132 
	#BM_RAR_CTRL
(
_i
Ë(
	`BM_PHY_REG
(
BM_WUC_PAGE
, 19 + ((_iË<< 2)))

	)

133 
	#BM_MTA
(
_i
Ë(
	`BM_PHY_REG
(
BM_WUC_PAGE
, 128 + ((_iË<< 1)))

	)

135 
	#BM_RCTL_UPE
 0x0001

	)

136 
	#BM_RCTL_MPE
 0x0002

	)

137 
	#BM_RCTL_MO_SHIFT
 3

	)

138 
	#BM_RCTL_MO_MASK
 (3 << 3Ë

	)

139 
	#BM_RCTL_BAM
 0x0020

	)

140 
	#BM_RCTL_PMCF
 0x0040

	)

141 
	#BM_RCTL_RFCE
 0x0080

	)

143 
	#HV_LED_CONFIG
 
	`PHY_REG
(768, 30Ë

	)

144 
	#HV_MUX_DATA_CTRL
 
	`PHY_REG
(776, 16)

	)

145 
	#HV_MUX_DATA_CTRL_GEN_TO_MAC
 0x0400

	)

146 
	#HV_MUX_DATA_CTRL_FORCE_SPEED
 0x0004

	)

147 
	#HV_STATS_PAGE
 778

	)

149 
	#HV_SCC_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 16Ë

	)

150 
	#HV_SCC_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 17)

	)

151 
	#HV_ECOL_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 18Ë

	)

152 
	#HV_ECOL_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 19)

	)

153 
	#HV_MCC_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 20Ë

	)

154 
	#HV_MCC_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 21)

	)

155 
	#HV_LATECOL_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 23Ë

	)

156 
	#HV_LATECOL_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 24)

	)

157 
	#HV_COLC_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 25Ë

	)

158 
	#HV_COLC_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 26)

	)

159 
	#HV_DC_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 27Ë

	)

160 
	#HV_DC_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 28)

	)

161 
	#HV_TNCRS_UPPER
 
	`PHY_REG
(
HV_STATS_PAGE
, 29Ë

	)

162 
	#HV_TNCRS_LOWER
 
	`PHY_REG
(
HV_STATS_PAGE
, 30)

	)

164 
	#E1000_FCRTV_PCH
 0x05F40

	)

166 
	#E1000_NVM_K1_CONFIG
 0x1B

	)

167 
	#E1000_NVM_K1_ENABLE
 0x1

	)

170 
	#CV_SMB_CTRL
 
	`PHY_REG
(769, 23)

	)

171 
	#CV_SMB_CTRL_FORCE_SMBUS
 0x0001

	)

174 
	#I218_ULP_CONFIG1
 
	`PHY_REG
(779, 16)

	)

175 
	#I218_ULP_CONFIG1_START
 0x0001

	)

176 
	#I218_ULP_CONFIG1_IND
 0x0004

	)

177 
	#I218_ULP_CONFIG1_STICKY_ULP
 0x0010

	)

178 
	#I218_ULP_CONFIG1_INBAND_EXIT
 0x0020

	)

179 
	#I218_ULP_CONFIG1_WOL_HOST
 0x0040

	)

180 
	#I218_ULP_CONFIG1_RESET_TO_SMBUS
 0x0100

	)

181 
	#I218_ULP_CONFIG1_DISABLE_SMB_PERST
 0x1000

	)

184 
	#HV_SMB_ADDR
 
	`PHY_REG
(768, 26)

	)

185 
	#HV_SMB_ADDR_MASK
 0x007F

	)

186 
	#HV_SMB_ADDR_PEC_EN
 0x0200

	)

187 
	#HV_SMB_ADDR_VALID
 0x0080

	)

188 
	#HV_SMB_ADDR_FREQ_MASK
 0x1100

	)

189 
	#HV_SMB_ADDR_FREQ_LOW_SHIFT
 8

	)

190 
	#HV_SMB_ADDR_FREQ_HIGH_SHIFT
 12

	)

193 
	#E1000_STRAP
 0x0000C

	)

194 
	#E1000_STRAP_SMBUS_ADDRESS_MASK
 0x00FE0000

	)

195 
	#E1000_STRAP_SMBUS_ADDRESS_SHIFT
 17

	)

196 
	#E1000_STRAP_SMT_FREQ_MASK
 0x00003000

	)

197 
	#E1000_STRAP_SMT_FREQ_SHIFT
 12

	)

200 
	#HV_OEM_BITS
 
	`PHY_REG
(768, 25)

	)

201 
	#HV_OEM_BITS_LPLU
 0x0004

	)

202 
	#HV_OEM_BITS_GBE_DIS
 0x0040

	)

203 
	#HV_OEM_BITS_RESTART_AN
 0x0400

	)

206 
	#HV_KMRN_MODE_CTRL
 
	`PHY_REG
(769, 16)

	)

207 
	#HV_KMRN_MDIO_SLOW
 0x0400

	)

210 
	#HV_KMRN_FIFO_CTRLSTA
 
	`PHY_REG
(770, 16)

	)

211 
	#HV_KMRN_FIFO_CTRLSTA_PREAMBLE_MASK
 0x7000

	)

212 
	#HV_KMRN_FIFO_CTRLSTA_PREAMBLE_SHIFT
 12

	)

215 
	#HV_PM_CTRL
 
	`PHY_REG
(770, 17)

	)

216 
	#HV_PM_CTRL_PLL_STOP_IN_K1_GIGA
 0x100

	)

217 
	#HV_PM_CTRL_K1_ENABLE
 0x4000

	)

219 
	#SW_FLAG_TIMEOUT
 1000

	)

222 
	#I217_INBAND_CTRL
 
	`PHY_REG
(770, 18)

	)

223 
	#I217_INBAND_CTRL_LINK_STAT_TX_TIMEOUT_MASK
 0x3F00

	)

224 
	#I217_INBAND_CTRL_LINK_STAT_TX_TIMEOUT_SHIFT
 8

	)

227 
	#I217_LPI_GPIO_CTRL
 
	`PHY_REG
(772, 18)

	)

228 
	#I217_LPI_GPIO_CTRL_AUTO_EN_LPI
 0x0800

	)

231 
	#I82579_LPI_CTRL
 
	`PHY_REG
(772, 20)

	)

232 
	#I82579_LPI_CTRL_100_ENABLE
 0x2000

	)

233 
	#I82579_LPI_CTRL_1000_ENABLE
 0x4000

	)

234 
	#I82579_LPI_CTRL_ENABLE_MASK
 0x6000

	)

235 
	#I82579_LPI_CTRL_FORCE_PLL_LOCK_COUNT
 0x80

	)

238 
	#I82579_DFT_CTRL
 
	`PHY_REG
(769, 20)

	)

239 
	#I82579_DFT_CTRL_GATE_PHY_RESET
 0x0040

	)

242 
	#I82579_EMI_ADDR
 0x10

	)

243 
	#I82579_EMI_DATA
 0x11

	)

244 
	#I82579_LPI_UPDATE_TIMER
 0x4805

	)

245 
	#I82579_MSE_THRESHOLD
 0x084F

	)

246 
	#I82577_MSE_THRESHOLD
 0x0887

	)

247 
	#I82579_MSE_LINK_DOWN
 0x2411

	)

248 
	#I82579_RX_CONFIG
 0x3412

	)

249 
	#I82579_EEE_PCS_STATUS
 0x182E

	)

250 
	#I82579_EEE_CAPABILITY
 0x0410

	)

251 
	#I82579_EEE_ADVERTISEMENT
 0x040E

	)

252 
	#I82579_EEE_LP_ABILITY
 0x040F

	)

253 
	#I82579_EEE_100_SUPPORTED
 (1 << 1Ë

	)

254 
	#I82579_EEE_1000_SUPPORTED
 (1 << 2Ë

	)

255 
	#I217_EEE_PCS_STATUS
 0x9401

	)

256 
	#I217_EEE_CAPABILITY
 0x8000

	)

257 
	#I217_EEE_ADVERTISEMENT
 0x8001

	)

258 
	#I217_EEE_LP_ABILITY
 0x8002

	)

260 
	#E1000_EEE_RX_LPI_RCVD
 0x0400

	)

261 
	#E1000_EEE_TX_LPI_RCVD
 0x0800

	)

264 
	#I217_PROXY_CTRL
 
	`BM_PHY_REG
(
BM_WUC_PAGE
, 70)

	)

265 
	#I217_PROXY_CTRL_AUTO_DISABLE
 0x0080

	)

266 
	#I217_SxCTRL
 
	`PHY_REG
(
BM_PORT_CTRL_PAGE
, 28)

	)

267 
	#I217_SxCTRL_ENABLE_LPI_RESET
 0x1000

	)

268 
	#I217_CGFREG
 
	`PHY_REG
(772, 29)

	)

269 
	#I217_CGFREG_ENABLE_MTA_RESET
 0x0002

	)

270 
	#I217_MEMPWR
 
	`PHY_REG
(772, 26)

	)

271 
	#I217_MEMPWR_DISABLE_SMB_RELEASE
 0x0010

	)

274 
	#E1000_PCH_RAICC
(
_n
Ë(0x05F50 + ((_nË* 4))

	)

277 
	#E1000_LTRV
 0x000F8

	)

278 
	#E1000_LTRV_SCALE_MAX
 5

	)

279 
	#E1000_LTRV_SCALE_FACTOR
 5

	)

280 
	#E1000_LTRV_REQ_SHIFT
 15

	)

281 
	#E1000_LTRV_NOSNOOP_SHIFT
 16

	)

282 
	#E1000_LTRV_SEND
 (1 << 30)

	)

285 
	#E1000_PCI_LTR_CAP_LPT
 0xA8

	)

287 
	#E1000_PCI_REVISION_ID_REG
 0x08

	)

288 
e1000e_£t_km∫_lock_loss_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
,

289 
boﬁ
 
°©e
);

290 
e1000e_igp3_phy_powîdown_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
);

291 
e1000e_gig_downshi·_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
);

292 
e1000_su•íd_w‹k¨ounds_ich8œn
(
e1000_hw
 *
hw
);

293 
e1000_ªsume_w‹k¨ounds_pchœn
(
e1000_hw
 *
hw
);

294 
s32
 
e1000_c⁄figuª_k1_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
k1_íabÀ
);

295 
e1000_c›y_rx_addrs_to_phy_ich8œn
(
e1000_hw
 *
hw
);

296 
s32
 
e1000_lv_jumbo_w‹k¨ound_ich8œn
(
e1000_hw
 *
hw
, 
boﬁ
 
íabÀ
);

297 
s32
 
e1000_ªad_emi_ªg_locked
(
e1000_hw
 *
hw
, 
u16
 
addr
, u16 *
d©a
);

298 
s32
 
e1000_wrôe_emi_ªg_locked
(
e1000_hw
 *
hw
, 
u16
 
addr
, u16 
d©a
);

299 
s32
 
e1000_£t_ìe_pchœn
(
e1000_hw
 *
hw
);

300 
s32
 
e1000_íabÀ_uÕ_Õt_Õ
(
e1000_hw
 *
hw
, 
boﬁ
 
to_sx
);

301 
s32
 
e1000_dißbÀ_uÕ_Õt_Õ
(
e1000_hw
 *
hw
, 
boﬁ
 
f‹˚
);

	@kcompat.c

29 
	~"e1000.h
"

30 
	~"kcom∑t.h
"

33 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,8) )

35 
	~<asm/div64.h
>

37 
	$skù_©oi
(c⁄° **
s
)

39 
i
 = 0;

41 
	`isdigô
(**
s
))

42 
i
 = i * 10 + *((*
s
)++) - '0';

43  
i
;

44 
	}
}

46 
	#_kc_ZEROPAD
 1

	)

47 
	#_kc_SIGN
 2

	)

48 
	#_kc_PLUS
 4

	)

49 
	#_kc_SPACE
 8

	)

50 
	#_kc_LEFT
 16

	)

51 
	#_kc_SPECIAL
 32

	)

52 
	#_kc_LARGE
 64

	)

54 *
	$numbî
(*
buf
, *
íd
, 
num
, 
ba£
, 
size
,

55 
¥ecisi⁄
, 
ty≥
)

57 
c
, 
sign
, 
tmp
[66];

58 c⁄° *
digôs
;

59 c⁄° 
smÆl_digôs
[] = "0123456789abcdefghijklmnopqrstuvwxyz";

60 c⁄° 
œrge_digôs
[] = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ";

61 
i
;

63 
digôs
 = (
ty≥
 & 
_kc_LARGE
Ë? 
œrge_digôs
 : 
smÆl_digôs
;

64 i‡(
ty≥
 & 
_kc_LEFT
)

65 
ty≥
 &~
_kc_ZEROPAD
;

66 i‡(
ba£
 < 2 || base > 36)

68 
c
 = (
ty≥
 & 
_kc_ZEROPAD
) ? '0' : ' ';

69 
sign
 = 0;

70 i‡(
ty≥
 & 
_kc_SIGN
) {

71 i‡(
num
 < 0) {

72 
sign
 = '-';

73 
num
 = -num;

74 
size
--;

75 } i‡(
ty≥
 & 
_kc_PLUS
) {

76 
sign
 = '+';

77 
size
--;

78 } i‡(
ty≥
 & 
_kc_SPACE
) {

79 
sign
 = ' ';

80 
size
--;

83 i‡(
ty≥
 & 
_kc_SPECIAL
) {

84 i‡(
ba£
 == 16)

85 
size
 -= 2;

86 i‡(
ba£
 == 8)

87 
size
--;

89 
i
 = 0;

90 i‡(
num
 == 0)

91 
tmp
[
i
++] = '0';

93 
num
 != 0)

94 
tmp
[
i
++] = 
digôs
[
	`do_div
(
num
, 
ba£
)];

95 i‡(
i
 > 
¥ecisi⁄
)

96 
¥ecisi⁄
 = 
i
;

97 
size
 -
¥ecisi⁄
;

98 i‡(!(
ty≥
 & (
_kc_ZEROPAD
 + 
_kc_LEFT
))) {

99 
size
-- > 0) {

100 i‡(
buf
 <
íd
)

101 *
buf
 = ' ';

102 ++
buf
;

105 i‡(
sign
) {

106 i‡(
buf
 <
íd
)

107 *
buf
 = 
sign
;

108 ++
buf
;

110 i‡(
ty≥
 & 
_kc_SPECIAL
) {

111 i‡(
ba£
 == 8) {

112 i‡(
buf
 <
íd
)

113 *
buf
 = '0';

114 ++
buf
;

115 } i‡(
ba£
 == 16) {

116 i‡(
buf
 <
íd
)

117 *
buf
 = '0';

118 ++
buf
;

119 i‡(
buf
 <
íd
)

120 *
buf
 = 
digôs
[33];

121 ++
buf
;

124 i‡(!(
ty≥
 & 
_kc_LEFT
)) {

125 
size
-- > 0) {

126 i‡(
buf
 <
íd
)

127 *
buf
 = 
c
;

128 ++
buf
;

131 
i
 < 
¥ecisi⁄
--) {

132 i‡(
buf
 <
íd
)

133 *
buf
 = '0';

134 ++
buf
;

136 
i
-- > 0) {

137 i‡(
buf
 <
íd
)

138 *
buf
 = 
tmp
[
i
];

139 ++
buf
;

141 
size
-- > 0) {

142 i‡(
buf
 <
íd
)

143 *
buf
 = ' ';

144 ++
buf
;

146  
buf
;

147 
	}
}

149 
	$_kc_v¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, 
va_li°
 
¨gs
)

151 
Àn
;

152 
num
;

153 
i
, 
ba£
;

154 *
°r
, *
íd
, 
c
;

155 c⁄° *
s
;

157 
Êags
;

159 
fõld_width
;

160 
¥ecisi⁄
;

162 
quÆifõr
;

166 
°r
 = 
buf
;

167 
íd
 = 
buf
 + 
size
 - 1;

169 i‡(
íd
 < 
buf
 - 1) {

170 
íd
 = ((*)-1);

171 
size
 = 
íd
 - 
buf
 + 1;

174 ; *
fmt
; ++fmt) {

175 i‡(*
fmt
 != '%') {

176 i‡(
°r
 <
íd
)

177 *
°r
 = *
fmt
;

178 ++
°r
;

183 
Êags
 = 0;

184 
ª≥©
:

185 ++
fmt
;

186 *
fmt
) {

188 
Êags
 |
_kc_LEFT
;

189 
ª≥©
;

191 
Êags
 |
_kc_PLUS
;

192 
ª≥©
;

194 
Êags
 |
_kc_SPACE
;

195 
ª≥©
;

197 
Êags
 |
_kc_SPECIAL
;

198 
ª≥©
;

200 
Êags
 |
_kc_ZEROPAD
;

201 
ª≥©
;

205 
fõld_width
 = -1;

206 i‡(
	`isdigô
(*
fmt
))

207 
fõld_width
 = 
	`skù_©oi
(&
fmt
);

208 i‡(*
fmt
 == '*') {

209 ++
fmt
;

211 
fõld_width
 = 
	`va_¨g
(
¨gs
, );

212 i‡(
fõld_width
 < 0) {

213 
fõld_width
 = -field_width;

214 
Êags
 |
_kc_LEFT
;

219 
¥ecisi⁄
 = -1;

220 i‡(*
fmt
 == '.') {

221 ++
fmt
;

222 i‡(
	`isdigô
(*
fmt
))

223 
¥ecisi⁄
 = 
	`skù_©oi
(&
fmt
);

224 i‡(*
fmt
 == '*') {

225 ++
fmt
;

227 
¥ecisi⁄
 = 
	`va_¨g
(
¨gs
, );

229 i‡(
¥ecisi⁄
 < 0)

230 
¥ecisi⁄
 = 0;

234 
quÆifõr
 = -1;

235 i‡(*
fmt
 == 'h' || *fmt == 'l' || *fmt == 'L' || *fmt == 'Z') {

236 
quÆifõr
 = *
fmt
;

237 ++
fmt
;

241 
ba£
 = 10;

243 *
fmt
) {

245 i‡(!(
Êags
 & 
_kc_LEFT
)) {

246 --
fõld_width
 > 0) {

247 i‡(
°r
 <
íd
)

248 *
°r
 = ' ';

249 ++
°r
;

252 
c
 = ()
	`va_¨g
(
¨gs
, );

253 i‡(
°r
 <
íd
)

254 *
°r
 = 
c
;

255 ++
°r
;

256 --
fõld_width
 > 0) {

257 i‡(
°r
 <
íd
)

258 *
°r
 = ' ';

259 ++
°r
;

264 
s
 = 
	`va_¨g
(
¨gs
, *);

265 i‡(!
s
)

266 
s
 = "<NULL>";

268 
Àn
 = 
	`°∫Àn
(
s
, 
¥ecisi⁄
);

270 i‡(!(
Êags
 & 
_kc_LEFT
)) {

271 
Àn
 < 
fõld_width
--) {

272 i‡(
°r
 <
íd
)

273 *
°r
 = ' ';

274 ++
°r
;

277 
i
 = 0; i < 
Àn
; ++i) {

278 i‡(
°r
 <
íd
)

279 *
°r
 = *
s
;

280 ++
°r
;

281 ++
s
;

283 
Àn
 < 
fõld_width
--) {

284 i‡(
°r
 <
íd
)

285 *
°r
 = ' ';

286 ++
°r
;

291 i‡(
fõld_width
 == -1) {

292 
fõld_width
 = 2 * (*);

293 
Êags
 |
_kc_ZEROPAD
;

295 
°r
 = 
	`numbî
(°r, 
íd
,

296 ()
	`va_¨g
(
¨gs
, *),

297 16, 
fõld_width
, 
¥ecisi⁄
, 
Êags
);

303 i‡(
quÆifõr
 == 'l') {

304 *
ù
 = 
	`va_¨g
(
¨gs
, *);

305 *
ù
 = (
°r
 - 
buf
);

306 } i‡(
quÆifõr
 == 'Z') {

307 
size_t
 *
ù
 = 
	`va_¨g
(
¨gs
, size_t *);

308 *
ù
 = (
°r
 - 
buf
);

310 *
ù
 = 
	`va_¨g
(
¨gs
, *);

311 *
ù
 = (
°r
 - 
buf
);

316 i‡(
°r
 <
íd
)

317 *
°r
 = '%';

318 ++
°r
;

323 
ba£
 = 8;

327 
Êags
 |
_kc_LARGE
;

329 
ba£
 = 16;

334 
Êags
 |
_kc_SIGN
;

339 i‡(
°r
 <
íd
)

340 *
°r
 = '%';

341 ++
°r
;

342 i‡(*
fmt
) {

343 i‡(
°r
 <
íd
)

344 *
°r
 = *
fmt
;

345 ++
°r
;

347 --
fmt
;

351 i‡(
quÆifõr
 == 'L')

352 
num
 = 
	`va_¨g
(
¨gs
, );

353 i‡(
quÆifõr
 == 'l') {

354 
num
 = 
	`va_¨g
(
¨gs
, );

355 i‡(
Êags
 & 
_kc_SIGN
)

356 
num
 = (signed )num;

357 } i‡(
quÆifõr
 == 'Z') {

358 
num
 = 
	`va_¨g
(
¨gs
, 
size_t
);

359 } i‡(
quÆifõr
 == 'h') {

360 
num
 = ()
	`va_¨g
(
¨gs
, );

361 i‡(
Êags
 & 
_kc_SIGN
)

362 
num
 = (signed )num;

364 
num
 = 
	`va_¨g
(
¨gs
, );

365 i‡(
Êags
 & 
_kc_SIGN
)

366 
num
 = (signed )num;

368 
°r
 = 
	`numbî
(°r, 
íd
, 
num
, 
ba£
,

369 
fõld_width
, 
¥ecisi⁄
, 
Êags
);

371 i‡(
°r
 <
íd
)

372 *
°r
 = '\0';

373 i‡(
size
 > 0)

375 *
íd
 = '\0';

379  
°r
 - 
buf
;

380 
	}
}

382 
	$_kc_¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, ...)

384 
va_li°
 
¨gs
;

385 
i
;

387 
	`va_°¨t
(
¨gs
, 
fmt
);

388 
i
 = 
	`_kc_v¢¥ötf
(
buf
, 
size
, 
fmt
, 
¨gs
);

389 
	`va_íd
(
¨gs
);

390  
i
;

391 
	}
}

395 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,13) )

400 #i‡
deföed
(
CONFIG_HIGHMEM
)

402 #i‚de‡
PCI_DRAM_OFFSET


403 
	#PCI_DRAM_OFFSET
 0

	)

406 
u64


407 
	$_kc_pci_m≠_∑ge
(
pci_dev
 *
dev
, 
∑ge
 *∑ge, 
off£t
,

408 
size_t
 
size
, 
dúe˘i⁄
)

410  (((
u64
)(
∑ge
 - 
mem_m≠
Ë<< 
PAGE_SHIFT
Ë+ 
off£t
 +

411 
PCI_DRAM_OFFSET
);

412 
	}
}

416 
u64


417 
	$_kc_pci_m≠_∑ge
(
pci_dev
 *
dev
, 
∑ge
 *∑ge, 
off£t
,

418 
size_t
 
size
, 
dúe˘i⁄
)

420  
	`pci_m≠_sögÀ
(
dev
, (*)
	`∑ge_addªss
(
∑ge
Ë+ 
off£t
, 
size
,

421 
dúe˘i⁄
);

422 
	}
}

427 
	$_kc_pci_unm≠_∑ge
(
pci_dev
 *
dev
, 
u64
 
dma_addr
, 
size_t
 
size
,

428 
dúe˘i⁄
)

430  
	`pci_unm≠_sögÀ
(
dev
, 
dma_addr
, 
size
, 
dúe˘i⁄
);

431 
	}
}

436 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,3) )

441 
	$_kc_pci_£t_dma_mask
(
pci_dev
 *
dev
, 
dma_addr_t
 
mask
)

443 i‡(!
	`pci_dma_suµ‹ãd
(
dev
, 
mask
))

444  -
EIO
;

445 
dev
->
dma_mask
 = 
mask
;

447 
	}
}

449 
	$_kc_pci_ªque°_ªgi⁄s
(
pci_dev
 *
dev
, *
ªs_«me
)

451 
i
;

453 
i
 = 0; i < 6; i++) {

454 i‡(
	`pci_ªsour˚_Àn
(
dev
, 
i
) == 0)

457 i‡(
	`pci_ªsour˚_Êags
(
dev
, 
i
Ë& 
IORESOURCE_IO
) {

458 i‡(!
ªque°_ªgi⁄


459 (
	`pci_ªsour˚_°¨t
(
dev
, 
i
),

460 
	`pci_ªsour˚_Àn
(
dev
, 
i
), 
ªs_«me
)) {

461 
	`pci_ªÀa£_ªgi⁄s
(
dev
);

462  -
EBUSY
;

464 } i‡(
	`pci_ªsour˚_Êags
(
dev
, 
i
Ë& 
IORESOURCE_MEM
) {

465 i‡(!
ªque°_mem_ªgi⁄


466 (
	`pci_ªsour˚_°¨t
(
dev
, 
i
),

467 
	`pci_ªsour˚_Àn
(
dev
, 
i
), 
ªs_«me
)) {

468 
	`pci_ªÀa£_ªgi⁄s
(
dev
);

469  -
EBUSY
;

474 
	}
}

476 
	$_kc_pci_ªÀa£_ªgi⁄s
(
pci_dev
 *
dev
)

478 
i
;

480 
i
 = 0; i < 6; i++) {

481 i‡(
	`pci_ªsour˚_Àn
(
dev
, 
i
) == 0)

484 i‡(
	`pci_ªsour˚_Êags
(
dev
, 
i
Ë& 
IORESOURCE_IO
)

485 
	`ªÀa£_ªgi⁄
(
	`pci_ªsour˚_°¨t
(
dev
, 
i
),

486 
	`pci_ªsour˚_Àn
(
dev
, 
i
));

488 i‡(
	`pci_ªsour˚_Êags
(
dev
, 
i
Ë& 
IORESOURCE_MEM
)

489 
	`ªÀa£_mem_ªgi⁄
(
	`pci_ªsour˚_°¨t
(
dev
, 
i
),

490 
	`pci_ªsour˚_Àn
(
dev
, 
i
));

492 
	}
}

497 
√t_devi˚
 *
	$_kc_Æloc_ëhîdev
(
sizeof_¥iv
)

499 
√t_devi˚
 *
dev
;

500 
Æloc_size
;

502 
Æloc_size
 = (*
dev
Ë+ 
sizeof_¥iv
 + 
IFNAMSIZ
 + 31;

503 
dev
 = 
	`kzÆloc
(
Æloc_size
, 
GFP_KERNEL
);

504 i‡(!
dev
)

505  
NULL
;

507 i‡(
sizeof_¥iv
)

508 
dev
->
¥iv
 = (*)((()(dev + 1) + 31) & ~31);

509 
dev
->
«me
[0] = '\0';

510 
	`ëhî_£tup
(
dev
);

512  
dev
;

513 
	}
}

515 
	$_kc_is_vÆid_ëhî_addr
(
u8
 *
addr
)

517 c⁄° 
zaddr
[6] = { 0, };

519  !(
addr
[0] & 1Ë&& 
	`memcmp
◊ddr, 
zaddr
, 6);

520 
	}
}

525 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,6) )

527 
	$_kc_pci_£t_powî_°©e
(
pci_dev
 *
dev
, 
°©e
)

530 
	}
}

532 
	$_kc_pci_íabÀ_wake
(
pci_dev
 *
pdev
, 
u32
 
°©e
, 
íabÀ
)

535 
	}
}

540 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0) )

541 
	$_kc_skb_fûl_∑ge_desc
(
sk_buff
 *
skb
, 
i
, 
∑ge
 *page,

542 
off
, 
size
)

544 
skb_‰ag_t
 *
‰ag
 = &
	`skb_shöfo
(
skb
)->
‰ags
[
i
];

545 
‰ag
->
∑ge
 =Öage;

546 
‰ag
->
∑ge_off£t
 = 
off
;

547 
‰ag
->
size
 = size;

548 
	`skb_shöfo
(
skb
)->
ƒ_‰ags
 = 
i
 + 1;

549 
	}
}

565 
	$föd_√xt_bô
(c⁄° *
addr
, 
size
,

566 
off£t
)

568 c⁄° *
p
 = 
addr
 + 
	`BITOP_WORD
(
off£t
);

569 
ªsu…
 = 
off£t
 & ~(
BITS_PER_LONG
 - 1);

570 
tmp
;

572 i‡(
off£t
 >
size
)

573  
size
;

574 
size
 -
ªsu…
;

575 
off£t
 %
BITS_PER_LONG
;

576 i‡(
off£t
) {

577 
tmp
 = *(
p
++);

578 
tmp
 &(~0UL << 
off£t
);

579 i‡(
size
 < 
BITS_PER_LONG
)

580 
found_fú°
;

581 i‡(
tmp
)

582 
found_middÀ
;

583 
size
 -
BITS_PER_LONG
;

584 
ªsu…
 +
BITS_PER_LONG
;

586 
size
 & ~(
BITS_PER_LONG
 - 1)) {

587 i‡((
tmp
 = *(
p
++)))

588 
found_middÀ
;

589 
ªsu…
 +
BITS_PER_LONG
;

590 
size
 -
BITS_PER_LONG
;

592 i‡(!
size
)

593  
ªsu…
;

594 
tmp
 = *
p
;

596 
found_fú°
:

597 
tmp
 &(~0UL >> (
BITS_PER_LONG
 - 
size
));

598 i‡(
tmp
 == 0UL)

599  
ªsu…
 + 
size
;

600 
found_middÀ
:

601  
ªsu…
 + 
	`ffs
(
tmp
);

602 
	}
}

604 
size_t
 
	$_kc_°æ˝y
(*
de°
, c⁄° *
§c
, 
size_t
 
size
)

606 
size_t
 
ªt
 = 
	`°æí
(
§c
);

608 i‡(
size
) {

609 
size_t
 
Àn
 = (
ªt
 >
size
) ? size - 1 :Ñet;

610 
	`mem˝y
(
de°
, 
§c
, 
Àn
);

611 
de°
[
Àn
] = '\0';

613  
ªt
;

614 
	}
}

616 #i‚de‡
do_div


617 #i‡
BITS_PER_LONG
 == 32

618 
uöt32_t
 
__©åibuã__
 ((
wók
)Ë
	$_kc__div64_32
(
uöt64_t
 * 
n
, 
uöt32_t
 
ba£
)

620 
uöt64_t
 
ªm
 = *
n
;

621 
uöt64_t
 
b
 = 
ba£
;

622 
uöt64_t
 
ªs
, 
d
 = 1;

623 
uöt32_t
 
high
 = 
ªm
 >> 32;

626 
ªs
 = 0;

627 i‡(
high
 >
ba£
) {

628 
high
 /
ba£
;

629 
ªs
 = (
uöt64_t
Ë
high
 << 32;

630 
ªm
 -(
uöt64_t
Ë(
high
 * 
ba£
) << 32;

633 (
öt64_t
Ë
b
 > 0 && b < 
ªm
) {

634 
b
 = b + b;

635 
d
 = d + d;

639 i‡(
ªm
 >
b
) {

640 
ªm
 -
b
;

641 
ªs
 +
d
;

643 
b
 >>= 1;

644 
d
 >>= 1;

645 } 
d
);

647 *
n
 = 
ªs
;

648  
ªm
;

649 
	}
}

655 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,4) )

656 
	$_kc_s˙¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, ...)

658 
va_li°
 
¨gs
;

659 
i
;

661 
	`va_°¨t
(
¨gs
, 
fmt
);

662 
i
 = 
	`v¢¥ötf
(
buf
, 
size
, 
fmt
, 
¨gs
);

663 
	`va_íd
(
¨gs
);

664  (
i
 >
size
) ? (size - 1) : i;

665 
	}
}

669 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,10) )

670 
DECLARE_BITMAP
(
_kcom∑t_node_⁄löe_m≠
, 
MAX_NUMNODES
) = {

675 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,13) )

676 *
	$_kc_k°rdup
(c⁄° *
s
, 
gÂ
)

678 
size_t
 
Àn
;

679 *
buf
;

681 i‡(!
s
)

682  
NULL
;

684 
Àn
 = 
	`°æí
(
s
) + 1;

685 
buf
 = 
	`kmÆloc
(
Àn
, 
gÂ
);

686 i‡(
buf
)

687 
	`mem˝y
(
buf
, 
s
, 
Àn
);

688  
buf
;

689 
	}
}

693 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,14) )

694 *
	$_kc_kzÆloc
(
size_t
 
size
, 
Êags
)

696 *
ªt
 = 
	`kmÆloc
(
size
, 
Êags
);

697 i‡(
ªt
)

698 
	`mem£t
(
ªt
, 0, 
size
);

699  
ªt
;

700 
	}
}

704 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,19) )

705 
	$_kc_skb_∑d
(
sk_buff
 *
skb
, 
∑d
)

707 
¡aû
;

710 i‡(!
	`skb_˛⁄ed
(
skb
Ë&& 
	`skb_èûroom
(skbË>
∑d
) {

711 
	`mem£t
(
skb
->
d©a
 + skb->
Àn
, 0, 
∑d
);

715 
¡aû
 = 
skb
->
d©a_Àn
 + 
∑d
 - (skb->
íd
 - skb->
èû
);

716 i‡(
	`likñy
(
	`skb_˛⁄ed
(
skb
Ë|| 
¡aû
 > 0)) {

717 i‡(
	`pskb_ex∑nd_hód
(
skb
, 0, 
¡aû
, 
GFP_ATOMIC
)) ;

718 
‰ì_skb
;

720 #ifde‡
MAX_SKB_FRAGS


721 i‡(
	`skb_is_n⁄löór
(
skb
Ë&& !
	`__pskb_puŒ_èû
(skb, skb->
d©a_Àn
))

722 
‰ì_skb
;

725 
	`mem£t
(
skb
->
d©a
 + skb->
Àn
, 0, 
∑d
);

728 
‰ì_skb
:

729 
	`k‰ì_skb
(
skb
);

730  -
ENOMEM
;

731 
	}
}

733 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(5,4)))

734 
	$_kc_pci_ßve_°©e
(
pci_dev
 *
pdev
)

736 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

737 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

738 
size
 = 
PCI_CONFIG_SPACE_LEN
, 
i
;

739 
u16
 
pcõ_ˇp_off£t
, 
pcõ_lök_°©us
;

741 #i‡–
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,0) )

743 
	`WARN_ON
(
pdev
->
dev
.
drivî_d©a
 =
NULL
);

745 
pcõ_ˇp_off£t
 = 
	`pci_föd_ˇ∑bûôy
(
pdev
, 
PCI_CAP_ID_EXP
);

746 i‡(
pcõ_ˇp_off£t
) {

747 i‡(!
	`pci_ªad_c⁄fig_w‹d
(
pdev
,

748 
pcõ_ˇp_off£t
 + 
PCIE_LINK_STATUS
,

749 &
pcõ_lök_°©us
))

750 
size
 = 
PCIE_CONFIG_SPACE_LEN
;

752 
	`pci_c⁄fig_•a˚_ich8œn
();

753 #ifde‡
HAVE_PCI_ERS


754 i‡(
ad≠ãr
->
c⁄fig_•a˚
 =
NULL
)

756 
	`WARN_ON
(
ad≠ãr
->
c⁄fig_•a˚
 !
NULL
);

758 
ad≠ãr
->
c⁄fig_•a˚
 = 
	`kmÆloc
(
size
, 
GFP_KERNEL
);

759 i‡(!
ad≠ãr
->
c⁄fig_•a˚
) {

760 
	`¥ötk
(
KERN_ERR
 "Out of memory inÖci_save_state\n");

761  -
ENOMEM
;

763 
i
 = 0; i < (
size
 / 4); i++)

764 
	`pci_ªad_c⁄fig_dw‹d
(
pdev
, 
i
 * 4, &
ad≠ãr
->
c⁄fig_•a˚
[i]);

766 
	}
}

768 
	$_kc_pci_ª°‹e_°©e
(
pci_dev
 *
pdev
)

770 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

771 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

772 
size
 = 
PCI_CONFIG_SPACE_LEN
, 
i
;

773 
u16
 
pcõ_ˇp_off£t
;

774 
u16
 
pcõ_lök_°©us
;

776 i‡(
ad≠ãr
->
c⁄fig_•a˚
 !
NULL
) {

777 
pcõ_ˇp_off£t
 = 
	`pci_föd_ˇ∑bûôy
(
pdev
, 
PCI_CAP_ID_EXP
);

778 i‡(
pcõ_ˇp_off£t
 &&

779 !
	`pci_ªad_c⁄fig_w‹d
(
pdev
,

780 
pcõ_ˇp_off£t
 + 
PCIE_LINK_STATUS
,

781 &
pcõ_lök_°©us
))

782 
size
 = 
PCIE_CONFIG_SPACE_LEN
;

784 
	`pci_c⁄fig_•a˚_ich8œn
();

785 
i
 = 0; i < (
size
 / 4); i++)

786 
	`pci_wrôe_c⁄fig_dw‹d
(
pdev
, 
i
 * 4,

787 
ad≠ãr
->
c⁄fig_•a˚
[
i
]);

788 #i‚de‡
HAVE_PCI_ERS


789 
	`k‰ì
(
ad≠ãr
->
c⁄fig_•a˚
);

790 
ad≠ãr
->
c⁄fig_•a˚
 = 
NULL
;

793 
	}
}

796 #ifde‡
HAVE_PCI_ERS


797 
	$_kc_‰ì_√tdev
(
√t_devi˚
 *
√tdev
)

799 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

801 i‡(
ad≠ãr
->
c⁄fig_•a˚
 !
NULL
)

802 
	`k‰ì
(
ad≠ãr
->
c⁄fig_•a˚
);

803 #ifde‡
CONFIG_SYSFS


804 i‡(
√tdev
->
ªg_°©e
 =
NETREG_UNINITIALIZED
) {

805 
	`k‰ì
((*)
√tdev
 -Çëdev->
∑dded
);

807 
	`BUG_ON
(
√tdev
->
ªg_°©e
 !
NETREG_UNREGISTERED
);

808 
√tdev
->
ªg_°©e
 = 
NETREG_RELEASED
;

809 
	`˛ass_devi˚_put
(&
√tdev
->
˛ass_dev
);

812 
	`k‰ì
((*)
√tdev
 -Çëdev->
∑dded
);

814 
	}
}

817 *
	$_kc_kmemdup
(c⁄° *
§c
, 
size_t
 
Àn
, 
gÂ
)

819 *
p
;

821 
p
 = 
	`kzÆloc
(
Àn
, 
gÂ
);

822 i‡(
p
)

823 
	`mem˝y
(
p
, 
§c
, 
Àn
);

824  
p
;

825 
	}
}

829 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,21) )

830 
pci_dev
 *
	$_kc_√tdev_to_pdev
(
√t_devi˚
 *
√tdev
)

832  ((
ad≠ãr_°ru˘
 *)
	`√tdev_¥iv
(
√tdev
))->
pdev
;

833 
	}
}

837 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,22) )

839 
	$_kc_hex_dump_to_buf„r
(c⁄° *
buf
, 
size_t
 
Àn
, 
rowsize
,

840 
groupsize
, *
löebuf
,

841 
size_t
 
löebuÊí
, 
boﬁ
 
ascii
)

843 c⁄° 
u8
 *
±r
 = 
buf
;

844 
u8
 
ch
;

845 
j
, 
lx
 = 0;

846 
ascii_cﬁumn
;

848 i‡(
rowsize
 != 16 &&Ñowsize != 32)

849 
rowsize
 = 16;

851 i‡(!
Àn
)

852 
nû
;

853 i‡(
Àn
 > 
rowsize
)

854 
Àn
 = 
rowsize
;

855 i‡((
Àn
 % 
groupsize
) != 0)

856 
groupsize
 = 1;

858 
groupsize
) {

860 c⁄° 
u64
 *
±r8
 = 
buf
;

861 
ngroups
 = 
Àn
 / 
groupsize
;

863 
j
 = 0; j < 
ngroups
; j++)

864 
lx
 +=

865 
	`s˙¥ötf
((*)(
löebuf
 + 
lx
),

866 
löebuÊí
 - 
lx
, "%s%16.16llx",

867 
j
 ? " " : "",

868 ()*(
±r8
 + 
j
));

869 
ascii_cﬁumn
 = 17 * 
ngroups
 + 2;

874 c⁄° 
u32
 *
±r4
 = 
buf
;

875 
ngroups
 = 
Àn
 / 
groupsize
;

877 
j
 = 0; j < 
ngroups
; j++)

878 
lx
 +=

879 
	`s˙¥ötf
((*)(
löebuf
 + 
lx
),

880 
löebuÊí
 - 
lx
, "%s%8.8x",

881 
j
 ? " " : "", *(
±r4
 + j));

882 
ascii_cﬁumn
 = 9 * 
ngroups
 + 2;

887 c⁄° 
u16
 *
±r2
 = 
buf
;

888 
ngroups
 = 
Àn
 / 
groupsize
;

890 
j
 = 0; j < 
ngroups
; j++)

891 
lx
 +=

892 
	`s˙¥ötf
((*)(
löebuf
 + 
lx
),

893 
löebuÊí
 - 
lx
, "%s%4.4x",

894 
j
 ? " " : "", *(
±r2
 + j));

895 
ascii_cﬁumn
 = 5 * 
ngroups
 + 2;

900 
j
 = 0; (j < 
Àn
Ë&& (
lx
 + 3Ë<
löebuÊí
; j++) {

901 
ch
 = 
±r
[
j
];

902 
löebuf
[
lx
++] = 
	`hex_asc
(
ch
 >> 4);

903 
löebuf
[
lx
++] = 
	`hex_asc
(
ch
 & 0x0f);

904 
löebuf
[
lx
++] = ' ';

906 i‡(
j
)

907 
lx
--;

909 
ascii_cﬁumn
 = 3 * 
rowsize
 + 2;

912 i‡(!
ascii
)

913 
nû
;

915 
lx
 < (
löebuÊí
 - 1Ë&&Üx < (
ascii_cﬁumn
 - 1))

916 
löebuf
[
lx
++] = ' ';

917 
j
 = 0; (j < 
Àn
Ë&& (
lx
 + 2Ë< 
löebuÊí
; j++)

918 
löebuf
[
lx
++] = (
	`ißscii
(
±r
[
j
]Ë&& 
	`i•röt
(ptr[j])) ?Ötr[j]

920 
nû
:

921 
löebuf
[
lx
++] = '\0';

922 
	}
}

924 
	$_kc_¥öt_hex_dump
(c⁄° *
Àvñ
,

925 c⁄° *
¥efix_°r
, 
¥efix_ty≥
,

926 
rowsize
, 
groupsize
,

927 c⁄° *
buf
, 
size_t
 
Àn
, 
boﬁ
 
ascii
)

929 c⁄° 
u8
 *
±r
 = 
buf
;

930 
i
, 
löñí
, 
ªmaöög
 = 
Àn
;

931 
löebuf
[200];

933 i‡(
rowsize
 != 16 &&Ñowsize != 32)

934 
rowsize
 = 16;

936 
i
 = 0; i < 
Àn
; i +
rowsize
) {

937 
löñí
 = 
	`mö
(
ªmaöög
, 
rowsize
);

938 
ªmaöög
 -
rowsize
;

939 
	`_kc_hex_dump_to_buf„r
(
±r
 + 
i
, 
löñí
, 
rowsize
, 
groupsize
,

940 
löebuf
, ÷öebuf), 
ascii
);

942 
¥efix_ty≥
) {

943 
DUMP_PREFIX_ADDRESS
:

944 
	`¥ötk
("%s%s%*p: %s\n", 
Àvñ
, 
¥efix_°r
,

945 ()(2 * (*)), 
±r
 + 
i
, 
löebuf
);

947 
DUMP_PREFIX_OFFSET
:

948 
	`¥ötk
("%s%s%.8x: %s\n", 
Àvñ
, 
¥efix_°r
, 
i
, 
löebuf
);

951 
	`¥ötk
("%s%s%s\n", 
Àvñ
, 
¥efix_°r
, 
löebuf
);

955 
	}
}

960 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,24) )

961 #ifde‡
NAPI


963 
	$__kc_ad≠ãr_˛ón
(
√t_devi˚
 *
√tdev
, *
budgë
)

965 
w‹k_d⁄e
;

966 
w‹k_to_do
 = 
	`mö
(*
budgë
, 
√tdev
->
quŸa
);

967 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

968 
«pi_°ru˘
 *
«pi
 = &
ad≠ãr
->napi;

969 
w‹k_d⁄e
 = 
«pi
->
	`pﬁl
“≠i, 
w‹k_to_do
);

970 *
budgë
 -
w‹k_d⁄e
;

971 
√tdev
->
quŸa
 -
w‹k_d⁄e
;

972  (
w‹k_d⁄e
 >
w‹k_to_do
) ? 1 : 0;

973 
	}
}

978 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,26) )

979 
	$_kc_pci_dißbÀ_lök_°©e
(
pci_dev
 *
pdev
, 
°©e
)

981 
pci_dev
 *
∑ª¡
 = 
pdev
->
bus
->
£lf
;

982 
u16
 
lök_°©e
;

983 
pos
;

985 i‡(!
∑ª¡
)

988 
pos
 = 
	`pci_föd_ˇ∑bûôy
(
∑ª¡
, 
PCI_CAP_ID_EXP
);

989 i‡(
pos
) {

990 
	`pci_ªad_c⁄fig_w‹d
(
∑ª¡
, 
pos
 + 
PCI_EXP_LNKCTL
, &
lök_°©e
);

991 
lök_°©e
 &~
°©e
;

992 
	`pci_wrôe_c⁄fig_w‹d
(
∑ª¡
, 
pos
 + 
PCI_EXP_LNKCTL
, 
lök_°©e
);

994 
	}
}

998 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,27) )

999 #ifde‡
HAVE_TX_MQ


1000 
	$_kc_√tif_tx_°›_Æl_queues
(
√t_devi˚
 *
√tdev
)

1002 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1003 
i
;

1005 
	`√tif_°›_queue
(
√tdev
);

1006 i‡(
	`√tif_is_mu…iqueue
(
√tdev
))

1007 
i
 = 0; i < 
ad≠ãr
->
num_tx_queues
; i++)

1008 
	`√tif_°›_subqueue
(
√tdev
, 
i
);

1009 
	}
}

1011 
	$_kc_√tif_tx_wake_Æl_queues
(
√t_devi˚
 *
√tdev
)

1013 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1014 
i
;

1016 
	`√tif_wake_queue
(
√tdev
);

1017 i‡(
	`√tif_is_mu…iqueue
(
√tdev
))

1018 
i
 = 0; i < 
ad≠ãr
->
num_tx_queues
; i++)

1019 
	`√tif_wake_subqueue
(
√tdev
, 
i
);

1020 
	}
}

1022 
	$_kc_√tif_tx_°¨t_Æl_queues
(
√t_devi˚
 *
√tdev
)

1024 
ad≠ãr_°ru˘
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1025 
i
;

1027 
	`√tif_°¨t_queue
(
√tdev
);

1028 i‡(
	`√tif_is_mu…iqueue
(
√tdev
))

1029 
i
 = 0; i < 
ad≠ãr
->
num_tx_queues
; i++)

1030 
	`√tif_°¨t_subqueue
(
√tdev
, 
i
);

1031 
	}
}

1034 #i‚de‡
__WARN_¥ötf


1035 
	$__kc_w¨n_¶ow∑th
(c⁄° *
fûe
, 
löe
, c⁄° *
fmt
, ...)

1037 
va_li°
 
¨gs
;

1039 
	`¥ötk
(
KERN_WARNING
 "------------[ cut here ]------------\n");

1040 
	`¥ötk
(
KERN_WARNING
 "WARNING:áà%s:%d %s()\n", 
fûe
, 
löe
);

1041 
	`va_°¨t
(
¨gs
, 
fmt
);

1042 
	`v¥ötk
(
fmt
, 
¨gs
);

1043 
	`va_íd
(
¨gs
);

1045 
	`dump_°ack
();

1046 
	}
}

1051 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,28) )

1053 
	$_kc_pci_¥ï¨e_to_¶ìp
(
pci_dev
 *
dev
)

1055 
pci_powî_t
 
èrgë_°©e
;

1056 
îr‹
;

1058 
èrgë_°©e
 = 
	`pci_choo£_°©e
(
dev
, 
PMSG_SUSPEND
);

1060 
	`pci_íabÀ_wake
(
dev
, 
èrgë_°©e
, 
åue
);

1062 
îr‹
 = 
	`pci_£t_powî_°©e
(
dev
, 
èrgë_°©e
);

1064 i‡(
îr‹
)

1065 
	`pci_íabÀ_wake
(
dev
, 
èrgë_°©e
, 
Ál£
);

1067  
îr‹
;

1068 
	}
}

1070 
	$_kc_pci_wake_‰om_d3
(
pci_dev
 *
dev
, 
boﬁ
 
íabÀ
)

1072 
îr
;

1074 
îr
 = 
	`pci_íabÀ_wake
(
dev
, 
PCI_D3cﬁd
, 
íabÀ
);

1075 i‡(
îr
)

1076 
out
;

1078 
îr
 = 
	`pci_íabÀ_wake
(
dev
, 
PCI_D3hŸ
, 
íabÀ
);

1080 
out
:

1081  
îr
;

1082 
	}
}

1086 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,29) )

1087 
	$__kc_pci_£t_ma°î
(
pci_dev
 *
pdev
, 
boﬁ
 
íabÀ
)

1089 
u16
 
ﬁd_cmd
, 
cmd
;

1091 
	`pci_ªad_c⁄fig_w‹d
(
pdev
, 
PCI_COMMAND
, &
ﬁd_cmd
);

1092 i‡(
íabÀ
)

1093 
cmd
 = 
ﬁd_cmd
 | 
PCI_COMMAND_MASTER
;

1095 
cmd
 = 
ﬁd_cmd
 & ~
PCI_COMMAND_MASTER
;

1096 i‡(
cmd
 !
ﬁd_cmd
) {

1097 
	`dev_dbg
(
	`pci_dev_to_dev
(
pdev
), "%s bus mastering\n",

1098 
íabÀ
 ? "enabling" : "disabling");

1099 
	`pci_wrôe_c⁄fig_w‹d
(
pdev
, 
PCI_COMMAND
, 
cmd
);

1101 #i‡–
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,7) )

1102 
pdev
->
is_busma°î
 = 
íabÀ
;

1104 
	}
}

1106 
	$_kc_pci_˛ór_ma°î
(
pci_dev
 *
dev
)

1108 
	`__kc_pci_£t_ma°î
(
dev
, 
Ál£
);

1109 
	}
}

1112 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,34) )

1113 #i‡(
RHEL_RELEASE_CODE
 < 
RHEL_RELEASE_VERSION
(6,0))

1114 
	$_kc_pci_num_vf
(
pci_dev
 *
dev
)

1116 
num_vf
 = 0;

1117 #ifde‡
CONFIG_PCI_IOV


1118 
pci_dev
 *
vfdev
;

1121 
vfdev
 = 
	`pci_gë_˛ass
(
PCI_CLASS_NETWORK_ETHERNET
 << 8, 
NULL
);

1122 
vfdev
) {

1123 i‡(
vfdev
->
is_vút‚
 && vfdev->
phys‚
 =
dev
)

1124 
num_vf
++;

1126 
vfdev
 = 
	`pci_gë_˛ass
(
PCI_CLASS_NETWORK_ETHERNET
 << 8, vfdev);

1130  
num_vf
;

1131 
	}
}

1135 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,35) )

1139 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,36) )

1140 c⁄° 
u32
 
	g_kc_Êags_dup_„©uªs
 =

1141 (
ETH_FLAG_LRO
 | 
ETH_FLAG_NTUPLE
 | 
ETH_FLAG_RXHASH
);

1143 
u32
 
	$_kc_ëhtoﬁ_›_gë_Êags
(
√t_devi˚
 *
dev
)

1145  
dev
->
„©uªs
 & 
_kc_Êags_dup_„©uªs
;

1146 
	}
}

1148 
	$_kc_ëhtoﬁ_›_£t_Êags
(
√t_devi˚
 *
dev
, 
u32
 
d©a
, u32 
suµ‹ãd
)

1150 i‡(
d©a
 & ~
suµ‹ãd
)

1151  -
EINVAL
;

1153 
dev
->
„©uªs
 = ((dev->„©uª†& ~
_kc_Êags_dup_„©uªs
) |

1154 (
d©a
 & 
_kc_Êags_dup_„©uªs
));

1156 
	}
}

1160 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,39) )

1161 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE > 
RHEL_RELEASE_VERSION
(6,0)))

1167 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,4,0) )

1168 
	$_kc_skb_add_rx_‰ag
(
sk_buff
 *
skb
, 
i
, 
∑ge
 *page,

1169 
off
, 
size
, 
åuesize
)

1171 
	`skb_fûl_∑ge_desc
(
skb
, 
i
, 
∑ge
, 
off
, 
size
);

1172 
skb
->
Àn
 +
size
;

1173 
skb
->
d©a_Àn
 +
size
;

1174 
skb
->
åuesize
 +=Åruesize;

1175 
	}
}

1180 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,7,0) )

1181 #i‡!(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
SLE_VERSION
(11,3,0))

1182 
ölöe
 
	$__kc_pcõ_ˇp_vîsi⁄
(
pci_dev
 *
dev
)

1184 
pos
;

1185 
u16
 
ªg16
;

1187 
pos
 = 
	`pci_föd_ˇ∑bûôy
(
dev
, 
PCI_CAP_ID_EXP
);

1188 i‡(!
pos
)

1190 
	`pci_ªad_c⁄fig_w‹d
(
dev
, 
pos
 + 
PCI_EXP_FLAGS
, &
ªg16
);

1191  
ªg16
 & 
PCI_EXP_FLAGS_VERS
;

1192 
	}
}

1194 
ölöe
 
boﬁ
 
	$__kc_pcõ_ˇp_has_dev˘l
(c⁄° 
pci_dev
 
__Æways_unu£d


1195 *
dev
)

1197  
åue
;

1198 
	}
}

1200 
ölöe
 
boﬁ
 
	$__kc_pcõ_ˇp_has_ k˘l
(
pci_dev
 *
dev
)

1202 
ty≥
 = 
	`pci_pcõ_ty≥
(
dev
);

1204  
	`__kc_pcõ_ˇp_vîsi⁄
(
dev
) > 1 ||

1205 
ty≥
 =
PCI_EXP_TYPE_ROOT_PORT
 ||

1206 
ty≥
 =
PCI_EXP_TYPE_ENDPOINT
 ||Åy≥ =
PCI_EXP_TYPE_LEG_END
;

1207 
	}
}

1209 
ölöe
 
boﬁ
 
	$__kc_pcõ_ˇp_has_¶t˘l
(
pci_dev
 *
dev
)

1211 
ty≥
 = 
	`pci_pcõ_ty≥
(
dev
);

1212 
pos
;

1213 
u16
 
pcõ_Êags_ªg
;

1215 
pos
 = 
	`pci_föd_ˇ∑bûôy
(
dev
, 
PCI_CAP_ID_EXP
);

1216 i‡(!
pos
)

1218 
	`pci_ªad_c⁄fig_w‹d
(
dev
, 
pos
 + 
PCI_EXP_FLAGS
, &
pcõ_Êags_ªg
);

1220  
	`__kc_pcõ_ˇp_vîsi⁄
(
dev
) > 1 ||

1221 
ty≥
 =
PCI_EXP_TYPE_ROOT_PORT
 ||

1222 (
ty≥
 =
PCI_EXP_TYPE_DOWNSTREAM
 &&

1223 
pcõ_Êags_ªg
 & 
PCI_EXP_FLAGS_SLOT
);

1224 
	}
}

1226 
ölöe
 
boﬁ
 
	$__kc_pcõ_ˇp_has_π˘l
(
pci_dev
 *
dev
)

1228 
ty≥
 = 
	`pci_pcõ_ty≥
(
dev
);

1230  
	`__kc_pcõ_ˇp_vîsi⁄
(
dev
) > 1 ||

1231 
ty≥
 =
PCI_EXP_TYPE_ROOT_PORT
 ||Åy≥ =
PCI_EXP_TYPE_RC_EC
;

1232 
	}
}

1234 
boﬁ
 
	$__kc_pcõ_ˇ∑bûôy_ªg_im∂emíãd
(
pci_dev
 *
dev
, 
pos
)

1236 i‡(!
	`pci_is_pcõ
(
dev
))

1237  
Ál£
;

1239 
pos
) {

1240 
PCI_EXP_FLAGS_TYPE
:

1241  
åue
;

1242 
PCI_EXP_DEVCAP
:

1243 
PCI_EXP_DEVCTL
:

1244 
PCI_EXP_DEVSTA
:

1245  
	`__kc_pcõ_ˇp_has_dev˘l
(
dev
);

1246 
PCI_EXP_LNKCAP
:

1247 
PCI_EXP_LNKCTL
:

1248 
PCI_EXP_LNKSTA
:

1249  
	`__kc_pcõ_ˇp_has_ k˘l
(
dev
);

1250 
PCI_EXP_SLTCAP
:

1251 
PCI_EXP_SLTCTL
:

1252 
PCI_EXP_SLTSTA
:

1253  
	`__kc_pcõ_ˇp_has_¶t˘l
(
dev
);

1254 
PCI_EXP_RTCTL
:

1255 
PCI_EXP_RTCAP
:

1256 
PCI_EXP_RTSTA
:

1257  
	`__kc_pcõ_ˇp_has_π˘l
(
dev
);

1258 
PCI_EXP_DEVCAP2
:

1259 
PCI_EXP_DEVCTL2
:

1260 
PCI_EXP_LNKCAP2
:

1261 
PCI_EXP_LNKCTL2
:

1262 
PCI_EXP_LNKSTA2
:

1263  
	`__kc_pcõ_ˇp_vîsi⁄
(
dev
) > 1;

1265  
Ál£
;

1267 
	}
}

1274 
	$__kc_pcõ_ˇ∑bûôy_ªad_w‹d
(
pci_dev
 *
dev
, 
pos
, 
u16
 *
vÆ
)

1276 
ªt
;

1278 *
vÆ
 = 0;

1279 i‡(
pos
 & 1)

1280  -
EINVAL
;

1282 i‡(
	`__kc_pcõ_ˇ∑bûôy_ªg_im∂emíãd
(
dev
, 
pos
)) {

1283 
ªt
 = 
	`pci_ªad_c⁄fig_w‹d
(
dev
, 
	`pci_pcõ_ˇp
(devË+ 
pos
, 
vÆ
);

1289 i‡(
ªt
)

1290 *
vÆ
 = 0;

1291  
ªt
;

1301 i‡(
	`pci_is_pcõ
(
dev
Ë&& 
pos
 =
PCI_EXP_SLTSTA
 &&

1302 
	`pci_pcõ_ty≥
(
dev
Ë=
PCI_EXP_TYPE_DOWNSTREAM
) {

1303 *
vÆ
 = 
PCI_EXP_SLTSTA_PDS
;

1307 
	}
}

1309 
	$__kc_pcõ_ˇ∑bûôy_wrôe_w‹d
(
pci_dev
 *
dev
, 
pos
, 
u16
 
vÆ
)

1311 i‡(
pos
 & 1)

1312  -
EINVAL
;

1314 i‡(!
	`__kc_pcõ_ˇ∑bûôy_ªg_im∂emíãd
(
dev
, 
pos
))

1317  
	`pci_wrôe_c⁄fig_w‹d
(
dev
, 
	`pci_pcõ_ˇp
(devË+ 
pos
, 
vÆ
);

1318 
	}
}

1320 
	$__kc_pcõ_ˇ∑bûôy_˛ór_™d_£t_w‹d
(
pci_dev
 *
dev
, 
pos
,

1321 
u16
 
˛ór
, u16 
£t
)

1323 
ªt
;

1324 
u16
 
vÆ
;

1326 
ªt
 = 
	`__kc_pcõ_ˇ∑bûôy_ªad_w‹d
(
dev
, 
pos
, &
vÆ
);

1327 i‡(!
ªt
) {

1328 
vÆ
 &~
˛ór
;

1329 
vÆ
 |
£t
;

1330 
ªt
 = 
	`__kc_pcõ_ˇ∑bûôy_wrôe_w‹d
(
dev
, 
pos
, 
vÆ
);

1333  
ªt
;

1334 
	}
}

1339 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,9,0) )

1343 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,10,0) )

	@kcompat.h

29 #i‚de‡
_KCOMPAT_H_


30 
	#_KCOMPAT_H_


	)

32 #i‚de‡
LINUX_VERSION_CODE


33 
	~<löux/vîsi⁄.h
>

35 
	#KERNEL_VERSION
(
a
,
b
,
c
Ë((◊Ë<< 16Ë+ ((bË<< 8Ë+ (c))

	)

37 
	~<löux/öô.h
>

38 
	~<löux/ty≥s.h
>

39 
	~<löux/î∫o.h
>

40 
	~<löux/moduÀ.h
>

41 
	~<löux/pci.h
>

42 
	~<löux/√tdevi˚.h
>

43 
	~<löux/ëhîdevi˚.h
>

44 
	~<löux/skbuff.h
>

45 
	~<löux/i›‹t.h
>

46 
	~<löux/¶ab.h
>

47 
	~<löux/li°.h
>

48 
	~<löux/dñay.h
>

49 
	~<löux/sched.h
>

50 
	~<löux/ö.h
>

51 
	~<löux/ù.h
>

52 
	~<löux/udp.h
>

53 
	~<löux/mii.h
>

54 
	~<löux/vmÆloc.h
>

55 
	~<asm/io.h
>

56 
	~<löux/ëhtoﬁ.h
>

57 
	~<löux/if_vœn.h
>

60 
	#NAPI


	)

61 #ifde‡
E1000E_NO_NAPI


62 #unde‡
NAPI


65 
	#ad≠ãr_°ru˘
 
e1000_ad≠ãr


	)

66 
	#CONFIG_E1000E_MSIX


	)

69 #ifde‡
NAPI


70 #i‚de‡
CONFIG_E1000E_NAPI


71 
	#CONFIG_E1000E_NAPI


	)

74 #unde‡
CONFIG_E1000E_NAPI


78 #ifde‡
DISABLE_PACKET_SPLIT


82 #ifde‡
DISABLE_PCI_MSI


83 #unde‡
CONFIG_PCI_MSI


85 #i‚de‡
CONFIG_PCI_MSI


86 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,8) )

87 
	smsix_íåy
 {

88 
u16
 
	mve˘‹
;

89 
u16
 
	míåy
;

92 #unde‡
pci_íabÀ_msi


93 
	#pci_íabÀ_msi
(
a
Ë-
ENOTSUPP


	)

94 #unde‡
pci_dißbÀ_msi


95 
	#pci_dißbÀ_msi
(
a
Ëdÿ{} 0)

	)

96 #unde‡
pci_íabÀ_msix


97 
	#pci_íabÀ_msix
(
a
, 
b
, 
c
Ë-
ENOTSUPP


	)

98 #unde‡
pci_dißbÀ_msix


99 
	#pci_dißbÀ_msix
(
a
Ëdÿ{} 0)

	)

100 
	#msi_ªmove_pci_úq_ve˘‹s
(
a
Ëdÿ{} 0)

	)

102 #ifde‡
DISABLE_PM


103 #unde‡
CONFIG_PM


106 #ifde‡
DISABLE_NET_POLL_CONTROLLER


107 #unde‡
CONFIG_NET_POLL_CONTROLLER


110 #i‚de‡
PMSG_SUSPEND


111 
	#PMSG_SUSPEND
 3

	)

115 #unde‡
TRUE


116 #unde‡
FALSE


117 
	#TRUE
 
åue


	)

118 
	#FALSE
 
Ál£


	)

119 #ifde‡
GCC_VERSION


120 #i‡–
GCC_VERSION
 < 3000 )

121 
	#_Boﬁ
 

	)

124 
	#_Boﬁ
 

	)

128 #i‚de‡
ETH_P_8021Q


129 
	#ETH_P_8021Q
 0x8100

	)

132 #i‚de‡
moduÀ_∑øm


133 
	#moduÀ_∑øm
(
v
,
t
,
p
Ë
	`MODULE_PARM
(v, "i");

	)

136 #i‚de‡
DMA_64BIT_MASK


137 
	#DMA_64BIT_MASK
 0xffffffffffffffffULL

	)

140 #i‚de‡
DMA_32BIT_MASK


141 
	#DMA_32BIT_MASK
 0x00000000ffffffffULL

	)

144 #i‚de‡
PCI_CAP_ID_EXP


145 
	#PCI_CAP_ID_EXP
 0x10

	)

148 #i‚de‡
PCIE_LINK_STATE_L0S


149 
	#PCIE_LINK_STATE_L0S
 1

	)

151 #i‚de‡
PCIE_LINK_STATE_L1


152 
	#PCIE_LINK_STATE_L1
 2

	)

155 #i‚de‡
mmiowb


156 #ifde‡
CONFIG_IA64


157 
	#mmiowb
(Ë
asm
 vﬁ©ûê("mf.a" ::: "mem‹y")

	)

159 
	#mmiowb
()

	)

163 #i‚de‡
SET_NETDEV_DEV


164 
	#SET_NETDEV_DEV
(
√t
, 
pdev
)

	)

167 #i‡!
deföed
(
HAVE_FREE_NETDEV
Ë&& ( 
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,1,0) )

168 
	#‰ì_√tdev
(
x
Ë
	`k‰ì
(x)

	)

171 #ifde‡
HAVE_POLL_CONTROLLER


172 
	#CONFIG_NET_POLL_CONTROLLER


	)

175 #i‚de‡
SKB_DATAREF_SHIFT


178 
	#skb_hódî_˛⁄ed
(
x
Ë0

	)

181 #i‚de‡
NETIF_F_GSO


182 
	#gso_size
 
tso_size


	)

183 
	#gso_£gs
 
tso_£gs


	)

186 #i‚de‡
NETIF_F_GRO


187 
	#vœn_gro_ª˚ive
(
_«pi
, 
_vlgΩ
, 
_vœn
, 
_skb
) \

188 
	`vœn_hwac˚l_ª˚ive_skb
(
_skb
, 
_vlgΩ
, 
_vœn
)

	)

189 
	#«pi_gro_ª˚ive
(
_«pi
, 
_skb
Ë
	`√tif_ª˚ive_skb
(_skb)

	)

192 #i‚de‡
NETIF_F_SCTP_CSUM


193 
	#NETIF_F_SCTP_CSUM
 0

	)

196 #i‚de‡
NETIF_F_LRO


197 
	#NETIF_F_LRO
 (1 << 15)

	)

200 #i‚de‡
NETIF_F_NTUPLE


201 
	#NETIF_F_NTUPLE
 (1 << 27)

	)

204 #i‚de‡
IPPROTO_SCTP


205 
	#IPPROTO_SCTP
 132

	)

208 #i‚de‡
CHECKSUM_PARTIAL


209 
	#CHECKSUM_PARTIAL
 
CHECKSUM_HW


	)

210 
	#CHECKSUM_COMPLETE
 
CHECKSUM_HW


	)

213 #i‚de‡
__ªad_mo°ly


214 
	#__ªad_mo°ly


	)

217 #i‚de‡
MII_RESV1


218 
	#MII_RESV1
 0x17

	)

221 #i‚de‡
u∆ikñy


222 
	#u∆ikñy
(
_x
Ë
	)
_x

223 
	#likñy
(
_x
Ë
	)
_x

226 #i‚de‡
WARN_ON


227 
	#WARN_ON
(
x
)

	)

230 #i‚de‡
PCI_DEVICE


231 
	#PCI_DEVICE
(
víd
,
dev
) \

232 .
víd‹
 = (
víd
), .
devi˚
 = (
dev
), \

233 .
subvíd‹
 = 
PCI_ANY_ID
, .
subdevi˚
 = 
	)
PCI_ANY_ID

236 #i‚de‡
node_⁄löe


237 
	#node_⁄löe
(
node
Ë(“odeË=0)

	)

240 #i‚de‡
num_⁄löe_˝us


241 
	#num_⁄löe_˝us
(Ë
smp_num_˝us


	)

244 #i‚de‡
˝u_⁄löe


245 
	#˝u_⁄löe
(
˝uid
Ë
	`ã°_bô
((˝uid), &
˝u_⁄löe_m≠
)

	)

248 #i‚de‡
_LINUX_RANDOM_H


249 
	~<löux/øndom.h
>

252 #i‚de‡
DECLARE_BITMAP


253 #i‚de‡
BITS_TO_LONGS


254 
	#BITS_TO_LONGS
(
bôs
Ë(((bôs)+
BITS_PER_LONG
-1)/BITS_PER_LONG)

	)

256 
	#DECLARE_BITMAP
(
«me
,
bôs
Ë«me[
	`BITS_TO_LONGS
(bôs)]

	)

259 #i‚de‡
VLAN_HLEN


260 
	#VLAN_HLEN
 4

	)

263 #i‚de‡
VLAN_ETH_HLEN


264 
	#VLAN_ETH_HLEN
 18

	)

267 #i‚de‡
VLAN_ETH_FRAME_LEN


268 
	#VLAN_ETH_FRAME_LEN
 1518

	)

271 #i‡!
deföed
(
IXGBE_DCA
Ë&& !deföed(
IGB_DCA
)

272 
	#dˇ_gë_èg
(
b
Ë0

	)

273 
	#dˇ_add_ªque°î
(
a
Ë-1

	)

274 
	#dˇ_ªmove_ªque°î
(
b
Ëdÿ{ } 0)

	)

275 
	#DCA_PROVIDER_ADD
 0x0001

	)

276 
	#DCA_PROVIDER_REMOVE
 0x0002

	)

279 #i‚de‡
DCA_GET_TAG_TWO_ARGS


280 
	#dˇ3_gë_èg
(
a
,
b
Ë
	`dˇ_gë_èg
(b)

	)

283 #i‚de‡
CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS


284 #i‡
deföed
(
__i386__
Ë|| deföed(
__x86_64__
)

285 
	#CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS


	)

290 #i‚de‡
IS_ALIGNED


291 
	#IS_ALIGNED
(
x
,
a
Ë(((xË% ((
	`ty≥of
(x))◊))Ë=0)

	)

294 #ifde‡
IS_ENABLED


295 #unde‡
IS_ENABLED


296 #unde‡
__ARG_PLACEHOLDER_1


297 #unde‡
c⁄fig_íabÀd


298 #unde‡
_c⁄fig_íabÀd


299 #unde‡
__c⁄fig_íabÀd


300 #unde‡
___c⁄fig_íabÀd


303 
	#__ARG_PLACEHOLDER_1
 0,

	)

304 
	#c⁄fig_íabÀd
(
cfg
Ë
	`_c⁄fig_íabÀd
(cfg)

	)

305 
	#_c⁄fig_íabÀd
(
vÆue
Ë
	`__c⁄fig_íabÀd
(
__ARG_PLACEHOLDER_
##vÆue)

	)

306 
	#__c⁄fig_íabÀd
(
¨g1_‹_junk
Ë
	`___c⁄fig_íabÀd
◊rg1_‹_junk 1, 0)

	)

307 
	#___c⁄fig_íabÀd
(
__ign‹ed
, 
vÆ
, ...Ë
	)
val

309 
	#IS_ENABLED
(
›ti⁄
) \

310 (
	`c⁄fig_íabÀd
(
›ti⁄
Ë|| c⁄fig_íabÀd(›ti⁄##
_MODULE
))

	)

312 #i‡!
deföed
(
NETIF_F_HW_VLAN_TX
Ë&& !deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

313 
	s_kc_vœn_ëhhdr
 {

314 
	mh_de°
[
ETH_ALEN
];

315 
	mh_sour˚
[
ETH_ALEN
];

316 
__be16
 
	mh_vœn_¥Ÿo
;

317 
__be16
 
	mh_vœn_TCI
;

318 
__be16
 
	mh_vœn_íˇpsuœãd_¥Ÿo
;

320 
	#vœn_ëhhdr
 
_kc_vœn_ëhhdr


	)

321 
	s_kc_vœn_hdr
 {

322 
__be16
 
	mh_vœn_TCI
;

323 
__be16
 
	mh_vœn_íˇpsuœãd_¥Ÿo
;

325 
	#vœn_hdr
 
_kc_vœn_hdr


	)

326 
	#vœn_tx_èg_¥e£¡
(
_skb
Ë0

	)

327 
	#vœn_tx_èg_gë
(
_skb
Ë0

	)

330 #i‚de‡
VLAN_PRIO_SHIFT


331 
	#VLAN_PRIO_SHIFT
 13

	)

334 #i‚de‡
__GFP_COLD


335 
	#__GFP_COLD
 0

	)

338 #i‚de‡
__GFP_COMP


339 
	#__GFP_COMP
 0

	)

346 #i‚de‡
ETH_GSTRING_LEN


347 
	#ETH_GSTRING_LEN
 32

	)

350 #i‚de‡
ETHTOOL_GSTATS


351 
	#ETHTOOL_GSTATS
 0x1d

	)

352 #unde‡
ëhtoﬁ_drvöfo


353 
	#ëhtoﬁ_drvöfo
 
k_ëhtoﬁ_drvöfo


	)

354 
	sk_ëhtoﬁ_drvöfo
 {

355 
u32
 
	mcmd
;

356 
	mdrivî
[32];

357 
	mvîsi⁄
[32];

358 
	mfw_vîsi⁄
[32];

359 
	mbus_öfo
[32];

360 
	mª£rved1
[32];

361 
	mª£rved2
[16];

362 
u32
 
	mn_°©s
;

363 
u32
 
	mã°öfo_Àn
;

364 
u32
 
	mìdump_Àn
;

365 
u32
 
	mªgdump_Àn
;

368 
	sëhtoﬁ_°©s
 {

369 
u32
 
	mcmd
;

370 
u32
 
	mn_°©s
;

371 
u64
 
	md©a
[0];

375 #i‚de‡
ETHTOOL_PHYS_ID


376 
	#ETHTOOL_PHYS_ID
 0x1c

	)

379 #i‚de‡
ETHTOOL_GSTRINGS


380 
	#ETHTOOL_GSTRINGS
 0x1b

	)

381 
	eëhtoﬁ_°rög£t
 {

382 
	mETH_SS_TEST
 = 0,

383 
	mETH_SS_STATS
,

385 
	sëhtoﬁ_g°rögs
 {

386 
u32
 
	mcmd
;

387 
u32
 
	m°rög_£t
;

388 
u32
 
	mÀn
;

389 
u8
 
	md©a
[0];

393 #i‚de‡
ETHTOOL_TEST


394 
	#ETHTOOL_TEST
 0x1a

	)

395 
	eëhtoﬁ_ã°_Êags
 {

396 
	mETH_TEST_FL_OFFLINE
 = (1 << 0),

397 
	mETH_TEST_FL_FAILED
 = (1 << 1),

399 
	sëhtoﬁ_ã°
 {

400 
u32
 
	mcmd
;

401 
u32
 
	mÊags
;

402 
u32
 
	mª£rved
;

403 
u32
 
	mÀn
;

404 
u64
 
	md©a
[0];

408 #i‚de‡
ETHTOOL_GEEPROM


409 
	#ETHTOOL_GEEPROM
 0xb

	)

410 #unde‡
ETHTOOL_GREGS


411 
	sëhtoﬁ_ì¥om
 {

412 
u32
 
	mcmd
;

413 
u32
 
	mmagic
;

414 
u32
 
	moff£t
;

415 
u32
 
	mÀn
;

416 
u8
 
	md©a
[0];

419 
	sëhtoﬁ_vÆue
 {

420 
u32
 
	mcmd
;

421 
u32
 
	md©a
;

425 #i‚de‡
ETHTOOL_GLINK


426 
	#ETHTOOL_GLINK
 0xa

	)

429 #i‚de‡
ETHTOOL_GWOL


430 
	#ETHTOOL_GWOL
 0x5

	)

431 
	#ETHTOOL_SWOL
 0x6

	)

432 
	#SOPASS_MAX
 6

	)

433 
	sëhtoﬁ_wﬁöfo
 {

434 
u32
 
	mcmd
;

435 
u32
 
	msuµ‹ãd
;

436 
u32
 
	mwﬁ›ts
;

437 
u8
 
	ms›ass
[
SOPASS_MAX
];

441 #i‚de‡
ETHTOOL_GREGS


442 
	#ETHTOOL_GREGS
 0x00000004

	)

443 
	#ëhtoﬁ_ªgs
 
_kc_ëhtoﬁ_ªgs


	)

445 
	s_kc_ëhtoﬁ_ªgs
 {

446 
u32
 
	mcmd
;

447 
u32
 
	mvîsi⁄
;

448 
u32
 
	mÀn
;

449 
u8
 
	md©a
[0];

453 #i‚de‡
ETHTOOL_GMSGLVL


454 
	#ETHTOOL_GMSGLVL
 0x00000007

	)

456 #i‚de‡
ETHTOOL_SMSGLVL


457 
	#ETHTOOL_SMSGLVL
 0x00000008

	)

459 #i‚de‡
ETHTOOL_NWAY_RST


460 
	#ETHTOOL_NWAY_RST
 0x00000009

	)

462 #i‚de‡
ETHTOOL_GLINK


463 
	#ETHTOOL_GLINK
 0x0000000®

	)

465 #i‚de‡
ETHTOOL_GEEPROM


466 
	#ETHTOOL_GEEPROM
 0x0000000b

	)

468 #i‚de‡
ETHTOOL_SEEPROM


469 
	#ETHTOOL_SEEPROM
 0x0000000¯

	)

471 #i‚de‡
ETHTOOL_GCOALESCE


472 
	#ETHTOOL_GCOALESCE
 0x0000000ê

	)

474 
	#ëhtoﬁ_cﬂÀs˚
 
_kc_ëhtoﬁ_cﬂÀs˚


	)

475 
	s_kc_ëhtoﬁ_cﬂÀs˚
 {

476 
u32
 
	mcmd
;

482 
u32
 
	mrx_cﬂÀs˚_u£cs
;

490 
u32
 
	mrx_max_cﬂÀs˚d_‰ames
;

497 
u32
 
	mrx_cﬂÀs˚_u£cs_úq
;

498 
u32
 
	mrx_max_cﬂÀs˚d_‰ames_úq
;

504 
u32
 
	mtx_cﬂÀs˚_u£cs
;

512 
u32
 
	mtx_max_cﬂÀs˚d_‰ames
;

519 
u32
 
	mtx_cﬂÀs˚_u£cs_úq
;

520 
u32
 
	mtx_max_cﬂÀs˚d_‰ames_úq
;

527 
u32
 
	m°©s_block_cﬂÀs˚_u£cs
;

536 
u32
 
	mu£_ad≠tive_rx_cﬂÀs˚
;

537 
u32
 
	mu£_ad≠tive_tx_cﬂÀs˚
;

543 
u32
 
	mpkt_øã_low
;

544 
u32
 
	mrx_cﬂÀs˚_u£cs_low
;

545 
u32
 
	mrx_max_cﬂÀs˚d_‰ames_low
;

546 
u32
 
	mtx_cﬂÀs˚_u£cs_low
;

547 
u32
 
	mtx_max_cﬂÀs˚d_‰ames_low
;

558 
u32
 
	mpkt_øã_high
;

559 
u32
 
	mrx_cﬂÀs˚_u£cs_high
;

560 
u32
 
	mrx_max_cﬂÀs˚d_‰ames_high
;

561 
u32
 
	mtx_cﬂÀs˚_u£cs_high
;

562 
u32
 
	mtx_max_cﬂÀs˚d_‰ames_high
;

567 
u32
 
	møã_ßm∂e_öãrvÆ
;

571 #i‚de‡
ETHTOOL_SCOALESCE


572 
	#ETHTOOL_SCOALESCE
 0x0000000‡

	)

574 #i‚de‡
ETHTOOL_GRINGPARAM


575 
	#ETHTOOL_GRINGPARAM
 0x00000010

	)

577 
	#ëhtoﬁ_rög∑øm
 
_kc_ëhtoﬁ_rög∑øm


	)

578 
	s_kc_ëhtoﬁ_rög∑øm
 {

579 
u32
 
	mcmd
;

585 
u32
 
	mrx_max_≥ndög
;

586 
u32
 
	mrx_möi_max_≥ndög
;

587 
u32
 
	mrx_jumbo_max_≥ndög
;

588 
u32
 
	mtx_max_≥ndög
;

593 
u32
 
	mrx_≥ndög
;

594 
u32
 
	mrx_möi_≥ndög
;

595 
u32
 
	mrx_jumbo_≥ndög
;

596 
u32
 
	mtx_≥ndög
;

600 #i‚de‡
ETHTOOL_SRINGPARAM


601 
	#ETHTOOL_SRINGPARAM
 0x00000011

	)

603 #i‚de‡
ETHTOOL_GPAUSEPARAM


604 
	#ETHTOOL_GPAUSEPARAM
 0x00000012

	)

606 
	#ëhtoﬁ_∑u£∑øm
 
_kc_ëhtoﬁ_∑u£∑øm


	)

607 
	s_kc_ëhtoﬁ_∑u£∑øm
 {

608 
u32
 
	mcmd
;

620 
u32
 
	maut⁄eg
;

621 
u32
 
	mrx_∑u£
;

622 
u32
 
	mtx_∑u£
;

626 #i‚de‡
ETHTOOL_SPAUSEPARAM


627 
	#ETHTOOL_SPAUSEPARAM
 0x00000013

	)

629 #i‚de‡
ETHTOOL_GRXCSUM


630 
	#ETHTOOL_GRXCSUM
 0x00000014

	)

632 #i‚de‡
ETHTOOL_SRXCSUM


633 
	#ETHTOOL_SRXCSUM
 0x00000015

	)

635 #i‚de‡
ETHTOOL_GTXCSUM


636 
	#ETHTOOL_GTXCSUM
 0x00000016

	)

638 #i‚de‡
ETHTOOL_STXCSUM


639 
	#ETHTOOL_STXCSUM
 0x00000017

	)

641 #i‚de‡
ETHTOOL_GSG


642 
	#ETHTOOL_GSG
 0x00000018

	)

645 #i‚de‡
ETHTOOL_SSG


646 
	#ETHTOOL_SSG
 0x00000019

	)

649 #i‚de‡
ETHTOOL_TEST


650 
	#ETHTOOL_TEST
 0x0000001®

	)

652 #i‚de‡
ETHTOOL_GSTRINGS


653 
	#ETHTOOL_GSTRINGS
 0x0000001b

	)

655 #i‚de‡
ETHTOOL_PHYS_ID


656 
	#ETHTOOL_PHYS_ID
 0x0000001¯

	)

658 #i‚de‡
ETHTOOL_GSTATS


659 
	#ETHTOOL_GSTATS
 0x0000001d

	)

661 #i‚de‡
ETHTOOL_GTSO


662 
	#ETHTOOL_GTSO
 0x0000001ê

	)

664 #i‚de‡
ETHTOOL_STSO


665 
	#ETHTOOL_STSO
 0x0000001‡

	)

668 #i‚de‡
ETHTOOL_BUSINFO_LEN


669 
	#ETHTOOL_BUSINFO_LEN
 32

	)

672 #i‚de‡
RHEL_RELEASE_VERSION


673 
	#RHEL_RELEASE_VERSION
(
a
,
b
Ë((◊Ë<< 8Ë+ (b))

	)

675 #i‚de‡
AX_RELEASE_VERSION


676 
	#AX_RELEASE_VERSION
(
a
,
b
Ë((◊Ë<< 8Ë+ (b))

	)

679 #i‚de‡
AX_RELEASE_CODE


680 
	#AX_RELEASE_CODE
 0

	)

683 #i‡(
AX_RELEASE_CODE
 && AX_RELEASE_CODE =
AX_RELEASE_VERSION
(3,0))

684 
	#RHEL_RELEASE_CODE
 
	`RHEL_RELEASE_VERSION
(5,0)

	)

685 #ñi‡(
AX_RELEASE_CODE
 && AX_RELEASE_CODE =
AX_RELEASE_VERSION
(3,1))

686 
	#RHEL_RELEASE_CODE
 
	`RHEL_RELEASE_VERSION
(5,1)

	)

687 #ñi‡(
AX_RELEASE_CODE
 && AX_RELEASE_CODE =
AX_RELEASE_VERSION
(3,2))

688 
	#RHEL_RELEASE_CODE
 
	`RHEL_RELEASE_VERSION
(5,3)

	)

691 #i‚de‡
RHEL_RELEASE_CODE


693 
	#RHEL_RELEASE_CODE
 0

	)

697 #i‚de‡
SLE_VERSION


698 
	#SLE_VERSION
(
a
,
b
,
c
Ë
	`KERNEL_VERSION
◊,b,c)

	)

700 #ifde‡
CONFIG_SUSE_KERNEL


701 #i‡–
LINUX_VERSION_CODE
 =
KERNEL_VERSION
(2,6,27) )

703 
	#SLE_VERSION_CODE
 
	`SLE_VERSION
(11,0,0)

	)

704 #ñi‡–
LINUX_VERSION_CODE
 =
KERNEL_VERSION
(2,6,32) )

706 
	#SLE_VERSION_CODE
 
	`SLE_VERSION
(11,1,0)

	)

707 #ñi‡((
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(3,0,61)) && \

708 (
	gLINUX_VERSION_CODE
 < 
	$KERNEL_VERSION
(3,1,0)))

710 
	#SLE_VERSION_CODE
 
	`SLE_VERSION
(11,3,0)

	)

713 #i‚de‡
SLE_VERSION_CODE


714 
	#SLE_VERSION_CODE
 0

	)

717 #ifde‡
__KLOCWORK__


718 #ifde‡
ARRAY_SIZE


719 #unde‡
ARRAY_SIZE


720 
	#ARRAY_SIZE
(
x
Ë((xË/ ((x)[0]))

	)

726 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,4,3) )

731 #i‚de‡
pci_£t_dma_mask


732 
	#pci_£t_dma_mask
 
_kc_pci_£t_dma_mask


	)

733 
	`_kc_pci_£t_dma_mask
(
pci_dev
 *
dev
, 
dma_addr_t
 
mask
);

736 #i‚de‡
pci_ªque°_ªgi⁄s


737 
	#pci_ªque°_ªgi⁄s
 
_kc_pci_ªque°_ªgi⁄s


	)

738 
	`_kc_pci_ªque°_ªgi⁄s
(
pci_dev
 *
pdev
, *
ªs_«me
);

741 #i‚de‡
pci_ªÀa£_ªgi⁄s


742 
	#pci_ªÀa£_ªgi⁄s
 
_kc_pci_ªÀa£_ªgi⁄s


	)

743 
	`_kc_pci_ªÀa£_ªgi⁄s
(
pci_dev
 *
pdev
);

749 #i‚de‡
Æloc_ëhîdev


750 
	#Æloc_ëhîdev
 
_kc_Æloc_ëhîdev


	)

751 
√t_devi˚
 *
	`_kc_Æloc_ëhîdev
(
sizeof_¥iv
);

754 #i‚de‡
is_vÆid_ëhî_addr


755 
	#is_vÆid_ëhî_addr
 
_kc_is_vÆid_ëhî_addr


	)

756 
	`_kc_is_vÆid_ëhî_addr
(
u8
 *
addr
);

762 #i‚de‡
INIT_TQUEUE


763 
	#INIT_TQUEUE
(
_tq
, 
_routöe
, 
_d©a
) \

765 
	`INIT_LIST_HEAD
(&(
_tq
)->
li°
); \

766 (
_tq
)->
sync
 = 0; \

767 (
_tq
)->
routöe
 = 
_routöe
; \

768 (
_tq
)->
d©a
 = 
_d©a
; \

769 
	}
} 0)

	)

775 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,5) )

777 
	#MII_BMCR
 0x00

	)

778 
	#MII_BMSR
 0x01

	)

779 
	#MII_PHYSID1
 0x02

	)

780 
	#MII_PHYSID2
 0x03

	)

781 
	#MII_ADVERTISE
 0x04

	)

782 
	#MII_LPA
 0x05

	)

783 
	#MII_EXPANSION
 0x06

	)

785 
	#BMCR_FULLDPLX
 0x0100

	)

786 
	#BMCR_ANENABLE
 0x1000

	)

788 
	#BMSR_ERCAP
 0x0001

	)

789 
	#BMSR_ANEGCAPABLE
 0x0008

	)

790 
	#BMSR_10HALF
 0x0800

	)

791 
	#BMSR_10FULL
 0x1000

	)

792 
	#BMSR_100HALF
 0x2000

	)

793 
	#BMSR_100FULL
 0x4000

	)

795 
	#ADVERTISE_CSMA
 0x0001

	)

796 
	#ADVERTISE_10HALF
 0x0020

	)

797 
	#ADVERTISE_10FULL
 0x0040

	)

798 
	#ADVERTISE_100HALF
 0x0080

	)

799 
	#ADVERTISE_100FULL
 0x0100

	)

800 
	#ADVERTISE_ALL
 (
ADVERTISE_10HALF
 | 
ADVERTISE_10FULL
 | \

801 
ADVERTISE_100HALF
 | 
ADVERTISE_100FULL
)

	)

803 
	#EXPANSION_ENABLENPAGE
 0x0004

	)

808 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,6) )

810 #i‚de‡
pci_£t_powî_°©e


811 
	#pci_£t_powî_°©e
 
_kc_pci_£t_powî_°©e


	)

812 
_kc_pci_£t_powî_°©e
(
pci_dev
 *
dev
, 
°©e
);

815 #i‚de‡
pci_íabÀ_wake


816 
	#pci_íabÀ_wake
 
_kc_pci_íabÀ_wake


	)

817 
_kc_pci_íabÀ_wake
(
pci_dev
 *
pdev
, 
u32
 
°©e
, 
íabÀ
);

820 #i‚de‡
pci_dißbÀ_devi˚


821 
	#pci_dißbÀ_devi˚
 
_kc_pci_dißbÀ_devi˚


	)

822 
_kc_pci_dißbÀ_devi˚
(
pci_dev
 *
pdev
);

826 #unde‡
CONFIG_PM


830 #i‚de‡
HAVE_PCI_SET_MWI


831 
	#pci_£t_mwi
(
X
Ë
	`pci_wrôe_c⁄fig_w‹d
(X, \

832 
PCI_COMMAND_INVALIDATE
);

	)

833 
	#pci_˛ór_mwi
(
X
Ë
	`pci_wrôe_c⁄fig_w‹d
(X, \

834 ~
PCI_COMMAND_INVALIDATE
);

	)

839 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,10) )

844 #i‚de‡
MODULE_LICENSE


845 
	#MODULE_LICENSE
(
X
)

	)

851 #unde‡
mö


852 
	#mö
(
x
,
y
) ({ \

853 c⁄° 
	`ty≥of
(
x
Ë
_x
 = (x); \

854 c⁄° 
	`ty≥of
(
y
Ë
_y
 = (y); \

855 (Ë(&
_x
 =&
_y
); \

856 
_x
 < 
_y
 ? _x : _y; })

	)

858 #unde‡
max


859 
	#max
(
x
,
y
) ({ \

860 c⁄° 
	`ty≥of
(
x
Ë
_x
 = (x); \

861 c⁄° 
	`ty≥of
(
y
Ë
_y
 = (y); \

862 (Ë(&
_x
 =&
_y
); \

863 
_x
 > 
_y
 ? _x : _y; })

	)

865 
	#mö_t
(
ty≥
,
x
,
y
) ({ \

866 
ty≥
 
_x
 = (
x
); \

867 
ty≥
 
_y
 = (
y
); \

868 
_x
 < 
_y
 ? _x : _y; })

	)

870 
	#max_t
(
ty≥
,
x
,
y
) ({ \

871 
ty≥
 
_x
 = (
x
); \

872 
ty≥
 
_y
 = (
y
); \

873 
_x
 > 
_y
 ? _x : _y; })

	)

875 #i‚de‡
li°_f‹_óch_ß„


876 
	#li°_f‹_óch_ß„
(
pos
, 
n
, 
hód
) \

877 
pos
 = (
hód
)->
√xt
, 
n
 =Öos->next;Öos != (head); \

878 
pos
 = 
n
,Ç =Öos->
√xt
)

	)

881 #i‚de‡
____ˇchñöe_Æig√d_ö_smp


882 #ifde‡
CONFIG_SMP


883 
	#____ˇchñöe_Æig√d_ö_smp
 
____ˇchñöe_Æig√d


	)

885 
	#____ˇchñöe_Æig√d_ö_smp


	)

889 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,8) )

890 
_kc_¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, ...);

891 
	#¢¥ötf
(
buf
, 
size
, 
fmt
, 
¨gs
...Ë
	`_kc_¢¥ötf
(buf, size, fmt, ##¨gs)

	)

892 
_kc_v¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, 
va_li°
 
¨gs
);

893 
	#v¢¥ötf
(
buf
, 
size
, 
fmt
, 
¨gs
Ë
	`_kc_v¢¥ötf
(buf, size, fmt,árgs)

	)

895 
¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, ...);

896 
v¢¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, 
va_li°
 
¨gs
);

902 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,12) )

903 #i‚de‡
HAVE_NETIF_MSG


904 
	#HAVE_NETIF_MSG
 1

	)

906 
	mNETIF_MSG_DRV
 = 0x0001,

907 
	mNETIF_MSG_PROBE
 = 0x0002,

908 
	mNETIF_MSG_LINK
 = 0x0004,

909 
	mNETIF_MSG_TIMER
 = 0x0008,

910 
	mNETIF_MSG_IFDOWN
 = 0x0010,

911 
	mNETIF_MSG_IFUP
 = 0x0020,

912 
	mNETIF_MSG_RX_ERR
 = 0x0040,

913 
	mNETIF_MSG_TX_ERR
 = 0x0080,

914 
	mNETIF_MSG_TX_QUEUED
 = 0x0100,

915 
	mNETIF_MSG_INTR
 = 0x0200,

916 
	mNETIF_MSG_TX_DONE
 = 0x0400,

917 
	mNETIF_MSG_RX_STATUS
 = 0x0800,

918 
	mNETIF_MSG_PKTDATA
 = 0x1000,

919 
	mNETIF_MSG_HW
 = 0x2000,

920 
	mNETIF_MSG_WOL
 = 0x4000,

923 
	#√tif_msg_drv
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_DRV
)

	)

924 
	#√tif_msg_¥obe
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_PROBE
)

	)

925 
	#√tif_msg_lök
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_LINK
)

	)

926 
	#√tif_msg_timî
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_TIMER
)

	)

927 
	#√tif_msg_ifdown
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_IFDOWN
)

	)

928 
	#√tif_msg_ifup
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_IFUP
)

	)

929 
	#√tif_msg_rx_îr
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_RX_ERR
)

	)

930 
	#√tif_msg_tx_îr
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_TX_ERR
)

	)

931 
	#√tif_msg_tx_queued
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_TX_QUEUED
)

	)

932 
	#√tif_msg_öå
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_INTR
)

	)

933 
	#√tif_msg_tx_d⁄e
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_TX_DONE
)

	)

934 
	#√tif_msg_rx_°©us
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_RX_STATUS
)

	)

935 
	#√tif_msg_pktd©a
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_PKTDATA
)

	)

941 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,13) )

946 #i‚de‡
vút_to_∑ge


947 
	#vút_to_∑ge
(
v
Ë(
mem_m≠
 + (
	`vút_to_phys
(vË>> 
PAGE_SHIFT
))

	)

950 #i‚de‡
pci_m≠_∑ge


951 
	#pci_m≠_∑ge
 
_kc_pci_m≠_∑ge


	)

952 
u64
 
_kc_pci_m≠_∑ge
(
pci_dev
 *
dev
, 
∑ge
 *page,

953 
off£t
, 
size_t
 
size
, 
dúe˘i⁄
);

956 #i‚de‡
pci_unm≠_∑ge


957 
	#pci_unm≠_∑ge
 
_kc_pci_unm≠_∑ge


	)

958 
_kc_pci_unm≠_∑ge
(
pci_dev
 *
dev
, 
u64
 
dma_addr
, 
size_t
 
size
,

959 
dúe˘i⁄
);

964 #unde‡
DMA_32BIT_MASK


965 
	#DMA_32BIT_MASK
 0xffffffff

	)

966 #unde‡
DMA_64BIT_MASK


967 
	#DMA_64BIT_MASK
 0xffffffff

	)

972 #i‚de‡
˝u_ªœx


973 
	#˝u_ªœx
(Ë
	`ªp_n›
()

	)

976 
	svœn_ëhhdr
 {

977 
	mh_de°
[
ETH_ALEN
];

978 
	mh_sour˚
[
ETH_ALEN
];

979 
	mh_vœn_¥Ÿo
;

980 
	mh_vœn_TCI
;

981 
	mh_vœn_íˇpsuœãd_¥Ÿo
;

987 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,17) )

989 #i‚de‡
__devexô_p


990 
	#__devexô_p
(
x
Ë&(x)

	)

996 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,18) )

997 
	#NETIF_MSG_HW
 0x2000

	)

998 
	#NETIF_MSG_WOL
 0x4000

	)

1000 #i‚de‡
√tif_msg_hw


1001 
	#√tif_msg_hw
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_HW
)

	)

1003 #i‚de‡
√tif_msg_wﬁ


1004 
	#√tif_msg_wﬁ
(
p
Ë(’)->
msg_íabÀ
 & 
NETIF_MSG_WOL
)

	)

1009 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,19) ) || \

1010 (–
	gLINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,0ËË&& !
	$deföed
(
CONFIG_CRC32
))

1011 #unde‡
ëhî_¸c_À


1012 
	#ëhî_¸c_À
(
Àngth
, 
d©a
Ë
	`_kc_ëhî_¸c_À
÷ígth, d©a)

	)

1013 
ölöe
 
	$_kc_ëhî_¸c_À
(
Àngth
, *
d©a
)

1015 
¸c
 = 0xffffffff;

1016 --
Àngth
 >= 0) {

1017 
cuºít_o˘ë
 = *
d©a
++;

1018 
bô
;

1019 
bô
 = 8; --bô >0; 
cuºít_o˘ë
 >>= 1) {

1020 i‡((
¸c
 ^ 
cuºít_o˘ë
) & 1) {

1021 
¸c
 >>= 1;

1022 
¸c
 ^= 0xedb88320U;

1024 
¸c
 >>= 1;

1027  
¸c
;

1028 
	}
}

1030 
	~<löux/¸c32.h
>

1035 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,20) )

1038 #ifde‡
NAPI


1039 #unde‡
NAPI


1040 #unde‡
CONFIG_E1000E_NAPI


1047 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,22) )

1048 
	#pci_«me
(
x
Ë((x)->
¶Ÿ_«me
)

	)

1050 #i‚de‡
SUPPORTED_10000ba£T_FuŒ


1051 
	#SUPPORTED_10000ba£T_FuŒ
 (1 << 12)

	)

1053 #i‚de‡
ADVERTISED_10000ba£T_FuŒ


1054 
	#ADVERTISED_10000ba£T_FuŒ
 (1 << 12)

	)

1061 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,23) )

1063 #ifde‡
NAPI


1064 #i‚de‡
√tif_pﬁl_dißbÀ


1065 
	#√tif_pﬁl_dißbÀ
(
x
Ë
	`_kc_√tif_pﬁl_dißbÀ
(x)

	)

1066 
ölöe
 
	$_kc_√tif_pﬁl_dißbÀ
(
√t_devi˚
 *
√tdev
)

1068 
	`ã°_™d_£t_bô
(
__LINK_STATE_RX_SCHED
, &
√tdev
->
°©e
)) {

1070 
cuºít
->
°©e
 = 
TASK_INTERRUPTIBLE
;

1071 
	`scheduÀ_timeout
(1);

1073 
	}
}

1075 #i‚de‡
√tif_pﬁl_íabÀ


1076 
	#√tif_pﬁl_íabÀ
(
x
Ë
	`_kc_√tif_pﬁl_íabÀ
(x)

	)

1077 
ölöe
 
	$_kc_√tif_pﬁl_íabÀ
(
√t_devi˚
 *
√tdev
)

1079 
	`˛ór_bô
(
__LINK_STATE_RX_SCHED
, &
√tdev
->
°©e
);

1080 
	}
}

1083 #i‚de‡
√tif_tx_dißbÀ


1084 
	#√tif_tx_dißbÀ
(
x
Ë
	`_kc_√tif_tx_dißbÀ
(x)

	)

1085 
ölöe
 
	$_kc_√tif_tx_dißbÀ
(
√t_devi˚
 *
dev
)

1087 
	`•ö_lock_bh
(&
dev
->
xmô_lock
);

1088 
	`√tif_°›_queue
(
dev
);

1089 
	`•ö_u∆ock_bh
(&
dev
->
xmô_lock
);

1090 
	}
}

1093 
	#HAVE_SCTP


	)

1098 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,25) || \

1099 –
	gLINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,0) && \

1100 
	gLINUX_VERSION_CODE
 < 
	$KERNEL_VERSION
(2,6,4) ) )

1101 
	#ETHTOOL_OPS_COMPAT


	)

1105 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,4,27) )

1106 
	#__u£r


	)

1111 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,5,71) )

1112 
	#sk_¥Ÿocﬁ
 
¥Ÿocﬁ


	)

1113 
	#pci_gë_devi˚
 
pci_föd_devi˚


	)

1118 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,4,27) || \

1119 –
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,0) && \

1120 
LINUX_VERSION_CODE
 < 
	$KERNEL_VERSION
(2,6,5) ) )

1122 #i‚de‡
√tif_msg_öô


1123 
	#√tif_msg_öô
 
_kc_√tif_msg_öô


	)

1124 
ölöe
 
u32
 
	$_kc_√tif_msg_öô
(
debug_vÆue
,

1125 
deÁu…_msg_íabÀ_bôs
)

1128 i‡(
debug_vÆue
 < 0 || debug_vÆuê>((
u32
) * 8))

1129  
deÁu…_msg_íabÀ_bôs
;

1130 i‡(
debug_vÆue
 == 0)

1133  (1 << 
debug_vÆue
) - 1;

1134 
	}
}

1139 #i‡(–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,4,27) ) || \

1140 (–
	gLINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,0) ) && \

1141 –
	gLINUX_VERSION_CODE
 < 
	$KERNEL_VERSION
(2,6,3) )))

1142 
	#√tdev_¥iv
(
x
Ëx->
¥iv


	)

1147 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,5,0) )

1148 
	~<löux/π√éök.h
>

1149 #unde‡
pci_ªgi°î_drivî


1150 
	#pci_ªgi°î_drivî
 
pci_moduÀ_öô


	)

1158 
	edma_d©a_dúe˘i⁄
 {

1159 
DMA_BIDIRECTIONAL
 = 0,

1160 
DMA_TO_DEVICE
 = 1,

1161 
DMA_FROM_DEVICE
 = 2,

1162 
DMA_NONE
 = 3,

1165 
	sdevi˚
 {

1166 
pci_dev
 
pdev
;

1169 
ölöe
 
pci_dev
 *
	$to_pci_dev
(
devi˚
 *
dev
)

1171  (
pci_dev
 *)
dev
;

1172 
	}
}

1174 
ölöe
 
devi˚
 *
	$pci_dev_to_dev
(
pci_dev
 *
pdev
)

1176  (
devi˚
 *)
pdev
;

1177 
	}
}

1179 
	#pdev_¥ötk
(
lvl
, 
pdev
, 
fmt
, 
¨gs
...) \

1180 
	`¥ötk
("%†%s: " 
fmt
, 
lvl
, 
	`pci_«me
(
pdev
), ## 
¨gs
)

	)

1181 
	#dev_îr
(
dev
, 
fmt
, 
¨gs
...) \

1182 
	`pdev_¥ötk
(
KERN_ERR
, 
	`to_pci_dev
(
dev
), 
fmt
, ## 
¨gs
)

	)

1183 
	#dev_öfo
(
dev
, 
fmt
, 
¨gs
...) \

1184 
	`pdev_¥ötk
(
KERN_INFO
, 
	`to_pci_dev
(
dev
), 
fmt
, ## 
¨gs
)

	)

1185 
	#dev_w¨n
(
dev
, 
fmt
, 
¨gs
...) \

1186 
	`pdev_¥ötk
(
KERN_WARNING
, 
	`to_pci_dev
(
dev
), 
fmt
, ## 
¨gs
)

	)

1187 
	#dev_nŸi˚
(
dev
, 
fmt
, 
¨gs
...) \

1188 
	`pdev_¥ötk
(
KERN_NOTICE
, 
	`to_pci_dev
(
dev
), 
fmt
, ## 
¨gs
)

	)

1189 
	#dev_dbg
(
dev
, 
fmt
, 
¨gs
...) \

1190 
	`pdev_¥ötk
(
KERN_DEBUG
, 
	`to_pci_dev
(
dev
), 
fmt
, ## 
¨gs
)

	)

1193 
	#dma_Æloc_cohîít
(
dev
,
sz
,
dma
,
gÂ
) \

1194 
	`pci_Æloc_c⁄si°ít
(
	`to_pci_dev
(
dev
),(
sz
),(
dma
))

	)

1195 
	#dma_‰ì_cohîít
(
dev
,
sz
,
addr
,
dma_addr
) \

1196 
	`pci_‰ì_c⁄si°ít
(
	`to_pci_dev
(
dev
),(
sz
),(
addr
),(
dma_addr
))

	)

1198 
	#dma_m≠_∑ge
(
dev
,
a
,
b
,
c
,
d
) \

1199 
	`pci_m≠_∑ge
(
	`to_pci_dev
(
dev
),(
a
),(
b
),(
c
),(
d
))

	)

1200 
	#dma_unm≠_∑ge
(
dev
,
a
,
b
,
c
) \

1201 
	`pci_unm≠_∑ge
(
	`to_pci_dev
(
dev
),(
a
),(
b
),(
c
))

	)

1203 
	#dma_m≠_sögÀ
(
dev
,
a
,
b
,
c
) \

1204 
	`pci_m≠_sögÀ
(
	`to_pci_dev
(
dev
),(
a
),(
b
),(
c
))

	)

1205 
	#dma_unm≠_sögÀ
(
dev
,
a
,
b
,
c
) \

1206 
	`pci_unm≠_sögÀ
(
	`to_pci_dev
(
dev
),(
a
),(
b
),(
c
))

	)

1208 
	#dma_m≠_sg
(
dev
, 
sg
, 
√¡s
, 
dú
) \

1209 
	`pci_m≠_sg
(
	`to_pci_dev
(
dev
), (
sg
), (
√¡s
), (
dú
)

	)

1210 
	#dma_unm≠_sg
(
dev
, 
sg
, 
√¡s
, 
dú
) \

1211 
	`pci_unm≠_sg
(
	`to_pci_dev
(
dev
), (
sg
), (
√¡s
), (
dú
)

	)

1213 
	#dma_sync_sögÀ
(
dev
,
a
,
b
,
c
) \

1214 
	`pci_dma_sync_sögÀ
(
	`to_pci_dev
(
dev
),(
a
),(
b
),(
c
))

	)

1217 
	#dma_sync_sögÀ_ønge
(
dev
,
addr
,
off
,
sz
,
dú
) \

1218 
	`pci_dma_sync_sögÀ
(
	`to_pci_dev
(
dev
),(
addr
),(
off
)+(
sz
),(
dú
))

	)

1220 
	#dma_£t_mask
(
dev
,
mask
) \

1221 
	`pci_£t_dma_mask
(
	`to_pci_dev
(
dev
),(
mask
))

	)

1224 
	shli°_hód
 {

1225 
hli°_node
 *
	mfú°
;

1228 
	shli°_node
 {

1229 
hli°_node
 *
	m√xt
, **
	mµªv
;

1232 
ölöe
 
	$__hli°_dñ
(
hli°_node
 *
n
)

1234 
hli°_node
 *
√xt
 = 
n
->next;

1235 
hli°_node
 **
µªv
 = 
n
->pprev;

1236 *
µªv
 = 
√xt
;

1237 i‡(
√xt
)

1238 
√xt
->
µªv
 =Öprev;

1239 
	}
}

1241 
ölöe
 
	$hli°_dñ
(
hli°_node
 *
n
)

1243 
	`__hli°_dñ
(
n
);

1244 
n
->
√xt
 = 
NULL
;

1245 
n
->
µªv
 = 
NULL
;

1246 
	}
}

1248 
ölöe
 
	$hli°_add_hód
(
hli°_node
 *
n
, 
hli°_hód
 *
h
)

1250 
hli°_node
 *
fú°
 = 
h
->first;

1251 
n
->
√xt
 = 
fú°
;

1252 i‡(
fú°
)

1253 
fú°
->
µªv
 = &
n
->
√xt
;

1254 
h
->
fú°
 = 
n
;

1255 
n
->
µªv
 = &
h
->
fú°
;

1256 
	}
}

1258 
ölöe
 
	$hli°_em±y
(c⁄° 
hli°_hód
 *
h
)

1260  !
h
->
fú°
;

1261 
	}
}

1263 
	#HLIST_HEAD_INIT
 { .
fú°
 = 
NULL
 }

	)

1264 
	#HLIST_HEAD
(
«me
Ë
hli°_hód
Çamê{ .
fú°
 = 
NULL
 }

	)

1265 
	#INIT_HLIST_HEAD
(
±r
Ë(’å)->
fú°
 = 
NULL
)

	)

1266 
ölöe
 
	$INIT_HLIST_NODE
(
hli°_node
 *
h
)

1268 
h
->
√xt
 = 
NULL
;

1269 
h
->
µªv
 = 
NULL
;

1270 
	}
}

1272 #i‚de‡
might_¶ìp


1273 
	#might_¶ìp
()

	)

1276 
ölöe
 
devi˚
 *
	$pci_dev_to_dev
(
pci_dev
 *
pdev
)

1278  &
pdev
->
dev
;

1279 
	}
}

1284 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,5,28) )

1286 
	~<löux/tqueue.h
>

1287 
	#w‹k_°ru˘
 
tq_°ru˘


	)

1288 #unde‡
INIT_WORK


1289 
	#INIT_WORK
(
a
,
b
Ë
	`INIT_TQUEUE
◊,((*)(*))b,a)

	)

1290 #unde‡
c⁄èöî_of


1291 
	#c⁄èöî_of
 
li°_íåy


	)

1292 
	#scheduÀ_w‹k
 
scheduÀ_èsk


	)

1293 
	#Êush_scheduÀd_w‹k
 
Êush_scheduÀd_èsks


	)

1294 
	#ˇn˚l_w‹k_sync
(
x
Ë
	`Êush_scheduÀd_w‹k
()

	)

1300 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0) )

1301 #i‚de‡
ªad_b¨rõr_dïíds


1302 
	#ªad_b¨rõr_dïíds
(Ë
	`rmb
()

	)

1305 #unde‡
gë_˝u


1306 
	#gë_˝u
(Ë
	`smp_¥o˚ss‹_id
()

	)

1307 #unde‡
put_˝u


1308 
	#put_˝u
(Ëdÿ{ } 0)

	)

1309 
	#MODULE_INFO
(
vîsi⁄
, 
_vîsi⁄
)

	)

1310 #i‚de‡
CONFIG_E1000_DISABLE_PACKET_SPLIT


1311 
	#CONFIG_E1000_DISABLE_PACKET_SPLIT
 1

	)

1313 #i‚de‡
CONFIG_IGB_DISABLE_PACKET_SPLIT


1314 
	#CONFIG_IGB_DISABLE_PACKET_SPLIT
 1

	)

1317 
	#dma_£t_cohîít_mask
(
dev
,
mask
Ë1

	)

1319 #unde‡
dev_put


1320 
	#dev_put
(
dev
Ë
	`__dev_put
(dev)

	)

1322 #i‚de‡
skb_fûl_∑ge_desc


1323 
	#skb_fûl_∑ge_desc
 
_kc_skb_fûl_∑ge_desc


	)

1324 
_kc_skb_fûl_∑ge_desc
(
sk_buff
 *
skb
, 
i
,

1325 
∑ge
 *∑ge, 
off
, 
size
);

1328 #unde‡
ALIGN


1329 
	#ALIGN
(
x
,
a
Ë(((x)+◊)-1)&~(◊)-1))

	)

1331 #i‚de‡
∑ge_cou¡


1332 
	#∑ge_cou¡
(
p
Ë
	`©omic_ªad
(&’)->
cou¡
)

	)

1335 #ifde‡
MAX_NUMNODES


1336 #unde‡
MAX_NUMNODES


1338 
	#MAX_NUMNODES
 1

	)

1343 
	~<löux/bô›s.h
>

1344 
	#BITOP_WORD
(
ƒ
Ë(“rË/ 
BITS_PER_LONG
)

	)

1345 #unde‡
föd_√xt_bô


1346 
	#föd_√xt_bô
 
_kc_föd_√xt_bô


	)

1347 
_kc_föd_√xt_bô
(c⁄° *
addr
,

1348 
size
,

1349 
off£t
);

1350 
	#föd_fú°_bô
(
addr
, 
size
Ë
	`föd_√xt_bô
(◊ddr), (size), 0)

	)

1352 #i‚de‡
√tdev_«me


1353 
ölöe
 c⁄° *
	$_kc_√tdev_«me
(c⁄° 
√t_devi˚
 *
dev
)

1355 i‡(
	`°rchr
(
dev
->
«me
, '%'))

1357  
dev
->
«me
;

1358 
	}
}

1360 
	#√tdev_«me
(
√tdev
Ë
	`_kc_√tdev_«me
“ëdev)

	)

1363 #i‚de‡
°æ˝y


1364 
	#°æ˝y
 
_kc_°æ˝y


	)

1365 
size_t
 
_kc_°æ˝y
(*
de°
, c⁄° *
§c
, size_à
size
);

1368 #i‚de‡
do_div


1369 #i‡
BITS_PER_LONG
 == 64

1370 
	#do_div
(
n
,
ba£
) ({ \

1371 
uöt32_t
 
__ba£
 = (
ba£
); \

1372 
uöt32_t
 
__ªm
; \

1373 
__ªm
 = ((
uöt64_t
)(
n
)Ë% 
__ba£
; \

1374 (
n
Ë((
uöt64_t
)“)Ë/ 
__ba£
; \

1375 
__ªm
; \

1376 })

	)

1377 #ñi‡
BITS_PER_LONG
 == 32

1378 
uöt32_t
 
_kc__div64_32
(
uöt64_t
 * 
dividíd
, uöt32_à
divis‹
);

1379 
	#do_div
(
n
,
ba£
) ({ \

1380 
uöt32_t
 
__ba£
 = (
ba£
); \

1381 
uöt32_t
 
__ªm
; \

1382 i‡(
	`likñy
(((
n
) >> 32) == 0)) { \

1383 
__ªm
 = (
uöt32_t
)(
n
Ë% 
__ba£
; \

1384 (
n
Ë(
uöt32_t
)“Ë/ 
__ba£
; \

1386 
__ªm
 = 
	`_kc__div64_32
(&(
n
), 
__ba£
); \

1387 
__ªm
; \

1388 })

	)

1390 #îr‹ 
do_div
(Ë
d€s
 
nŸ
 
yë
 
suµ‹t
 
the
 
C64


1394 #i‚de‡
NSEC_PER_SEC


1395 
	#NSEC_PER_SEC
 1000000000L

	)

1398 #unde‡
HAVE_I2C_SUPPORT


1403 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,3) )

1404 
	#dma_poﬁ
 
pci_poﬁ


	)

1405 
	#dma_poﬁ_de°roy
 
pci_poﬁ_de°roy


	)

1406 
	#dma_poﬁ_Æloc
 
pci_poﬁ_Æloc


	)

1407 
	#dma_poﬁ_‰ì
 
pci_poﬁ_‰ì


	)

1409 
	#dma_poﬁ_¸óã
(
«me
,
dev
,
size
,
Æign
,
Æloˇti⁄
) \

1410 
	`pci_poﬁ_¸óã
((
«me
),
	`to_pci_dev
(
dev
),(
size
),(
Æign
),(
Æloˇti⁄
))

	)

1415 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,4) )

1416 
	#MODULE_VERSION
(
_vîsi⁄
Ë
	`MODULE_INFO
(
vîsi⁄
, _vîsi⁄)

	)

1421 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,5) )

1422 
	#dma_sync_sögÀ_f‹_˝u
 
dma_sync_sögÀ


	)

1423 
	#dma_sync_sögÀ_f‹_devi˚
 
dma_sync_sögÀ


	)

1424 
	#dma_sync_sögÀ_ønge_f‹_˝u
 
dma_sync_sögÀ_ønge


	)

1425 
	#dma_sync_sögÀ_ønge_f‹_devi˚
 
dma_sync_sögÀ_ønge


	)

1426 #i‚de‡
pci_dma_m≠pög_îr‹


1427 
	#pci_dma_m≠pög_îr‹
 
_kc_pci_dma_m≠pög_îr‹


	)

1428 
ölöe
 
	$_kc_pci_dma_m≠pög_îr‹
(
dma_addr_t
 
dma_addr
)

1430  
dma_addr
 == 0;

1431 
	}
}

1436 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,4) )

1437 
_kc_s˙¥ötf
(*
buf
, 
size_t
 
size
, c⁄° *
fmt
, ...);

1438 
	#s˙¥ötf
(
buf
, 
size
, 
fmt
, 
¨gs
...Ë
	`_kc_s˙¥ötf
(buf, size, fmt, ##¨gs)

	)

1442 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,6) )

1444 #unde‡
bôm≠_zîo


1445 
	#bôm≠_zîo
 
_kc_bôm≠_zîo


	)

1446 
ölöe
 
	$_kc_bôm≠_zîo
(*
d°
, 
nbôs
)

1448 i‡(
nbôs
 <
BITS_PER_LONG
)

1449 *
d°
 = 0UL;

1451 
Àn
 = 
	`BITS_TO_LONGS
(
nbôs
) * ();

1452 
	`mem£t
(
d°
, 0, 
Àn
);

1454 
	}
}

1456 
	#øndom_ëhî_addr
 
_kc_øndom_ëhî_addr


	)

1457 
ölöe
 
	$_kc_øndom_ëhî_addr
(
u8
 *
addr
)

1459 
	`gë_øndom_byãs
(
addr
, 
ETH_ALEN
);

1460 
addr
[0] &= 0xfe;

1461 
addr
[0] |= 0x02;

1462 
	}
}

1464 
	#∑ge_to_nid
(
x
Ë0

	)

1469 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,7) )

1470 #unde‡
if_mii


1471 
	#if_mii
 
_kc_if_mii


	)

1472 
ölöe
 
mii_io˘l_d©a
 *
	$_kc_if_mii
(
i‰eq
 *
rq
)

1474  (
mii_io˘l_d©a
 *)&
rq
->
i‰_i‰u
;

1475 
	}
}

1477 #i‚de‡
__f‹˚


1478 
	#__f‹˚


	)

1483 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,8) )

1484 #i‚de‡
PCI_EXP_DEVCTL


1485 
	#PCI_EXP_DEVCTL
 8

	)

1487 #i‚de‡
PCI_EXP_DEVCTL_CERE


1488 
	#PCI_EXP_DEVCTL_CERE
 0x0001

	)

1490 
	#PCI_EXP_FLAGS
 2

	)

1491 
	#PCI_EXP_FLAGS_VERS
 0x000‡

	)

1492 
	#PCI_EXP_FLAGS_TYPE
 0x00f0

	)

1493 
	#PCI_EXP_TYPE_ENDPOINT
 0x0

	)

1494 
	#PCI_EXP_TYPE_LEG_END
 0x1

	)

1495 
	#PCI_EXP_TYPE_ROOT_PORT
 0x4

	)

1496 
	#PCI_EXP_TYPE_DOWNSTREAM
 0x6

	)

1497 
	#PCI_EXP_FLAGS_SLOT
 0x0100

	)

1498 
	#PCI_EXP_DEVCAP
 4

	)

1499 
	#PCI_EXP_DEVSTA
 10

	)

1500 
	#m¶ìp
(
x
Ëdÿ{ 
	`£t_cuºít_°©e
(
TASK_UNINTERRUPTIBLE
); \

1501 
	`scheduÀ_timeout
((
x
 * 
HZ
)/1000 + 2); \

1502 } 0)

	)

1507 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,9))

1508 
	~<√t/dsfõld.h
>

1509 
	#__iomem


	)

1511 #i‚de‡
kˇŒoc


1512 
	#kˇŒoc
(
n
, 
size
, 
Êags
Ë
	`_kc_kzÆloc
((“Ë* (size)), fœgs)

	)

1513 *
_kc_kzÆloc
(
size_t
 
size
, 
Êags
);

1515 
	#MSEC_PER_SEC
 1000L

	)

1516 
ölöe
 
	$_kc_jiffõs_to_m£cs
(c⁄° 
j
)

1518 #i‡
HZ
 <
MSEC_PER_SEC
 && !(MSEC_PER_SEC % HZ)

1519  (
MSEC_PER_SEC
 / 
HZ
Ë* 
j
;

1520 #ñi‡
HZ
 > 
MSEC_PER_SEC
 && !(HZ % MSEC_PER_SEC)

1521  (
j
 + (
HZ
 / 
MSEC_PER_SEC
) - 1) / (HZ / MSEC_PER_SEC);

1523  (
j
 * 
MSEC_PER_SEC
Ë/ 
HZ
;

1525 
	}
}

1527 
ölöe
 
	$_kc_m£cs_to_jiffõs
(c⁄° 
m
)

1529 i‡(
m
 > 
	`_kc_jiffõs_to_m£cs
(
MAX_JIFFY_OFFSET
))

1530  
MAX_JIFFY_OFFSET
;

1531 #i‡
HZ
 <
MSEC_PER_SEC
 && !(MSEC_PER_SEC % HZ)

1532  (
m
 + (
MSEC_PER_SEC
 / 
HZ
) - 1) / (MSEC_PER_SEC / HZ);

1533 #ñi‡
HZ
 > 
MSEC_PER_SEC
 && !(HZ % MSEC_PER_SEC)

1534  
m
 * (
HZ
 / 
MSEC_PER_SEC
);

1536  (
m
 * 
HZ
 + 
MSEC_PER_SEC
 - 1) / MSEC_PER_SEC;

1538 
	}
}

1540 
	#m¶ìp_öãºu±ibÀ
 
_kc_m¶ìp_öãºu±ibÀ


	)

1541 
ölöe
 
	$_kc_m¶ìp_öãºu±ibÀ
(
m£cs
)

1543 
timeout
 = 
	`_kc_m£cs_to_jiffõs
(
m£cs
) + 1;

1545 
timeout
 && !
	`sig«l_≥ndög
(
cuºít
)) {

1546 
	`__£t_cuºít_°©e
(
TASK_INTERRUPTIBLE
);

1547 
timeout
 = 
	`scheduÀ_timeout
(timeout);

1549  
	`_kc_jiffõs_to_m£cs
(
timeout
);

1550 
	}
}

1553 
	#BMCR_SPEED1000
 0x0040

	)

1555 #i‚de‡
__À16


1556 
	#__À16
 
u16


	)

1558 #i‚de‡
__À32


1559 
	#__À32
 
u32


	)

1561 #i‚de‡
__À64


1562 
	#__À64
 
u64


	)

1564 #i‚de‡
__be16


1565 
	#__be16
 
u16


	)

1567 #i‚de‡
__be32


1568 
	#__be32
 
u32


	)

1570 #i‚de‡
__be64


1571 
	#__be64
 
u64


	)

1574 
ölöe
 
vœn_ëhhdr
 *
	$vœn_ëh_hdr
(c⁄° 
sk_buff
 *
skb
)

1576  (
vœn_ëhhdr
 *)
skb
->
mac
.
øw
;

1577 
	}
}

1580 
	#WAKE_PHY
 (1 << 0)

	)

1581 
	#WAKE_UCAST
 (1 << 1)

	)

1582 
	#WAKE_MCAST
 (1 << 2)

	)

1583 
	#WAKE_BCAST
 (1 << 3)

	)

1584 
	#WAKE_ARP
 (1 << 4)

	)

1585 
	#WAKE_MAGIC
 (1 << 5)

	)

1586 
	#WAKE_MAGICSECURE
 (1 << 6Ë

	)

1588 
	#skb_hódî_poöãr
 
_kc_skb_hódî_poöãr


	)

1589 
ölöe
 *
	$_kc_skb_hódî_poöãr
(c⁄° 
sk_buff
 *
skb
,

1590 
off£t
, 
Àn
, *
buf„r
)

1592 
hÀn
 = 
	`skb_hódÀn
(
skb
);

1594 i‡(
hÀn
 - 
off£t
 >
Àn
)

1595  
skb
->
d©a
 + 
off£t
;

1597 #ifde‡
MAX_SKB_FRAGS


1598 i‡(
	`skb_c›y_bôs
(
skb
, 
off£t
, 
buf„r
, 
Àn
) < 0)

1599  
NULL
;

1601  
buf„r
;

1603  
NULL
;

1606 #i‚de‡
NETDEV_TX_OK


1607 
	#NETDEV_TX_OK
 0

	)

1609 #i‚de‡
NETDEV_TX_BUSY


1610 
	#NETDEV_TX_BUSY
 1

	)

1612 #i‚de‡
NETDEV_TX_LOCKED


1613 
	#NETDEV_TX_LOCKED
 -1

	)

1615 
	}
}

1617 #i‚de‡
__bôwi£


1618 
	#__bôwi£


	)

1623 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,10) )

1624 #ifde‡
moduÀ_∑øm_¨øy_«med


1625 #unde‡
moduÀ_∑øm_¨øy_«med


1626 
	#moduÀ_∑øm_¨øy_«med
(
«me
, 
¨øy
, 
ty≥
, 
nump
, 
≥rm
) \

1627 
k∑øm_¨øy
 
__∑øm_¨r_
##
«me
 \

1628 { 
	`ARRAY_SIZE
(
¨øy
), 
nump
, 
∑øm_£t_
##
ty≥
, 
∑øm_gë_
##type, \

1629 (
¨øy
[0]),árray }; \

1630 
	`moduÀ_∑øm_ˇŒ
(
«me
, 
∑øm_¨øy_£t
, 
∑øm_¨øy_gë
, \

1631 &
__∑øm_¨r_
##
«me
, 
≥rm
)

	)

1637 #unde‡
num_⁄löe_nodes


1638 
	#num_⁄löe_nodes
(
n
Ë1

	)

1639 
DECLARE_BITMAP
(
_kcom∑t_node_⁄löe_m≠
, 
MAX_NUMNODES
);

1640 #unde‡
node_⁄löe_m≠


1641 
	#node_⁄löe_m≠
 
_kcom∑t_node_⁄löe_m≠


	)

1642 
	#pci_gë_˛ass
 
pci_föd_˛ass


	)

1646 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,11) )

1647 
	#PCI_D0
 0

	)

1648 
	#PCI_D1
 1

	)

1649 
	#PCI_D2
 2

	)

1650 
	#PCI_D3hŸ
 3

	)

1651 
	#PCI_D3cﬁd
 4

	)

1652 
	tpci_powî_t
;

1653 
	#pci_choo£_°©e
(
pdev
,
°©e
Ë
	)
state

1654 
	#PMSG_SUSPEND
 3

	)

1655 
	#PCI_EXP_LNKCTL
 16

	)

1657 #unde‡
NETIF_F_LLTX


1659 #i‚de‡
ARCH_HAS_PREFETCH


1660 
	#¥e„tch
(
X
)

	)

1663 #i‚de‡
NET_IP_ALIGN


1664 
	#NET_IP_ALIGN
 2

	)

1667 
	#KC_USEC_PER_SEC
 1000000L

	)

1668 
	#u£cs_to_jiffõs
 
_kc_u£cs_to_jiffõs


	)

1669 
ölöe
 
	$_kc_jiffõs_to_u£cs
(c⁄° 
j
)

1671 #i‡
HZ
 <
KC_USEC_PER_SEC
 && !(KC_USEC_PER_SEC % HZ)

1672  (
KC_USEC_PER_SEC
 / 
HZ
Ë* 
j
;

1673 #ñi‡
HZ
 > 
KC_USEC_PER_SEC
 && !(HZ % KC_USEC_PER_SEC)

1674  (
j
 + (
HZ
 / 
KC_USEC_PER_SEC
) - 1) / (HZ / KC_USEC_PER_SEC);

1676  (
j
 * 
KC_USEC_PER_SEC
Ë/ 
HZ
;

1678 
	}
}

1680 
ölöe
 
	$_kc_u£cs_to_jiffõs
(c⁄° 
m
)

1682 i‡(
m
 > 
	`_kc_jiffõs_to_u£cs
(
MAX_JIFFY_OFFSET
))

1683  
MAX_JIFFY_OFFSET
;

1684 #i‡
HZ
 <
KC_USEC_PER_SEC
 && !(KC_USEC_PER_SEC % HZ)

1685  (
m
 + (
KC_USEC_PER_SEC
 / 
HZ
) - 1) / (KC_USEC_PER_SEC / HZ);

1686 #ñi‡
HZ
 > 
KC_USEC_PER_SEC
 && !(HZ % KC_USEC_PER_SEC)

1687  
m
 * (
HZ
 / 
KC_USEC_PER_SEC
);

1689  (
m
 * 
HZ
 + 
KC_USEC_PER_SEC
 - 1) / KC_USEC_PER_SEC;

1691 
	}
}

1693 
	#PCI_EXP_LNKCAP
 12

	)

1694 
	#PCI_EXP_LNKSTA
 18

	)

1695 
	#PCI_EXP_SLTCAP
 20

	)

1696 
	#PCI_EXP_SLTCTL
 24

	)

1697 
	#PCI_EXP_SLTSTA
 26

	)

1698 
	#PCI_EXP_RTCTL
 28

	)

1699 
	#PCI_EXP_RTCAP
 30

	)

1700 
	#PCI_EXP_RTSTA
 32

	)

1704 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,12) )

1705 
	~<löux/ªboŸ.h
>

1706 
	#USE_REBOOT_NOTIFIER


	)

1709 
	#MII_CTRL1000
 0x09

	)

1710 
	#MII_STAT1000
 0x0®

	)

1712 
	#ADVERTISE_PAUSE_CAP
 0x0400

	)

1713 
	#ADVERTISE_PAUSE_ASYM
 0x0800

	)

1715 
	#LPA_PAUSE_CAP
 0x0400

	)

1716 
	#LPA_PAUSE_ASYM
 0x0800

	)

1718 
	#ADVERTISE_1000FULL
 0x0200

	)

1719 
	#ADVERTISE_1000HALF
 0x0100

	)

1721 
	#LPA_1000LOCALRXOK
 0x2000

	)

1722 
	#LPA_1000REMRXOK
 0x1000

	)

1724 #i‚de‡
is_zîo_ëhî_addr


1725 
	#is_zîo_ëhî_addr
 
_kc_is_zîo_ëhî_addr


	)

1726 
ölöe
 
	$_kc_is_zîo_ëhî_addr
(c⁄° 
u8
 *
addr
)

1728  !(
addr
[0] |áddr[1] |áddr[2] |áddr[3] |áddr[4] |áddr[5]);

1729 
	}
}

1731 #i‚de‡
is_mu…iˇ°_ëhî_addr


1732 
	#is_mu…iˇ°_ëhî_addr
 
_kc_is_mu…iˇ°_ëhî_addr


	)

1733 
ölöe
 
	$_kc_is_mu…iˇ°_ëhî_addr
(c⁄° 
u8
 *
addr
)

1735  
addr
[0] & 0x01;

1736 
	}
}

1741 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,13) )

1742 #i‚de‡
k°rdup


1743 
	#k°rdup
 
_kc_k°rdup


	)

1744 *
_kc_k°rdup
(c⁄° *
s
, 
gÂ
);

1749 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,14) )

1750 
	#pm_mesßge_t
 
u32


	)

1751 #i‚de‡
kzÆloc


1752 
	#kzÆloc
 
_kc_kzÆloc


	)

1753 *
_kc_kzÆloc
(
size_t
 
size
, 
Êags
);

1757 
	#MII_ESTATUS
 0x0‡

	)

1759 
	#BMSR_ESTATEN
 0x0100

	)

1761 
	#ESTATUS_1000_TFULL
 0x2000

	)

1762 
	#ESTATUS_1000_THALF
 0x1000

	)

1764 
	#SUPPORTED_Pau£
 (1 << 13)

	)

1765 
	#SUPPORTED_Asym_Pau£
 (1 << 14)

	)

1766 
	#ADVERTISED_Pau£
 (1 << 13)

	)

1767 
	#ADVERTISED_Asym_Pau£
 (1 << 14)

	)

1769 #i‡(!(
RHEL_RELEASE_CODE
 && \

1770 (
	gRHEL_RELEASE_CODE
 > 
RHEL_RELEASE_VERSION
(4,3)) && \

1771 (
	gRHEL_RELEASE_CODE
 < 
	$RHEL_RELEASE_VERSION
(5,0))))

1772 #i‡((
LINUX_VERSION_CODE
 =
	`KERNEL_VERSION
(2,6,9)Ë&& !
	`deföed
(
gÂ_t
))

1773 
	#gÂ_t
 

	)

1775 
	tgÂ_t
;

1779 #i‡–
LINUX_VERSION_CODE
 >
	`KERNEL_VERSION
(2,6,9) )

1780 #ifde‡
CONFIG_X86_64


1781 
	#dma_sync_sögÀ_ønge_f‹_˝u
(
dev
, 
addr
, 
off
, 
sz
, 
dú
) \

1782 
	`dma_sync_sögÀ_f‹_˝u
((
dev
), (
addr
), (
off
Ë+ (
sz
), (
dú
))

	)

1783 
	#dma_sync_sögÀ_ønge_f‹_devi˚
(
dev
, 
addr
, 
off
, 
sz
, 
dú
) \

1784 
	`dma_sync_sögÀ_f‹_devi˚
((
dev
), (
addr
), (
off
Ë+ (
sz
), (
dú
))

	)

1790 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,15) )

1791 #i‚de‡
vmÆloc_node


1792 
	#vmÆloc_node
(
a
,
b
Ë
	`vmÆloc
◊)

	)

1795 
	#£tup_timî
(
_timî
, 
_fun˘i⁄
, 
_d©a
) \

1797 (
_timî
)->
fun˘i⁄
 = 
_fun˘i⁄
; \

1798 (
_timî
)->
d©a
 = 
_d©a
; \

1799 
	`öô_timî
(
_timî
); \

1800 
	}
} 0)

	)

1801 #i‚de‡
devi˚_ˇn_wakeup


1802 
	#devi˚_ˇn_wakeup
(
dev
Ë(1)

	)

1804 #i‚de‡
devi˚_£t_wakeup_íabÀ


1805 
	#devi˚_£t_wakeup_íabÀ
(
dev
, 
vÆ
Ëdo{}0)

	)

1807 #i‚de‡
devi˚_öô_wakeup


1808 
	#devi˚_öô_wakeup
(
dev
,
vÆ
Ëdÿ{} 0)

	)

1810 
ölöe
 
	$_kc_com∑ª_ëhî_addr
(c⁄° 
u8
 *
addr1
, c⁄° u8 *
addr2
)

1812 c⁄° 
u16
 *
a
 = (c⁄° u16 *)
addr1
;

1813 c⁄° 
u16
 *
b
 = (c⁄° u16 *)
addr2
;

1815  ((
a
[0] ^ 
b
[0]) | (a[1] ^ b[1]) | (a[2] ^ b[2])) != 0;

1816 
	}
}

1818 #unde‡
com∑ª_ëhî_addr


1819 
	#com∑ª_ëhî_addr
(
addr1
, 
addr2
Ë
	`_kc_com∑ª_ëhî_addr
◊ddr1,áddr2)

	)

1823 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,16) )

1824 #unde‡
DEFINE_MUTEX


1825 
	#DEFINE_MUTEX
(
x
Ë
	`DECLARE_MUTEX
(x)

	)

1826 
	#muãx_lock
(
x
Ë
	`down_öãºu±ibÀ
(x)

	)

1827 
	#muãx_u∆ock
(
x
Ë
	`up
(x)

	)

1829 #i‚de‡
____ˇchñöe_öã∫odólig√d_ö_smp


1830 #ifde‡
CONFIG_SMP


1831 
	#____ˇchñöe_öã∫odólig√d_ö_smp
 
____ˇchñöe_Æig√d_ö_smp


	)

1833 
	#____ˇchñöe_öã∫odólig√d_ö_smp


	)

1836 #unde‡
HAVE_PCI_ERS


1838 #unde‡
HAVE_PCI_ERS


1839 
	#HAVE_PCI_ERS


	)

1840 #i‡–
SLE_VERSION_CODE
 && SLE_VERSION_CODE =
SLE_VERSION
(10,4,0) )

1841 #ifde‡
devi˚_ˇn_wakeup


1842 #unde‡
devi˚_ˇn_wakeup


1844 
	#devi˚_ˇn_wakeup
(
dev
Ë1

	)

1849 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,17) )

1850 #i‚de‡
dev_nŸi˚


1851 
	#dev_nŸi˚
(
dev
, 
fmt
, 
¨gs
...) \

1852 
	`dev_¥ötk
(
KERN_NOTICE
, 
dev
, 
fmt
, ## 
¨gs
)

	)

1855 #i‚de‡
fú°_⁄löe_node


1856 
	#fú°_⁄löe_node
 0

	)

1858 #i‚de‡
NET_SKB_PAD


1859 
	#NET_SKB_PAD
 16

	)

1864 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,18) )

1866 #i‚de‡
IRQ_HANDLED


1867 
	#úqªtu∫_t
 

	)

1868 
	#IRQ_HANDLED


	)

1869 
	#IRQ_NONE


	)

1872 #i‚de‡
IRQF_PROBE_SHARED


1873 #ifde‡
SA_PROBEIRQ


1874 
	#IRQF_PROBE_SHARED
 
SA_PROBEIRQ


	)

1876 
	#IRQF_PROBE_SHARED
 0

	)

1880 #i‚de‡
IRQF_SHARED


1881 
	#IRQF_SHARED
 
SA_SHIRQ


	)

1884 #i‚de‡
ARRAY_SIZE


1885 
	#ARRAY_SIZE
(
x
Ë((xË/ ((x)[0]))

	)

1888 #i‚de‡
FIELD_SIZEOF


1889 
	#FIELD_SIZEOF
(
t
, 
f
Ë(((—*)0)->f))

	)

1892 #i‚de‡
skb_is_gso


1893 #ifde‡
NETIF_F_TSO


1894 
	#skb_is_gso
 
_kc_skb_is_gso


	)

1895 
ölöe
 
	$_kc_skb_is_gso
(c⁄° 
sk_buff
 *
skb
)

1897  
	`skb_shöfo
(
skb
)->
gso_size
;

1898 
	}
}

1900 
	#skb_is_gso
(
a
Ë0

	)

1904 #i‚de‡
ªsour˚_size_t


1905 
	#ªsour˚_size_t
 

	)

1908 #ifde‡
skb_∑d


1909 #unde‡
skb_∑d


1911 
	#skb_∑d
(
x
,
y
Ë
	`_kc_skb_∑d
(x, y)

	)

1912 
_kc_skb_∑d
(
sk_buff
 *
skb
, 
∑d
);

1913 #ifde‡
skb_∑dto


1914 #unde‡
skb_∑dto


1916 
	#skb_∑dto
(
x
,
y
Ë
	`_kc_skb_∑dto
(x, y)

	)

1917 
ölöe
 
	$_kc_skb_∑dto
(
sk_buff
 *
skb
, 
Àn
)

1919 
size
 = 
skb
->
Àn
;

1920 i‡(
	`likñy
(
size
 >
Àn
))

1922  
	`_kc_skb_∑d
(
skb
, 
Àn
 - 
size
);

1923 
	}
}

1925 #i‚de‡
DECLARE_PCI_UNMAP_ADDR


1926 
	#DECLARE_PCI_UNMAP_ADDR
(
ADDR_NAME
) \

1927 
dma_addr_t
 
ADDR_NAME


	)

1928 
	#DECLARE_PCI_UNMAP_LEN
(
LEN_NAME
) \

1929 
u32
 
LEN_NAME


	)

1930 
	#pci_unm≠_addr
(
PTR
, 
ADDR_NAME
) \

1931 ((
PTR
)->
ADDR_NAME
)

	)

1932 
	#pci_unm≠_addr_£t
(
PTR
, 
ADDR_NAME
, 
VAL
) \

1933 (((
PTR
)->
ADDR_NAME
Ë(
VAL
))

	)

1934 
	#pci_unm≠_Àn
(
PTR
, 
LEN_NAME
) \

1935 ((
PTR
)->
LEN_NAME
)

	)

1936 
	#pci_unm≠_Àn_£t
(
PTR
, 
LEN_NAME
, 
VAL
) \

1937 (((
PTR
)->
LEN_NAME
Ë(
VAL
))

	)

1942 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,19) )

1944 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(5,0)))

1945 
	#i_¥iv©e
 
u
.
gíîic_ù


	)

1948 #i‚de‡
DIV_ROUND_UP


1949 
	#DIV_ROUND_UP
(
n
,
d
Ë((“Ë+ (dË- 1Ë/ (d))

	)

1951 #i‚de‡
__ALIGN_MASK


1952 
	#__ALIGN_MASK
(
x
, 
mask
Ë(((xË+ (mask)Ë& ~(mask))

	)

1954 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,0) )

1955 #i‡(!((
RHEL_RELEASE_CODE
 && \

1956 ((
	gRHEL_RELEASE_CODE
 > 
RHEL_RELEASE_VERSION
(4,4) && \

1957 
	gRHEL_RELEASE_CODE
 < 
RHEL_RELEASE_VERSION
(5,0)) || \

1958 (
	gRHEL_RELEASE_CODE
 > 
	$RHEL_RELEASE_VERSION
(5,0))))))

1959 
	$úqªtu∫_t
(*
	túq_h™dÀr_t
Ë(, *, 
	t±_ªgs
 *);

1961 #i‡(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE < 
	`RHEL_RELEASE_VERSION
(6,0))

1962 #unde‡
CONFIG_INET_LRO


1963 #unde‡
CONFIG_INET_LRO_MODULE


1964 #ifde‡
IXGBE_FCOE


1965 #unde‡
CONFIG_FCOE


1966 #unde‡
CONFIG_FCOE_MODULE


1969 
	$úqªtu∫_t
(*
	t√w_h™dÀr_t
) (, *);

1970 
ölöe
 
úqªtu∫_t
 
	$_kc_ªque°_úq
(
úq
,

1971 
√w_h™dÀr_t
 
h™dÀr
,

1972 
Êags
,

1973 c⁄° *
dev«me
, *
dev_id
)

1975 (*
	túq_h™dÀr_t
Ë(, *, 
	t±_ªgs
 *);

1976 (*
	t√w_h™dÀr_t
) (, *);

1977 
ölöe
 
	$_kc_ªque°_úq
(
úq
, 
√w_h™dÀr_t
 
h™dÀr
,

1978 
Êags
, c⁄° *
dev«me
,

1979 *
dev_id
)

1982 
úq_h™dÀr_t
 
√w_h™dÀr
 = (úq_h™dÀr_tË
h™dÀr
;

1983  
	`ªque°_úq
(
úq
, 
√w_h™dÀr
, 
Êags
, 
dev«me
, 
dev_id
);

1984 
	}
}

1986 #unde‡
ªque°_úq


1987 
	#ªque°_úq
(
úq
, 
h™dÀr
, 
Êags
, 
dev«me
, 
dev_id
Ë
	`_kc_ªque°_úq
((úq), (h™dÀr), (Êags), (dev«me), (dev_id))

	)

1989 
	#úq_h™dÀr_t
 
√w_h™dÀr_t


	)

1991 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(5,4)))

1992 
	#PCIE_CONFIG_SPACE_LEN
 256

	)

1993 
	#PCI_CONFIG_SPACE_LEN
 64

	)

1994 
	#PCIE_LINK_STATUS
 0x12

	)

1995 
	#pci_c⁄fig_•a˚_ich8œn
() { \

1996 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
) \

1997 
size
 = 
PCIE_CONFIG_SPACE_LEN
; \

1998 }

	)

1999 #unde‡
pci_ßve_°©e


2000 
_kc_pci_ßve_°©e
(
pci_dev
 *);

2001 
	#pci_ßve_°©e
(
pdev
Ë
	`_kc_pci_ßve_°©e
’dev)

	)

2002 #unde‡
pci_ª°‹e_°©e


2003 
_kc_pci_ª°‹e_°©e
(
pci_dev
 *);

2004 
	#pci_ª°‹e_°©e
(
pdev
Ë
	`_kc_pci_ª°‹e_°©e
’dev)

	)

2007 #ifde‡
HAVE_PCI_ERS


2008 #unde‡
‰ì_√tdev


2009 
_kc_‰ì_√tdev
(
√t_devi˚
 *);

2010 
	#‰ì_√tdev
(
√tdev
Ë
	`_kc_‰ì_√tdev
“ëdev)

	)

2012 
ölöe
 
	$pci_íabÀ_pcõ_îr‹_ªp‹tög
(
pci_dev
 *
dev
)

2015 
	}
}

2017 
	#pci_dißbÀ_pcõ_îr‹_ªp‹tög
(
dev
Ëdÿ{} 0)

	)

2018 
	#pci_˛ónup_´r_unc‹ª˘_îr‹_°©us
(
dev
Ëdÿ{} 0)

	)

2020 *
_kc_kmemdup
(c⁄° *
§c
, 
size_t
 
Àn
, 
gÂ
);

2021 
	#kmemdup
(
§c
, 
Àn
, 
gÂ
Ë
	`_kc_kmemdup
(§c,Üí, gÂ)

	)

2022 #i‚de‡
boﬁ


2023 
	#boﬁ
 
_Boﬁ


	)

2024 
	#åue
 1

	)

2025 
	#Ál£
 0

	)

2028 
	~<löux/´r.h
>

2029 
	~<löux/°rög.h
>

2033 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,20) )

2034 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,5,28) )

2035 #unde‡
INIT_WORK


2036 
	#INIT_WORK
(
_w‹k
, 
_func
) \

2038 
	`INIT_LIST_HEAD
(&(
_w‹k
)->
íåy
); \

2039 (
_w‹k
)->
≥ndög
 = 0; \

2040 (
_w‹k
)->
func
 = ((*)(*))
_func
; \

2041 (
_w‹k
)->
d©a
 = _work; \

2042 
	`öô_timî
(&(
_w‹k
)->
timî
); \

2043 } 0)

	)

2046 #i‚de‡
PCI_VDEVICE


2047 
	#PCI_VDEVICE
(
ví
, 
dev
) \

2048 
PCI_VENDOR_ID_
##
ví
, (
dev
), \

2049 
PCI_ANY_ID
, PCI_ANY_ID, 0, 0

	)

2052 #i‚de‡
PCI_VENDOR_ID_INTEL


2053 
	#PCI_VENDOR_ID_INTEL
 0x8086

	)

2056 #i‚de‡
round_jiffõs


2057 
	#round_jiffõs
(
x
Ë
	)
x

2060 
	#csum_off£t
 
csum


	)

2062 
	#HAVE_EARLY_VMALLOC_NODE


	)

2063 
	#dev_to_node
(
dev
Ë-1

	)

2064 #unde‡
£t_dev_node


2066 
	#£t_dev_node
(
a
, 
b
Ëdÿ{ (bË(b); } 0)

	)

2068 #i‡(!(
RHEL_RELEASE_CODE
 && \

2069 (((
	gRHEL_RELEASE_CODE
 >
RHEL_RELEASE_VERSION
(4,7)) && \

2070 (
	gRHEL_RELEASE_CODE
 < 
RHEL_RELEASE_VERSION
(5,0))) || \

2071 (
	gRHEL_RELEASE_CODE
 >
RHEL_RELEASE_VERSION
(5,6)))) && \

2072 !(
	gSLE_VERSION_CODE
 && SLE_VERSION_CODE >
	$SLE_VERSION
(10,2,0)))

2073 
__u16
 
	t__bôwi£
 
	t__sum16
;

2074 
__u32
 
	t__bôwi£
 
	t__wsum
;

2077 #i‡(!(
RHEL_RELEASE_CODE
 && \

2078 (((
RHEL_RELEASE_CODE
 >
	`RHEL_RELEASE_VERSION
(4,7)) && \

2079 (
RHEL_RELEASE_CODE
 < 
	`RHEL_RELEASE_VERSION
(5,0))) || \

2080 (
RHEL_RELEASE_CODE
 >
	`RHEL_RELEASE_VERSION
(5,4)))) && \

2081 !(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
	$SLE_VERSION
(10,2,0)))

2082 
ölöe
 
__wsum
 
	$csum_unfﬁd
(
__sum16
 
n
)

2084  (
__f‹˚
 
__wsum
Ë
n
;

2085 
	}
}

2089 
	#HAVE_DEVICE_NUMA_NODE


	)

2093 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,21) )

2094 
	#to_√t_dev
(
˛ass
Ë
	`c⁄èöî_of
(˛ass, 
√t_devi˚
, 
˛ass_dev
)

	)

2095 
	#NETDEV_CLASS_DEV


	)

2096 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE > 
RHEL_RELEASE_VERSION
(5,5)))

2097 
	#vœn_group_gë_devi˚
(
vg
, 
id
Ë(vg->
vœn_devi˚s
[id])

	)

2098 
	#vœn_group_£t_devi˚
(
vg
, 
id
, 
dev
) \

2100 i‡(
vg
Ëvg->
vœn_devi˚s
[
id
] = 
dev
; \

2101 } 0)

	)

2103 
	#pci_ch™√l_ofÊöe
(
pdev
Ë’dev->
îr‹_°©e
 && \

2104 
pdev
->
îr‹_°©e
 !
pci_ch™√l_io_n‹mÆ
)

	)

2105 
	#pci_ªque°_£À˘ed_ªgi⁄s
(
pdev
, 
b¨s
, 
«me
) \

2106 
	`pci_ªque°_ªgi⁄s
(
pdev
, 
«me
)

	)

2107 
	#pci_ªÀa£_£À˘ed_ªgi⁄s
(
pdev
, 
b¨s
Ë
	`pci_ªÀa£_ªgi⁄s
’dev);

	)

2109 #i‚de‡
__Æig√d


2110 
	#__Æig√d
(
x
Ë
	`__©åibuã__
((
	`Æig√d
(x)))

	)

2113 
pci_dev
 *
_kc_√tdev_to_pdev
(
√t_devi˚
 *
√tdev
);

2114 
	#√tdev_to_dev
(
√tdev
) \

2115 
	`pci_dev_to_dev
(
	`_kc_√tdev_to_pdev
(
√tdev
))

	)

2117 
ölöe
 
devi˚
 *
	$√tdev_to_dev
(
√t_devi˚
 *
√tdev
)

2119  &
√tdev
->
dev
;

2120 
	}
}

2125 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,22) )

2126 
	#t˝_hdr
(
skb
Ë(skb->
h
.
th
)

	)

2127 
	#t˝_hdæí
(
skb
Ë(skb->
h
.
th
->
doff
 << 2)

	)

2128 
	#skb_å™•‹t_off£t
(
skb
Ë(skb->
h
.
øw
 - skb->
d©a
)

	)

2129 
	#skb_å™•‹t_hódî
(
skb
Ë(skb->
h
.
øw
)

	)

2130 
	#ùv6_hdr
(
skb
Ë(skb->
nh
.
ùv6h
)

	)

2131 
	#ù_hdr
(
skb
Ë(skb->
nh
.
ùh
)

	)

2132 
	#skb_√tw‹k_off£t
(
skb
Ë(skb->
nh
.
øw
 - skb->
d©a
)

	)

2133 
	#skb_√tw‹k_hódî
(
skb
Ë(skb->
nh
.
øw
)

	)

2134 
	#skb_èû_poöãr
(
skb
Ëskb->
èû


	)

2135 
	#skb_ª£t_èû_poöãr
(
skb
) \

2137 
skb
->
èû
 = skb->
d©a
; \

2138 } 0)

	)

2139 
	#skb_£t_èû_poöãr
(
skb
, 
off£t
) \

2141 
skb
->
èû
 = skb->
d©a
 + 
off£t
; \

2142 } 0)

	)

2143 
	#skb_c›y_to_löór_d©a
(
skb
, 
‰om
, 
Àn
) \

2144 
	`mem˝y
(
skb
->
d©a
, 
‰om
, 
Àn
)

	)

2145 
	#skb_c›y_to_löór_d©a_off£t
(
skb
, 
off£t
, 
‰om
, 
Àn
) \

2146 
	`mem˝y
(
skb
->
d©a
 + 
off£t
, 
‰om
, 
Àn
)

	)

2147 
	#skb_√tw‹k_hódî_Àn
(
skb
Ë(skb->
h
.
øw
 - skb->
nh
.øw)

	)

2148 
	#pci_ªgi°î_drivî
 
pci_moduÀ_öô


	)

2149 
	#skb_mac_hódî
(
skb
Ëskb->
mac
.
øw


	)

2151 #ifde‡
NETIF_F_MULTI_QUEUE


2152 #i‚de‡
Æloc_ëhîdev_mq


2153 
	#Æloc_ëhîdev_mq
(
_a
, 
_b
Ë
	`Æloc_ëhîdev
(_a)

	)

2157 #i‚de‡
ETH_FCS_LEN


2158 
	#ETH_FCS_LEN
 4

	)

2160 
	#ˇn˚l_w‹k_sync
(
x
Ë
	`Êush_scheduÀd_w‹k
()

	)

2161 #i‚de‡
udp_hdr


2162 
	#udp_hdr
 
_udp_hdr


	)

2163 
ölöe
 
udphdr
 *
	$_udp_hdr
(c⁄° 
sk_buff
 *
skb
)

2165  (
udphdr
 *)
	`skb_å™•‹t_hódî
(
skb
);

2166 
	}
}

2169 #ifde‡
˝u_to_be16


2170 #unde‡
˝u_to_be16


2172 
	#˝u_to_be16
(
x
Ë
	`__c⁄°™t_ht⁄s
(x)

	)

2174 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE > 
RHEL_RELEASE_VERSION
(5,1)))

2176 
	mDUMP_PREFIX_NONE
,

2177 
	mDUMP_PREFIX_ADDRESS
,

2178 
	mDUMP_PREFIX_OFFSET


2181 #i‚de‡
hex_asc


2182 
	#hex_asc
(
x
Ë"0123456789abcdef"[x]

	)

2184 
	~<löux/˘y≥.h
>

2185 
_kc_¥öt_hex_dump
(c⁄° *
Àvñ
, c⁄° *
¥efix_°r
,

2186 
¥efix_ty≥
, 
rowsize
, 
groupsize
,

2187 c⁄° *
buf
, 
size_t
 
Àn
, 
boﬁ
 
ascii
);

2188 
	#¥öt_hex_dump
(
lvl
, 
s
, 
t
, 
r
, 
g
, 
b
, 
l
, 
a
) \

2189 
	`_kc_¥öt_hex_dump
(
lvl
, 
s
, 
t
, 
r
, 
g
, 
b
, 
l
, 
a
)

	)

2190 #i‚de‡
ADVERTISED_2500ba£X_FuŒ


2191 
	#ADVERTISED_2500ba£X_FuŒ
 (1 << 15)

	)

2193 #i‚de‡
SUPPORTED_2500ba£X_FuŒ


2194 
	#SUPPORTED_2500ba£X_FuŒ
 (1 << 15)

	)

2198 
	#ETH_TYPE_TRANS_SETS_DEV


	)

2199 
	#HAVE_NETDEV_STATS_IN_NETDEV


	)

2203 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,6,22) )

2204 #unde‡
SET_MODULE_OWNER


2205 
	#SET_MODULE_OWNER
(
dev
Ëdÿ{ } 0)

	)

2209 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,23) )

2210 
	#√tif_subqueue_°›≥d
(
_a
, 
_b
Ë0

	)

2211 #i‚de‡
PTR_ALIGN


2212 
	#PTR_ALIGN
(
p
, 
a
Ë((
	`ty≥of
’))
	`ALIGN
(()’), (a)))

	)

2215 #i‚de‡
CONFIG_PM_SLEEP


2216 
	#CONFIG_PM_SLEEP
 
CONFIG_PM


	)

2219 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,6,13) )

2220 
	#HAVE_ETHTOOL_GET_PERM_ADDR


	)

2225 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,24) )

2226 #i‚de‡
ETH_FLAG_LRO


2227 
	#ETH_FLAG_LRO
 
NETIF_F_LRO


	)

2231 #i‚de‡
NETIF_F_GRO


2233 
	s«pi_°ru˘
 {

2235 (*
	mpﬁl
Ë(
	m«pi_°ru˘
 *, );

2236 
√t_devi˚
 *
	mdev
;

2237 
	mweight
;

2241 #ifde‡
NAPI


2242 
__kc_ad≠ãr_˛ón
(
√t_devi˚
 *, *);

2243 
	#«pi_to_pﬁl_dev
(
_«pi
Ë(_«pi)->
dev


	)

2244 
	#√tif_«pi_add
(
_√tdev
, 
_«pi
, 
_pﬁl
, 
_weight
) \

2246 
«pi_°ru˘
 *
__«pi
 = (
_«pi
); \

2247 
_√tdev
->
pﬁl
 = &(
__kc_ad≠ãr_˛ón
); \

2248 
_√tdev
->
weight
 = (
_weight
); \

2249 
__«pi
->
pﬁl
 = &(
_pﬁl
); \

2250 
__«pi
->
weight
 = (
_weight
); \

2251 
__«pi
->
dev
 = (
_√tdev
); \

2252 
	`√tif_pﬁl_dißbÀ
(
_√tdev
); \

2253 } 0)

	)

2254 
	#√tif_«pi_dñ
(
_a
Ëdÿ{} 0)

	)

2255 
	#«pi_scheduÀ_¥ï
(
_«pi
Ë
	`√tif_rx_scheduÀ_¥ï
((_«pi)->
dev
)

	)

2256 
	#«pi_scheduÀ
(
_«pi
Ë
	`√tif_rx_scheduÀ
((_«pi)->
dev
)

	)

2257 
	#«pi_íabÀ
(
_«pi
Ë
	`√tif_pﬁl_íabÀ
(
	`«pi_to_pﬁl_dev
(_«pi))

	)

2258 
	#«pi_dißbÀ
(
_«pi
Ë
	`√tif_pﬁl_dißbÀ
(
	`«pi_to_pﬁl_dev
(_«pi))

	)

2259 #ifde‡
CONFIG_SMP


2260 
ölöe
 
	$«pi_synchr⁄ize
(c⁄° 
«pi_°ru˘
 *
n
)

2262 
√t_devi˚
 *
dev
 = 
	`«pi_to_pﬁl_dev
(
n
);

2264 
	`ã°_bô
(
__LINK_STATE_RX_SCHED
, &
dev
->
°©e
)) {

2266 
	`m¶ìp
(1);

2268 
	}
}

2270 
	#«pi_synchr⁄ize
(
n
Ë
	`b¨rõr
()

	)

2272 
	#__«pi_scheduÀ
(
_«pi
Ë
	`__√tif_rx_scheduÀ
(
	`«pi_to_pﬁl_dev
(_«pi))

	)

2273 #i‚de‡
NETIF_F_GRO


2274 
	#«pi_com∂ëe
(
_«pi
Ë
	`√tif_rx_com∂ëe
(
	`«pi_to_pﬁl_dev
(_«pi))

	)

2276 
	#«pi_com∂ëe
(
_«pi
) \

2278 
	`«pi_gro_Êush
(
_«pi
); \

2279 
	`√tif_rx_com∂ëe
(
	`«pi_to_pﬁl_dev
(
_«pi
)); \

2280 } 0)

	)

2283 
	#√tif_«pi_add
(
_√tdev
, 
_«pi
, 
_pﬁl
, 
_weight
) \

2285 
«pi_°ru˘
 *
__«pi
 = 
_«pi
; \

2286 
_√tdev
->
pﬁl
 = &(
_pﬁl
); \

2287 
_√tdev
->
weight
 = (
_weight
); \

2288 
__«pi
->
pﬁl
 = &(
_pﬁl
); \

2289 
__«pi
->
weight
 = (
_weight
); \

2290 
__«pi
->
dev
 = (
_√tdev
); \

2291 } 0)

	)

2292 
	#√tif_«pi_dñ
(
_a
Ëdÿ{} 0)

	)

2295 #unde‡
dev_gë_by_«me


2296 
	#dev_gë_by_«me
(
_a
, 
_b
Ë
	`dev_gë_by_«me
(_b)

	)

2297 
	#__√tif_subqueue_°›≥d
(
_a
, 
_b
Ë
	`√tif_subqueue_°›≥d
(_a, _b)

	)

2298 #i‚de‡
DMA_BIT_MASK


2299 
	#DMA_BIT_MASK
(
n
Ë((“Ë=64Ë? 
DMA_64BIT_MASK
 : ((1ULL<<“))-1))

	)

2302 #ifde‡
NETIF_F_TSO6


2303 
	#skb_is_gso_v6
 
_kc_skb_is_gso_v6


	)

2304 
ölöe
 
	$_kc_skb_is_gso_v6
(c⁄° 
sk_buff
 *
skb
)

2306  
	`skb_shöfo
(
skb
)->
gso_ty≥
 & 
SKB_GSO_TCPV6
;

2307 
	}
}

2310 #i‚de‡
KERN_CONT


2311 
	#KERN_CONT
 ""

	)

2313 #i‚de‡
¥_îr


2314 
	#¥_îr
(
fmt
, 
¨g
...) \

2315 
	`¥ötk
(
KERN_ERR
 
fmt
, ##
¨g
)

	)

2318 
	#HAVE_ETHTOOL_GET_SSET_COUNT


	)

2319 
	#HAVE_NETDEV_NAPI_LIST


	)

2323 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,6,24) )

2324 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,2,0) )

2325 
	~<löux/pm_qos_∑øms.h
>

2327 
	~<löux/pm_qos.h
>

2332 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,25) )

2333 
	#PM_QOS_CPU_DMA_LATENCY
 1

	)

2335 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,6,18) )

2336 
	~<löux/œãncy.h
>

2337 
	#PM_QOS_DEFAULT_VALUE
 
INFINITE_LATENCY


	)

2338 
	#pm_qos_add_ªquúemít
(
pm_qos_˛ass
, 
«me
, 
vÆue
) \

2339 
	`£t_ac˚±abÀ_œãncy
(
«me
, 
vÆue
)

	)

2340 
	#pm_qos_ªmove_ªquúemít
(
pm_qos_˛ass
, 
«me
) \

2341 
	`ªmove_ac˚±abÀ_œãncy
(
«me
)

	)

2342 
	#pm_qos_upd©e_ªquúemít
(
pm_qos_˛ass
, 
«me
, 
vÆue
) \

2343 
	`modify_ac˚±abÀ_œãncy
(
«me
, 
vÆue
)

	)

2345 
	#PM_QOS_DEFAULT_VALUE
 -1

	)

2346 
	#pm_qos_add_ªquúemít
(
pm_qos_˛ass
, 
«me
, 
vÆue
)

	)

2347 
	#pm_qos_ªmove_ªquúemít
(
pm_qos_˛ass
, 
«me
)

	)

2348 
	#pm_qos_upd©e_ªquúemít
(
pm_qos_˛ass
, 
«me
, 
vÆue
) { \

2349 i‡(
vÆue
 !
PM_QOS_DEFAULT_VALUE
) { \

2350 
	`¥ötk
(
KERN_WARNING
 "%s: unableÅo set PM QoSÑequirement\n", \

2351 
	`pci_«me
(
ad≠ãr
->
pdev
)); \

2353 }

	)

2357 
	#pci_íabÀ_devi˚_mem
(
pdev
Ë
	`pci_íabÀ_devi˚
’dev)

	)

2359 #i‚de‡
DEFINE_PCI_DEVICE_TABLE


2360 
	#DEFINE_PCI_DEVICE_TABLE
(
_èbÀ
Ë
pci_devi˚_id
 _èbÀ[]

	)

2368 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,26) )

2369 #i‚de‡
˛amp_t


2370 
	#˛amp_t
(
ty≥
, 
vÆ
, 
mö
, 
max
) ({ \

2371 
ty≥
 
__vÆ
 = (
vÆ
); \

2372 
ty≥
 
__mö
 = (
mö
); \

2373 
ty≥
 
__max
 = (
max
); \

2374 
__vÆ
 = __vÆ < 
__mö
 ? __min : __val; \

2375 
__vÆ
 > 
__max
 ? __max : __vÆ; })

	)

2377 #unde‡
kzÆloc_node


2378 
	#kzÆloc_node
(
_size
, 
_Êags
, 
_node
Ë
	`kzÆloc
(_size, _Êags)

	)

2380 
_kc_pci_dißbÀ_lök_°©e
(
pci_dev
 *
dev
, 
°©e
);

2381 
	#pci_dißbÀ_lök_°©e
(
p
, 
s
Ë
	`_kc_pci_dißbÀ_lök_°©e
’, s)

	)

2383 
	~<löux/pci-a•m.h
>

2384 
	#HAVE_NETDEV_VLAN_FEATURES


	)

2385 #i‚de‡
PCI_EXP_LNKCAP_ASPMS


2386 
	#PCI_EXP_LNKCAP_ASPMS
 0x00000c00

	)

2390 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,27) )

2391 
ölöe
 
	$_kc_ëhtoﬁ_cmd_•ìd_£t
(
ëhtoﬁ_cmd
 *
ï
,

2392 
__u32
 
•ìd
)

2394 
ï
->
•ìd
 = (
__u16
) speed;

2396 
	}
}

2398 
	#ëhtoﬁ_cmd_•ìd_£t
 
_kc_ëhtoﬁ_cmd_•ìd_£t


	)

2400 
ölöe
 
__u32
 
	$_kc_ëhtoﬁ_cmd_•ìd
(
ëhtoﬁ_cmd
 *
ï
)

2403  (
__u32
Ë
ï
->
•ìd
;

2404 
	}
}

2406 
	#ëhtoﬁ_cmd_•ìd
 
_kc_ëhtoﬁ_cmd_•ìd


	)

2408 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,15) )

2409 #i‡((
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,23)Ë&& 
deföed
(
CONFIG_PM
))

2410 
	#ANCIENT_PM
 1

	)

2411 #ñi‡((
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,23)) && \

2412 (
	gLINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,26)) && \

2413 
	$deföed
(
CONFIG_PM_SLEEP
))

2414 
	#NEWER_PM
 1

	)

2416 #i‡
	`deföed
(
ANCIENT_PM
Ë|| deföed(
NEWER_PM
)

2417 #unde‡
devi˚_£t_wakeup_íabÀ


2418 
	#devi˚_£t_wakeup_íabÀ
(
dev
, 
vÆ
) \

2420 
u16
 
pmc
 = 0; \

2421 
pm
 = 
	`pci_föd_ˇ∑bûôy
(
ad≠ãr
->
pdev
, 
PCI_CAP_ID_PM
); \

2422 i‡(
pm
) { \

2423 
	`pci_ªad_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
pm
 + 
PCI_PM_PMC
, \

2424 &
pmc
); \

2426 (
dev
)->
powî
.
ˇn_wakeup
 = !!(
pmc
 >> 11); \

2427 (
dev
)->
powî
.
should_wakeup
 = (
vÆ
 && (
pmc
 >> 11)); \

2428 
	}
} 0)

	)

2431 #i‚de‡
√tif_«pi_dñ


2432 
	#√tif_«pi_dñ
(
_a
Ëdÿ{} 0)

	)

2433 #ifde‡
NAPI


2434 #ifde‡
CONFIG_NETPOLL


2435 #unde‡
√tif_«pi_dñ


2436 
	#√tif_«pi_dñ
(
_a
Ë
	`li°_dñ
(&(_a)->
dev_li°
);

	)

2440 #ifde‡
dma_m≠pög_îr‹


2441 #unde‡
dma_m≠pög_îr‹


2443 
	#dma_m≠pög_îr‹
(
dev
, 
dma_addr
Ë
	`pci_dma_m≠pög_îr‹
(dma_addr)

	)

2445 #ifde‡
HAVE_TX_MQ


2446 
_kc_√tif_tx_°›_Æl_queues
(
√t_devi˚
 *);

2447 
_kc_√tif_tx_wake_Æl_queues
(
√t_devi˚
 *);

2448 
_kc_√tif_tx_°¨t_Æl_queues
(
√t_devi˚
 *);

2449 
	#√tif_tx_°›_Æl_queues
(
a
Ë
	`_kc_√tif_tx_°›_Æl_queues
◊)

	)

2450 
	#√tif_tx_wake_Æl_queues
(
a
Ë
	`_kc_√tif_tx_wake_Æl_queues
◊)

	)

2451 
	#√tif_tx_°¨t_Æl_queues
(
a
Ë
	`_kc_√tif_tx_°¨t_Æl_queues
◊)

	)

2452 #unde‡
√tif_°›_subqueue


2453 
	#√tif_°›_subqueue
(
_ndev
,
_qi
) do { \

2454 i‡(
	`√tif_is_mu…iqueue
((
_ndev
))) \

2455 
	`√tif_°›_subqueue
((
_ndev
), (
_qi
)); \

2457 
	`√tif_°›_queue
((
_ndev
)); \

2458 } 0)

	)

2459 #unde‡
√tif_°¨t_subqueue


2460 
	#√tif_°¨t_subqueue
(
_ndev
,
_qi
) do { \

2461 i‡(
	`√tif_is_mu…iqueue
((
_ndev
))) \

2462 
	`√tif_°¨t_subqueue
((
_ndev
), (
_qi
)); \

2464 
	`√tif_°¨t_queue
((
_ndev
)); \

2465 } 0)

	)

2467 
	#√tif_tx_°›_Æl_queues
(
a
Ë
	`√tif_°›_queue
◊)

	)

2468 
	#√tif_tx_wake_Æl_queues
(
a
Ë
	`√tif_wake_queue
◊)

	)

2469 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,12) )

2470 
	#√tif_tx_°¨t_Æl_queues
(
a
Ë
	`√tif_°¨t_queue
◊)

	)

2472 
	#√tif_tx_°¨t_Æl_queues
(
a
Ëdÿ{} 0)

	)

2474 
	#√tif_°›_subqueue
(
_ndev
,
_qi
Ë
	`√tif_°›_queue
((_ndev))

	)

2475 
	#√tif_°¨t_subqueue
(
_ndev
,
_qi
Ë
	`√tif_°¨t_queue
((_ndev))

	)

2477 #i‚de‡
NETIF_F_MULTI_QUEUE


2478 
	#NETIF_F_MULTI_QUEUE
 0

	)

2479 
	#√tif_is_mu…iqueue
(
a
Ë0

	)

2480 
	#√tif_wake_subqueue
(
a
, 
b
)

	)

2483 #i‚de‡
__WARN_¥ötf


2484 
	$__kc_w¨n_¶ow∑th
(c⁄° *
fûe
, c⁄° 
löe
,

2485 c⁄° *
fmt
, ...)

2486 
	`__©åibuã__
 ((
	`f‹m©
(
¥ötf
, 3, 4)));

2487 
	#__WARN_¥ötf
(
¨g
...Ë
	`__kc_w¨n_¶ow∑th
(
__FILE__
, 
__LINE__
,árg)

	)

2490 #i‚de‡
WARN


2491 
	#WARN
(
c⁄dôi⁄
, 
f‹m©
...) ({ \

2492 
__ªt_w¨n_⁄
 = !!(
c⁄dôi⁄
); \

2493 i‡(
	`u∆ikñy
(
__ªt_w¨n_⁄
)) \

2494 
	`__WARN_¥ötf
(
f‹m©
); \

2495 
	`u∆ikñy
(
__ªt_w¨n_⁄
); \

2496 
	}
})

	)

2498 #unde‡
HAVE_IXGBE_DEBUG_FS


2499 #unde‡
HAVE_IGB_DEBUG_FS


2501 
	#HAVE_TX_MQ


	)

2502 
	#HAVE_NETDEV_SELECT_QUEUE


	)

2503 #ifde‡
CONFIG_DEBUG_FS


2504 
	#HAVE_IXGBE_DEBUG_FS


	)

2505 
	#HAVE_IGB_DEBUG_FS


	)

2510 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,28) )

2511 
	#pci_i‹em≠_b¨
(
pdev
, 
b¨
Ë
	`i‹em≠
(
	`pci_ªsour˚_°¨t
(pdev, bar), \

2512 
	`pci_ªsour˚_Àn
(
pdev
, 
b¨
))

	)

2513 
	#pci_wake_‰om_d3
 
_kc_pci_wake_‰om_d3


	)

2514 
	#pci_¥ï¨e_to_¶ìp
 
_kc_pci_¥ï¨e_to_¶ìp


	)

2515 
_kc_pci_wake_‰om_d3
(
pci_dev
 *
dev
, 
boﬁ
 
íabÀ
);

2516 
_kc_pci_¥ï¨e_to_¶ìp
(
pci_dev
 *
dev
);

2517 
	#√tdev_Æloc_∑ge
(
a
Ë
	`Æloc_∑ge
(
GFP_ATOMIC
)

	)

2518 #i‚de‡
__skb_queue_hód_öô


2519 
ölöe
 
	$__kc_skb_queue_hód_öô
(
sk_buff_hód
 *
li°
)

2521 
li°
->
¥ev
 =Üi°->
√xt
 = (
sk_buff
 *)list;

2522 
li°
->
qÀn
 = 0;

2523 
	}
}

2525 
	#__skb_queue_hód_öô
(
_q
Ë
	`__kc_skb_queue_hód_öô
(_q)

	)

2528 
	#PCI_EXP_DEVCAP2
 36

	)

2529 
	#PCI_EXP_DEVCTL2
 40

	)

2534 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,29) )

2535 #i‚de‡
sw≠


2536 
	#sw≠
(
a
, 
b
) \

2537 dÿ{ 
	`ty≥of
(
a
Ë
__tmp
 = (a); (aË(
b
); (bË__tmp; } 0)

	)

2539 
	#pci_ªque°_£À˘ed_ªgi⁄s_ex˛usive
(
pdev
, 
b¨s
, 
«me
) \

2540 
	`pci_ªque°_£À˘ed_ªgi⁄s
(
pdev
, 
b¨s
, 
«me
)

	)

2541 #i‚de‡
CONFIG_NR_CPUS


2542 
	#CONFIG_NR_CPUS
 1

	)

2544 #i‚de‡
pcõ_a•m_íabÀd


2545 
	#pcõ_a•m_íabÀd
(Ë(1)

	)

2548 
	#PCI_EXP_SLTSTA_PDS
 0x0040

	)

2550 #i‚de‡
pci_˛ór_ma°î


2551 
_kc_pci_˛ór_ma°î
(
pci_dev
 *
dev
);

2552 
	#pci_˛ór_ma°î
(
dev
Ë
	`_kc_pci_˛ór_ma°î
(dev)

	)

2555 #i‚de‡
PCI_EXP_LNKCTL_ASPMC


2556 
	#PCI_EXP_LNKCTL_ASPMC
 0x0003

	)

2559 #i‚de‡
HAVE_NET_DEVICE_OPS


2560 
	#HAVE_NET_DEVICE_OPS


	)

2562 #ifde‡
CONFIG_DCB


2563 
	#HAVE_PFC_MODE_ENABLE


	)

2568 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,30) )

2569 
	#skb_rx_queue_ªc‹ded
(
a
Ë
Ál£


	)

2570 
	#skb_gë_rx_queue
(
a
Ë0

	)

2571 
	#skb_ªc‹d_rx_queue
(
a
, 
b
Ëdÿ{} 0)

	)

2572 
	#skb_tx_hash
(
n
, 
s
Ë
	`___kc_skb_tx_hash
(“), (s), (n)->
ªÆ_num_tx_queues
)

	)

2573 #i‚de‡
CONFIG_PCI_IOV


2574 #unde‡
pci_íabÀ_§iov


2575 
	#pci_íabÀ_§iov
(
a
, 
b
Ë-
ENOTSUPP


	)

2576 #unde‡
pci_dißbÀ_§iov


2577 
	#pci_dißbÀ_§iov
(
a
Ëdÿ{} 0)

	)

2579 #i‚de‡
¥_c⁄t


2580 
	#¥_c⁄t
(
fmt
, ...) \

2581 
	`¥ötk
(
KERN_CONT
 
fmt
, ##
__VA_ARGS__
)

	)

2583 
ölöe
 
	$_kc_synchr⁄ize_úq
(
a
)

2585 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,5,28) )

2586 
	`synchr⁄ize_úq
();

2588 
	`synchr⁄ize_úq
(
a
);

2590 
	}
}

2592 #unde‡
synchr⁄ize_úq


2593 
	#synchr⁄ize_úq
(
a
Ë
	`_kc_synchr⁄ize_úq
◊)

	)

2595 
	#PCI_EXP_LNKCTL2
 48

	)

2598 
	#HAVE_ASPM_QUIRKS


	)

2602 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,31) )

2603 
	#ETH_P_1588
 0x88F7

	)

2604 
	#ETH_P_FIP
 0x8914

	)

2605 #i‚de‡
√tdev_uc_cou¡


2606 
	#√tdev_uc_cou¡
(
dev
Ë((dev)->
uc_cou¡
)

	)

2608 #i‚de‡
√tdev_f‹_óch_uc_addr


2609 
	#√tdev_f‹_óch_uc_addr
(
u˛i°
, 
dev
) \

2610 
u˛i°
 = 
dev
->
uc_li°
; u˛i°; u˛i° = u˛i°->
√xt
)

	)

2612 #i‚de‡
PORT_OTHER


2613 
	#PORT_OTHER
 0xff

	)

2615 #i‚de‡
MDIO_PHY_ID_PRTAD


2616 
	#MDIO_PHY_ID_PRTAD
 0x03e0

	)

2618 #i‚de‡
MDIO_PHY_ID_DEVAD


2619 
	#MDIO_PHY_ID_DEVAD
 0x001f

	)

2621 #i‚de‡
skb_d°


2622 
	#skb_d°
(
s
Ë((s)->
d°
)

	)

2625 #i‚de‡
SUPPORTED_1000ba£KX_FuŒ


2626 
	#SUPPORTED_1000ba£KX_FuŒ
 (1 << 17)

	)

2628 #i‚de‡
SUPPORTED_10000ba£KX4_FuŒ


2629 
	#SUPPORTED_10000ba£KX4_FuŒ
 (1 << 18)

	)

2631 #i‚de‡
SUPPORTED_10000ba£KR_FuŒ


2632 
	#SUPPORTED_10000ba£KR_FuŒ
 (1 << 19)

	)

2635 #i‚de‡
ADVERTISED_1000ba£KX_FuŒ


2636 
	#ADVERTISED_1000ba£KX_FuŒ
 (1 << 17)

	)

2638 #i‚de‡
ADVERTISED_10000ba£KX4_FuŒ


2639 
	#ADVERTISED_10000ba£KX4_FuŒ
 (1 << 18)

	)

2641 #i‚de‡
ADVERTISED_10000ba£KR_FuŒ


2642 
	#ADVERTISED_10000ba£KR_FuŒ
 (1 << 19)

	)

2646 #i‚de‡
HAVE_NETDEV_STORAGE_ADDRESS


2647 
	#HAVE_NETDEV_STORAGE_ADDRESS


	)

2649 #i‚de‡
HAVE_NETDEV_HW_ADDR


2650 
	#HAVE_NETDEV_HW_ADDR


	)

2652 #i‚de‡
HAVE_TRANS_START_IN_QUEUE


2653 
	#HAVE_TRANS_START_IN_QUEUE


	)

2655 #i‚de‡
HAVE_INCLUDE_LINUX_MDIO_H


2656 
	#HAVE_INCLUDE_LINUX_MDIO_H


	)

2661 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,32) )

2662 #unde‡
√tdev_tx_t


2663 
	#√tdev_tx_t
 

	)

2664 #i‡
deföed
(
CONFIG_FCOE
Ë|| deföed(
CONFIG_FCOE_MODULE
)

2665 #i‚de‡
NETIF_F_FCOE_MTU


2666 
	#NETIF_F_FCOE_MTU
 (1 << 26)

	)

2670 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0) )

2671 
ölöe
 
	$_kc_pm_ru¡ime_gë_sync
()

2674 
	}
}

2676 
	#pm_ru¡ime_gë_sync
(
dev
Ë
	`_kc_pm_ru¡ime_gë_sync
()

	)

2678 
ölöe
 
	$_kc_pm_ru¡ime_gë_sync
(
devi˚
 *
dev
)

2681 
	}
}

2683 #i‚de‡
pm_ru¡ime_gë_sync


2684 
	#pm_ru¡ime_gë_sync
(
dev
Ë
	`_kc_pm_ru¡ime_gë_sync
(dev)

	)

2687 #i‚de‡
pm_ru¡ime_put


2688 
	#pm_ru¡ime_put
(
dev
Ëdÿ{} 0)

	)

2690 #i‚de‡
pm_ru¡ime_put_sync


2691 
	#pm_ru¡ime_put_sync
(
dev
Ëdÿ{} 0)

	)

2693 #i‚de‡
pm_ru¡ime_ªsume


2694 
	#pm_ru¡ime_ªsume
(
dev
Ëdÿ{} 0)

	)

2696 #i‚de‡
pm_scheduÀ_su•íd


2697 
	#pm_scheduÀ_su•íd
(
dev
, 
t
Ëdÿ{} 0)

	)

2699 #i‚de‡
pm_ru¡ime_£t_su•íded


2700 
	#pm_ru¡ime_£t_su•íded
(
dev
Ëdÿ{} 0)

	)

2702 #i‚de‡
pm_ru¡ime_dißbÀ


2703 
	#pm_ru¡ime_dißbÀ
(
dev
Ëdÿ{} 0)

	)

2705 #i‚de‡
pm_ru¡ime_put_noidÀ


2706 
	#pm_ru¡ime_put_noidÀ
(
dev
Ëdÿ{} 0)

	)

2708 #i‚de‡
pm_ru¡ime_£t_a˘ive


2709 
	#pm_ru¡ime_£t_a˘ive
(
dev
Ëdÿ{} 0)

	)

2711 #i‚de‡
pm_ru¡ime_íabÀ


2712 
	#pm_ru¡ime_íabÀ
(
dev
Ëdÿ{} 0)

	)

2714 #i‚de‡
pm_ru¡ime_gë_n‹esume


2715 
	#pm_ru¡ime_gë_n‹esume
(
dev
Ëdÿ{} 0)

	)

2718 #i‡
deföed
(
CONFIG_FCOE
Ë|| deföed(
CONFIG_FCOE_MODULE
)

2719 #i‚de‡
HAVE_NETDEV_OPS_FCOE_ENABLE


2720 
	#HAVE_NETDEV_OPS_FCOE_ENABLE


	)

2723 #ifde‡
CONFIG_DCB


2724 #i‚de‡
HAVE_DCBNL_OPS_GETAPP


2725 
	#HAVE_DCBNL_OPS_GETAPP


	)

2728 
	~<löux/pm_ru¡ime.h
>

2730 
	#HAVE_PCIE_TYPE


	)

2734 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,33) )

2735 #i‚de‡
pci_pcõ_ˇp


2736 
	#pci_pcõ_ˇp
(
pdev
Ë
	`pci_föd_ˇ∑bûôy
’dev, 
PCI_CAP_ID_EXP
)

	)

2738 #i‚de‡
IPV4_FLOW


2739 
	#IPV4_FLOW
 0x10

	)

2741 #i‚de‡
IPV6_FLOW


2742 
	#IPV6_FLOW
 0x11

	)

2745 #i‡–(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(6,0)) || \

2746 (
	gSLE_VERSION_CODE
 && SLE_VERSION_CODE >
	$SLE_VERSION
(11,1,0)) )

2747 #i‡
	`deföed
(
CONFIG_FCOE
Ë|| deföed(
CONFIG_FCOE_MODULE
)

2748 #i‚de‡
HAVE_NETDEV_OPS_FCOE_GETWWN


2749 
	#HAVE_NETDEV_OPS_FCOE_GETWWN


	)

2753 #i‚de‡
__≥r˝u


2754 
	#__≥r˝u


	)

2756 #i‚de‡
PORT_DA


2757 
	#PORT_DA
 
PORT_OTHER


	)

2759 #i‚de‡
PORT_NONE


2760 
	#PORT_NONE
 
PORT_OTHER


	)

2763 #i‡((
RHEL_RELEASE_CODE
 && \

2764 (
RHEL_RELEASE_CODE
 >
	`RHEL_RELEASE_VERSION
(6,3)) && \

2765 (
RHEL_RELEASE_CODE
 < 
	$RHEL_RELEASE_VERSION
(7,0))))

2766 #i‡!
	`deföed
(
CONFIG_X86_32
Ë&& !deföed(
CONFIG_NEED_DMA_MAP_STATE
)

2767 #unde‡
DEFINE_DMA_UNMAP_ADDR


2768 
	#DEFINE_DMA_UNMAP_ADDR
(
ADDR_NAME
Ë
dma_addr_t
 
	)
ADDR_NAME

2769 #unde‡
DEFINE_DMA_UNMAP_LEN


2770 
	#DEFINE_DMA_UNMAP_LEN
(
LEN_NAME
Ë
__u32
 
	)
LEN_NAME

2771 #unde‡
dma_unm≠_addr


2772 
	#dma_unm≠_addr
(
PTR
, 
ADDR_NAME
Ë((PTR)->ADDR_NAME)

	)

2773 #unde‡
dma_unm≠_addr_£t


2774 
	#dma_unm≠_addr_£t
(
PTR
, 
ADDR_NAME
, 
VAL
Ë(((PTR)->ADDR_NAMEË(VAL))

	)

2775 #unde‡
dma_unm≠_Àn


2776 
	#dma_unm≠_Àn
(
PTR
, 
LEN_NAME
Ë((PTR)->LEN_NAME)

	)

2777 #unde‡
dma_unm≠_Àn_£t


2778 
	#dma_unm≠_Àn_£t
(
PTR
, 
LEN_NAME
, 
VAL
Ë(((PTR)->LEN_NAMEË(VAL))

	)

2782 #i‡(!(
RHEL_RELEASE_CODE
 && \

2783 (((
RHEL_RELEASE_CODE
 >
	`RHEL_RELEASE_VERSION
(5,8)) && \

2784 (
RHEL_RELEASE_CODE
 < 
	`RHEL_RELEASE_VERSION
(6,0))) || \

2785 ((
RHEL_RELEASE_CODE
 >
	`RHEL_RELEASE_VERSION
(6,1)) && \

2786 (
RHEL_RELEASE_CODE
 < 
	$RHEL_RELEASE_VERSION
(7,0))))))

2787 
ölöe
 
boﬁ
 
	$pci_is_pcõ
(
pci_dev
 *
dev
)

2789  !!
	`pci_pcõ_ˇp
(
dev
);

2790 
	}
}

2793 #i‚de‡
__Æways_unu£d


2794 
	#__Æways_unu£d
 
	`__©åibuã__
((
__unu£d__
))

	)

2796 #i‚de‡
__maybe_unu£d


2797 
	#__maybe_unu£d
 
	`__©åibuã__
((
__unu£d__
))

	)

2800 #i‡(!(
RHEL_RELEASE_CODE
 && \

2801 (
	gRHEL_RELEASE_CODE
 >
	$RHEL_RELEASE_VERSION
(6,2))))

2802 
	#sk_tx_queue_gë
(
_sk
Ë(-1)

	)

2803 
	#sk_tx_queue_£t
(
_sk
, 
_tx_queue
Ëdÿ{
	}
} 0)

	)

2806 #i‡(
RHEL_RELEASE_CODE
 && \

2807 (
	gRHEL_RELEASE_CODE
 >
RHEL_RELEASE_VERSION
(6,4)) && \

2808 (
	gRHEL_RELEASE_CODE
 < 
	$RHEL_RELEASE_VERSION
(7,0)))

2809 
	#HAVE_RHEL6_ETHTOOL_OPS_EXT_STRUCT


	)

2810 
	#HAVE_ETHTOOL_SET_PHYS_ID


	)

2811 
	#HAVE_ETHTOOL_GET_TS_INFO


	)

2815 #i‡
	`deföed
(
CONFIG_FCOE
Ë|| deföed(
CONFIG_FCOE_MODULE
)

2816 #i‚de‡
HAVE_NETDEV_OPS_FCOE_GETWWN


2817 
	#HAVE_NETDEV_OPS_FCOE_GETWWN


	)

2823 #i‡–
LINUX_VERSION_CODE
 < 
	`KERNEL_VERSION
(2,6,34) )

2824 #i‡(
RHEL_RELEASE_CODE
 < 
	`RHEL_RELEASE_VERSION
(6,0))

2825 #i‚de‡
pci_num_vf


2826 
	#pci_num_vf
(
pdev
Ë
	`_kc_pci_num_vf
’dev)

	)

2827 
	`_kc_pci_num_vf
(
pci_dev
 *
dev
);

2831 #i‚de‡
ETH_FLAG_NTUPLE


2832 
	#ETH_FLAG_NTUPLE
 
NETIF_F_NTUPLE


	)

2835 #i‚de‡
√tdev_mc_cou¡


2836 
	#√tdev_mc_cou¡
(
dev
Ë((dev)->
mc_cou¡
)

	)

2838 #i‚de‡
√tdev_mc_em±y


2839 
	#√tdev_mc_em±y
(
dev
Ë(
	`√tdev_mc_cou¡
(devË=0)

	)

2841 #i‚de‡
√tdev_f‹_óch_mc_addr


2842 
	#√tdev_f‹_óch_mc_addr
(
m˛i°
, 
dev
) \

2843 
m˛i°
 = 
dev
->
mc_li°
; m˛i°; m˛i° = m˛i°->
√xt
)

	)

2845 #i‚de‡
√tdev_uc_cou¡


2846 
	#√tdev_uc_cou¡
(
dev
Ë((dev)->
uc
.
cou¡
)

	)

2848 #i‚de‡
√tdev_uc_em±y


2849 
	#√tdev_uc_em±y
(
dev
Ë(
	`√tdev_uc_cou¡
(devË=0)

	)

2851 #i‚de‡
√tdev_f‹_óch_uc_addr


2852 
	#√tdev_f‹_óch_uc_addr
(
ha
, 
dev
) \

2853 
	`li°_f‹_óch_íåy
(
ha
, &
dev
->
uc
.
li°
,Üi°)

	)

2855 #i‚de‡
dma_£t_cohîít_mask


2856 
	#dma_£t_cohîít_mask
(
dev
,
mask
) \

2857 
	`pci_£t_c⁄si°ít_dma_mask
(
	`to_pci_dev
(
dev
),(
mask
))

	)

2859 #i‚de‡
pci_dev_run_wake


2860 
	#pci_dev_run_wake
(
pdev
Ë(0)

	)

2864 #i‚de‡
√tdev_«me


2865 
ölöe
 c⁄° *
	$_kc_√tdev_«me
(c⁄° 
√t_devi˚
 *
dev
)

2867 i‡(
dev
->
ªg_°©e
 !
NETREG_REGISTERED
)

2869  
dev
->
«me
;

2870 
	}
}

2872 
	#√tdev_«me
(
√tdev
Ë
	`_kc_√tdev_«me
“ëdev)

	)

2875 #unde‡
√tdev_¥ötk


2876 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0) )

2877 
	#√tdev_¥ötk
(
Àvñ
, 
√tdev
, 
f‹m©
, 
¨gs
...) \

2879 
pci_dev
 *
pdev
 = 
	`_kc_√tdev_to_pdev
(
√tdev
); \

2880 
	`¥ötk
(
Àvñ
 "%s: " 
f‹m©
, 
	`pci_«me
(
pdev
), ##
¨gs
); \

2881 } 0)

	)

2882 #ñi‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,21) )

2883 
	#√tdev_¥ötk
(
Àvñ
, 
√tdev
, 
f‹m©
, 
¨gs
...) \

2885 
pci_dev
 *
pdev
 = 
	`_kc_√tdev_to_pdev
(
√tdev
); \

2886 
devi˚
 *
dev
 = 
	`pci_dev_to_dev
(
pdev
); \

2887 
	`dev_¥ötk
(
Àvñ
, 
dev
, "%s: " 
f‹m©
, \

2888 
	`√tdev_«me
(
√tdev
), ##
¨gs
); \

2889 } 0)

	)

2891 
	#√tdev_¥ötk
(
Àvñ
, 
√tdev
, 
f‹m©
, 
¨gs
...) \

2892 
	`dev_¥ötk
(
Àvñ
, (
√tdev
)->
dev
.
∑ª¡
, \

2893 "%s: " 
f‹m©
, \

2894 
	`√tdev_«me
(
√tdev
), ##
¨gs
)

	)

2896 #unde‡
√tdev_emîg


2897 
	#√tdev_emîg
(
dev
, 
f‹m©
, 
¨gs
...) \

2898 
	`√tdev_¥ötk
(
KERN_EMERG
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2899 #unde‡
√tdev_Æît


2900 
	#√tdev_Æît
(
dev
, 
f‹m©
, 
¨gs
...) \

2901 
	`√tdev_¥ötk
(
KERN_ALERT
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2902 #unde‡
√tdev_¸ô


2903 
	#√tdev_¸ô
(
dev
, 
f‹m©
, 
¨gs
...) \

2904 
	`√tdev_¥ötk
(
KERN_CRIT
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2905 #unde‡
√tdev_îr


2906 
	#√tdev_îr
(
dev
, 
f‹m©
, 
¨gs
...) \

2907 
	`√tdev_¥ötk
(
KERN_ERR
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2908 #unde‡
√tdev_w¨n


2909 
	#√tdev_w¨n
(
dev
, 
f‹m©
, 
¨gs
...) \

2910 
	`√tdev_¥ötk
(
KERN_WARNING
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2911 #unde‡
√tdev_nŸi˚


2912 
	#√tdev_nŸi˚
(
dev
, 
f‹m©
, 
¨gs
...) \

2913 
	`√tdev_¥ötk
(
KERN_NOTICE
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2914 #unde‡
√tdev_öfo


2915 
	#√tdev_öfo
(
dev
, 
f‹m©
, 
¨gs
...) \

2916 
	`√tdev_¥ötk
(
KERN_INFO
, 
dev
, 
f‹m©
, ##
¨gs
)

	)

2917 #unde‡
√tdev_dbg


2918 #i‡ 
deföed
(
CONFIG_DYNAMIC_DEBUG
)

2919 
	#√tdev_dbg
(
__dev
, 
f‹m©
, 
¨gs
...) \

2921 
	`dy«mic_dev_dbg
((
__dev
)->
dev
.
∑ª¡
, "%s: " 
f‹m©
, \

2922 
	`√tdev_«me
(
__dev
), ##
¨gs
); \

2923 } 0)

	)

2925 
	#√tdev_dbg
(
__dev
, 
f‹m©
, 
¨gs
...) \

2928 
	`√tdev_¥ötk
(
KERN_DEBUG
, 
__dev
, 
f‹m©
, ##
¨gs
); \

2930 })

	)

2933 #unde‡
√tif_¥ötk


2934 
	#√tif_¥ötk
(
¥iv
, 
ty≥
, 
Àvñ
, 
dev
, 
fmt
, 
¨gs
...) \

2936 i‡(
√tif_msg_
##
	`ty≥
(
¥iv
)) \

2937 
	`√tdev_¥ötk
(
Àvñ
, (
dev
), 
fmt
, ##
¨gs
); \

2938 } 0)

	)

2940 #unde‡
√tif_emîg


2941 
	#√tif_emîg
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2942 
	`√tif_Àvñ
(
emîg
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2943 #unde‡
√tif_Æît


2944 
	#√tif_Æît
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2945 
	`√tif_Àvñ
(
Æît
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2946 #unde‡
√tif_¸ô


2947 
	#√tif_¸ô
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2948 
	`√tif_Àvñ
(
¸ô
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2949 #unde‡
√tif_îr


2950 
	#√tif_îr
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2951 
	`√tif_Àvñ
(
îr
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2952 #unde‡
√tif_w¨n


2953 
	#√tif_w¨n
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2954 
	`√tif_Àvñ
(
w¨n
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2955 #unde‡
√tif_nŸi˚


2956 
	#√tif_nŸi˚
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2957 
	`√tif_Àvñ
(
nŸi˚
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2958 #unde‡
√tif_öfo


2959 
	#√tif_öfo
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2960 
	`√tif_Àvñ
(
öfo
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2961 #unde‡
√tif_dbg


2962 
	#√tif_dbg
(
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

2963 
	`√tif_Àvñ
(
dbg
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, ##
¨gs
)

	)

2965 #ifde‡
SET_SYSTEM_SLEEP_PM_OPS


2966 
	#HAVE_SYSTEM_SLEEP_PM_OPS


	)

2969 #i‚de‡
f‹_óch_£t_bô


2970 
	#f‹_óch_£t_bô
(
bô
, 
addr
, 
size
) \

2971 (
bô
Ë
	`föd_fú°_bô
((
addr
), (
size
)); \

2972 (
bô
Ë< (
size
); \

2973 (
bô
Ë
	`föd_√xt_bô
((
addr
), (
size
), (bôË+ 1))

	)

2976 #i‚de‡
DEFINE_DMA_UNMAP_ADDR


2977 
	#DEFINE_DMA_UNMAP_ADDR
 
DECLARE_PCI_UNMAP_ADDR


	)

2978 
	#DEFINE_DMA_UNMAP_LEN
 
DECLARE_PCI_UNMAP_LEN


	)

2979 
	#dma_unm≠_addr
 
pci_unm≠_addr


	)

2980 
	#dma_unm≠_addr_£t
 
pci_unm≠_addr_£t


	)

2981 
	#dma_unm≠_Àn
 
pci_unm≠_Àn


	)

2982 
	#dma_unm≠_Àn_£t
 
pci_unm≠_Àn_£t


	)

2985 #i‡(
RHEL_RELEASE_CODE
 < 
RHEL_RELEASE_VERSION
(6,3))

2986 #ifde‡
IGB_HWMON


2987 #ifde‡
CONFIG_DEBUG_LOCK_ALLOC


2988 
	#sysfs_©å_öô
(
©å
) \

2990 
lock_˛ass_key
 
__key
; \

2991 (
©å
)->
key
 = &
__key
; \

2992 } 0)

	)

2994 
	#sysfs_©å_öô
(
©å
Ëdÿ{} 0)

	)

2999 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,0) )

3000 
ölöe
 
boﬁ
 
	$_kc_pm_ru¡ime_su•íded
()

3002  
Ál£
;

3003 
	}
}

3005 
	#pm_ru¡ime_su•íded
(
dev
Ë
	`_kc_pm_ru¡ime_su•íded
()

	)

3007 
ölöe
 
boﬁ
 
	$_kc_pm_ru¡ime_su•íded
(
devi˚
 *
dev
)

3009  
Ál£
;

3010 
	}
}

3012 #i‚de‡
pm_ru¡ime_su•íded


3013 
	#pm_ru¡ime_su•íded
(
dev
Ë
	`_kc_pm_ru¡ime_su•íded
(dev)

	)

3018 
	#HAVE_SYSTEM_SLEEP_PM_OPS


	)

3019 #i‚de‡
HAVE_SET_RX_MODE


3020 
	#HAVE_SET_RX_MODE


	)

3026 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,35) )

3028 
ssize_t
 
_kc_sim∂e_wrôe_to_buf„r
(*
to
, 
size_t
 
avaûabÀ
, 
loff_t
 * 
µos
,

3029 c⁄° 
__u£r
 * 
‰om
, 
size_t
 
cou¡
);

3030 
	#sim∂e_wrôe_to_buf„r
 
_kc_sim∂e_wrôe_to_buf„r


	)

3032 #i‚de‡
numa_node_id


3033 
	#numa_node_id
(Ë0

	)

3035 #ifde‡
HAVE_TX_MQ


3036 
	~<√t/sch_gíîic.h
>

3037 #i‚de‡
CONFIG_NETDEVICES_MULTIQUEUE


3038 #i‡(!(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(6,0)))

3039 
_kc_√tif_£t_ªÆ_num_tx_queues
(
√t_devi˚
 *, );

3040 
	#√tif_£t_ªÆ_num_tx_queues
 
_kc_√tif_£t_ªÆ_num_tx_queues


	)

3043 
	#√tif_£t_ªÆ_num_tx_queues
(
_√tdev
, 
_cou¡
) \

3045 (
_√tdev
)->
egªss_subqueue_cou¡
 = 
_cou¡
; \

3046 } 0)

	)

3049 
	#√tif_£t_ªÆ_num_tx_queues
(
_√tdev
, 
_cou¡
Ëdÿ{} 0)

	)

3051 #i‚de‡
ETH_FLAG_RXHASH


3052 
	#ETH_FLAG_RXHASH
 (1<<28)

	)

3054 #i‡(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(6,0))

3055 
	#HAVE_IRQ_AFFINITY_HINT


	)

3058 
	#HAVE_PM_QOS_REQUEST_LIST


	)

3059 
	#HAVE_IRQ_AFFINITY_HINT


	)

3063 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,36) )

3064 
_kc_ëhtoﬁ_›_£t_Êags
(
√t_devi˚
 *, 
u32
, u32);

3065 
	#ëhtoﬁ_›_£t_Êags
 
_kc_ëhtoﬁ_›_£t_Êags


	)

3066 
u32
 
_kc_ëhtoﬁ_›_gë_Êags
(
√t_devi˚
 *);

3067 
	#ëhtoﬁ_›_gë_Êags
 
_kc_ëhtoﬁ_›_gë_Êags


	)

3069 #ifde‡
CONFIG_HAVE_EFFICIENT_UNALIGNED_ACCESS


3070 #ifde‡
NET_IP_ALIGN


3071 #unde‡
NET_IP_ALIGN


3073 
	#NET_IP_ALIGN
 0

	)

3076 #ifde‡
NET_SKB_PAD


3077 #unde‡
NET_SKB_PAD


3080 #i‡(
L1_CACHE_BYTES
 > 32)

3081 
	#NET_SKB_PAD
 
L1_CACHE_BYTES


	)

3083 
	#NET_SKB_PAD
 32

	)

3086 
ölöe
 
sk_buff
 *
	$_kc_√tdev_Æloc_skb_ù_Æign
(
√t_devi˚


3087 *
dev
,

3088 
Àngth
)

3090 
sk_buff
 *
skb
;

3092 
skb
 = 
	`Æloc_skb
(
Àngth
 + 
NET_SKB_PAD
 + 
NET_IP_ALIGN
, 
GFP_ATOMIC
);

3093 i‡(
skb
) {

3094 #i‡(
NET_IP_ALIGN
 + 
NET_SKB_PAD
)

3095 
	`skb_ª£rve
(
skb
, 
NET_IP_ALIGN
 + 
NET_SKB_PAD
);

3097 
skb
->
dev
 = dev;

3099  
skb
;

3100 
	}
}

3102 #ifde‡
√tdev_Æloc_skb_ù_Æign


3103 #unde‡
√tdev_Æloc_skb_ù_Æign


3105 
	#√tdev_Æloc_skb_ù_Æign
(
n
, 
l
Ë
	`_kc_√tdev_Æloc_skb_ù_Æign
“,Ü)

	)

3107 #unde‡
√tif_Àvñ


3108 
	#√tif_Àvñ
(
Àvñ
, 
¥iv
, 
ty≥
, 
dev
, 
fmt
, 
¨gs
...) \

3110 i‡(
√tif_msg_
##
	`ty≥
(
¥iv
)) \

3111 
√tdev_
##
	`Àvñ
(
dev
, 
fmt
, ##
¨gs
); \

3112 } 0)

	)

3114 #unde‡
u¶ìp_ønge


3115 
	#u¶ìp_ønge
(
mö
, 
max
Ë
	`m¶ìp
(
	`DIV_ROUND_UP
(mö, 1000))

	)

3117 
	#u64_°©s_upd©e_begö
(
a
Ëdÿ{ } 0)

	)

3118 
	#u64_°©s_upd©e_íd
(
a
Ëdÿ{ } 0)

	)

3119 
	#u64_°©s_„tch_begö
(
a
Ëdÿ{ } 0)

	)

3120 
	#u64_°©s_„tch_ªåy_bh
(
a
Ë(0)

	)

3121 
	#u64_°©s_„tch_begö_bh
(
a
Ë(0)

	)

3123 #i‡(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE >
RHEL_RELEASE_VERSION
(6,1))

3124 
	#HAVE_8021P_SUPPORT


	)

3129 
	#HAVE_PM_QOS_REQUEST_ACTIVE


	)

3130 
	#HAVE_8021P_SUPPORT


	)

3131 
	#HAVE_NDO_GET_STATS64


	)

3135 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,37) )

3136 #i‚de‡
√tif_£t_ªÆ_num_rx_queues


3137 
ölöe
 
	$__kc_√tif_£t_ªÆ_num_rx_queues
(
√t_devi˚
 *
dev
,

3138 
rxq
)

3141 
	}
}

3143 
	#√tif_£t_ªÆ_num_rx_queues
(
dev
, 
rxq
) \

3144 
	`__kc_√tif_£t_ªÆ_num_rx_queues
((
dev
), (
rxq
))

	)

3146 #i‚de‡
ETHTOOL_RXNTUPLE_ACTION_CLEAR


3147 
	#ETHTOOL_RXNTUPLE_ACTION_CLEAR
 (-2)

	)

3149 #i‚de‡
VLAN_N_VID


3150 
	#VLAN_N_VID
 
VLAN_GROUP_ARRAY_LEN


	)

3152 #i‚de‡
ETH_FLAG_TXVLAN


3153 
	#ETH_FLAG_TXVLAN
 (1 << 7)

	)

3155 #i‚de‡
ETH_FLAG_RXVLAN


3156 
	#ETH_FLAG_RXVLAN
 (1 << 8)

	)

3159 
ölöe
 
	$_kc_skb_checksum_n⁄e_as£π
(
sk_buff
 *
skb
)

3161 
	`WARN_ON
(
skb
->
ù_summed
 !
CHECKSUM_NONE
);

3162 
	}
}

3164 
	#skb_checksum_n⁄e_as£π
(
skb
Ë
	`_kc_skb_checksum_n⁄e_as£π
(skb)

	)

3166 
ölöe
 *
	$_kc_vzÆloc_node
(
size
, 
node
)

3168 *
addr
 = 
	`vmÆloc_node
(
size
, 
node
);

3169 i‡(
addr
)

3170 
	`mem£t
(
addr
, 0, 
size
);

3171  
addr
;

3172 
	}
}

3174 
	#vzÆloc_node
(
_size
, 
_node
Ë
	`_kc_vzÆloc_node
(_size, _node)

	)

3176 
ölöe
 *
	$_kc_vzÆloc
(
size
)

3178 *
addr
 = 
	`vmÆloc
(
size
);

3179 i‡(
addr
)

3180 
	`mem£t
(
addr
, 0, 
size
);

3181  
addr
;

3182 
	}
}

3184 
	#vzÆloc
(
_size
Ë
	`_kc_vzÆloc
(_size)

	)

3186 #i‚de‡
vœn_gë_¥Ÿocﬁ


3187 
ölöe
 
__be16
 
	$__kc_vœn_gë_¥Ÿocﬁ
(c⁄° 
sk_buff
 *
skb
)

3189 i‡(
	`vœn_tx_èg_¥e£¡
(
skb
) ||

3190 
skb
->
¥Ÿocﬁ
 !
	`˝u_to_be16
(
ETH_P_8021Q
))

3191  
skb
->
¥Ÿocﬁ
;

3193 i‡(
	`skb_hódÀn
(
skb
Ë< (
vœn_ëhhdr
))

3196  ((
vœn_ëhhdr
 *)
skb
->
d©a
)->
h_vœn_íˇpsuœãd_¥Ÿo
;

3197 
	}
}

3199 
	#vœn_gë_¥Ÿocﬁ
(
_skb
Ë
	`__kc_vœn_gë_¥Ÿocﬁ
(_skb)

	)

3201 #ifde‡
HAVE_HW_TIME_STAMP


3202 
	#SKBTX_HW_TSTAMP
 (1 << 0)

	)

3203 
	#SKBTX_IN_PROGRESS
 (1 << 2)

	)

3204 
	#SKB_SHARED_TX_IS_UNION


	)

3207 #i‚de‡
devi˚_wakeup_íabÀ


3208 
	#devi˚_wakeup_íabÀ
(
dev
Ë
	`devi˚_£t_wakeup_íabÀ
(dev, 
åue
)

	)

3211 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,4,18) )

3212 #i‚de‡
HAVE_VLAN_RX_REGISTER


3213 
	#HAVE_VLAN_RX_REGISTER


	)

3219 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,38) )

3220 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,22) )

3221 
	#skb_checksum_°¨t_off£t
(
skb
Ë
	`skb_å™•‹t_off£t
(skb)

	)

3223 
ölöe
 
	$_kc_skb_checksum_°¨t_off£t
(c⁄° 
sk_buff
 *
skb
)

3225  
skb
->
csum_°¨t
 - 
	`skb_hódroom
(skb);

3226 
	}
}

3228 
	#skb_checksum_°¨t_off£t
(
skb
Ë
	`_kc_skb_checksum_°¨t_off£t
(skb)

	)

3230 #ifde‡
CONFIG_DCB


3231 #i‚de‡
IEEE_8021QAZ_MAX_TCS


3232 
	#IEEE_8021QAZ_MAX_TCS
 8

	)

3234 #i‚de‡
DCB_CAP_DCBX_HOST


3235 
	#DCB_CAP_DCBX_HOST
 0x01

	)

3237 #i‚de‡
DCB_CAP_DCBX_LLD_MANAGED


3238 
	#DCB_CAP_DCBX_LLD_MANAGED
 0x02

	)

3240 #i‚de‡
DCB_CAP_DCBX_VER_CEE


3241 
	#DCB_CAP_DCBX_VER_CEE
 0x04

	)

3243 #i‚de‡
DCB_CAP_DCBX_VER_IEEE


3244 
	#DCB_CAP_DCBX_VER_IEEE
 0x08

	)

3246 #i‚de‡
DCB_CAP_DCBX_STATIC


3247 
	#DCB_CAP_DCBX_STATIC
 0x10

	)

3250 #i‡(
RHEL_RELEASE_CODE
 >
RHEL_RELEASE_VERSION
(6,2))

3251 
	#CONFIG_XPS


	)

3256 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,39) )

3257 #i‚de‡
NETIF_F_RXCSUM


3258 
	#NETIF_F_RXCSUM
 (1 << 29)

	)

3260 #i‚de‡
skb_queue_ªvî£_wÆk_ß„


3261 
	#skb_queue_ªvî£_wÆk_ß„
(
queue
, 
skb
, 
tmp
) \

3262 
skb
 = (
queue
)->
¥ev
, 
tmp
 = skb->prev; \

3263 
skb
 !(
sk_buff
 *)(
queue
); \

3264 
skb
 = 
tmp
,Åm∞skb->
¥ev
)

	)

3267 #i‡
deföed
(
CONFIG_FCOE
Ë|| deföed(
CONFIG_FCOE_MODULE
)

3268 #i‚de‡
HAVE_NETDEV_OPS_FCOE_DDP_TARGET


3269 
	#HAVE_NETDEV_OPS_FCOE_DDP_TARGET


	)

3272 #i‚de‡
HAVE_MQPRIO


3273 
	#HAVE_MQPRIO


	)

3275 #i‚de‡
HAVE_SETUP_TC


3276 
	#HAVE_SETUP_TC


	)

3278 #ifde‡
CONFIG_DCB


3279 #i‚de‡
HAVE_DCBNL_IEEE


3280 
	#HAVE_DCBNL_IEEE


	)

3283 #i‚de‡
HAVE_NDO_SET_FEATURES


3284 
	#HAVE_NDO_SET_FEATURES


	)

3293 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,40) )

3294 #ifde‡
ETHTOOL_GRXRINGS


3295 #i‚de‡
FLOW_EXT


3296 
	#FLOW_EXT
 0x80000000

	)

3297 
	u_kc_ëhtoﬁ_Êow_uni⁄
 {

3298 
ëhtoﬁ_t˝ù4_•ec
 
	mt˝_ù4_•ec
;

3299 
ëhtoﬁ_u§ù4_•ec
 
	mu§_ù4_•ec
;

3300 
__u8
 
	mhd©a
[60];

3302 
	s_kc_ëhtoﬁ_Êow_ext
 {

3303 
__be16
 
	mvœn_ëy≥
;

3304 
__be16
 
	mvœn_tci
;

3305 
__be32
 
	md©a
[2];

3307 
	s_kc_ëhtoﬁ_rx_Êow_•ec
 {

3308 
__u32
 
	mÊow_ty≥
;

3309 
_kc_ëhtoﬁ_Êow_uni⁄
 
	mh_u
;

3310 
_kc_ëhtoﬁ_Êow_ext
 
	mh_ext
;

3311 
_kc_ëhtoﬁ_Êow_uni⁄
 
	mm_u
;

3312 
_kc_ëhtoﬁ_Êow_ext
 
	mm_ext
;

3313 
__u64
 
	mrög_cookõ
;

3314 
__u32
 
	mloˇti⁄
;

3316 
	#ëhtoﬁ_rx_Êow_•ec
 
_kc_ëhtoﬁ_rx_Êow_•ec


	)

3320 
	#pci_dißbÀ_lök_°©e_locked
 
pci_dißbÀ_lök_°©e


	)

3322 #i‚de‡
PCI_LTR_VALUE_MASK


3323 
	#PCI_LTR_VALUE_MASK
 0x000003ff

	)

3325 #i‚de‡
PCI_LTR_SCALE_MASK


3326 
	#PCI_LTR_SCALE_MASK
 0x00001c00

	)

3328 #i‚de‡
PCI_LTR_SCALE_SHIFT


3329 
	#PCI_LTR_SCALE_SHIFT
 10

	)

3333 
	#HAVE_ETHTOOL_SET_PHYS_ID


	)

3337 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,0,0) )

3338 
	#USE_LEGACY_PM_SUPPORT


	)

3342 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,1,0) )

3343 #i‚de‡
__√tdev_Æloc_skb_ù_Æign


3344 
	#__√tdev_Æloc_skb_ù_Æign
(
d
,
l
,
_g
Ë
	`√tdev_Æloc_skb_ù_Æign
(d,l)

	)

3346 
	#dcb_õì_£èµ
(
dev
, 
≠p
Ë
	`dcb_£èµ
(dev,áµ)

	)

3347 
	#dcb_õì_dñ≠p
(
dev
, 
≠p
Ë0

	)

3348 
	#dcb_õì_gë≠p_mask
(
dev
, 
≠p
Ë(1 <<áµ->
¥i‹ôy
)

	)

3351 
	#CTL1000_AS_MASTER
 0x0800

	)

3352 
	#CTL1000_ENABLE_MASTER
 0x1000

	)

3355 #i‚de‡
HAVE_DCBNL_IEEE_DELAPP


3356 
	#HAVE_DCBNL_IEEE_DELAPP


	)

3361 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,2,0) )

3362 #ifde‡
ETHTOOL_GRXRINGS


3363 
	#HAVE_ETHTOOL_GET_RXNFC_VOID_RULE_LOCS


	)

3366 #i‚de‡
skb_‰ag_size


3367 
	#skb_‰ag_size
(
‰ag
Ë
	`_kc_skb_‰ag_size
(‰ag)

	)

3368 
ölöe
 
	$_kc_skb_‰ag_size
(c⁄° 
skb_‰ag_t
 * 
‰ag
)

3370  
‰ag
->
size
;

3371 
	}
}

3374 #i‚de‡
skb_‰ag_size_sub


3375 
	#skb_‰ag_size_sub
(
‰ag
, 
dñè
Ë
	`_kc_skb_‰ag_size_sub
(‰ag, dñè)

	)

3376 
ölöe
 
	$_kc_skb_‰ag_size_sub
(
skb_‰ag_t
 * 
‰ag
, 
dñè
)

3378 
‰ag
->
size
 -
dñè
;

3379 
	}
}

3382 #i‚de‡
skb_‰ag_∑ge


3383 
	#skb_‰ag_∑ge
(
‰ag
Ë
	`_kc_skb_‰ag_∑ge
(‰ag)

	)

3384 
ölöe
 
∑ge
 *
	$_kc_skb_‰ag_∑ge
(c⁄° 
skb_‰ag_t
 * 
‰ag
)

3386  
‰ag
->
∑ge
;

3387 
	}
}

3390 #i‚de‡
skb_‰ag_addªss


3391 
	#skb_‰ag_addªss
(
‰ag
Ë
	`_kc_skb_‰ag_addªss
(‰ag)

	)

3392 
ölöe
 *
	$_kc_skb_‰ag_addªss
(c⁄° 
skb_‰ag_t
 * 
‰ag
)

3394  
	`∑ge_addªss
(
	`skb_‰ag_∑ge
(
‰ag
)Ë+ føg->
∑ge_off£t
;

3395 
	}
}

3398 #i‚de‡
skb_‰ag_dma_m≠


3399 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(2,6,0) )

3400 
	~<löux/dma-m≠pög.h
>

3402 
	#skb_‰ag_dma_m≠
(
dev
,
‰ag
,
off£t
,
size
,
dú
) \

3403 
	`_kc_skb_‰ag_dma_m≠
(
dev
,
‰ag
,
off£t
,
size
,
dú
)

	)

3404 
ölöe
 
dma_addr_t
 
	$_kc_skb_‰ag_dma_m≠
(
devi˚
 *
dev
,

3405 c⁄° 
skb_‰ag_t
 * 
‰ag
,

3406 
size_t
 
off£t
, size_à
size
,

3407 
dma_d©a_dúe˘i⁄
 
dú
)

3409  
	`dma_m≠_∑ge
(
dev
, 
	`skb_‰ag_∑ge
(
‰ag
),

3410 
‰ag
->
∑ge_off£t
 + 
off£t
, 
size
, 
dú
);

3411 
	}
}

3414 #i‚de‡
__skb_‰ag_uƒef


3415 
	#__skb_‰ag_uƒef
(
‰ag
Ë
	`__kc_skb_‰ag_uƒef
(‰ag)

	)

3416 
ölöe
 
	$__kc_skb_‰ag_uƒef
(
skb_‰ag_t
 * 
‰ag
)

3418 
	`put_∑ge
(
	`skb_‰ag_∑ge
(
‰ag
));

3419 
	}
}

3422 #i‚de‡
SPEED_UNKNOWN


3423 
	#SPEED_UNKNOWN
 -1

	)

3425 #i‚de‡
DUPLEX_UNKNOWN


3426 
	#DUPLEX_UNKNOWN
 0xff

	)

3428 #i‡(
RHEL_RELEASE_CODE
 >
RHEL_RELEASE_VERSION
(6,3))

3429 #i‚de‡
HAVE_PCI_DEV_FLAGS_ASSIGNED


3430 
	#HAVE_PCI_DEV_FLAGS_ASSIGNED


	)

3434 #i‚de‡
HAVE_PCI_DEV_FLAGS_ASSIGNED


3435 
	#HAVE_PCI_DEV_FLAGS_ASSIGNED


	)

3436 
	#HAVE_VF_SPOOFCHK_CONFIGURE


	)

3440 #i‡(
RHEL_RELEASE_CODE
 && RHEL_RELEASE_CODE =
RHEL_RELEASE_VERSION
(6,2))

3441 #unde‡
ixgbe_gë_√tdev_tc_txq


3442 
	#ixgbe_gë_√tdev_tc_txq
(
dev
, 
tc
Ë(&
	`√tdev_exãnded
(dev)->
qos_d©a
.
tc_to_txq
[tc])

	)

3445 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,3,0) )

3446 
u32
 
	t√tdev_„©uªs_t
;

3447 #unde‡
PCI_EXP_TYPE_RC_EC


3448 
	#PCI_EXP_TYPE_RC_EC
 0x®

	)

3449 #i‚de‡
CONFIG_BQL


3450 
	#√tdev_tx_com∂ëed_queue
(
_q
, 
_p
, 
_b
Ëdÿ{} 0)

	)

3451 
	#√tdev_com∂ëed_queue
(
_n
, 
_p
, 
_b
Ëdÿ{} 0)

	)

3452 
	#√tdev_tx_£¡_queue
(
_q
, 
_b
Ëdÿ{} 0)

	)

3453 
	#√tdev_£¡_queue
(
_n
, 
_b
Ëdÿ{} 0)

	)

3454 
	#√tdev_tx_ª£t_queue
(
_q
Ëdÿ{} 0)

	)

3455 
	#√tdev_ª£t_queue
(
_n
Ëdÿ{} 0)

	)

3458 
	#HAVE_INT_NDO_VLAN_RX_ADD_VID


	)

3459 #ifde‡
ETHTOOL_SRXNTUPLE


3460 #unde‡
ETHTOOL_SRXNTUPLE


3465 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,4,0) )

3466 #i‚de‡
NETIF_F_RXFCS


3467 
	#NETIF_F_RXFCS
 0

	)

3469 #i‚de‡
NETIF_F_RXALL


3470 
	#NETIF_F_RXALL
 0

	)

3473 #i‡!(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
SLE_VERSION
(11,3,0))

3474 
	#NUMTCS_RETURNS_U8


	)

3476 
_kc_sim∂e_›í
(
öode
 *öode, 
fûe
 *file);

3477 
	#sim∂e_›í
 
_kc_sim∂e_›í


	)

3480 
	~<löux/highmem.h
>

3481 
ölöe
 *
	$_kc_km≠_©omic
(
∑ge
 *page)

3483  
	`km≠_©omic
(
∑ge
, 
KM_SKB_DATA_SOFTIRQ
);

3484 
	}
}

3486 #unde‡
km≠_©omic


3487 
	#km≠_©omic
(
∑ge
Ë
	`_kc_km≠_©omic
(’age))

	)

3489 
ölöe
 
	$_kc_kunm≠_©omic
(*
addr
)

3491 
	`kunm≠_©omic
(
addr
, 
KM_SKB_DATA_SOFTIRQ
);

3492 
	}
}

3494 #unde‡
kunm≠_©omic


3495 
	#kunm≠_©omic
(
addr
Ë
	`_kc_kunm≠_©omic
(◊ddr))

	)

3497 #i‚de‡
skb_add_rx_‰ag


3498 
	#skb_add_rx_‰ag
 
_kc_skb_add_rx_‰ag


	)

3499 
_kc_skb_add_rx_‰ag
(
sk_buff
 *, , 
∑ge
 *,

3502 #ifde‡
NET_ADDR_RANDOM


3503 
	#ëh_hw_addr_øndom
(
N
) do { \

3504 
	`øndom_ëhî_addr
(
N
->
dev_addr
); \

3505 
N
->
addr_assign_ty≥
 |
NET_ADDR_RANDOM
; \

3506 } 0)

	)

3508 
	#ëh_hw_addr_øndom
(
N
Ë
	`øndom_ëhî_addr
(N->
dev_addr
)

	)

3511 
	~<löux/kc⁄fig.h
>

3515 #i‡
deföed
(
E1000E_PTP
Ë|| deföed(
IGB_PTP
Ë|| deföed(
IXGBE_PTP
Ë|| deföed(
I40E_PTP
)

3516 #i‡–
LINUX_VERSION_CODE
 >
KERNEL_VERSION
(3,0,0ËË&& 
IS_ENABLED
(
CONFIG_PTP_1588_CLOCK
)

3517 
	#HAVE_PTP_1588_CLOCK


	)

3519 #îr‹ 
C™nŸ
 
íabÀ
 
PTP
 
H¨dw¨e
 
Clock
 
suµ‹t
 
due
 
to
 
a
 
¥e
-3.0 
kî√l
 
vîsi⁄
 
‹
 
CONFIG_PTP_1588_CLOCK
 
nŸ
 
íabÀd
 
ö
 
the
 kernel

3524 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,5,0) )

3525 
	#skb_tx_time°amp
(
skb
Ëdÿ{} 0)

	)

3527 
	#HAVE_FDB_OPS


	)

3528 
	#HAVE_ETHTOOL_GET_TS_INFO


	)

3532 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,6,0) )

3533 
	#PCI_EXP_LNKCAP2
 44

	)

3535 #i‚de‡
MDIO_EEE_100TX


3536 
	#MDIO_EEE_100TX
 0x0002

	)

3538 #i‚de‡
MDIO_EEE_1000T


3539 
	#MDIO_EEE_1000T
 0x0004

	)

3541 #i‚de‡
MDIO_EEE_10GT


3542 
	#MDIO_EEE_10GT
 0x0008

	)

3544 #i‚de‡
MDIO_EEE_1000KX


3545 
	#MDIO_EEE_1000KX
 0x0010

	)

3547 #i‚de‡
MDIO_EEE_10GKX4


3548 
	#MDIO_EEE_10GKX4
 0x0020

	)

3550 #i‚de‡
MDIO_EEE_10GKR


3551 
	#MDIO_EEE_10GKR
 0x0040

	)

3554 
	~<löux/mdio.h
>

3558 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,7,0) )

3559 #i‚de‡
ADVERTISED_40000ba£KR4_FuŒ


3563 
	#SUPPORTED_40000ba£KR4_FuŒ
 (1 << 23)

	)

3564 
	#SUPPORTED_40000ba£CR4_FuŒ
 (1 << 24)

	)

3565 
	#SUPPORTED_40000ba£SR4_FuŒ
 (1 << 25)

	)

3566 
	#SUPPORTED_40000ba£LR4_FuŒ
 (1 << 26)

	)

3567 
	#ADVERTISED_40000ba£KR4_FuŒ
 (1 << 23)

	)

3568 
	#ADVERTISED_40000ba£CR4_FuŒ
 (1 << 24)

	)

3569 
	#ADVERTISED_40000ba£SR4_FuŒ
 (1 << 25)

	)

3570 
	#ADVERTISED_40000ba£LR4_FuŒ
 (1 << 26)

	)

3579 
ölöe
 
u32
 
	$mmd_ìe_ˇp_to_ëhtoﬁ_sup_t
(
u16
 
ìe_ˇp
)

3581 
u32
 
suµ‹ãd
 = 0;

3583 i‡(
ìe_ˇp
 & 
MDIO_EEE_100TX
)

3584 
suµ‹ãd
 |
SUPPORTED_100ba£T_FuŒ
;

3585 i‡(
ìe_ˇp
 & 
MDIO_EEE_1000T
)

3586 
suµ‹ãd
 |
SUPPORTED_1000ba£T_FuŒ
;

3587 i‡(
ìe_ˇp
 & 
MDIO_EEE_10GT
)

3588 
suµ‹ãd
 |
SUPPORTED_10000ba£T_FuŒ
;

3589 i‡(
ìe_ˇp
 & 
MDIO_EEE_1000KX
)

3590 
suµ‹ãd
 |
SUPPORTED_1000ba£KX_FuŒ
;

3591 i‡(
ìe_ˇp
 & 
MDIO_EEE_10GKX4
)

3592 
suµ‹ãd
 |
SUPPORTED_10000ba£KX4_FuŒ
;

3593 i‡(
ìe_ˇp
 & 
MDIO_EEE_10GKR
)

3594 
suµ‹ãd
 |
SUPPORTED_10000ba£KR_FuŒ
;

3596  
suµ‹ãd
;

3597 
	}
}

3607 
ölöe
 
u32
 
	$mmd_ìe_adv_to_ëhtoﬁ_adv_t
(
u16
 
ìe_adv
)

3609 
u32
 
adv
 = 0;

3611 i‡(
ìe_adv
 & 
MDIO_EEE_100TX
)

3612 
adv
 |
ADVERTISED_100ba£T_FuŒ
;

3613 i‡(
ìe_adv
 & 
MDIO_EEE_1000T
)

3614 
adv
 |
ADVERTISED_1000ba£T_FuŒ
;

3615 i‡(
ìe_adv
 & 
MDIO_EEE_10GT
)

3616 
adv
 |
ADVERTISED_10000ba£T_FuŒ
;

3617 i‡(
ìe_adv
 & 
MDIO_EEE_1000KX
)

3618 
adv
 |
ADVERTISED_1000ba£KX_FuŒ
;

3619 i‡(
ìe_adv
 & 
MDIO_EEE_10GKX4
)

3620 
adv
 |
ADVERTISED_10000ba£KX4_FuŒ
;

3621 i‡(
ìe_adv
 & 
MDIO_EEE_10GKR
)

3622 
adv
 |
ADVERTISED_10000ba£KR_FuŒ
;

3624  
adv
;

3625 
	}
}

3635 
ölöe
 
u16
 
	$ëhtoﬁ_adv_to_mmd_ìe_adv_t
(
u32
 
adv
)

3637 
u16
 
ªg
 = 0;

3639 i‡(
adv
 & 
ADVERTISED_100ba£T_FuŒ
)

3640 
ªg
 |
MDIO_EEE_100TX
;

3641 i‡(
adv
 & 
ADVERTISED_1000ba£T_FuŒ
)

3642 
ªg
 |
MDIO_EEE_1000T
;

3643 i‡(
adv
 & 
ADVERTISED_10000ba£T_FuŒ
)

3644 
ªg
 |
MDIO_EEE_10GT
;

3645 i‡(
adv
 & 
ADVERTISED_1000ba£KX_FuŒ
)

3646 
ªg
 |
MDIO_EEE_1000KX
;

3647 i‡(
adv
 & 
ADVERTISED_10000ba£KX4_FuŒ
)

3648 
ªg
 |
MDIO_EEE_10GKX4
;

3649 i‡(
adv
 & 
ADVERTISED_10000ba£KR_FuŒ
)

3650 
ªg
 |
MDIO_EEE_10GKR
;

3652  
ªg
;

3653 
	}
}

3655 #i‚de‡
pci_pcõ_ty≥


3656 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(2,6,24) )

3657 
ölöe
 
u8
 
	$pci_pcõ_ty≥
(
pci_dev
 *
pdev
)

3659 
pos
;

3660 
u16
 
ªg16
;

3662 
pos
 = 
	`pci_föd_ˇ∑bûôy
(
pdev
, 
PCI_CAP_ID_EXP
);

3663 i‡(!
pos
)

3664 
	`BUG
();

3665 
	`pci_ªad_c⁄fig_w‹d
(
pdev
, 
pos
 + 
PCI_EXP_FLAGS
, &
ªg16
);

3666  (
ªg16
 & 
PCI_EXP_FLAGS_TYPE
) >> 4;

3667 
	}
}

3669 
	#pci_pcõ_ty≥
(
x
Ë(x)->
pcõ_ty≥


	)

3673 
	#±p_˛ock_ªgi°î
(
ˇps
, 
¨gs
...Ë
	`±p_˛ock_ªgi°î
(ˇps)

	)

3675 #i‡!(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
SLE_VERSION
(11,3,0))

3676 
__kc_pcõ_ˇ∑bûôy_ªad_w‹d
(
pci_dev
 *
dev
, 
pos
, 
u16
 *
vÆ
);

3677 
	#pcõ_ˇ∑bûôy_ªad_w‹d
(
d
,
p
,
v
Ë
	`__kc_pcõ_ˇ∑bûôy_ªad_w‹d
(d,p,v)

	)

3678 
__kc_pcõ_ˇ∑bûôy_wrôe_w‹d
(
pci_dev
 *
dev
, 
pos
, 
u16
 
vÆ
);

3679 
	#pcõ_ˇ∑bûôy_wrôe_w‹d
(
d
,
p
,
v
Ë
	`__kc_pcõ_ˇ∑bûôy_wrôe_w‹d
(d,p,v)

	)

3680 
__kc_pcõ_ˇ∑bûôy_˛ór_™d_£t_w‹d
(
pci_dev
 *
dev
, 
pos
,

3681 
u16
 
˛ór
, u16 
£t
);

3682 
	#pcõ_ˇ∑bûôy_˛ór_™d_£t_w‹d
(
d
,
p
,
c
,
s
) \

3683 
	`__kc_pcõ_ˇ∑bûôy_˛ór_™d_£t_w‹d
(
d
,
p
,
c
,
s
)

	)

3685 
	#PCI_EXP_LNKSTA2
 50

	)

3687 
ölöe
 
	$pcõ_ˇ∑bûôy_˛ór_w‹d
(
pci_dev
 *
dev
, 
pos
,

3688 
u16
 
˛ór
)

3690  
	`__kc_pcõ_ˇ∑bûôy_˛ór_™d_£t_w‹d
(
dev
, 
pos
, 
˛ór
, 0);

3691 
	}
}

3694 #i‡(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
SLE_VERSION
(11,3,0))

3695 
	#USE_CONST_DEV_UC_CHAR


	)

3699 
	#HAVE_CONST_STRUCT_PCI_ERROR_HANDLERS


	)

3700 
	#USE_CONST_DEV_UC_CHAR


	)

3704 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,8,0) )

3705 #i‚de‡
PCI_EXP_LNKCTL_ASPM_L0S


3706 
	#PCI_EXP_LNKCTL_ASPM_L0S
 0x01

	)

3708 #i‚de‡
PCI_EXP_LNKCTL_ASPM_L1


3709 
	#PCI_EXP_LNKCTL_ASPM_L1
 0x02

	)

3711 
	#HAVE_CONFIG_HOTPLUG


	)

3713 c⁄° 
u8
 
	gëh_ª£rved_addr_ba£
[
ETH_ALEN
] 
__Æig√d
(2) = {

3716 #i‡!(
SLE_VERSION_CODE
 && SLE_VERSION_CODE >
SLE_VERSION
(11,3,0))

3717 
ölöe
 
boﬁ
 
	$is_lök_loˇl_ëhî_addr
(c⁄° 
u8
 *
addr
)

3719 
__be16
 *
a
 = (__be16 *Ë
addr
;

3720 c⁄° 
__be16
 *
b
 = (c⁄° __be16 *)
ëh_ª£rved_addr_ba£
;

3721 c⁄° 
__be16
 
m
 = 
	`˝u_to_be16
(0xfff0);

3723  ((
a
[0] ^ 
b
[0]Ë| (a[1] ^ b[1]Ë| (◊[2] ^ b[2]Ë& 
m
)) == 0;

3724 
	}
}

3727 #i‚de‡
__devöô


3728 
	#__devöô


	)

3729 
	#HAVE_ENCAP_CSUM_OFFLOAD


	)

3732 #i‚de‡
__devöôd©a


3733 
	#__devöôd©a


	)

3736 #i‚de‡
__devexô


3737 
	#__devexô


	)

3740 #i‚de‡
__devexô_p


3741 
	#__devexô_p


	)

3744 #i‚de‡
HAVE_SRIOV_CONFIGURE


3745 
	#HAVE_SRIOV_CONFIGURE


	)

3748 
	#HAVE_BRIDGE_ATTRIBS


	)

3749 #i‚de‡
BRIDGE_MODE_VEB


3750 
	#BRIDGE_MODE_VEB
 0

	)

3752 #i‚de‡
BRIDGE_MODE_VEPA


3753 
	#BRIDGE_MODE_VEPA
 1

	)

3758 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,9,0) )

3760 #unde‡
hli°_íåy


3761 
	#hli°_íåy
(
±r
, 
ty≥
, 
membî
Ë
	`c⁄èöî_of
’å,ty≥,membî)

	)

3763 #unde‡
hli°_íåy_ß„


3764 
	#hli°_íåy_ß„
(
±r
, 
ty≥
, 
membî
) \

3765 (
±r
Ë? 
	`hli°_íåy
’å, 
ty≥
, 
membî
Ë: 
NULL


	)

3767 #unde‡
hli°_f‹_óch_íåy


3768 
	#hli°_f‹_óch_íåy
(
pos
, 
hód
, 
membî
) \

3769 
pos
 = 
	`hli°_íåy_ß„
((
hód
)->
fú°
, 
	`ty≥of
(*’os)), 
membî
); \

3770 
pos
; \

3771 
pos
 = 
	`hli°_íåy_ß„
(’os)->
membî
.
√xt
, 
	`ty≥of
(*’os)), membî))

	)

3773 #unde‡
hli°_f‹_óch_íåy_ß„


3774 
	#hli°_f‹_óch_íåy_ß„
(
pos
, 
n
, 
hód
, 
membî
) \

3775 
pos
 = 
	`hli°_íåy_ß„
((
hód
)->
fú°
, 
	`ty≥of
(*pos), 
membî
); \

3776 
pos
 && ({ 
n
 =Öos->
membî
.
√xt
; 1; }); \

3777 
pos
 = 
	`hli°_íåy_ß„
(
n
, 
	`ty≥of
(*pos), 
membî
))

	)

3780 
	#HAVE_BRIDGE_FILTER


	)

3781 
	#USE_DEFAULT_FDB_DEL_DUMP


	)

3785 #i‡–
LINUX_VERSION_CODE
 < 
KERNEL_VERSION
(3,10,0) )

3787 #i‚de‡
VLAN_TX_COOKIE_MAGIC


3788 
ölöe
 
sk_buff
 *
	$__kc__vœn_hwac˚l_put_èg
(
sk_buff
 *
skb
,

3789 
u16
 
vœn_tci
)

3791 #ifde‡
VLAN_TAG_PRESENT


3792 
vœn_tci
 |
VLAN_TAG_PRESENT
;

3794 
skb
->
vœn_tci
 = vlan_tci;

3795  
skb
;

3796 
	}
}

3798 
	#__vœn_hwac˚l_put_èg
(
skb
, 
vœn_¥Ÿo
, 
vœn_tci
) \

3799 
	`__kc__vœn_hwac˚l_put_èg
(
skb
, 
vœn_tci
)

	)

3803 
	#HAVE_ENCAP_TSO_OFFLOAD


	)

	@kcompat_ethtool.c

50 
	~<löux/moduÀ.h
>

51 
	~<löux/ty≥s.h
>

52 
	~<löux/î∫o.h
>

53 
	~<löux/mii.h
>

54 
	~<löux/ëhtoﬁ.h
>

55 
	~<löux/√tdevi˚.h
>

56 
	~<asm/uac˚ss.h
>

58 
	~"kcom∑t.h
"

60 #unde‡
SUPPORTED_10000ba£T_FuŒ


61 
	#SUPPORTED_10000ba£T_FuŒ
 (1 << 12)

	)

62 #unde‡
ADVERTISED_10000ba£T_FuŒ


63 
	#ADVERTISED_10000ba£T_FuŒ
 (1 << 12)

	)

64 #unde‡
SPEED_10000


66 #unde‡
ëhtoﬁ_›s


67 
	#ëhtoﬁ_›s
 
_kc_ëhtoﬁ_›s


	)

69 
	s_kc_ëhtoﬁ_›s
 {

70 (*
	mgë_£âögs
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_cmd
 *);

71 (*
	m£t_£âögs
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_cmd
 *);

72 (*
	mgë_drvöfo
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_drvöfo
 *);

73 (*
	mgë_ªgs_Àn
Ë(
	m√t_devi˚
 *);

74 (*
	mgë_ªgs
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_ªgs
 *, *);

75 (*
	mgë_wﬁ
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_wﬁöfo
 *);

76 (*
	m£t_wﬁ
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_wﬁöfo
 *);

77 
u32
 (*
gë_msgÀvñ
Ë(
	m√t_devi˚
 *);

78 (*
	m£t_msgÀvñ
Ë(
	m√t_devi˚
 *, 
	mu32
);

79 (*
	mnway_ª£t
Ë(
	m√t_devi˚
 *);

80 
u32
 (*
gë_lök
Ë(
	m√t_devi˚
 *);

81 (*
	mgë_ì¥om_Àn
Ë(
	m√t_devi˚
 *);

82 (*
	mgë_ì¥om
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_ì¥om
 *, 
	mu8
 *);

83 (*
	m£t_ì¥om
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_ì¥om
 *, 
	mu8
 *);

84 (*
	mgë_cﬂÀs˚
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_cﬂÀs˚
 *);

85 (*
	m£t_cﬂÀs˚
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_cﬂÀs˚
 *);

86 (*
	mgë_rög∑øm
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_rög∑øm
 *);

87 (*
	m£t_rög∑øm
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_rög∑øm
 *);

88 (*
	mgë_∑u£∑øm
Ë(
	m√t_devi˚
 *,

89 
	mëhtoﬁ_∑u£∑øm
 *);

90 (*
	m£t_∑u£∑øm
Ë(
	m√t_devi˚
 *,

91 
	mëhtoﬁ_∑u£∑øm
 *);

92 
u32
 (*
gë_rx_csum
Ë(
	m√t_devi˚
 *);

93 (*
	m£t_rx_csum
Ë(
	m√t_devi˚
 *, 
	mu32
);

94 
u32
 (*
gë_tx_csum
Ë(
	m√t_devi˚
 *);

95 (*
	m£t_tx_csum
Ë(
	m√t_devi˚
 *, 
	mu32
);

96 
u32
 (*
gë_sg
Ë(
	m√t_devi˚
 *);

97 (*
	m£t_sg
Ë(
	m√t_devi˚
 *, 
	mu32
);

98 
u32
 (*
gë_tso
Ë(
	m√t_devi˚
 *);

99 (*
	m£t_tso
Ë(
	m√t_devi˚
 *, 
	mu32
);

100 (*
	m£lf_ã°_cou¡
Ë(
	m√t_devi˚
 *);

101 (*
	m£lf_ã°
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_ã°
 *, 
	mu64
 *);

102 (*
	mgë_°rögs
Ë(
	m√t_devi˚
 *, 
u32
 
	m°rög£t
, 
	mu8
 *);

103 (*
	mphys_id
Ë(
	m√t_devi˚
 *, 
	mu32
);

104 (*
	mgë_°©s_cou¡
Ë(
	m√t_devi˚
 *);

105 (*
	mgë_ëhtoﬁ_°©s
Ë(
	m√t_devi˚
 *, 
	mëhtoﬁ_°©s
 *,

106 
	mu64
 *);

107 } *
	gëhtoﬁ_›s
 = 
NULL
;

109 #unde‡
SET_ETHTOOL_OPS


110 
	#SET_ETHTOOL_OPS
(
√tdev
, 
›s
Ë(
ëhtoﬁ_›s
 = (›s))

	)

118 #unde‡
ëhtoﬁ_›_gë_lök


119 
	#ëhtoﬁ_›_gë_lök
 
_kc_ëhtoﬁ_›_gë_lök


	)

120 
u32
 
	$_kc_ëhtoﬁ_›_gë_lök
(
√t_devi˚
 *
dev
)

122  
	`√tif_ˇºõr_ok
(
dev
) ? 1 : 0;

123 
	}
}

125 #unde‡
ëhtoﬁ_›_gë_tx_csum


126 
	#ëhtoﬁ_›_gë_tx_csum
 
_kc_ëhtoﬁ_›_gë_tx_csum


	)

127 
u32
 
	$_kc_ëhtoﬁ_›_gë_tx_csum
(
√t_devi˚
 *
dev
)

129 #ifde‡
NETIF_F_IP_CSUM


130  (
dev
->
„©uªs
 & 
NETIF_F_IP_CSUM
) != 0;

134 
	}
}

136 #unde‡
ëhtoﬁ_›_£t_tx_csum


137 
	#ëhtoﬁ_›_£t_tx_csum
 
_kc_ëhtoﬁ_›_£t_tx_csum


	)

138 
	$_kc_ëhtoﬁ_›_£t_tx_csum
(
√t_devi˚
 *
dev
, 
u32
 
d©a
)

140 #ifde‡
NETIF_F_IP_CSUM


141 i‡(
d©a
)

142 #ifde‡
NETIF_F_IPV6_CSUM


143 
dev
->
„©uªs
 |(
NETIF_F_IP_CSUM
 | 
NETIF_F_IPV6_CSUM
);

145 
dev
->
„©uªs
 &~(
NETIF_F_IP_CSUM
 | 
NETIF_F_IPV6_CSUM
);

147 
dev
->
„©uªs
 |
NETIF_F_IP_CSUM
;

149 
dev
->
„©uªs
 &~
NETIF_F_IP_CSUM
;

154 
	}
}

156 #unde‡
ëhtoﬁ_›_gë_sg


157 
	#ëhtoﬁ_›_gë_sg
 
_kc_ëhtoﬁ_›_gë_sg


	)

158 
u32
 
	$_kc_ëhtoﬁ_›_gë_sg
(
√t_devi˚
 *
dev
)

160 #ifde‡
NETIF_F_SG


161  (
dev
->
„©uªs
 & 
NETIF_F_SG
) != 0;

165 
	}
}

167 #unde‡
ëhtoﬁ_›_£t_sg


168 
	#ëhtoﬁ_›_£t_sg
 
_kc_ëhtoﬁ_›_£t_sg


	)

169 
	$_kc_ëhtoﬁ_›_£t_sg
(
√t_devi˚
 *
dev
, 
u32
 
d©a
)

171 #ifde‡
NETIF_F_SG


172 i‡(
d©a
)

173 
dev
->
„©uªs
 |
NETIF_F_SG
;

175 
dev
->
„©uªs
 &~
NETIF_F_SG
;

179 
	}
}

181 #unde‡
ëhtoﬁ_›_gë_tso


182 
	#ëhtoﬁ_›_gë_tso
 
_kc_ëhtoﬁ_›_gë_tso


	)

183 
u32
 
	$_kc_ëhtoﬁ_›_gë_tso
(
√t_devi˚
 *
dev
)

185 #ifde‡
NETIF_F_TSO


186  (
dev
->
„©uªs
 & 
NETIF_F_TSO
) != 0;

190 
	}
}

192 #unde‡
ëhtoﬁ_›_£t_tso


193 
	#ëhtoﬁ_›_£t_tso
 
_kc_ëhtoﬁ_›_£t_tso


	)

194 
	$_kc_ëhtoﬁ_›_£t_tso
(
√t_devi˚
 *
dev
, 
u32
 
d©a
)

196 #ifde‡
NETIF_F_TSO


197 i‡(
d©a
)

198 
dev
->
„©uªs
 |
NETIF_F_TSO
;

200 
dev
->
„©uªs
 &~
NETIF_F_TSO
;

204 
	}
}

208 
	$ëhtoﬁ_gë_£âögs
(
√t_devi˚
 *
dev
, *
u£øddr
)

210 
ëhtoﬁ_cmd
 
cmd
 = { 
ETHTOOL_GSET
 };

211 
îr
;

213 i‡(!
ëhtoﬁ_›s
->
gë_£âögs
)

214  -
EOPNOTSUPP
;

216 
îr
 = 
ëhtoﬁ_›s
->
	`gë_£âögs
(
dev
, &
cmd
);

217 i‡(
îr
 < 0)

218  
îr
;

220 i‡(
	`c›y_to_u£r
(
u£øddr
, &
cmd
, (cmd)))

221  -
EFAULT
;

223 
	}
}

225 
	$ëhtoﬁ_£t_£âögs
(
√t_devi˚
 *
dev
, *
u£øddr
)

227 
ëhtoﬁ_cmd
 
cmd
;

229 i‡(!
ëhtoﬁ_›s
->
£t_£âögs
)

230  -
EOPNOTSUPP
;

232 i‡(
	`c›y_‰om_u£r
(&
cmd
, 
u£øddr
, (cmd)))

233  -
EFAULT
;

235  
ëhtoﬁ_›s
->
	`£t_£âögs
(
dev
, &
cmd
);

236 
	}
}

238 
	$ëhtoﬁ_gë_drvöfo
(
√t_devi˚
 *
dev
, *
u£øddr
)

240 
ëhtoﬁ_drvöfo
 
öfo
;

241 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

243 i‡(!
›s
->
gë_drvöfo
)

244  -
EOPNOTSUPP
;

246 
	`mem£t
(&
öfo
, 0, (info));

247 
öfo
.
cmd
 = 
ETHTOOL_GDRVINFO
;

248 
›s
->
	`gë_drvöfo
(
dev
, &
öfo
);

250 i‡(
›s
->
£lf_ã°_cou¡
)

251 
öfo
.
ã°öfo_Àn
 = 
›s
->
	`£lf_ã°_cou¡
(
dev
);

252 i‡(
›s
->
gë_°©s_cou¡
)

253 
öfo
.
n_°©s
 = 
›s
->
	`gë_°©s_cou¡
(
dev
);

254 i‡(
›s
->
gë_ªgs_Àn
)

255 
öfo
.
ªgdump_Àn
 = 
›s
->
	`gë_ªgs_Àn
(
dev
);

256 i‡(
›s
->
gë_ì¥om_Àn
)

257 
öfo
.
ìdump_Àn
 = 
›s
->
	`gë_ì¥om_Àn
(
dev
);

259 i‡(
	`c›y_to_u£r
(
u£øddr
, &
öfo
, (info)))

260  -
EFAULT
;

262 
	}
}

264 
	$ëhtoﬁ_gë_ªgs
(
√t_devi˚
 *
dev
, *
u£øddr
)

266 
ëhtoﬁ_ªgs
 
ªgs
;

267 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

268 *
ªgbuf
;

269 
ªgÀn
, 
ªt
;

271 i‡(!
›s
->
gë_ªgs
 || !›s->
gë_ªgs_Àn
)

272  -
EOPNOTSUPP
;

274 i‡(
	`c›y_‰om_u£r
(&
ªgs
, 
u£øddr
, (regs)))

275  -
EFAULT
;

277 
ªgÀn
 = 
›s
->
	`gë_ªgs_Àn
(
dev
);

278 i‡(
ªgs
.
Àn
 > 
ªgÀn
)

279 
ªgs
.
Àn
 = 
ªgÀn
;

281 
ªgbuf
 = 
	`kmÆloc
(
ªgÀn
, 
GFP_USER
);

282 i‡(!
ªgbuf
)

283  -
ENOMEM
;

285 
›s
->
	`gë_ªgs
(
dev
, &
ªgs
, 
ªgbuf
);

287 
ªt
 = -
EFAULT
;

288 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ªgs
, (regs)))

289 
out
;

290 
u£øddr
 +
	`off£tof
(
ëhtoﬁ_ªgs
, 
d©a
);

291 i‡(
	`c›y_to_u£r
(
u£øddr
, 
ªgbuf
, 
ªgÀn
))

292 
out
;

293 
ªt
 = 0;

295 
out
:

296 
	`k‰ì
(
ªgbuf
);

297  
ªt
;

298 
	}
}

300 
	$ëhtoﬁ_gë_wﬁ
(
√t_devi˚
 *
dev
, *
u£øddr
)

302 
ëhtoﬁ_wﬁöfo
 
wﬁ
 = { 
ETHTOOL_GWOL
 };

304 i‡(!
ëhtoﬁ_›s
->
gë_wﬁ
)

305  -
EOPNOTSUPP
;

307 
ëhtoﬁ_›s
->
	`gë_wﬁ
(
dev
, &
wﬁ
);

309 i‡(
	`c›y_to_u£r
(
u£øddr
, &
wﬁ
, (wol)))

310  -
EFAULT
;

312 
	}
}

314 
	$ëhtoﬁ_£t_wﬁ
(
√t_devi˚
 *
dev
, *
u£øddr
)

316 
ëhtoﬁ_wﬁöfo
 
wﬁ
;

318 i‡(!
ëhtoﬁ_›s
->
£t_wﬁ
)

319  -
EOPNOTSUPP
;

321 i‡(
	`c›y_‰om_u£r
(&
wﬁ
, 
u£øddr
, (wol)))

322  -
EFAULT
;

324  
ëhtoﬁ_›s
->
	`£t_wﬁ
(
dev
, &
wﬁ
);

325 
	}
}

327 
	$ëhtoﬁ_gë_msgÀvñ
(
√t_devi˚
 *
dev
, *
u£øddr
)

329 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GMSGLVL
 };

331 i‡(!
ëhtoﬁ_›s
->
gë_msgÀvñ
)

332  -
EOPNOTSUPP
;

334 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_msgÀvñ
(
dev
);

336 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

337  -
EFAULT
;

339 
	}
}

341 
	$ëhtoﬁ_£t_msgÀvñ
(
√t_devi˚
 *
dev
, *
u£øddr
)

343 
ëhtoﬁ_vÆue
 
ed©a
;

345 i‡(!
ëhtoﬁ_›s
->
£t_msgÀvñ
)

346  -
EOPNOTSUPP
;

348 i‡(
	`c›y_‰om_u£r
(&
ed©a
, 
u£øddr
, (edata)))

349  -
EFAULT
;

351 
ëhtoﬁ_›s
->
	`£t_msgÀvñ
(
dev
, 
ed©a
.
d©a
);

353 
	}
}

355 
	$ëhtoﬁ_nway_ª£t
(
√t_devi˚
 *
dev
)

357 i‡(!
ëhtoﬁ_›s
->
nway_ª£t
)

358  -
EOPNOTSUPP
;

360  
ëhtoﬁ_›s
->
	`nway_ª£t
(
dev
);

361 
	}
}

363 
	$ëhtoﬁ_gë_lök
(
√t_devi˚
 *
dev
, *
u£øddr
)

365 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GLINK
 };

367 i‡(!
ëhtoﬁ_›s
->
gë_lök
)

368  -
EOPNOTSUPP
;

370 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_lök
(
dev
);

372 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

373  -
EFAULT
;

375 
	}
}

377 
	$ëhtoﬁ_gë_ì¥om
(
√t_devi˚
 *
dev
, *
u£øddr
)

379 
ëhtoﬁ_ì¥om
 
ì¥om
;

380 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

381 
u8
 *
d©a
;

382 
ªt
;

384 i‡(!
›s
->
gë_ì¥om
 || !›s->
gë_ì¥om_Àn
)

385  -
EOPNOTSUPP
;

387 i‡(
	`c›y_‰om_u£r
(&
ì¥om
, 
u£øddr
, (eeprom)))

388  -
EFAULT
;

391 i‡(
ì¥om
.
off£t
 +Éïrom.
Àn
 <=Éeprom.offset)

392  -
EINVAL
;

395 i‡(
ì¥om
.
off£t
 +Éïrom.
Àn
 > 
›s
->
	`gë_ì¥om_Àn
(
dev
))

396  -
EINVAL
;

398 
d©a
 = 
	`kmÆloc
(
ì¥om
.
Àn
, 
GFP_USER
);

399 i‡(!
d©a
)

400  -
ENOMEM
;

402 
ªt
 = -
EFAULT
;

403 i‡(
	`c›y_‰om_u£r
(
d©a
, 
u£øddr
 + (
ì¥om
),Éïrom.
Àn
))

404 
out
;

406 
ªt
 = 
›s
->
	`gë_ì¥om
(
dev
, &
ì¥om
, 
d©a
);

407 i‡(
ªt
)

408 
out
;

410 
ªt
 = -
EFAULT
;

411 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ì¥om
, (eeprom)))

412 
out
;

413 i‡(
	`c›y_to_u£r
(
u£øddr
 + (
ì¥om
), 
d©a
,Éïrom.
Àn
))

414 
out
;

415 
ªt
 = 0;

417 
out
:

418 
	`k‰ì
(
d©a
);

419  
ªt
;

420 
	}
}

422 
	$ëhtoﬁ_£t_ì¥om
(
√t_devi˚
 *
dev
, *
u£øddr
)

424 
ëhtoﬁ_ì¥om
 
ì¥om
;

425 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

426 
u8
 *
d©a
;

427 
ªt
;

429 i‡(!
›s
->
£t_ì¥om
 || !›s->
gë_ì¥om_Àn
)

430  -
EOPNOTSUPP
;

432 i‡(
	`c›y_‰om_u£r
(&
ì¥om
, 
u£øddr
, (eeprom)))

433  -
EFAULT
;

436 i‡(
ì¥om
.
off£t
 +Éïrom.
Àn
 <=Éeprom.offset)

437  -
EINVAL
;

440 i‡(
ì¥om
.
off£t
 +Éïrom.
Àn
 > 
›s
->
	`gë_ì¥om_Àn
(
dev
))

441  -
EINVAL
;

443 
d©a
 = 
	`kmÆloc
(
ì¥om
.
Àn
, 
GFP_USER
);

444 i‡(!
d©a
)

445  -
ENOMEM
;

447 
ªt
 = -
EFAULT
;

448 i‡(
	`c›y_‰om_u£r
(
d©a
, 
u£øddr
 + (
ì¥om
),Éïrom.
Àn
))

449 
out
;

451 
ªt
 = 
›s
->
	`£t_ì¥om
(
dev
, &
ì¥om
, 
d©a
);

452 i‡(
ªt
)

453 
out
;

455 i‡(
	`c›y_to_u£r
(
u£øddr
 + (
ì¥om
), 
d©a
,Éïrom.
Àn
))

456 
ªt
 = -
EFAULT
;

458 
out
:

459 
	`k‰ì
(
d©a
);

460  
ªt
;

461 
	}
}

463 
	$ëhtoﬁ_gë_cﬂÀs˚
(
√t_devi˚
 *
dev
, *
u£øddr
)

465 
ëhtoﬁ_cﬂÀs˚
 
cﬂÀs˚
 = { 
ETHTOOL_GCOALESCE
 };

467 i‡(!
ëhtoﬁ_›s
->
gë_cﬂÀs˚
)

468  -
EOPNOTSUPP
;

470 
ëhtoﬁ_›s
->
	`gë_cﬂÀs˚
(
dev
, &
cﬂÀs˚
);

472 i‡(
	`c›y_to_u£r
(
u£øddr
, &
cﬂÀs˚
, (coalesce)))

473  -
EFAULT
;

475 
	}
}

477 
	$ëhtoﬁ_£t_cﬂÀs˚
(
√t_devi˚
 *
dev
, *
u£øddr
)

479 
ëhtoﬁ_cﬂÀs˚
 
cﬂÀs˚
;

481 i‡(!
ëhtoﬁ_›s
->
gë_cﬂÀs˚
)

482  -
EOPNOTSUPP
;

484 i‡(
	`c›y_‰om_u£r
(&
cﬂÀs˚
, 
u£øddr
, (coalesce)))

485  -
EFAULT
;

487  
ëhtoﬁ_›s
->
	`£t_cﬂÀs˚
(
dev
, &
cﬂÀs˚
);

488 
	}
}

490 
	$ëhtoﬁ_gë_rög∑øm
(
√t_devi˚
 *
dev
, *
u£øddr
)

492 
ëhtoﬁ_rög∑øm
 
rög∑øm
 = { 
ETHTOOL_GRINGPARAM
 };

494 i‡(!
ëhtoﬁ_›s
->
gë_rög∑øm
)

495  -
EOPNOTSUPP
;

497 
ëhtoﬁ_›s
->
	`gë_rög∑øm
(
dev
, &
rög∑øm
);

499 i‡(
	`c›y_to_u£r
(
u£øddr
, &
rög∑øm
, (ringparam)))

500  -
EFAULT
;

502 
	}
}

504 
	$ëhtoﬁ_£t_rög∑øm
(
√t_devi˚
 *
dev
, *
u£øddr
)

506 
ëhtoﬁ_rög∑øm
 
rög∑øm
;

508 i‡(!
ëhtoﬁ_›s
->
gë_rög∑øm
)

509  -
EOPNOTSUPP
;

511 i‡(
	`c›y_‰om_u£r
(&
rög∑øm
, 
u£øddr
, (ringparam)))

512  -
EFAULT
;

514  
ëhtoﬁ_›s
->
	`£t_rög∑øm
(
dev
, &
rög∑øm
);

515 
	}
}

517 
	$ëhtoﬁ_gë_∑u£∑øm
(
√t_devi˚
 *
dev
, *
u£øddr
)

519 
ëhtoﬁ_∑u£∑øm
 
∑u£∑øm
 = { 
ETHTOOL_GPAUSEPARAM
 };

521 i‡(!
ëhtoﬁ_›s
->
gë_∑u£∑øm
)

522  -
EOPNOTSUPP
;

524 
ëhtoﬁ_›s
->
	`gë_∑u£∑øm
(
dev
, &
∑u£∑øm
);

526 i‡(
	`c›y_to_u£r
(
u£øddr
, &
∑u£∑øm
, (pauseparam)))

527  -
EFAULT
;

529 
	}
}

531 
	$ëhtoﬁ_£t_∑u£∑øm
(
√t_devi˚
 *
dev
, *
u£øddr
)

533 
ëhtoﬁ_∑u£∑øm
 
∑u£∑øm
;

535 i‡(!
ëhtoﬁ_›s
->
gë_∑u£∑øm
)

536  -
EOPNOTSUPP
;

538 i‡(
	`c›y_‰om_u£r
(&
∑u£∑øm
, 
u£øddr
, (pauseparam)))

539  -
EFAULT
;

541  
ëhtoﬁ_›s
->
	`£t_∑u£∑øm
(
dev
, &
∑u£∑øm
);

542 
	}
}

544 
	$ëhtoﬁ_gë_rx_csum
(
√t_devi˚
 *
dev
, *
u£øddr
)

546 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GRXCSUM
 };

548 i‡(!
ëhtoﬁ_›s
->
gë_rx_csum
)

549  -
EOPNOTSUPP
;

551 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_rx_csum
(
dev
);

553 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

554  -
EFAULT
;

556 
	}
}

558 
	$ëhtoﬁ_£t_rx_csum
(
√t_devi˚
 *
dev
, *
u£øddr
)

560 
ëhtoﬁ_vÆue
 
ed©a
;

562 i‡(!
ëhtoﬁ_›s
->
£t_rx_csum
)

563  -
EOPNOTSUPP
;

565 i‡(
	`c›y_‰om_u£r
(&
ed©a
, 
u£øddr
, (edata)))

566  -
EFAULT
;

568 
ëhtoﬁ_›s
->
	`£t_rx_csum
(
dev
, 
ed©a
.
d©a
);

570 
	}
}

572 
	$ëhtoﬁ_gë_tx_csum
(
√t_devi˚
 *
dev
, *
u£øddr
)

574 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GTXCSUM
 };

576 i‡(!
ëhtoﬁ_›s
->
gë_tx_csum
)

577  -
EOPNOTSUPP
;

579 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_tx_csum
(
dev
);

581 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

582  -
EFAULT
;

584 
	}
}

586 
	$ëhtoﬁ_£t_tx_csum
(
√t_devi˚
 *
dev
, *
u£øddr
)

588 
ëhtoﬁ_vÆue
 
ed©a
;

590 i‡(!
ëhtoﬁ_›s
->
£t_tx_csum
)

591  -
EOPNOTSUPP
;

593 i‡(
	`c›y_‰om_u£r
(&
ed©a
, 
u£øddr
, (edata)))

594  -
EFAULT
;

596  
ëhtoﬁ_›s
->
	`£t_tx_csum
(
dev
, 
ed©a
.
d©a
);

597 
	}
}

599 
	$ëhtoﬁ_gë_sg
(
√t_devi˚
 *
dev
, *
u£øddr
)

601 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GSG
 };

603 i‡(!
ëhtoﬁ_›s
->
gë_sg
)

604  -
EOPNOTSUPP
;

606 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_sg
(
dev
);

608 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

609  -
EFAULT
;

611 
	}
}

613 
	$ëhtoﬁ_£t_sg
(
√t_devi˚
 *
dev
, *
u£øddr
)

615 
ëhtoﬁ_vÆue
 
ed©a
;

617 i‡(!
ëhtoﬁ_›s
->
£t_sg
)

618  -
EOPNOTSUPP
;

620 i‡(
	`c›y_‰om_u£r
(&
ed©a
, 
u£øddr
, (edata)))

621  -
EFAULT
;

623  
ëhtoﬁ_›s
->
	`£t_sg
(
dev
, 
ed©a
.
d©a
);

624 
	}
}

626 
	$ëhtoﬁ_gë_tso
(
√t_devi˚
 *
dev
, *
u£øddr
)

628 
ëhtoﬁ_vÆue
 
ed©a
 = { 
ETHTOOL_GTSO
 };

630 i‡(!
ëhtoﬁ_›s
->
gë_tso
)

631  -
EOPNOTSUPP
;

633 
ed©a
.
d©a
 = 
ëhtoﬁ_›s
->
	`gë_tso
(
dev
);

635 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ed©a
, (edata)))

636  -
EFAULT
;

638 
	}
}

640 
	$ëhtoﬁ_£t_tso
(
√t_devi˚
 *
dev
, *
u£øddr
)

642 
ëhtoﬁ_vÆue
 
ed©a
;

644 i‡(!
ëhtoﬁ_›s
->
£t_tso
)

645  -
EOPNOTSUPP
;

647 i‡(
	`c›y_‰om_u£r
(&
ed©a
, 
u£øddr
, (edata)))

648  -
EFAULT
;

650  
ëhtoﬁ_›s
->
	`£t_tso
(
dev
, 
ed©a
.
d©a
);

651 
	}
}

653 
	$ëhtoﬁ_£lf_ã°
(
√t_devi˚
 *
dev
, *
u£øddr
)

655 
ëhtoﬁ_ã°
 
ã°
;

656 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

657 
u64
 *
d©a
;

658 
ªt
;

660 i‡(!
›s
->
£lf_ã°
 || !›s->
£lf_ã°_cou¡
)

661  -
EOPNOTSUPP
;

663 i‡(
	`c›y_‰om_u£r
(&
ã°
, 
u£øddr
, (test)))

664  -
EFAULT
;

666 
ã°
.
Àn
 = 
›s
->
	`£lf_ã°_cou¡
(
dev
);

667 
d©a
 = 
	`kmÆloc
(
ã°
.
Àn
 * (
u64
), 
GFP_USER
);

668 i‡(!
d©a
)

669  -
ENOMEM
;

671 
›s
->
	`£lf_ã°
(
dev
, &
ã°
, 
d©a
);

673 
ªt
 = -
EFAULT
;

674 i‡(
	`c›y_to_u£r
(
u£øddr
, &
ã°
, (test)))

675 
out
;

676 
u£øddr
 +(
ã°
);

677 i‡(
	`c›y_to_u£r
(
u£øddr
, 
d©a
, 
ã°
.
Àn
 * (
u64
)))

678 
out
;

679 
ªt
 = 0;

681 
out
:

682 
	`k‰ì
(
d©a
);

683  
ªt
;

684 
	}
}

686 
	$ëhtoﬁ_gë_°rögs
(
√t_devi˚
 *
dev
, *
u£øddr
)

688 
ëhtoﬁ_g°rögs
 
g°rögs
;

689 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

690 
u8
 *
d©a
;

691 
ªt
;

693 i‡(!
›s
->
gë_°rögs
)

694  -
EOPNOTSUPP
;

696 i‡(
	`c›y_‰om_u£r
(&
g°rögs
, 
u£øddr
, (gstrings)))

697  -
EFAULT
;

699 
g°rögs
.
°rög_£t
) {

700 
ETH_SS_TEST
:

701 i‡(!
›s
->
£lf_ã°_cou¡
)

702  -
EOPNOTSUPP
;

703 
g°rögs
.
Àn
 = 
›s
->
	`£lf_ã°_cou¡
(
dev
);

705 
ETH_SS_STATS
:

706 i‡(!
›s
->
gë_°©s_cou¡
)

707  -
EOPNOTSUPP
;

708 
g°rögs
.
Àn
 = 
›s
->
	`gë_°©s_cou¡
(
dev
);

711  -
EINVAL
;

714 
d©a
 = 
	`kmÆloc
(
g°rögs
.
Àn
 * 
ETH_GSTRING_LEN
, 
GFP_USER
);

715 i‡(!
d©a
)

716  -
ENOMEM
;

718 
›s
->
	`gë_°rögs
(
dev
, 
g°rögs
.
°rög_£t
, 
d©a
);

720 
ªt
 = -
EFAULT
;

721 i‡(
	`c›y_to_u£r
(
u£øddr
, &
g°rögs
, (gstrings)))

722 
out
;

723 
u£øddr
 +(
g°rögs
);

724 i‡(
	`c›y_to_u£r
(
u£øddr
, 
d©a
, 
g°rögs
.
Àn
 * 
ETH_GSTRING_LEN
))

725 
out
;

726 
ªt
 = 0;

728 
out
:

729 
	`k‰ì
(
d©a
);

730  
ªt
;

731 
	}
}

733 
	$ëhtoﬁ_phys_id
(
√t_devi˚
 *
dev
, *
u£øddr
)

735 
ëhtoﬁ_vÆue
 
id
;

737 i‡(!
ëhtoﬁ_›s
->
phys_id
)

738  -
EOPNOTSUPP
;

740 i‡(
	`c›y_‰om_u£r
(&
id
, 
u£øddr
, (id)))

741  -
EFAULT
;

743  
ëhtoﬁ_›s
->
	`phys_id
(
dev
, 
id
.
d©a
);

744 
	}
}

746 
	$ëhtoﬁ_gë_°©s
(
√t_devi˚
 *
dev
, *
u£øddr
)

748 
ëhtoﬁ_°©s
 
°©s
;

749 
ëhtoﬁ_›s
 *
›s
 =Éthtool_ops;

750 
u64
 *
d©a
;

751 
ªt
;

753 i‡(!
›s
->
gë_ëhtoﬁ_°©s
 || !›s->
gë_°©s_cou¡
)

754  -
EOPNOTSUPP
;

756 i‡(
	`c›y_‰om_u£r
(&
°©s
, 
u£øddr
, (stats)))

757  -
EFAULT
;

759 
°©s
.
n_°©s
 = 
›s
->
	`gë_°©s_cou¡
(
dev
);

760 
d©a
 = 
	`kmÆloc
(
°©s
.
n_°©s
 * (
u64
), 
GFP_USER
);

761 i‡(!
d©a
)

762  -
ENOMEM
;

764 
›s
->
	`gë_ëhtoﬁ_°©s
(
dev
, &
°©s
, 
d©a
);

766 
ªt
 = -
EFAULT
;

767 i‡(
	`c›y_to_u£r
(
u£øddr
, &
°©s
, (stats)))

768 
out
;

769 
u£øddr
 +(
°©s
);

770 i‡(
	`c›y_to_u£r
(
u£øddr
, 
d©a
, 
°©s
.
n_°©s
 * (
u64
)))

771 
out
;

772 
ªt
 = 0;

774 
out
:

775 
	`k‰ì
(
d©a
);

776  
ªt
;

777 
	}
}

781 
	#ETHTOOL_OPS_COMPAT


	)

782 
	$ëhtoﬁ_io˘l
(
i‰eq
 *
i‰
)

784 
√t_devi˚
 *
dev
 = 
	`__dev_gë_by_«me
(
i‰
->
i‰_«me
);

785 *
u£øddr
 = (*)
i‰
->
i‰_d©a
;

786 
u32
 
ëhcmd
;

792 i‡(!
	`ˇ∑bÀ
(
CAP_NET_ADMIN
))

793  -
EPERM
;

795 i‡(!
dev
 || !
	`√tif_devi˚_¥e£¡
(dev))

796  -
ENODEV
;

798 i‡(
	`c›y_‰om_u£r
(&
ëhcmd
, 
u£øddr
, (ethcmd)))

799  -
EFAULT
;

801 
ëhcmd
) {

802 
ETHTOOL_GSET
:

803  
	`ëhtoﬁ_gë_£âögs
(
dev
, 
u£øddr
);

804 
ETHTOOL_SSET
:

805  
	`ëhtoﬁ_£t_£âögs
(
dev
, 
u£øddr
);

806 
ETHTOOL_GDRVINFO
:

807  
	`ëhtoﬁ_gë_drvöfo
(
dev
, 
u£øddr
);

808 
ETHTOOL_GREGS
:

809  
	`ëhtoﬁ_gë_ªgs
(
dev
, 
u£øddr
);

810 
ETHTOOL_GWOL
:

811  
	`ëhtoﬁ_gë_wﬁ
(
dev
, 
u£øddr
);

812 
ETHTOOL_SWOL
:

813  
	`ëhtoﬁ_£t_wﬁ
(
dev
, 
u£øddr
);

814 
ETHTOOL_GMSGLVL
:

815  
	`ëhtoﬁ_gë_msgÀvñ
(
dev
, 
u£øddr
);

816 
ETHTOOL_SMSGLVL
:

817  
	`ëhtoﬁ_£t_msgÀvñ
(
dev
, 
u£øddr
);

818 
ETHTOOL_NWAY_RST
:

819  
	`ëhtoﬁ_nway_ª£t
(
dev
);

820 
ETHTOOL_GLINK
:

821  
	`ëhtoﬁ_gë_lök
(
dev
, 
u£øddr
);

822 
ETHTOOL_GEEPROM
:

823  
	`ëhtoﬁ_gë_ì¥om
(
dev
, 
u£øddr
);

824 
ETHTOOL_SEEPROM
:

825  
	`ëhtoﬁ_£t_ì¥om
(
dev
, 
u£øddr
);

826 
ETHTOOL_GCOALESCE
:

827  
	`ëhtoﬁ_gë_cﬂÀs˚
(
dev
, 
u£øddr
);

828 
ETHTOOL_SCOALESCE
:

829  
	`ëhtoﬁ_£t_cﬂÀs˚
(
dev
, 
u£øddr
);

830 
ETHTOOL_GRINGPARAM
:

831  
	`ëhtoﬁ_gë_rög∑øm
(
dev
, 
u£øddr
);

832 
ETHTOOL_SRINGPARAM
:

833  
	`ëhtoﬁ_£t_rög∑øm
(
dev
, 
u£øddr
);

834 
ETHTOOL_GPAUSEPARAM
:

835  
	`ëhtoﬁ_gë_∑u£∑øm
(
dev
, 
u£øddr
);

836 
ETHTOOL_SPAUSEPARAM
:

837  
	`ëhtoﬁ_£t_∑u£∑øm
(
dev
, 
u£øddr
);

838 
ETHTOOL_GRXCSUM
:

839  
	`ëhtoﬁ_gë_rx_csum
(
dev
, 
u£øddr
);

840 
ETHTOOL_SRXCSUM
:

841  
	`ëhtoﬁ_£t_rx_csum
(
dev
, 
u£øddr
);

842 
ETHTOOL_GTXCSUM
:

843  
	`ëhtoﬁ_gë_tx_csum
(
dev
, 
u£øddr
);

844 
ETHTOOL_STXCSUM
:

845  
	`ëhtoﬁ_£t_tx_csum
(
dev
, 
u£øddr
);

846 
ETHTOOL_GSG
:

847  
	`ëhtoﬁ_gë_sg
(
dev
, 
u£øddr
);

848 
ETHTOOL_SSG
:

849  
	`ëhtoﬁ_£t_sg
(
dev
, 
u£øddr
);

850 
ETHTOOL_GTSO
:

851  
	`ëhtoﬁ_gë_tso
(
dev
, 
u£øddr
);

852 
ETHTOOL_STSO
:

853  
	`ëhtoﬁ_£t_tso
(
dev
, 
u£øddr
);

854 
ETHTOOL_TEST
:

855  
	`ëhtoﬁ_£lf_ã°
(
dev
, 
u£øddr
);

856 
ETHTOOL_GSTRINGS
:

857  
	`ëhtoﬁ_gë_°rögs
(
dev
, 
u£øddr
);

858 
ETHTOOL_PHYS_ID
:

859  
	`ëhtoﬁ_phys_id
(
dev
, 
u£øddr
);

860 
ETHTOOL_GSTATS
:

861  
	`ëhtoﬁ_gë_°©s
(
dev
, 
u£øddr
);

863  -
EOPNOTSUPP
;

866  -
EOPNOTSUPP
;

867 
	}
}

869 
	#mii_if_öfo
 
_kc_mii_if_öfo


	)

870 
	s_kc_mii_if_öfo
 {

871 
	mphy_id
;

872 
	madvîtisög
;

873 
	mphy_id_mask
;

874 
	mªg_num_mask
;

876 
	mfuŒ_du∂ex
:1;

877 
	mf‹˚_medü
:1;

879 
√t_devi˚
 *
	mdev
;

880 (*
	mmdio_ªad
Ë(
√t_devi˚
 * 
	mdev
, 
	mphy_id
, 
	mloˇti⁄
);

881 (*
	mmdio_wrôe
Ë(
√t_devi˚
 * 
	mdev
, 
	mphy_id
, 
	mloˇti⁄
,

882 
	mvÆ
);

885 
	gëhtoﬁ_cmd
;

886 
	gmii_io˘l_d©a
;

888 #unde‡
mii_lök_ok


889 
	#mii_lök_ok
 
_kc_mii_lök_ok


	)

890 #unde‡
mii_nway_ª°¨t


891 
	#mii_nway_ª°¨t
 
_kc_mii_nway_ª°¨t


	)

892 #unde‡
mii_ëhtoﬁ_g£t


893 
	#mii_ëhtoﬁ_g£t
 
_kc_mii_ëhtoﬁ_g£t


	)

894 #unde‡
mii_ëhtoﬁ_s£t


895 
	#mii_ëhtoﬁ_s£t
 
_kc_mii_ëhtoﬁ_s£t


	)

896 #unde‡
mii_check_lök


897 
	#mii_check_lök
 
_kc_mii_check_lök


	)

898 
_kc_mii_lök_ok
(
mii_if_öfo
 *
mii
);

899 
_kc_mii_nway_ª°¨t
(
mii_if_öfo
 *
mii
);

900 
_kc_mii_ëhtoﬁ_g£t
(
mii_if_öfo
 *
mii
,

901 
ëhtoﬁ_cmd
 *
ecmd
);

902 
_kc_mii_ëhtoﬁ_s£t
(
mii_if_öfo
 *
mii
,

903 
ëhtoﬁ_cmd
 *
ecmd
);

904 
_kc_mii_check_lök
(
mii_if_öfo
 *
mii
);

905 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,4,6) )

906 #unde‡
gíîic_mii_io˘l


907 
	#gíîic_mii_io˘l
 
_kc_gíîic_mii_io˘l


	)

908 
_kc_gíîic_mii_io˘l
(
mii_if_öfo
 *
mii_if
,

909 
mii_io˘l_d©a
 *
mii_d©a
, 
cmd
,

910 *
du∂ex_ch™ged
);

913 
	s_kc_pci_dev_ext
 {

914 
pci_dev
 *
	mdev
;

915 *
	mpci_drvd©a
;

916 
pci_drivî
 *
	mdrivî
;

919 
	s_kc_√t_dev_ext
 {

920 
√t_devi˚
 *
	mdev
;

921 
	mˇºõr
;

927 
	$_kc_mii_ëhtoﬁ_g£t
(
mii_if_öfo
 *
mii
, 
ëhtoﬁ_cmd
 *
ecmd
)

929 
√t_devi˚
 *
dev
 = 
mii
->dev;

930 
u32
 
advît
, 
bm¸
, 
Õa
, 
√go
;

932 
ecmd
->
suµ‹ãd
 =

933 (
SUPPORTED_10ba£T_HÆf
 | 
SUPPORTED_10ba£T_FuŒ
 |

934 
SUPPORTED_100ba£T_HÆf
 | 
SUPPORTED_100ba£T_FuŒ
 |

935 
SUPPORTED_Aut⁄eg
 | 
SUPPORTED_TP
 | 
SUPPORTED_MII
);

938 
ecmd
->
p‹t
 = 
PORT_MII
;

941 
ecmd
->
å™s˚ivî
 = 
XCVR_INTERNAL
;

944 
ecmd
->
phy_addªss
 = 
mii
->
phy_id
;

946 
ecmd
->
advîtisög
 = 
ADVERTISED_TP
 | 
ADVERTISED_MII
;

947 
advît
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_ADVERTISE
);

948 i‡(
advît
 & 
ADVERTISE_10HALF
)

949 
ecmd
->
advîtisög
 |
ADVERTISED_10ba£T_HÆf
;

950 i‡(
advît
 & 
ADVERTISE_10FULL
)

951 
ecmd
->
advîtisög
 |
ADVERTISED_10ba£T_FuŒ
;

952 i‡(
advît
 & 
ADVERTISE_100HALF
)

953 
ecmd
->
advîtisög
 |
ADVERTISED_100ba£T_HÆf
;

954 i‡(
advît
 & 
ADVERTISE_100FULL
)

955 
ecmd
->
advîtisög
 |
ADVERTISED_100ba£T_FuŒ
;

957 
bm¸
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_BMCR
);

958 
Õa
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_LPA
);

959 i‡(
bm¸
 & 
BMCR_ANENABLE
) {

960 
ecmd
->
advîtisög
 |
ADVERTISED_Aut⁄eg
;

961 
ecmd
->
aut⁄eg
 = 
AUTONEG_ENABLE
;

963 
√go
 = 
	`mii_nway_ªsu…
(
advît
 & 
Õa
);

964 i‡(
√go
 =
LPA_100FULL
 ||Çegÿ=
LPA_100HALF
)

965 
ecmd
->
•ìd
 = 
SPEED_100
;

967 
ecmd
->
•ìd
 = 
SPEED_10
;

968 i‡(
√go
 =
LPA_100FULL
 ||Çegÿ=
LPA_10FULL
) {

969 
ecmd
->
du∂ex
 = 
DUPLEX_FULL
;

970 
mii
->
fuŒ_du∂ex
 = 1;

972 
ecmd
->
du∂ex
 = 
DUPLEX_HALF
;

973 
mii
->
fuŒ_du∂ex
 = 0;

976 
ecmd
->
aut⁄eg
 = 
AUTONEG_DISABLE
;

978 
ecmd
->
•ìd
 = (
bm¸
 & 
BMCR_SPEED100
Ë? 
SPEED_100
 : 
SPEED_10
;

979 
ecmd
->
du∂ex
 =

980 (
bm¸
 & 
BMCR_FULLDPLX
Ë? 
DUPLEX_FULL
 : 
DUPLEX_HALF
;

986 
	}
}

988 
	$_kc_mii_ëhtoﬁ_s£t
(
mii_if_öfo
 *
mii
, 
ëhtoﬁ_cmd
 *
ecmd
)

990 
√t_devi˚
 *
dev
 = 
mii
->dev;

992 i‡(
ecmd
->
•ìd
 !
SPEED_10
 &&Écmd->•ìd !
SPEED_100
)

993  -
EINVAL
;

994 i‡(
ecmd
->
du∂ex
 !
DUPLEX_HALF
 &&Écmd->du∂ex !
DUPLEX_FULL
)

995  -
EINVAL
;

996 i‡(
ecmd
->
p‹t
 !
PORT_MII
)

997  -
EINVAL
;

998 i‡(
ecmd
->
å™s˚ivî
 !
XCVR_INTERNAL
)

999  -
EINVAL
;

1000 i‡(
ecmd
->
phy_addªss
 !
mii
->
phy_id
)

1001  -
EINVAL
;

1002 i‡(
ecmd
->
aut⁄eg
 !
AUTONEG_DISABLE
 &&Écmd->aut⁄eg !
AUTONEG_ENABLE
)

1003  -
EINVAL
;

1007 i‡(
ecmd
->
aut⁄eg
 =
AUTONEG_ENABLE
) {

1008 
u32
 
bm¸
, 
advît
, 
tmp
;

1010 i‡((
ecmd
->
advîtisög
 & (
ADVERTISED_10ba£T_HÆf
 |

1011 
ADVERTISED_10ba£T_FuŒ
 |

1012 
ADVERTISED_100ba£T_HÆf
 |

1013 
ADVERTISED_100ba£T_FuŒ
)) == 0)

1014  -
EINVAL
;

1017 
advît
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_ADVERTISE
);

1018 
tmp
 = 
advît
 & ~(
ADVERTISE_ALL
 | 
ADVERTISE_100BASE4
);

1019 i‡(
ADVERTISED_10ba£T_HÆf
)

1020 
tmp
 |
ADVERTISE_10HALF
;

1021 i‡(
ADVERTISED_10ba£T_FuŒ
)

1022 
tmp
 |
ADVERTISE_10FULL
;

1023 i‡(
ADVERTISED_100ba£T_HÆf
)

1024 
tmp
 |
ADVERTISE_100HALF
;

1025 i‡(
ADVERTISED_100ba£T_FuŒ
)

1026 
tmp
 |
ADVERTISE_100FULL
;

1027 i‡(
advît
 !
tmp
) {

1028 
mii
->
	`mdio_wrôe
(
dev
, mii->
phy_id
, 
MII_ADVERTISE
, 
tmp
);

1029 
mii
->
advîtisög
 = 
tmp
;

1033 
bm¸
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_BMCR
);

1034 
bm¸
 |(
BMCR_ANENABLE
 | 
BMCR_ANRESTART
);

1035 
mii
->
	`mdio_wrôe
(
dev
, mii->
phy_id
, 
MII_BMCR
, 
bm¸
);

1037 
mii
->
f‹˚_medü
 = 0;

1039 
u32
 
bm¸
, 
tmp
;

1042 
bm¸
 = 
mii
->
	`mdio_ªad
(
dev
, mii->
phy_id
, 
MII_BMCR
);

1043 
tmp
 = 
bm¸
 & ~(
BMCR_ANENABLE
 | 
BMCR_SPEED100
 | 
BMCR_FULLDPLX
);

1044 i‡(
ecmd
->
•ìd
 =
SPEED_100
)

1045 
tmp
 |
BMCR_SPEED100
;

1046 i‡(
ecmd
->
du∂ex
 =
DUPLEX_FULL
) {

1047 
tmp
 |
BMCR_FULLDPLX
;

1048 
mii
->
fuŒ_du∂ex
 = 1;

1050 
mii
->
fuŒ_du∂ex
 = 0;

1051 i‡(
bm¸
 !
tmp
)

1052 
mii
->
	`mdio_wrôe
(
dev
, mii->
phy_id
, 
MII_BMCR
, 
tmp
);

1054 
mii
->
f‹˚_medü
 = 1;

1057 
	}
}

1059 
	$_kc_mii_lök_ok
(
mii_if_öfo
 *
mii
)

1062 
mii
->
	`mdio_ªad
(mii->
dev
, mii->
phy_id
, 
MII_BMSR
);

1063 i‡(
mii
->
	`mdio_ªad
(mii->
dev
, mii->
phy_id
, 
MII_BMSR
Ë& 
BMSR_LSTATUS
)

1066 
	}
}

1068 
	$_kc_mii_nway_ª°¨t
(
mii_if_öfo
 *
mii
)

1070 
bm¸
;

1071 
r
 = -
EINVAL
;

1074 
bm¸
 = 
mii
->
	`mdio_ªad
(mii->
dev
, mii->
phy_id
, 
MII_BMCR
);

1076 i‡(
bm¸
 & 
BMCR_ANENABLE
) {

1077 
bm¸
 |
BMCR_ANRESTART
;

1078 
mii
->
	`mdio_wrôe
(mii->
dev
, mii->
phy_id
, 
MII_BMCR
, 
bm¸
);

1079 
r
 = 0;

1082  
r
;

1083 
	}
}

1085 
	$_kc_mii_check_lök
(
mii_if_öfo
 *
mii
)

1087 
cur_lök
 = 
	`mii_lök_ok
(
mii
);

1088 
¥ev_lök
 = 
	`√tif_ˇºõr_ok
(
mii
->
dev
);

1090 i‡(
cur_lök
 && !
¥ev_lök
)

1091 
	`√tif_ˇºõr_⁄
(
mii
->
dev
);

1092 i‡(
¥ev_lök
 && !
cur_lök
)

1093 
	`√tif_ˇºõr_off
(
mii
->
dev
);

1094 
	}
}

1096 #i‡–
LINUX_VERSION_CODE
 > 
KERNEL_VERSION
(2,4,6) )

1097 
	$_kc_gíîic_mii_io˘l
(
mii_if_öfo
 *
mii_if
,

1098 
mii_io˘l_d©a
 *
mii_d©a
, 
cmd
,

1099 *
du∂ex_chg_out
)

1101 
rc
 = 0;

1102 
du∂ex_ch™ged
 = 0;

1104 i‡(
du∂ex_chg_out
)

1105 *
du∂ex_chg_out
 = 0;

1107 
mii_d©a
->
phy_id
 &
mii_if
->
phy_id_mask
;

1108 
mii_d©a
->
ªg_num
 &
mii_if
->
ªg_num_mask
;

1110 
cmd
) {

1111 
SIOCDEVPRIVATE
:

1112 
SIOCGMIIPHY
:

1113 
mii_d©a
->
phy_id
 = 
mii_if
->phy_id;

1116 
SIOCDEVPRIVATE
 + 1:

1117 
SIOCGMIIREG
:

1118 
mii_d©a
->
vÆ_out
 =

1119 
mii_if
->
	`mdio_ªad
(mii_if->
dev
, 
mii_d©a
->
phy_id
,

1120 
mii_d©a
->
ªg_num
);

1123 
SIOCDEVPRIVATE
 + 2:

1124 
SIOCSMIIREG
:{

1125 
u16
 
vÆ
 = 
mii_d©a
->
vÆ_ö
;

1127 i‡(!
	`ˇ∑bÀ
(
CAP_NET_ADMIN
))

1128  -
EPERM
;

1130 i‡(
mii_d©a
->
phy_id
 =
mii_if
->phy_id) {

1131 
mii_d©a
->
ªg_num
) {

1132 
MII_BMCR
:{

1133 
√w_du∂ex
 = 0;

1134 i‡(
vÆ
 &

1135 (
BMCR_RESET
 |

1136 
BMCR_ANENABLE
))

1137 
mii_if
->
f‹˚_medü
 = 0;

1139 
mii_if
->
f‹˚_medü
 = 1;

1140 i‡(
mii_if
->
f‹˚_medü
 &&

1141 (
vÆ
 & 
BMCR_FULLDPLX
))

1142 
√w_du∂ex
 = 1;

1143 i‡(
mii_if
->
fuŒ_du∂ex
 !=

1144 
√w_du∂ex
) {

1145 
du∂ex_ch™ged
 = 1;

1146 
mii_if
->
fuŒ_du∂ex
 =

1147 
√w_du∂ex
;

1151 
MII_ADVERTISE
:

1152 
mii_if
->
advîtisög
 = 
vÆ
;

1160 
mii_if
->
	`mdio_wrôe
(mii_if->
dev
, 
mii_d©a
->
phy_id
,

1161 
mii_d©a
->
ªg_num
, 
vÆ
);

1166 
rc
 = -
EOPNOTSUPP
;

1170 i‡((
rc
 =0Ë&& (
du∂ex_chg_out
Ë&& (
du∂ex_ch™ged
))

1171 *
du∂ex_chg_out
 = 1;

1173  
rc
;

1174 
	}
}

	@mac.c

29 
	~"e1000.h
"

39 
s32
 
	$e1000e_gë_bus_öfo_pcõ
(
e1000_hw
 *
hw
)

41 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

42 
e1000_bus_öfo
 *
bus
 = &
hw
->bus;

43 
e1000_ad≠ãr
 *
ad≠ãr
 = 
hw
->adapter;

44 
u16
 
pcõ_lök_°©us
, 
ˇp_off£t
;

46 
ˇp_off£t
 = 
	`pci_föd_ˇ∑bûôy
(
ad≠ãr
->
pdev
, 
PCI_CAP_ID_EXP
);

47 i‡(!
ˇp_off£t
) {

48 
bus
->
width
 = 
e1000_bus_width_unknown
;

50 
	`pci_ªad_c⁄fig_w‹d
(
ad≠ãr
->
pdev
,

51 
ˇp_off£t
 + 
PCIE_LINK_STATUS
,

52 &
pcõ_lök_°©us
);

53 
bus
->
width
 = (
e1000_bus_width
)((
pcõ_lök_°©us
 &

54 
PCIE_LINK_WIDTH_MASK
) >>

55 
PCIE_LINK_WIDTH_SHIFT
);

58 
mac
->
›s
.
	`£t_œn_id
(
hw
);

61 
	}
}

71 
	$e1000_£t_œn_id_mu…i_p‹t_pcõ
(
e1000_hw
 *
hw
)

73 
e1000_bus_öfo
 *
bus
 = &
hw
->bus;

74 
u32
 
ªg
;

79 
ªg
 = 
	`î32
(
STATUS
);

80 
bus
->
func
 = (
ªg
 & 
E1000_STATUS_FUNC_MASK
Ë>> 
E1000_STATUS_FUNC_SHIFT
;

81 
	}
}

89 
	$e1000_£t_œn_id_sögÀ_p‹t
(
e1000_hw
 *
hw
)

91 
e1000_bus_öfo
 *
bus
 = &
hw
->bus;

93 
bus
->
func
 = 0;

94 
	}
}

103 
	$e1000_˛ór_v·a_gíîic
(
e1000_hw
 *
hw
)

105 
u32
 
off£t
;

107 
off£t
 = 0; off£à< 
E1000_VLAN_FILTER_TBL_SIZE
; offset++) {

108 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_VFTA
, 
off£t
, 0);

109 
	`e1e_Êush
();

111 
	}
}

122 
	$e1000_wrôe_v·a_gíîic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, u32 
vÆue
)

124 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_VFTA
, 
off£t
, 
vÆue
);

125 
	`e1e_Êush
();

126 
	}
}

137 
	$e1000e_öô_rx_addrs
(
e1000_hw
 *
hw
, 
u16
 
ør_cou¡
)

139 
u32
 
i
;

140 
u8
 
mac_addr
[
ETH_ALEN
] = { 0 };

143 
	`e_dbg
("Programming MAC Address into RAR[0]\n");

145 
hw
->
mac
.
›s
.
	`ør_£t
(hw, hw->mac.
addr
, 0);

148 
	`e_dbg
("CÀ¨ög RAR[1-%u]\n", 
ør_cou¡
 - 1);

149 
i
 = 1; i < 
ør_cou¡
; i++)

150 
hw
->
mac
.
›s
.
	`ør_£t
(hw, 
mac_addr
, 
i
);

151 
	}
}

165 
s32
 
	$e1000_check_Æt_mac_addr_gíîic
(
e1000_hw
 *
hw
)

167 
u32
 
i
;

168 
s32
 
ªt_vÆ
;

169 
u16
 
off£t
, 
nvm_Æt_mac_addr_off£t
, 
nvm_d©a
;

170 
u8
 
Æt_mac_addr
[
ETH_ALEN
];

172 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_COMPAT
, 1, &
nvm_d©a
);

173 i‡(
ªt_vÆ
)

174  
ªt_vÆ
;

177 i‡(
hw
->
mac
.
ty≥
 =
e1000_82573
)

180 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_ALT_MAC_ADDR_PTR
, 1,

181 &
nvm_Æt_mac_addr_off£t
);

182 i‡(
ªt_vÆ
) {

183 
	`e_dbg
("NVM Read Error\n");

184  
ªt_vÆ
;

187 i‡((
nvm_Æt_mac_addr_off£t
 == 0xFFFF) ||

188 (
nvm_Æt_mac_addr_off£t
 == 0x0000))

192 i‡(
hw
->
bus
.
func
 =
E1000_FUNC_1
)

193 
nvm_Æt_mac_addr_off£t
 +
E1000_ALT_MAC_ADDRESS_OFFSET_LAN1
;

194 
i
 = 0; i < 
ETH_ALEN
; i += 2) {

195 
off£t
 = 
nvm_Æt_mac_addr_off£t
 + (
i
 >> 1);

196 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
off£t
, 1, &
nvm_d©a
);

197 i‡(
ªt_vÆ
) {

198 
	`e_dbg
("NVM Read Error\n");

199  
ªt_vÆ
;

202 
Æt_mac_addr
[
i
] = (
u8
)(
nvm_d©a
 & 0xFF);

203 
Æt_mac_addr
[
i
 + 1] = (
u8
)(
nvm_d©a
 >> 8);

207 i‡(
	`is_mu…iˇ°_ëhî_addr
(
Æt_mac_addr
)) {

208 
	`e_dbg
("Ignoring Alternate Mac Address with MC bit set\n");

216 
hw
->
mac
.
›s
.
	`ør_£t
(hw, 
Æt_mac_addr
, 0);

219 
	}
}

230 
	$e1000e_ør_£t_gíîic
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
)

232 
u32
 
ør_low
, 
ør_high
;

237 
ør_low
 = ((
u32
)
addr
[0] | ((u32)addr[1] << 8) |

238 ((
u32
)
addr
[2] << 16) | ((u32)addr[3] << 24));

240 
ør_high
 = ((
u32
)
addr
[4] | ((u32)addr[5] << 8));

243 i‡(
ør_low
 || 
ør_high
)

244 
ør_high
 |
E1000_RAH_AV
;

250 
	`ew32
(
	`RAL
(
ödex
), 
ør_low
);

251 
	`e1e_Êush
();

252 
	`ew32
(
	`RAH
(
ödex
), 
ør_high
);

253 
	`e1e_Êush
();

254 
	}
}

264 
u32
 
	$e1000_hash_mc_addr
(
e1000_hw
 *
hw
, 
u8
 *
mc_addr
)

266 
u32
 
hash_vÆue
, 
hash_mask
;

267 
u8
 
bô_shi·
 = 0;

270 
hash_mask
 = (
hw
->
mac
.
mè_ªg_cou¡
 * 32) - 1;

275 
hash_mask
 >> 
bô_shi·
 != 0xFF)

276 
bô_shi·
++;

303 
hw
->
mac
.
mc_fûãr_ty≥
) {

308 
bô_shi·
 += 1;

311 
bô_shi·
 += 2;

314 
bô_shi·
 += 4;

318 
hash_vÆue
 = 
hash_mask
 & (((
mc_addr
[4] >> (8 - 
bô_shi·
)) |

319 (((
u16
)
mc_addr
[5]Ë<< 
bô_shi·
)));

321  
hash_vÆue
;

322 
	}
}

333 
	$e1000e_upd©e_mc_addr_li°_gíîic
(
e1000_hw
 *
hw
,

334 
u8
 *
mc_addr_li°
, 
u32
 
mc_addr_cou¡
)

336 
u32
 
hash_vÆue
, 
hash_bô
, 
hash_ªg
;

337 
i
;

340 
	`mem£t
(&
hw
->
mac
.
mè_shadow
, 0, (hw->mac.mta_shadow));

343 
i
 = 0; (
u32
)ò< 
mc_addr_cou¡
; i++) {

344 
hash_vÆue
 = 
	`e1000_hash_mc_addr
(
hw
, 
mc_addr_li°
);

346 
hash_ªg
 = (
hash_vÆue
 >> 5Ë& (
hw
->
mac
.
mè_ªg_cou¡
 - 1);

347 
hash_bô
 = 
hash_vÆue
 & 0x1F;

349 
hw
->
mac
.
mè_shadow
[
hash_ªg
] |(1 << 
hash_bô
);

350 
mc_addr_li°
 +(
ETH_ALEN
);

354 
i
 = 
hw
->
mac
.
mè_ªg_cou¡
 - 1; i >= 0; i--)

355 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_MTA
, 
i
, hw->
mac
.
mè_shadow
[i]);

356 
	`e1e_Êush
();

357 
	}
}

365 
	$e1000e_˛ór_hw_˙ås_ba£
(
e1000_hw
 *
hw
)

367 
	`î32
(
CRCERRS
);

368 
	`î32
(
SYMERRS
);

369 
	`î32
(
MPC
);

370 
	`î32
(
SCC
);

371 
	`î32
(
ECOL
);

372 
	`î32
(
MCC
);

373 
	`î32
(
LATECOL
);

374 
	`î32
(
COLC
);

375 
	`î32
(
DC
);

376 
	`î32
(
SEC
);

377 
	`î32
(
RLEC
);

378 
	`î32
(
XONRXC
);

379 
	`î32
(
XONTXC
);

380 
	`î32
(
XOFFRXC
);

381 
	`î32
(
XOFFTXC
);

382 
	`î32
(
FCRUC
);

383 
	`î32
(
GPRC
);

384 
	`î32
(
BPRC
);

385 
	`î32
(
MPRC
);

386 
	`î32
(
GPTC
);

387 
	`î32
(
GORCL
);

388 
	`î32
(
GORCH
);

389 
	`î32
(
GOTCL
);

390 
	`î32
(
GOTCH
);

391 
	`î32
(
RNBC
);

392 
	`î32
(
RUC
);

393 
	`î32
(
RFC
);

394 
	`î32
(
ROC
);

395 
	`î32
(
RJC
);

396 
	`î32
(
TORL
);

397 
	`î32
(
TORH
);

398 
	`î32
(
TOTL
);

399 
	`î32
(
TOTH
);

400 
	`î32
(
TPR
);

401 
	`î32
(
TPT
);

402 
	`î32
(
MPTC
);

403 
	`î32
(
BPTC
);

404 
	}
}

414 
s32
 
	$e1000e_check_f‹_c›≥r_lök
(
e1000_hw
 *
hw
)

416 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

417 
s32
 
ªt_vÆ
;

418 
boﬁ
 
lök
;

425 i‡(!
mac
->
gë_lök_°©us
)

432 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

433 i‡(
ªt_vÆ
)

434  
ªt_vÆ
;

436 i‡(!
lök
)

439 
mac
->
gë_lök_°©us
 = 
Ál£
;

444 
	`e1000e_check_downshi·
(
hw
);

449 i‡(!
mac
->
aut⁄eg
)

450  -
E1000_ERR_CONFIG
;

456 
mac
->
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(
hw
);

463 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

464 i‡(
ªt_vÆ
)

465 
	`e_dbg
("Error configuring flow control\n");

467  
ªt_vÆ
;

468 
	}
}

477 
s32
 
	$e1000e_check_f‹_fibî_lök
(
e1000_hw
 *
hw
)

479 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

480 
u32
 
rxcw
;

481 
u32
 
˘æ
;

482 
u32
 
°©us
;

483 
s32
 
ªt_vÆ
;

485 
˘æ
 = 
	`î32
(
CTRL
);

486 
°©us
 = 
	`î32
(
STATUS
);

487 
rxcw
 = 
	`î32
(
RXCW
);

497 i‡((
˘æ
 & 
E1000_CTRL_SWDPIN1
Ë&& !(
°©us
 & 
E1000_STATUS_LU
) &&

498 !(
rxcw
 & 
E1000_RXCW_C
)) {

499 i‡(!
mac
->
aut⁄eg_Áûed
) {

500 
mac
->
aut⁄eg_Áûed
 = 
åue
;

503 
	`e_dbg
("NOT Rx'ing /C/, disable AutoNegánd forceÜink.\n");

506 
	`ew32
(
TXCW
, (
mac
->
txcw
 & ~
E1000_TXCW_ANE
));

509 
˘æ
 = 
	`î32
(
CTRL
);

510 
˘æ
 |(
E1000_CTRL_SLU
 | 
E1000_CTRL_FD
);

511 
	`ew32
(
CTRL
, 
˘æ
);

514 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

515 i‡(
ªt_vÆ
) {

516 
	`e_dbg
("Error configuring flow control\n");

517  
ªt_vÆ
;

519 } i‡((
˘æ
 & 
E1000_CTRL_SLU
Ë&& (
rxcw
 & 
E1000_RXCW_C
)) {

525 
	`e_dbg
("Rx'ing /C/,Énable AutoNegánd stop forcingÜink.\n");

526 
	`ew32
(
TXCW
, 
mac
->
txcw
);

527 
	`ew32
(
CTRL
, (
˘æ
 & ~
E1000_CTRL_SLU
));

529 
mac
->
£rdes_has_lök
 = 
åue
;

533 
	}
}

542 
s32
 
	$e1000e_check_f‹_£rdes_lök
(
e1000_hw
 *
hw
)

544 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

545 
u32
 
rxcw
;

546 
u32
 
˘æ
;

547 
u32
 
°©us
;

548 
s32
 
ªt_vÆ
;

550 
˘æ
 = 
	`î32
(
CTRL
);

551 
°©us
 = 
	`î32
(
STATUS
);

552 
rxcw
 = 
	`î32
(
RXCW
);

561 i‡(!(
°©us
 & 
E1000_STATUS_LU
Ë&& !(
rxcw
 & 
E1000_RXCW_C
)) {

562 i‡(!
mac
->
aut⁄eg_Áûed
) {

563 
mac
->
aut⁄eg_Áûed
 = 
åue
;

566 
	`e_dbg
("NOT Rx'ing /C/, disable AutoNegánd forceÜink.\n");

569 
	`ew32
(
TXCW
, (
mac
->
txcw
 & ~
E1000_TXCW_ANE
));

572 
˘æ
 = 
	`î32
(
CTRL
);

573 
˘æ
 |(
E1000_CTRL_SLU
 | 
E1000_CTRL_FD
);

574 
	`ew32
(
CTRL
, 
˘æ
);

577 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

578 i‡(
ªt_vÆ
) {

579 
	`e_dbg
("Error configuring flow control\n");

580  
ªt_vÆ
;

582 } i‡((
˘æ
 & 
E1000_CTRL_SLU
Ë&& (
rxcw
 & 
E1000_RXCW_C
)) {

588 
	`e_dbg
("Rx'ing /C/,Énable AutoNegánd stop forcingÜink.\n");

589 
	`ew32
(
TXCW
, 
mac
->
txcw
);

590 
	`ew32
(
CTRL
, (
˘æ
 & ~
E1000_CTRL_SLU
));

592 
mac
->
£rdes_has_lök
 = 
åue
;

593 } i‡(!(
E1000_TXCW_ANE
 & 
	`î32
(
TXCW
))) {

599 
	`u¶ìp_ønge
(10, 20);

600 
rxcw
 = 
	`î32
(
RXCW
);

601 i‡(
rxcw
 & 
E1000_RXCW_SYNCH
) {

602 i‡(!(
rxcw
 & 
E1000_RXCW_IV
)) {

603 
mac
->
£rdes_has_lök
 = 
åue
;

604 
	`e_dbg
("SERDES: Link up - forced.\n");

607 
mac
->
£rdes_has_lök
 = 
Ál£
;

608 
	`e_dbg
("SERDES: Link down - force failed.\n");

612 i‡(
E1000_TXCW_ANE
 & 
	`î32
(
TXCW
)) {

613 
°©us
 = 
	`î32
(
STATUS
);

614 i‡(
°©us
 & 
E1000_STATUS_LU
) {

616 
	`u¶ìp_ønge
(10, 20);

617 
rxcw
 = 
	`î32
(
RXCW
);

618 i‡(
rxcw
 & 
E1000_RXCW_SYNCH
) {

619 i‡(!(
rxcw
 & 
E1000_RXCW_IV
)) {

620 
mac
->
£rdes_has_lök
 = 
åue
;

621 
	`e_dbg
("SERDES: Link up -áutoneg completed successfully.\n");

623 
mac
->
£rdes_has_lök
 = 
Ál£
;

624 
	`e_dbg
("SERDES: Link down - invalid codewords detected ináutoneg.\n");

627 
mac
->
£rdes_has_lök
 = 
Ál£
;

628 
	`e_dbg
("SERDES: Link down -Ço sync.\n");

631 
mac
->
£rdes_has_lök
 = 
Ál£
;

632 
	`e_dbg
("SERDES: Link down -áutoneg failed\n");

637 
	}
}

646 
s32
 
	$e1000_£t_deÁu…_fc_gíîic
(
e1000_hw
 *
hw
)

648 
s32
 
ªt_vÆ
;

649 
u16
 
nvm_d©a
;

659 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_INIT_CONTROL2_REG
, 1, &
nvm_d©a
);

661 i‡(
ªt_vÆ
) {

662 
	`e_dbg
("NVM Read Error\n");

663  
ªt_vÆ
;

666 i‡(!(
nvm_d©a
 & 
NVM_WORD0F_PAUSE_MASK
))

667 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_n⁄e
;

668 i‡((
nvm_d©a
 & 
NVM_WORD0F_PAUSE_MASK
Ë=
NVM_WORD0F_ASM_DIR
)

669 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_tx_∑u£
;

671 
hw
->
fc
.
ªque°ed_mode
 = 
e1000_fc_fuŒ
;

674 
	}
}

686 
s32
 
	$e1000e_£tup_lök_gíîic
(
e1000_hw
 *
hw
)

688 
s32
 
ªt_vÆ
;

693 i‡(
hw
->
phy
.
›s
.
check_ª£t_block
 && hw->phy.›s.
	`check_ª£t_block
(hw))

699 i‡(
hw
->
fc
.
ªque°ed_mode
 =
e1000_fc_deÁu…
) {

700 
ªt_vÆ
 = 
	`e1000_£t_deÁu…_fc_gíîic
(
hw
);

701 i‡(
ªt_vÆ
)

702  
ªt_vÆ
;

708 
hw
->
fc
.
cuºít_mode
 = hw->fc.
ªque°ed_mode
;

710 
	`e_dbg
("A·î fix-up†FlowC⁄åﬁ i†now = %x\n", 
hw
->
fc
.
cuºít_mode
);

713 
ªt_vÆ
 = 
hw
->
mac
.
›s
.
	`£tup_physiˇl_öãrÁ˚
(hw);

714 i‡(
ªt_vÆ
)

715  
ªt_vÆ
;

722 
	`e_dbg
("InitializingÅhe Flow Controláddress,ÅypeándÅimerÑegs\n");

723 
	`ew32
(
FCT
, 
FLOW_CONTROL_TYPE
);

724 
	`ew32
(
FCAH
, 
FLOW_CONTROL_ADDRESS_HIGH
);

725 
	`ew32
(
FCAL
, 
FLOW_CONTROL_ADDRESS_LOW
);

727 
	`ew32
(
FCTTV
, 
hw
->
fc
.
∑u£_time
);

729  
	`e1000e_£t_fc_w©îm¨ks
(
hw
);

730 
	}
}

739 
s32
 
	$e1000_commô_fc_£âögs_gíîic
(
e1000_hw
 *
hw
)

741 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

742 
u32
 
txcw
;

760 
hw
->
fc
.
cuºít_mode
) {

761 
e1000_fc_n⁄e
:

763 
txcw
 = (
E1000_TXCW_ANE
 | 
E1000_TXCW_FD
);

765 
e1000_fc_rx_∑u£
:

773 
txcw
 = (
E1000_TXCW_ANE
 | 
E1000_TXCW_FD
 | 
E1000_TXCW_PAUSE_MASK
);

775 
e1000_fc_tx_∑u£
:

779 
txcw
 = (
E1000_TXCW_ANE
 | 
E1000_TXCW_FD
 | 
E1000_TXCW_ASM_DIR
);

781 
e1000_fc_fuŒ
:

785 
txcw
 = (
E1000_TXCW_ANE
 | 
E1000_TXCW_FD
 | 
E1000_TXCW_PAUSE_MASK
);

788 
	`e_dbg
("Flow controlÖaram set incorrectly\n");

789  -
E1000_ERR_CONFIG
;

793 
	`ew32
(
TXCW
, 
txcw
);

794 
mac
->
txcw
 =Åxcw;

797 
	}
}

806 
s32
 
	$e1000_pﬁl_fibî_£rdes_lök_gíîic
(
e1000_hw
 *
hw
)

808 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

809 
u32
 
i
, 
°©us
;

810 
s32
 
ªt_vÆ
;

818 
i
 = 0; i < 
FIBER_LINK_UP_LIMIT
; i++) {

819 
	`u¶ìp_ønge
(10000, 20000);

820 
°©us
 = 
	`î32
(
STATUS
);

821 i‡(
°©us
 & 
E1000_STATUS_LU
)

824 i‡(
i
 =
FIBER_LINK_UP_LIMIT
) {

825 
	`e_dbg
("Never gotá validÜink fromáuto-neg!!!\n");

826 
mac
->
aut⁄eg_Áûed
 = 
åue
;

832 
ªt_vÆ
 = 
mac
->
›s
.
	`check_f‹_lök
(
hw
);

833 i‡(
ªt_vÆ
) {

834 
	`e_dbg
("Error while checking forÜink\n");

835  
ªt_vÆ
;

837 
mac
->
aut⁄eg_Áûed
 = 
Ál£
;

839 
mac
->
aut⁄eg_Áûed
 = 
Ál£
;

840 
	`e_dbg
("Valid Link Found\n");

844 
	}
}

853 
s32
 
	$e1000e_£tup_fibî_£rdes_lök
(
e1000_hw
 *
hw
)

855 
u32
 
˘æ
;

856 
s32
 
ªt_vÆ
;

858 
˘æ
 = 
	`î32
(
CTRL
);

861 
˘æ
 &~
E1000_CTRL_LRST
;

863 
hw
->
mac
.
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(hw);

865 
ªt_vÆ
 = 
	`e1000_commô_fc_£âögs_gíîic
(
hw
);

866 i‡(
ªt_vÆ
)

867  
ªt_vÆ
;

875 
	`e_dbg
("Auto-negotiationÉnabled\n");

877 
	`ew32
(
CTRL
, 
˘æ
);

878 
	`e1e_Êush
();

879 
	`u¶ìp_ønge
(1000, 2000);

885 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
 ||

886 (
	`î32
(
CTRL
Ë& 
E1000_CTRL_SWDPIN1
)) {

887 
ªt_vÆ
 = 
	`e1000_pﬁl_fibî_£rdes_lök_gíîic
(
hw
);

889 
	`e_dbg
("No signal detected\n");

892  
ªt_vÆ
;

893 
	}
}

902 
	$e1000e_c⁄fig_cﬁlisi⁄_di°_gíîic
(
e1000_hw
 *
hw
)

904 
u32
 
t˘l
;

906 
t˘l
 = 
	`î32
(
TCTL
);

908 
t˘l
 &~
E1000_TCTL_COLD
;

909 
t˘l
 |
E1000_COLLISION_DISTANCE
 << 
E1000_COLD_SHIFT
;

911 
	`ew32
(
TCTL
, 
t˘l
);

912 
	`e1e_Êush
();

913 
	}
}

923 
s32
 
	$e1000e_£t_fc_w©îm¨ks
(
e1000_hw
 *
hw
)

925 
u32
 
f¸é
 = 0, 
f¸th
 = 0;

933 i‡(
hw
->
fc
.
cuºít_mode
 & 
e1000_fc_tx_∑u£
) {

938 
f¸é
 = 
hw
->
fc
.
low_w©î
;

939 i‡(
hw
->
fc
.
£nd_x⁄
)

940 
f¸é
 |
E1000_FCRTL_XONE
;

942 
f¸th
 = 
hw
->
fc
.
high_w©î
;

944 
	`ew32
(
FCRTL
, 
f¸é
);

945 
	`ew32
(
FCRTH
, 
f¸th
);

948 
	}
}

960 
s32
 
	$e1000e_f‹˚_mac_fc
(
e1000_hw
 *
hw
)

962 
u32
 
˘æ
;

964 
˘æ
 = 
	`î32
(
CTRL
);

983 
	`e_dbg
("hw->fc.cuºít_modê%u\n", 
hw
->
fc
.
cuºít_mode
);

985 
hw
->
fc
.
cuºít_mode
) {

986 
e1000_fc_n⁄e
:

987 
˘æ
 &(~(
E1000_CTRL_TFCE
 | 
E1000_CTRL_RFCE
));

989 
e1000_fc_rx_∑u£
:

990 
˘æ
 &(~
E1000_CTRL_TFCE
);

991 
˘æ
 |
E1000_CTRL_RFCE
;

993 
e1000_fc_tx_∑u£
:

994 
˘æ
 &(~
E1000_CTRL_RFCE
);

995 
˘æ
 |
E1000_CTRL_TFCE
;

997 
e1000_fc_fuŒ
:

998 
˘æ
 |(
E1000_CTRL_TFCE
 | 
E1000_CTRL_RFCE
);

1001 
	`e_dbg
("Flow controlÖaram set incorrectly\n");

1002  -
E1000_ERR_CONFIG
;

1005 
	`ew32
(
CTRL
, 
˘æ
);

1008 
	}
}

1020 
s32
 
	$e1000e_c⁄fig_fc_a·î_lök_up
(
e1000_hw
 *
hw
)

1022 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1023 
s32
 
ªt_vÆ
 = 0;

1024 
u32
 
pcs_°©us_ªg
, 
pcs_adv_ªg
, 
pcs_Õ_abûôy_ªg
, 
pcs_˘æ_ªg
;

1025 
u16
 
mii_°©us_ªg
, 
mii_nway_adv_ªg
, 
mii_nway_Õ_abûôy_ªg
;

1026 
u16
 
•ìd
, 
du∂ex
;

1032 i‡(
mac
->
aut⁄eg_Áûed
) {

1033 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
 ||

1034 
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
)

1035 
ªt_vÆ
 = 
	`e1000e_f‹˚_mac_fc
(
hw
);

1037 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
)

1038 
ªt_vÆ
 = 
	`e1000e_f‹˚_mac_fc
(
hw
);

1041 i‡(
ªt_vÆ
) {

1042 
	`e_dbg
("Error forcing flow control settings\n");

1043  
ªt_vÆ
;

1051 i‡((
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
Ë&& 
mac
->
aut⁄eg
) {

1056 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
mii_°©us_ªg
);

1057 i‡(
ªt_vÆ
)

1058  
ªt_vÆ
;

1059 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
mii_°©us_ªg
);

1060 i‡(
ªt_vÆ
)

1061  
ªt_vÆ
;

1063 i‡(!(
mii_°©us_ªg
 & 
BMSR_ANEGCOMPLETE
)) {

1064 
	`e_dbg
("Copper PHYánd Auto Neg hasÇot completed.\n");

1065  
ªt_vÆ
;

1074 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_ADVERTISE
, &
mii_nway_adv_ªg
);

1075 i‡(
ªt_vÆ
)

1076  
ªt_vÆ
;

1077 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_LPA
, &
mii_nway_Õ_abûôy_ªg
);

1078 i‡(
ªt_vÆ
)

1079  
ªt_vÆ
;

1114 i‡((
mii_nway_adv_ªg
 & 
ADVERTISE_PAUSE_CAP
) &&

1115 (
mii_nway_Õ_abûôy_ªg
 & 
LPA_PAUSE_CAP
)) {

1122 i‡(
hw
->
fc
.
ªque°ed_mode
 =
e1000_fc_fuŒ
) {

1123 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_fuŒ
;

1124 
	`e_dbg
("Flow Control = FULL.\n");

1126 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_rx_∑u£
;

1127 
	`e_dbg
("Flow Control = Rx PAUSE frames only.\n");

1137 i‡(!(
mii_nway_adv_ªg
 & 
ADVERTISE_PAUSE_CAP
) &&

1138 (
mii_nway_adv_ªg
 & 
ADVERTISE_PAUSE_ASYM
) &&

1139 (
mii_nway_Õ_abûôy_ªg
 & 
LPA_PAUSE_CAP
) &&

1140 (
mii_nway_Õ_abûôy_ªg
 & 
LPA_PAUSE_ASYM
)) {

1141 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_tx_∑u£
;

1142 
	`e_dbg
("Flow Control = Tx PAUSE frames only.\n");

1151 i‡((
mii_nway_adv_ªg
 & 
ADVERTISE_PAUSE_CAP
) &&

1152 (
mii_nway_adv_ªg
 & 
ADVERTISE_PAUSE_ASYM
) &&

1153 !(
mii_nway_Õ_abûôy_ªg
 & 
LPA_PAUSE_CAP
) &&

1154 (
mii_nway_Õ_abûôy_ªg
 & 
LPA_PAUSE_ASYM
)) {

1155 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_rx_∑u£
;

1156 
	`e_dbg
("Flow Control = Rx PAUSE frames only.\n");

1161 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_n⁄e
;

1162 
	`e_dbg
("Flow Control = NONE.\n");

1169 
ªt_vÆ
 = 
mac
->
›s
.
	`gë_lök_up_öfo
(
hw
, &
•ìd
, &
du∂ex
);

1170 i‡(
ªt_vÆ
) {

1171 
	`e_dbg
("Error gettingÜink speedánd duplex\n");

1172  
ªt_vÆ
;

1175 i‡(
du∂ex
 =
HALF_DUPLEX
)

1176 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_n⁄e
;

1181 
ªt_vÆ
 = 
	`e1000e_f‹˚_mac_fc
(
hw
);

1182 i‡(
ªt_vÆ
) {

1183 
	`e_dbg
("Error forcing flow control settings\n");

1184  
ªt_vÆ
;

1193 i‡((
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_öã∫Æ_£rdes
) &&

1194 
mac
->
aut⁄eg
) {

1198 
pcs_°©us_ªg
 = 
	`î32
(
PCS_LSTAT
);

1200 i‡(!(
pcs_°©us_ªg
 & 
E1000_PCS_LSTS_AN_COMPLETE
)) {

1201 
	`e_dbg
("PCS Auto Neg hasÇot completed.\n");

1202  
ªt_vÆ
;

1211 
pcs_adv_ªg
 = 
	`î32
(
PCS_ANADV
);

1212 
pcs_Õ_abûôy_ªg
 = 
	`î32
(
PCS_LPAB
);

1247 i‡((
pcs_adv_ªg
 & 
E1000_TXCW_PAUSE
) &&

1248 (
pcs_Õ_abûôy_ªg
 & 
E1000_TXCW_PAUSE
)) {

1255 i‡(
hw
->
fc
.
ªque°ed_mode
 =
e1000_fc_fuŒ
) {

1256 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_fuŒ
;

1257 
	`e_dbg
("Flow Control = FULL.\n");

1259 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_rx_∑u£
;

1260 
	`e_dbg
("Flow Control = Rx PAUSE frames only.\n");

1270 i‡(!(
pcs_adv_ªg
 & 
E1000_TXCW_PAUSE
) &&

1271 (
pcs_adv_ªg
 & 
E1000_TXCW_ASM_DIR
) &&

1272 (
pcs_Õ_abûôy_ªg
 & 
E1000_TXCW_PAUSE
) &&

1273 (
pcs_Õ_abûôy_ªg
 & 
E1000_TXCW_ASM_DIR
)) {

1274 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_tx_∑u£
;

1275 
	`e_dbg
("Flow Control = Tx PAUSE frames only.\n");

1284 i‡((
pcs_adv_ªg
 & 
E1000_TXCW_PAUSE
) &&

1285 (
pcs_adv_ªg
 & 
E1000_TXCW_ASM_DIR
) &&

1286 !(
pcs_Õ_abûôy_ªg
 & 
E1000_TXCW_PAUSE
) &&

1287 (
pcs_Õ_abûôy_ªg
 & 
E1000_TXCW_ASM_DIR
)) {

1288 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_rx_∑u£
;

1289 
	`e_dbg
("Flow Control = Rx PAUSE frames only.\n");

1294 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_n⁄e
;

1295 
	`e_dbg
("Flow Control = NONE.\n");

1301 
pcs_˘æ_ªg
 = 
	`î32
(
PCS_LCTL
);

1302 
pcs_˘æ_ªg
 |
E1000_PCS_LCTL_FORCE_FCTRL
;

1303 
	`ew32
(
PCS_LCTL
, 
pcs_˘æ_ªg
);

1305 
ªt_vÆ
 = 
	`e1000e_f‹˚_mac_fc
(
hw
);

1306 i‡(
ªt_vÆ
) {

1307 
	`e_dbg
("Error forcing flow control settings\n");

1308  
ªt_vÆ
;

1313 
	}
}

1324 
s32
 
	$e1000e_gë_•ìd_™d_du∂ex_c›≥r
(
e1000_hw
 *
hw
, 
u16
 *
•ìd
,

1325 
u16
 *
du∂ex
)

1327 
u32
 
°©us
;

1329 
°©us
 = 
	`î32
(
STATUS
);

1330 i‡(
°©us
 & 
E1000_STATUS_SPEED_1000
)

1331 *
•ìd
 = 
SPEED_1000
;

1332 i‡(
°©us
 & 
E1000_STATUS_SPEED_100
)

1333 *
•ìd
 = 
SPEED_100
;

1335 *
•ìd
 = 
SPEED_10
;

1337 i‡(
°©us
 & 
E1000_STATUS_FD
)

1338 *
du∂ex
 = 
FULL_DUPLEX
;

1340 *
du∂ex
 = 
HALF_DUPLEX
;

1342 
	`e_dbg
("%u Mbps, %s Duplex\n",

1343 *
•ìd
 =
SPEED_1000
 ? 1000 : *•ìd =
SPEED_100
 ? 100 : 10,

1344 *
du∂ex
 =
FULL_DUPLEX
 ? "Full" : "Half");

1347 
	}
}

1358 
s32
 
	$e1000e_gë_•ìd_™d_du∂ex_fibî_£rdes
(
e1000_hw
 
__Æways_unu£d


1359 *
hw
, 
u16
 *
•ìd
, u16 *
du∂ex
)

1361 *
•ìd
 = 
SPEED_1000
;

1362 *
du∂ex
 = 
FULL_DUPLEX
;

1365 
	}
}

1373 
s32
 
	$e1000e_gë_hw_£m≠h‹e
(
e1000_hw
 *
hw
)

1375 
u32
 
swsm
;

1376 
s32
 
timeout
 = 
hw
->
nvm
.
w‹d_size
 + 1;

1377 
s32
 
i
 = 0;

1380 
i
 < 
timeout
) {

1381 
swsm
 = 
	`î32
(
SWSM
);

1382 i‡(!(
swsm
 & 
E1000_SWSM_SMBI
))

1385 
	`u¶ìp_ønge
(50, 100);

1386 
i
++;

1389 i‡(
i
 =
timeout
) {

1390 
	`e_dbg
("Driver can'táccess device - SMBI bit is set.\n");

1391  -
E1000_ERR_NVM
;

1395 
i
 = 0; i < 
timeout
; i++) {

1396 
swsm
 = 
	`î32
(
SWSM
);

1397 
	`ew32
(
SWSM
, 
swsm
 | 
E1000_SWSM_SWESMBI
);

1400 i‡(
	`î32
(
SWSM
Ë& 
E1000_SWSM_SWESMBI
)

1403 
	`u¶ìp_ønge
(50, 100);

1406 i‡(
i
 =
timeout
) {

1408 
	`e1000e_put_hw_£m≠h‹e
(
hw
);

1409 
	`e_dbg
("Driver can'táccessÅhe NVM\n");

1410  -
E1000_ERR_NVM
;

1414 
	}
}

1422 
	$e1000e_put_hw_£m≠h‹e
(
e1000_hw
 *
hw
)

1424 
u32
 
swsm
;

1426 
swsm
 = 
	`î32
(
SWSM
);

1427 
swsm
 &~(
E1000_SWSM_SMBI
 | 
E1000_SWSM_SWESMBI
);

1428 
	`ew32
(
SWSM
, 
swsm
);

1429 
	}
}

1437 
s32
 
	$e1000e_gë_auto_rd_d⁄e
(
e1000_hw
 *
hw
)

1439 
s32
 
i
 = 0;

1441 
i
 < 
AUTO_READ_DONE_TIMEOUT
) {

1442 i‡(
	`î32
(
EECD
Ë& 
E1000_EECD_AUTO_RD
)

1444 
	`u¶ìp_ønge
(1000, 2000);

1445 
i
++;

1448 i‡(
i
 =
AUTO_READ_DONE_TIMEOUT
) {

1449 
	`e_dbg
("AutoÑead by HW from NVM hasÇot completed.\n");

1450  -
E1000_ERR_RESET
;

1454 
	}
}

1464 
s32
 
	$e1000e_vÆid_Àd_deÁu…
(
e1000_hw
 *
hw
, 
u16
 *
d©a
)

1466 
s32
 
ªt_vÆ
;

1468 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_ID_LED_SETTINGS
, 1, 
d©a
);

1469 i‡(
ªt_vÆ
) {

1470 
	`e_dbg
("NVM Read Error\n");

1471  
ªt_vÆ
;

1474 i‡(*
d©a
 =
ID_LED_RESERVED_0000
 || *d©®=
ID_LED_RESERVED_FFFF
)

1475 *
d©a
 = 
ID_LED_DEFAULT
;

1478 
	}
}

1485 
s32
 
	$e1000e_id_Àd_öô_gíîic
(
e1000_hw
 *
hw
)

1487 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1488 
s32
 
ªt_vÆ
;

1489 c⁄° 
u32
 
Àd˘l_mask
 = 0x000000FF;

1490 c⁄° 
u32
 
Àd˘l_⁄
 = 
E1000_LEDCTL_MODE_LED_ON
;

1491 c⁄° 
u32
 
Àd˘l_off
 = 
E1000_LEDCTL_MODE_LED_OFF
;

1492 
u16
 
d©a
, 
i
, 
ãmp
;

1493 c⁄° 
u16
 
Àd_mask
 = 0x0F;

1495 
ªt_vÆ
 = 
hw
->
nvm
.
›s
.
	`vÆid_Àd_deÁu…
(hw, &
d©a
);

1496 i‡(
ªt_vÆ
)

1497  
ªt_vÆ
;

1499 
mac
->
Àd˘l_deÁu…
 = 
	`î32
(
LEDCTL
);

1500 
mac
->
Àd˘l_mode1
 = mac->
Àd˘l_deÁu…
;

1501 
mac
->
Àd˘l_mode2
 = mac->
Àd˘l_deÁu…
;

1503 
i
 = 0; i < 4; i++) {

1504 
ãmp
 = (
d©a
 >> (
i
 << 2)Ë& 
Àd_mask
;

1505 
ãmp
) {

1506 
ID_LED_ON1_DEF2
:

1507 
ID_LED_ON1_ON2
:

1508 
ID_LED_ON1_OFF2
:

1509 
mac
->
Àd˘l_mode1
 &~(
Àd˘l_mask
 << (
i
 << 3));

1510 
mac
->
Àd˘l_mode1
 |
Àd˘l_⁄
 << (
i
 << 3);

1512 
ID_LED_OFF1_DEF2
:

1513 
ID_LED_OFF1_ON2
:

1514 
ID_LED_OFF1_OFF2
:

1515 
mac
->
Àd˘l_mode1
 &~(
Àd˘l_mask
 << (
i
 << 3));

1516 
mac
->
Àd˘l_mode1
 |
Àd˘l_off
 << (
i
 << 3);

1522 
ãmp
) {

1523 
ID_LED_DEF1_ON2
:

1524 
ID_LED_ON1_ON2
:

1525 
ID_LED_OFF1_ON2
:

1526 
mac
->
Àd˘l_mode2
 &~(
Àd˘l_mask
 << (
i
 << 3));

1527 
mac
->
Àd˘l_mode2
 |
Àd˘l_⁄
 << (
i
 << 3);

1529 
ID_LED_DEF1_OFF2
:

1530 
ID_LED_ON1_OFF2
:

1531 
ID_LED_OFF1_OFF2
:

1532 
mac
->
Àd˘l_mode2
 &~(
Àd˘l_mask
 << (
i
 << 3));

1533 
mac
->
Àd˘l_mode2
 |
Àd˘l_off
 << (
i
 << 3);

1542 
	}
}

1551 
s32
 
	$e1000e_£tup_Àd_gíîic
(
e1000_hw
 *
hw
)

1553 
u32
 
Àd˘l
;

1555 i‡(
hw
->
mac
.
›s
.
£tup_Àd
 !
e1000e_£tup_Àd_gíîic
)

1556  -
E1000_ERR_CONFIG
;

1558 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
) {

1559 
Àd˘l
 = 
	`î32
(
LEDCTL
);

1560 
hw
->
mac
.
Àd˘l_deÁu…
 = 
Àd˘l
;

1562 
Àd˘l
 &~(
E1000_LEDCTL_LED0_IVRT
 | 
E1000_LEDCTL_LED0_BLINK
 |

1563 
E1000_LEDCTL_LED0_MODE_MASK
);

1564 
Àd˘l
 |(
E1000_LEDCTL_MODE_LED_OFF
 <<

1565 
E1000_LEDCTL_LED0_MODE_SHIFT
);

1566 
	`ew32
(
LEDCTL
, 
Àd˘l
);

1567 } i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

1568 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_mode1
);

1572 
	}
}

1581 
s32
 
	$e1000e_˛ónup_Àd_gíîic
(
e1000_hw
 *
hw
)

1583 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_deÁu…
);

1585 
	}
}

1593 
s32
 
	$e1000e_blök_Àd_gíîic
(
e1000_hw
 *
hw
)

1595 
u32
 
Àd˘l_blök
 = 0;

1596 
u32
 
i
;

1598 i‡(
hw
->
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
) {

1600 
Àd˘l_blök
 = 
E1000_LEDCTL_LED0_BLINK
 |

1601 (
E1000_LEDCTL_MODE_LED_ON
 << 
E1000_LEDCTL_LED0_MODE_SHIFT
);

1609 
Àd˘l_blök
 = 
hw
->
mac
.
Àd˘l_mode2
;

1610 
i
 = 0; i < 32; i += 8) {

1611 
u32
 
mode
 = (
hw
->
mac
.
Àd˘l_mode2
 >> 
i
) &

1612 
E1000_LEDCTL_LED0_MODE_MASK
;

1613 
u32
 
Àd_deÁu…
 = 
hw
->
mac
.
Àd˘l_deÁu…
 >> 
i
;

1615 i‡((!(
Àd_deÁu…
 & 
E1000_LEDCTL_LED0_IVRT
) &&

1616 (
mode
 =
E1000_LEDCTL_MODE_LED_ON
)) ||

1617 ((
Àd_deÁu…
 & 
E1000_LEDCTL_LED0_IVRT
) &&

1618 (
mode
 =
E1000_LEDCTL_MODE_LED_OFF
))) {

1619 
Àd˘l_blök
 &=

1620 ~(
E1000_LEDCTL_LED0_MODE_MASK
 << 
i
);

1621 
Àd˘l_blök
 |(
E1000_LEDCTL_LED0_BLINK
 |

1622 
E1000_LEDCTL_MODE_LED_ON
Ë<< 
i
;

1627 
	`ew32
(
LEDCTL
, 
Àd˘l_blök
);

1630 
	}
}

1638 
s32
 
	$e1000e_Àd_⁄_gíîic
(
e1000_hw
 *
hw
)

1640 
u32
 
˘æ
;

1642 
hw
->
phy
.
medü_ty≥
) {

1643 
e1000_medü_ty≥_fibî
:

1644 
˘æ
 = 
	`î32
(
CTRL
);

1645 
˘æ
 &~
E1000_CTRL_SWDPIN0
;

1646 
˘æ
 |
E1000_CTRL_SWDPIO0
;

1647 
	`ew32
(
CTRL
, 
˘æ
);

1649 
e1000_medü_ty≥_c›≥r
:

1650 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_mode2
);

1657 
	}
}

1665 
s32
 
	$e1000e_Àd_off_gíîic
(
e1000_hw
 *
hw
)

1667 
u32
 
˘æ
;

1669 
hw
->
phy
.
medü_ty≥
) {

1670 
e1000_medü_ty≥_fibî
:

1671 
˘æ
 = 
	`î32
(
CTRL
);

1672 
˘æ
 |
E1000_CTRL_SWDPIN0
;

1673 
˘æ
 |
E1000_CTRL_SWDPIO0
;

1674 
	`ew32
(
CTRL
, 
˘æ
);

1676 
e1000_medü_ty≥_c›≥r
:

1677 
	`ew32
(
LEDCTL
, 
hw
->
mac
.
Àd˘l_mode1
);

1684 
	}
}

1693 
	$e1000e_£t_pcõ_no_¢o›
(
e1000_hw
 *
hw
, 
u32
 
no_¢o›
)

1695 
u32
 
g¸
;

1697 i‡(
no_¢o›
) {

1698 
g¸
 = 
	`î32
(
GCR
);

1699 
g¸
 &~(
PCIE_NO_SNOOP_ALL
);

1700 
g¸
 |
no_¢o›
;

1701 
	`ew32
(
GCR
, 
g¸
);

1703 
	}
}

1716 
s32
 
	$e1000e_dißbÀ_pcõ_ma°î
(
e1000_hw
 *
hw
)

1718 
u32
 
˘æ
;

1719 
s32
 
timeout
 = 
MASTER_DISABLE_TIMEOUT
;

1721 
˘æ
 = 
	`î32
(
CTRL
);

1722 
˘æ
 |
E1000_CTRL_GIO_MASTER_DISABLE
;

1723 
	`ew32
(
CTRL
, 
˘æ
);

1725 
timeout
) {

1726 i‡(!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_GIO_MASTER_ENABLE
))

1728 
	`u¶ìp_ønge
(100, 200);

1729 
timeout
--;

1732 i‡(!
timeout
) {

1733 
	`e_dbg
("MasterÑequestsáreÖending.\n");

1734  -
E1000_ERR_MASTER_REQUESTS_PENDING
;

1738 
	}
}

1746 
	$e1000e_ª£t_ad≠tive
(
e1000_hw
 *
hw
)

1748 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1750 i‡(!
mac
->
ad≠tive_ifs
) {

1751 
	`e_dbg
("Not in Adaptive IFS mode!\n");

1755 
mac
->
cuºít_ifs_vÆ
 = 0;

1756 
mac
->
ifs_mö_vÆ
 = 
IFS_MIN
;

1757 
mac
->
ifs_max_vÆ
 = 
IFS_MAX
;

1758 
mac
->
ifs_°ï_size
 = 
IFS_STEP
;

1759 
mac
->
ifs_øtio
 = 
IFS_RATIO
;

1761 
mac
->
ö_ifs_mode
 = 
Ál£
;

1762 
	`ew32
(
AIT
, 0);

1763 
	}
}

1772 
	$e1000e_upd©e_ad≠tive
(
e1000_hw
 *
hw
)

1774 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1776 i‡(!
mac
->
ad≠tive_ifs
) {

1777 
	`e_dbg
("Not in Adaptive IFS mode!\n");

1781 i‡((
mac
->
cﬁlisi⁄_dñè
 * mac->
ifs_øtio
Ë> mac->
tx_∑ckë_dñè
) {

1782 i‡(
mac
->
tx_∑ckë_dñè
 > 
MIN_NUM_XMITS
) {

1783 
mac
->
ö_ifs_mode
 = 
åue
;

1784 i‡(
mac
->
cuºít_ifs_vÆ
 < mac->
ifs_max_vÆ
) {

1785 i‡(!
mac
->
cuºít_ifs_vÆ
)

1786 
mac
->
cuºít_ifs_vÆ
 = mac->
ifs_mö_vÆ
;

1788 
mac
->
cuºít_ifs_vÆ
 +=

1789 
mac
->
ifs_°ï_size
;

1790 
	`ew32
(
AIT
, 
mac
->
cuºít_ifs_vÆ
);

1794 i‡(
mac
->
ö_ifs_mode
 &&

1795 (
mac
->
tx_∑ckë_dñè
 <
MIN_NUM_XMITS
)) {

1796 
mac
->
cuºít_ifs_vÆ
 = 0;

1797 
mac
->
ö_ifs_mode
 = 
Ál£
;

1798 
	`ew32
(
AIT
, 0);

1801 
	}
}

1810 
s32
 
	$e1000e_vÆid©e_mdi_£âög_gíîic
(
e1000_hw
 *
hw
)

1812 i‡(!
hw
->
mac
.
aut⁄eg
 && (hw->
phy
.
mdix
 == 0 || hw->phy.mdix == 3)) {

1813 
	`e_dbg
("Invalid MDI setting detected\n");

1814 
hw
->
phy
.
mdix
 = 1;

1815  -
E1000_ERR_CONFIG
;

1819 
	}
}

1828 
s32
 
	$e1000e_vÆid©e_mdi_£âög_¸ossovî_gíîic
(
e1000_hw


1829 
__Æways_unu£d
 *
hw
)

1832 
	}
}

	@mac.h

29 #i‚de‡
_E1000E_MAC_H_


30 
	#_E1000E_MAC_H_


	)

32 
s32
 
e1000e_blök_Àd_gíîic
(
e1000_hw
 *
hw
);

33 
s32
 
e1000e_check_f‹_c›≥r_lök
(
e1000_hw
 *
hw
);

34 
s32
 
e1000e_check_f‹_fibî_lök
(
e1000_hw
 *
hw
);

35 
s32
 
e1000e_check_f‹_£rdes_lök
(
e1000_hw
 *
hw
);

36 
s32
 
e1000e_˛ónup_Àd_gíîic
(
e1000_hw
 *
hw
);

37 
s32
 
e1000e_c⁄fig_fc_a·î_lök_up
(
e1000_hw
 *
hw
);

38 
s32
 
e1000e_dißbÀ_pcõ_ma°î
(
e1000_hw
 *
hw
);

39 
s32
 
e1000e_f‹˚_mac_fc
(
e1000_hw
 *
hw
);

40 
s32
 
e1000e_gë_auto_rd_d⁄e
(
e1000_hw
 *
hw
);

41 
s32
 
e1000e_gë_bus_öfo_pcõ
(
e1000_hw
 *
hw
);

42 
e1000_£t_œn_id_sögÀ_p‹t
(
e1000_hw
 *
hw
);

43 
s32
 
e1000e_gë_hw_£m≠h‹e
(
e1000_hw
 *
hw
);

44 
s32
 
e1000e_gë_•ìd_™d_du∂ex_c›≥r
(
e1000_hw
 *
hw
, 
u16
 *
•ìd
,

45 
u16
 *
du∂ex
);

46 
s32
 
e1000e_gë_•ìd_™d_du∂ex_fibî_£rdes
(
e1000_hw
 *
hw
,

47 
u16
 *
•ìd
, u16 *
du∂ex
);

48 
s32
 
e1000e_id_Àd_öô_gíîic
(
e1000_hw
 *
hw
);

49 
s32
 
e1000e_Àd_⁄_gíîic
(
e1000_hw
 *
hw
);

50 
s32
 
e1000e_Àd_off_gíîic
(
e1000_hw
 *
hw
);

51 
e1000e_upd©e_mc_addr_li°_gíîic
(
e1000_hw
 *
hw
,

52 
u8
 *
mc_addr_li°
, 
u32
 
mc_addr_cou¡
);

53 
s32
 
e1000e_£t_fc_w©îm¨ks
(
e1000_hw
 *
hw
);

54 
s32
 
e1000e_£tup_fibî_£rdes_lök
(
e1000_hw
 *
hw
);

55 
s32
 
e1000e_£tup_Àd_gíîic
(
e1000_hw
 *
hw
);

56 
s32
 
e1000e_£tup_lök_gíîic
(
e1000_hw
 *
hw
);

57 
s32
 
e1000e_vÆid©e_mdi_£âög_gíîic
(
e1000_hw
 *
hw
);

58 
s32
 
e1000e_vÆid©e_mdi_£âög_¸ossovî_gíîic
(
e1000_hw
 *
hw
);

60 
e1000e_˛ór_hw_˙ås_ba£
(
e1000_hw
 *
hw
);

61 
e1000_˛ór_v·a_gíîic
(
e1000_hw
 *
hw
);

62 
e1000e_öô_rx_addrs
(
e1000_hw
 *
hw
, 
u16
 
ør_cou¡
);

63 
e1000e_put_hw_£m≠h‹e
(
e1000_hw
 *
hw
);

64 
s32
 
e1000_check_Æt_mac_addr_gíîic
(
e1000_hw
 *
hw
);

65 
e1000e_ª£t_ad≠tive
(
e1000_hw
 *
hw
);

66 
e1000e_£t_pcõ_no_¢o›
(
e1000_hw
 *
hw
, 
u32
 
no_¢o›
);

67 
e1000e_upd©e_ad≠tive
(
e1000_hw
 *
hw
);

68 
e1000_wrôe_v·a_gíîic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, u32 
vÆue
);

70 
e1000_£t_œn_id_mu…i_p‹t_pcõ
(
e1000_hw
 *
hw
);

71 
e1000e_ør_£t_gíîic
(
e1000_hw
 *
hw
, 
u8
 *
addr
, 
u32
 
ödex
);

72 
e1000e_c⁄fig_cﬁlisi⁄_di°_gíîic
(
e1000_hw
 *
hw
);

	@manage.c

29 
	~"e1000.h
"

39 
u8
 
	$e1000_ˇlcuœã_checksum
(
u8
 *
buf„r
, 
u32
 
Àngth
)

41 
u32
 
i
;

42 
u8
 
sum
 = 0;

44 i‡(!
buf„r
)

46 
i
 = 0; i < 
Àngth
; i++)

47 
sum
 +
buf„r
[
i
];

49  (
u8
)(0 - 
sum
);

50 
	}
}

62 
s32
 
	$e1000_mng_íabÀ_ho°_if
(
e1000_hw
 *
hw
)

64 
u32
 
hi¸
;

65 
u8
 
i
;

67 i‡(!
hw
->
mac
.
¨c_subsy°em_vÆid
) {

68 
	`e_dbg
("ARC subsystemÇot valid.\n");

69  -
E1000_ERR_HOST_INTERFACE_COMMAND
;

73 
hi¸
 = 
	`î32
(
HICR
);

74 i‡(!(
hi¸
 & 
E1000_HICR_EN
)) {

75 
	`e_dbg
("E1000_HOST_EN bit disabled.\n");

76  -
E1000_ERR_HOST_INTERFACE_COMMAND
;

79 
i
 = 0; i < 
E1000_MNG_DHCP_COMMAND_TIMEOUT
; i++) {

80 
hi¸
 = 
	`î32
(
HICR
);

81 i‡(!(
hi¸
 & 
E1000_HICR_C
))

83 
	`mdñay
(1);

86 i‡(
i
 =
E1000_MNG_DHCP_COMMAND_TIMEOUT
) {

87 
	`e_dbg
("Previous commandÅimeout failed .\n");

88  -
E1000_ERR_HOST_INTERFACE_COMMAND
;

92 
	}
}

101 
boﬁ
 
	$e1000e_check_mng_mode_gíîic
(
e1000_hw
 *
hw
)

103 
u32
 
fwsm
 = 
	`î32
(
FWSM
);

105  (
fwsm
 & 
E1000_FWSM_MODE_MASK
) ==

106 (
E1000_MNG_IAMT_MODE
 << 
E1000_FWSM_MODE_SHIFT
);

107 
	}
}

116 
boﬁ
 
	$e1000e_íabÀ_tx_pkt_fûãrög
(
e1000_hw
 *
hw
)

118 
e1000_ho°_mng_dh˝_cookõ
 *
hdr
 = &
hw
->
mng_cookõ
;

119 
u32
 *
buf„r
 = (u32 *)&
hw
->
mng_cookõ
;

120 
u32
 
off£t
;

121 
s32
 
ªt_vÆ
, 
hdr_csum
, 
csum
;

122 
u8
 
i
, 
Àn
;

124 
hw
->
mac
.
tx_pkt_fûãrög
 = 
åue
;

127 i‡(!
hw
->
mac
.
›s
.
	`check_mng_mode
(hw)) {

128 
hw
->
mac
.
tx_pkt_fûãrög
 = 
Ál£
;

129  
hw
->
mac
.
tx_pkt_fûãrög
;

135 
ªt_vÆ
 = 
	`e1000_mng_íabÀ_ho°_if
(
hw
);

136 i‡(
ªt_vÆ
) {

137 
hw
->
mac
.
tx_pkt_fûãrög
 = 
Ál£
;

138  
hw
->
mac
.
tx_pkt_fûãrög
;

142 
Àn
 = 
E1000_MNG_DHCP_COOKIE_LENGTH
 >> 2;

143 
off£t
 = 
E1000_MNG_DHCP_COOKIE_OFFSET
 >> 2;

144 
i
 = 0; i < 
Àn
; i++)

145 *(
buf„r
 + 
i
Ë
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_HOST_IF
,

146 
off£t
 + 
i
);

147 
hdr_csum
 = 
hdr
->
checksum
;

148 
hdr
->
checksum
 = 0;

149 
csum
 = 
	`e1000_ˇlcuœã_checksum
((
u8
 *)
hdr
,

150 
E1000_MNG_DHCP_COOKIE_LENGTH
);

155 i‡((
hdr_csum
 !
csum
Ë|| (
hdr
->
sig«tuª
 !
E1000_IAMT_SIGNATURE
)) {

156 
hw
->
mac
.
tx_pkt_fûãrög
 = 
åue
;

157  
hw
->
mac
.
tx_pkt_fûãrög
;

161 i‡(!(
hdr
->
°©us
 & 
E1000_MNG_DHCP_COOKIE_STATUS_PARSING
))

162 
hw
->
mac
.
tx_pkt_fûãrög
 = 
Ál£
;

164  
hw
->
mac
.
tx_pkt_fûãrög
;

165 
	}
}

174 
s32
 
	$e1000_mng_wrôe_cmd_hódî
(
e1000_hw
 *
hw
,

175 
e1000_ho°_mng_comm™d_hódî
 *
hdr
)

177 
u16
 
i
, 
Àngth
 = (
e1000_ho°_mng_comm™d_hódî
);

181 
hdr
->
checksum
 = 
	`e1000_ˇlcuœã_checksum
((
u8
 *)hdr, 
Àngth
);

183 
Àngth
 >>= 2;

185 
i
 = 0; i < 
Àngth
; i++) {

186 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_HOST_IF
, 
i
, *((
u32
 *)
hdr
 + i));

187 
	`e1e_Êush
();

191 
	}
}

205 
s32
 
	$e1000_mng_ho°_if_wrôe
(
e1000_hw
 *
hw
, 
u8
 *
buf„r
,

206 
u16
 
Àngth
, u16 
off£t
, 
u8
 *
sum
)

208 
u8
 *
tmp
;

209 
u8
 *
buÂå
 = 
buf„r
;

210 
u32
 
d©a
 = 0;

211 
u16
 
ªmaöög
, 
i
, 
j
, 
¥ev_byãs
;

215 i‡(
Àngth
 =0 || 
off£t
 +Üígth > 
E1000_HI_MAX_MNG_DATA_LENGTH
)

216  -
E1000_ERR_PARAM
;

218 
tmp
 = (
u8
 *)&
d©a
;

219 
¥ev_byãs
 = 
off£t
 & 0x3;

220 
off£t
 >>= 2;

222 i‡(
¥ev_byãs
) {

223 
d©a
 = 
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_HOST_IF
, 
off£t
);

224 
j
 = 
¥ev_byãs
; j < (
u32
); j++) {

225 *(
tmp
 + 
j
Ë*
buÂå
++;

226 *
sum
 +*(
tmp
 + 
j
);

228 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_HOST_IF
, 
off£t
, 
d©a
);

229 
Àngth
 -
j
 - 
¥ev_byãs
;

230 
off£t
++;

233 
ªmaöög
 = 
Àngth
 & 0x3;

234 
Àngth
 -
ªmaöög
;

237 
Àngth
 >>= 2;

242 
i
 = 0; i < 
Àngth
; i++) {

243 
j
 = 0; j < (
u32
); j++) {

244 *(
tmp
 + 
j
Ë*
buÂå
++;

245 *
sum
 +*(
tmp
 + 
j
);

248 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_HOST_IF
, 
off£t
 + 
i
, 
d©a
);

250 i‡(
ªmaöög
) {

251 
j
 = 0; j < (
u32
); j++) {

252 i‡(
j
 < 
ªmaöög
)

253 *(
tmp
 + 
j
Ë*
buÂå
++;

255 *(
tmp
 + 
j
) = 0;

257 *
sum
 +*(
tmp
 + 
j
);

259 
	`E1000_WRITE_REG_ARRAY
(
hw
, 
E1000_HOST_IF
, 
off£t
 + 
i
, 
d©a
);

263 
	}
}

273 
s32
 
	$e1000e_mng_wrôe_dh˝_öfo
(
e1000_hw
 *
hw
, 
u8
 *
buf„r
, 
u16
 
Àngth
)

275 
e1000_ho°_mng_comm™d_hódî
 
hdr
;

276 
s32
 
ªt_vÆ
;

277 
u32
 
hi¸
;

279 
hdr
.
comm™d_id
 = 
E1000_MNG_DHCP_TX_PAYLOAD_CMD
;

280 
hdr
.
comm™d_Àngth
 = 
Àngth
;

281 
hdr
.
ª£rved1
 = 0;

282 
hdr
.
ª£rved2
 = 0;

283 
hdr
.
checksum
 = 0;

286 
ªt_vÆ
 = 
	`e1000_mng_íabÀ_ho°_if
(
hw
);

287 i‡(
ªt_vÆ
)

288  
ªt_vÆ
;

291 
ªt_vÆ
 = 
	`e1000_mng_ho°_if_wrôe
(
hw
, 
buf„r
, 
Àngth
,

292 (
hdr
), &(hdr.
checksum
));

293 i‡(
ªt_vÆ
)

294  
ªt_vÆ
;

297 
ªt_vÆ
 = 
	`e1000_mng_wrôe_cmd_hódî
(
hw
, &
hdr
);

298 i‡(
ªt_vÆ
)

299  
ªt_vÆ
;

302 
hi¸
 = 
	`î32
(
HICR
);

303 
	`ew32
(
HICR
, 
hi¸
 | 
E1000_HICR_C
);

306 
	}
}

315 
boﬁ
 
	$e1000e_íabÀ_mng_∑ss_thru
(
e1000_hw
 *
hw
)

317 
u32
 
m™c
;

318 
u32
 
fwsm
, 
Á˘ps
;

320 
m™c
 = 
	`î32
(
MANC
);

322 i‡(!(
m™c
 & 
E1000_MANC_RCV_TCO_EN
))

323  
Ál£
;

325 i‡(
hw
->
mac
.
has_fwsm
) {

326 
fwsm
 = 
	`î32
(
FWSM
);

327 
Á˘ps
 = 
	`î32
(
FACTPS
);

329 i‡(!(
Á˘ps
 & 
E1000_FACTPS_MNGCG
) &&

330 ((
fwsm
 & 
E1000_FWSM_MODE_MASK
) ==

331 (
e1000_mng_mode_±
 << 
E1000_FWSM_MODE_SHIFT
)))

332  
åue
;

333 } i‡((
hw
->
mac
.
ty≥
 =
e1000_82574
) ||

334 (
hw
->
mac
.
ty≥
 =
e1000_82583
)) {

335 
u16
 
d©a
;

337 
Á˘ps
 = 
	`î32
(
FACTPS
);

338 
	`e1000_ªad_nvm
(
hw
, 
NVM_INIT_CONTROL2_REG
, 1, &
d©a
);

340 i‡(!(
Á˘ps
 & 
E1000_FACTPS_MNGCG
) &&

341 ((
d©a
 & 
E1000_NVM_INIT_CTRL2_MNGM
) ==

342 (
e1000_mng_mode_±
 << 13)))

343  
åue
;

344 } i‡((
m™c
 & 
E1000_MANC_SMBUS_EN
) &&

345 !(
m™c
 & 
E1000_MANC_ASF_EN
)) {

346  
åue
;

349  
Ál£
;

350 
	}
}

	@manage.h

29 #i‚de‡
_E1000E_MANAGE_H_


30 
	#_E1000E_MANAGE_H_


	)

32 
boﬁ
 
e1000e_check_mng_mode_gíîic
(
e1000_hw
 *
hw
);

33 
boﬁ
 
e1000e_íabÀ_tx_pkt_fûãrög
(
e1000_hw
 *
hw
);

34 
s32
 
e1000e_mng_wrôe_dh˝_öfo
(
e1000_hw
 *
hw
, 
u8
 *
buf„r
, 
u16
 
Àngth
);

35 
boﬁ
 
e1000e_íabÀ_mng_∑ss_thru
(
e1000_hw
 *
hw
);

37 
	ee1000_mng_mode
 {

38 
	me1000_mng_mode_n⁄e
 = 0,

39 
	me1000_mng_mode_asf
,

40 
	me1000_mng_mode_±
,

41 
	me1000_mng_mode_ùmi
,

42 
	me1000_mng_mode_ho°_if_⁄ly


45 
	#E1000_FACTPS_MNGCG
 0x20000000

	)

47 
	#E1000_FWSM_MODE_MASK
 0xE

	)

48 
	#E1000_FWSM_MODE_SHIFT
 1

	)

50 
	#E1000_MNG_IAMT_MODE
 0x3

	)

51 
	#E1000_MNG_DHCP_COOKIE_LENGTH
 0x10

	)

52 
	#E1000_MNG_DHCP_COOKIE_OFFSET
 0x6F0

	)

53 
	#E1000_MNG_DHCP_COMMAND_TIMEOUT
 10

	)

54 
	#E1000_MNG_DHCP_TX_PAYLOAD_CMD
 64

	)

55 
	#E1000_MNG_DHCP_COOKIE_STATUS_PARSING
 0x1

	)

56 
	#E1000_MNG_DHCP_COOKIE_STATUS_VLAN
 0x2

	)

58 
	#E1000_VFTA_ENTRY_SHIFT
 5

	)

59 
	#E1000_VFTA_ENTRY_MASK
 0x7F

	)

60 
	#E1000_VFTA_ENTRY_BIT_SHIFT_MASK
 0x1F

	)

62 
	#E1000_HICR_EN
 0x01

	)

64 
	#E1000_HICR_C
 0x02

	)

65 
	#E1000_HICR_SV
 0x04

	)

66 
	#E1000_HICR_FW_RESET_ENABLE
 0x40

	)

67 
	#E1000_HICR_FW_RESET
 0x80

	)

70 
	#E1000_IAMT_SIGNATURE
 0x544D4149

	)

	@netdev.c

29 
	#¥_fmt
(
fmt
Ë
KBUILD_MODNAME
 ": " 
	)
fmt

31 
	~<löux/moduÀ.h
>

32 
	~<löux/ty≥s.h
>

33 
	~<löux/öô.h
>

34 
	~<löux/pci.h
>

35 
	~<löux/vmÆloc.h
>

36 
	~<löux/∑gem≠.h
>

37 
	~<löux/dñay.h
>

38 
	~<löux/√tdevi˚.h
>

39 
	~<löux/öãºu±.h
>

40 
	~<löux/t˝.h
>

41 
	~<löux/ùv6.h
>

42 
	~<löux/¶ab.h
>

43 #ifde‡
NETIF_F_TSO


44 
	~<√t/checksum.h
>

45 #ifde‡
NETIF_F_TSO6


46 
	~<√t/ù6_checksum.h
>

49 
	~<löux/ëhtoﬁ.h
>

50 #i‡
deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

51 
	~<löux/if_vœn.h
>

53 
	~<löux/¥e„tch.h
>

55 
	~"e1000.h
"

57 #ifde‡
CONFIG_E1000E_NAPI


58 
	#DRV_EXTRAVERSION
 "" "-NAPI"

	)

60 
	#DRV_EXTRAVERSION
 ""

	)

63 
	#DRV_VERSION
 "2.5.4" 
DRV_EXTRAVERSION


	)

64 
	ge1000e_drivî_«me
[] = "e1000e";

65 c⁄° 
	ge1000e_drivî_vîsi⁄
[] = 
DRV_VERSION
;

67 
	#DEFAULT_MSG_ENABLE
 (
NETIF_MSG_DRV
|
NETIF_MSG_PROBE
|
NETIF_MSG_LINK
)

	)

68 
	gdebug
 = -1;

69 
moduÀ_∑øm
(
debug
, , 0);

70 
MODULE_PARM_DESC
(
debug
, "DebugÜevel (0=none,...,16=all)");

72 
e1000e_dißbÀ_a•m
(
pci_dev
 *
pdev
, 
u16
 
°©e
);

74 c⁄° 
e1000_öfo
 *
	ge1000_öfo_tbl
[] = {

75 [
bﬂrd_82571
] = &
e1000_82571_öfo
,

76 [
bﬂrd_82572
] = &
e1000_82572_öfo
,

77 [
bﬂrd_82573
] = &
e1000_82573_öfo
,

78 [
bﬂrd_82574
] = &
e1000_82574_öfo
,

79 [
bﬂrd_82583
] = &
e1000_82583_öfo
,

80 [
bﬂrd_80003es2œn
] = &
e1000_es2_öfo
,

81 [
bﬂrd_ich8œn
] = &
e1000_ich8_öfo
,

82 [
bﬂrd_ich9œn
] = &
e1000_ich9_öfo
,

83 [
bﬂrd_ich10œn
] = &
e1000_ich10_öfo
,

84 [
bﬂrd_pchœn
] = &
e1000_pch_öfo
,

85 [
bﬂrd_pch2œn
] = &
e1000_pch2_öfo
,

86 [
bﬂrd_pch_Õt
] = &
e1000_pch_Õt_öfo
,

89 
	se1000_ªg_öfo
 {

90 
u32
 
	mofs
;

91 *
	m«me
;

94 c⁄° 
e1000_ªg_öfo
 
	ge1000_ªg_öfo_tbl
[] = {

96 {
E1000_CTRL
, "CTRL"},

97 {
E1000_STATUS
, "STATUS"},

98 {
E1000_CTRL_EXT
, "CTRL_EXT"},

101 {
E1000_ICR
, "ICR"},

104 {
E1000_RCTL
, "RCTL"},

105 {
E1000_RDLEN
(0), "RDLEN"},

106 {
E1000_RDH
(0), "RDH"},

107 {
E1000_RDT
(0), "RDT"},

108 {
E1000_RDTR
, "RDTR"},

109 {
E1000_RXDCTL
(0), "RXDCTL"},

110 {
E1000_ERT
, "ERT"},

111 {
E1000_RDBAL
(0), "RDBAL"},

112 {
E1000_RDBAH
(0), "RDBAH"},

113 {
E1000_RDFH
, "RDFH"},

114 {
E1000_RDFT
, "RDFT"},

115 {
E1000_RDFHS
, "RDFHS"},

116 {
E1000_RDFTS
, "RDFTS"},

117 {
E1000_RDFPC
, "RDFPC"},

120 {
E1000_TCTL
, "TCTL"},

121 {
E1000_TDBAL
(0), "TDBAL"},

122 {
E1000_TDBAH
(0), "TDBAH"},

123 {
E1000_TDLEN
(0), "TDLEN"},

124 {
E1000_TDH
(0), "TDH"},

125 {
E1000_TDT
(0), "TDT"},

126 {
E1000_TIDV
, "TIDV"},

127 {
E1000_TXDCTL
(0), "TXDCTL"},

128 {
E1000_TADV
, "TADV"},

129 {
E1000_TARC
(0), "TARC"},

130 {
E1000_TDFH
, "TDFH"},

131 {
E1000_TDFT
, "TDFT"},

132 {
E1000_TDFHS
, "TDFHS"},

133 {
E1000_TDFTS
, "TDFTS"},

134 {
E1000_TDFPC
, "TDFPC"},

137 {0, 
NULL
}

145 
	$e1000_ªgdump
(
e1000_hw
 *
hw
, 
e1000_ªg_öfo
 *
ªgöfo
)

147 
n
 = 0;

148 
∫ame
[16];

149 
u32
 
ªgs
[8];

151 
ªgöfo
->
ofs
) {

152 
	`E1000_RXDCTL
(0):

153 
n
 = 0;Ç < 2;Ç++)

154 
ªgs
[
n
] = 
	`__î32
(
hw
, 
	`E1000_RXDCTL
(n));

156 
	`E1000_TXDCTL
(0):

157 
n
 = 0;Ç < 2;Ç++)

158 
ªgs
[
n
] = 
	`__î32
(
hw
, 
	`E1000_TXDCTL
(n));

160 
	`E1000_TARC
(0):

161 
n
 = 0;Ç < 2;Ç++)

162 
ªgs
[
n
] = 
	`__î32
(
hw
, 
	`E1000_TARC
(n));

165 
	`¥_öfo
("%-15s %08x\n",

166 
ªgöfo
->
«me
, 
	`__î32
(
hw
,Ñegöfo->
ofs
));

170 
	`¢¥ötf
(
∫ame
, 16, "%s%s", 
ªgöfo
->
«me
, "[0-1]");

171 
	`¥_öfo
("%-15†%08x %08x\n", 
∫ame
, 
ªgs
[0],Ñegs[1]);

172 
	}
}

174 
	$e1000e_dump_ps_∑ges
(
e1000_ad≠ãr
 *
ad≠ãr
,

175 
e1000_buf„r
 *
bi
)

177 
i
;

178 
e1000_ps_∑ge
 *
ps_∑ge
;

180 
i
 = 0; i < 
ad≠ãr
->
rx_ps_∑ges
; i++) {

181 
ps_∑ge
 = &
bi
->
ps_∑ges
[
i
];

183 i‡(
ps_∑ge
->
∑ge
) {

184 
	`¥_öfo
("∑ckë dum∞f‹Ös_∑gê%d:\n", 
i
);

185 
	`¥öt_hex_dump
(
KERN_INFO
, "", 
DUMP_PREFIX_ADDRESS
,

186 16, 1, 
	`∑ge_addªss
(
ps_∑ge
->
∑ge
),

187 
PAGE_SIZE
, 
åue
);

190 
	}
}

196 
	$e1000e_dump
(
e1000_ad≠ãr
 *
ad≠ãr
)

198 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

199 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

200 
e1000_ªg_öfo
 *
ªgöfo
;

201 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

202 
e1000_tx_desc
 *
tx_desc
;

203 
	smy_u0
 {

204 
__À64
 
a
;

205 
__À64
 
b
;

206 } *
u0
;

207 
e1000_buf„r
 *
buf„r_öfo
;

208 
e1000_rög
 *
rx_rög
 = 
ad≠ãr
->rx_ring;

209 
e1000_rx_desc_∑ckë_•lô
 *
rx_desc_ps
;

210 
e1000_rx_desc_exãnded
 *
rx_desc
;

211 
	smy_u1
 {

212 
__À64
 
a
;

213 
__À64
 
b
;

214 
__À64
 
c
;

215 
__À64
 
d
;

216 } *
u1
;

217 
u32
 
°©îr
;

218 
i
 = 0;

220 i‡(!
	`√tif_msg_hw
(
ad≠ãr
))

224 i‡(
√tdev
) {

225 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Net device Info\n");

226 
	`¥_öfo
("Device Name stateÅrans_startÜast_rx\n");

227 
	`¥_öfo
("%-15†%016lX %016lX %016lX\n", 
√tdev
->
«me
,

228 
√tdev
->
°©e
,Çëdev->
å™s_°¨t
,Çëdev->
œ°_rx
);

232 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Register Dump\n");

233 
	`¥_öfo
(" Register Name Value\n");

234 
ªgöfo
 = (
e1000_ªg_öfo
 *)
e1000_ªg_öfo_tbl
;

235 
ªgöfo
->
«me
;Ñeginfo++) {

236 
	`e1000_ªgdump
(
hw
, 
ªgöfo
);

240 i‡(!
√tdev
 || !
	`√tif_ru¬ög
(netdev))

243 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Tx Ring Summary\n");

244 
	`¥_öfo
("Queue [NTU] [NTC] [bi(ntc)->dma ]ÜengÇtwÅimestamp\n");

245 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[tx_rög->
√xt_to_˛ón
];

246 
	`¥_öfo
(" %5d %5X %5X %016llX %04X %3X %016llX\n",

247 0, 
tx_rög
->
√xt_to_u£
,Åx_rög->
√xt_to_˛ón
,

248 ()
buf„r_öfo
->
dma
,

249 
buf„r_öfo
->
Àngth
,

250 
buf„r_öfo
->
√xt_to_w©ch
,

251 ()
buf„r_öfo
->
time_°amp
);

254 i‡(!
	`√tif_msg_tx_d⁄e
(
ad≠ãr
))

255 
rx_rög_summ¨y
;

257 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Tx Ring Dump\n");

286 
	`¥_öfo
("Tl[desc] [address 63:0 ] [SpeCssSCmCsLen] [bi->dma ]ÜengÇtwÅimestamp bi->skb <-- Legacy format\n");

287 
	`¥_öfo
("Tc[desc] [Ce CoCsIpceCoS] [MssHlRSCm0Plen] [bi->dma ]ÜengÇtwÅimestamp bi->skb <-- Ext Context format\n");

288 
	`¥_öfo
("Td[desc] [address 63:0 ] [VlaPoRSCm1Dlen] [bi->dma ]ÜengÇtwÅimestamp bi->skb <-- Ext Data format\n");

289 
i
 = 0; 
tx_rög
->
desc
 && (ò<Åx_rög->
cou¡
); i++) {

290 c⁄° *
√xt_desc
;

291 
tx_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
i
);

292 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

293 
u0
 = (
my_u0
 *)
tx_desc
;

294 i‡(
i
 =
tx_rög
->
√xt_to_u£
 && i =tx_rög->
√xt_to_˛ón
)

295 
√xt_desc
 = " NTC/U";

296 i‡(
i
 =
tx_rög
->
√xt_to_u£
)

297 
√xt_desc
 = " NTU";

298 i‡(
i
 =
tx_rög
->
√xt_to_˛ón
)

299 
√xt_desc
 = " NTC";

301 
√xt_desc
 = "";

302 
	`¥_öfo
("T%c[0x%03X] %016llX %016llX %016llX %04X %3X %016llX %p%s\n",

303 (!(
	`À64_to_˝u
(
u0
->
b
) & (1 << 29)) ? 'l' :

304 ((
	`À64_to_˝u
(
u0
->
b
) & (1 << 20)) ? 'd' : 'c')),

305 
i
,

306 ()
	`À64_to_˝u
(
u0
->
a
),

307 ()
	`À64_to_˝u
(
u0
->
b
),

308 ()
buf„r_öfo
->
dma
,

309 
buf„r_öfo
->
Àngth
, buf„r_öfo->
√xt_to_w©ch
,

310 ()
buf„r_öfo
->
time_°amp
,

311 
buf„r_öfo
->
skb
, 
√xt_desc
);

313 i‡(
	`√tif_msg_pktd©a
(
ad≠ãr
Ë&& 
buf„r_öfo
->
skb
)

314 
	`¥öt_hex_dump
(
KERN_INFO
, "", 
DUMP_PREFIX_ADDRESS
,

315 16, 1, 
buf„r_öfo
->
skb
->
d©a
,

316 
buf„r_öfo
->
skb
->
Àn
, 
åue
);

320 
rx_rög_summ¨y
:

321 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Rx Ring Summary\n");

322 
	`¥_öfo
("Queue [NTU] [NTC]\n");

323 
	`¥_öfo
(" %5d %5X %5X\n",

324 0, 
rx_rög
->
√xt_to_u£
,Ñx_rög->
√xt_to_˛ón
);

327 i‡(!
	`√tif_msg_rx_°©us
(
ad≠ãr
))

330 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "Rx Ring Dump\n");

331 
ad≠ãr
->
rx_ps_∑ges
) {

347 
	`¥_öfo
("R [desc] [buffer 0 63:0 ] [buffer 1 63:0 ] [buffer 2 63:0 ] [buffer 3 63:0 ] [bi->dma ] [bi->skb] <-- Ext Pkt Split format\n");

359 
	`¥_öfo
("RWB[desc] [ck ipid mrqhsh] [vlÜ0ÉeÉs] [Ü3Ü2Ü1 hs] [reserved ] ---------------- [bi->skb] <-- Ext Rx Write-Back format\n");

360 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

361 c⁄° *
√xt_desc
;

362 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

363 
rx_desc_ps
 = 
	`E1000_RX_DESC_PS
(*
rx_rög
, 
i
);

364 
u1
 = (
my_u1
 *)
rx_desc_ps
;

365 
°©îr
 =

366 
	`À32_to_˝u
(
rx_desc_ps
->
wb
.
middÀ
.
°©us_îr‹
);

368 i‡(
i
 =
rx_rög
->
√xt_to_u£
)

369 
√xt_desc
 = " NTU";

370 i‡(
i
 =
rx_rög
->
√xt_to_˛ón
)

371 
√xt_desc
 = " NTC";

373 
√xt_desc
 = "";

375 i‡(
°©îr
 & 
E1000_RXD_STAT_DD
) {

377 
	`¥_öfo
("%s[0x%03X] %016llX %016llX %016llX %016llX ---------------- %p%s\n",

378 "RWB", 
i
,

379 ()
	`À64_to_˝u
(
u1
->
a
),

380 ()
	`À64_to_˝u
(
u1
->
b
),

381 ()
	`À64_to_˝u
(
u1
->
c
),

382 ()
	`À64_to_˝u
(
u1
->
d
),

383 
buf„r_öfo
->
skb
, 
√xt_desc
);

385 
	`¥_öfo
("%s[0x%03X] %016llX %016llX %016llX %016llX %016llX %p%s\n",

386 "R ", 
i
,

387 ()
	`À64_to_˝u
(
u1
->
a
),

388 ()
	`À64_to_˝u
(
u1
->
b
),

389 ()
	`À64_to_˝u
(
u1
->
c
),

390 ()
	`À64_to_˝u
(
u1
->
d
),

391 ()
buf„r_öfo
->
dma
,

392 
buf„r_öfo
->
skb
, 
√xt_desc
);

394 i‡(
	`√tif_msg_pktd©a
(
ad≠ãr
))

395 
	`e1000e_dump_ps_∑ges
(
ad≠ãr
,

396 
buf„r_öfo
);

410 
	`¥_öfo
("R [desc] [bufáddr 63:0 ] [reserved 63:0 ] [bi->dma ] [bi->skb] <-- Ext (Read) format\n");

424 
	`¥_öfo
("RWB[desc] [cs ipid mrq] [vtÜn xe xs] [bi->skb] <-- Ext (Write-Back) format\n");

426 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

427 c⁄° *
√xt_desc
;

429 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

430 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

431 
u1
 = (
my_u1
 *)
rx_desc
;

432 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
uµî
.
°©us_îr‹
);

434 i‡(
i
 =
rx_rög
->
√xt_to_u£
)

435 
√xt_desc
 = " NTU";

436 i‡(
i
 =
rx_rög
->
√xt_to_˛ón
)

437 
√xt_desc
 = " NTC";

439 
√xt_desc
 = "";

441 i‡(
°©îr
 & 
E1000_RXD_STAT_DD
) {

443 
	`¥_öfo
("%s[0x%03X] %016llX %016llX ---------------- %p%s\n",

444 "RWB", 
i
,

445 ()
	`À64_to_˝u
(
u1
->
a
),

446 ()
	`À64_to_˝u
(
u1
->
b
),

447 
buf„r_öfo
->
skb
, 
√xt_desc
);

449 
	`¥_öfo
("%s[0x%03X] %016llX %016llX %016llX %p%s\n",

450 "R ", 
i
,

451 ()
	`À64_to_˝u
(
u1
->
a
),

452 ()
	`À64_to_˝u
(
u1
->
b
),

453 ()
buf„r_öfo
->
dma
,

454 
buf„r_öfo
->
skb
, 
√xt_desc
);

456 i‡(
	`√tif_msg_pktd©a
(
ad≠ãr
) &&

457 
buf„r_öfo
->
skb
)

458 
	`¥öt_hex_dump
(
KERN_INFO
, "",

459 
DUMP_PREFIX_ADDRESS
, 16,

461 
buf„r_öfo
->
skb
->
d©a
,

462 
ad≠ãr
->
rx_buf„r_Àn
,

463 
åue
);

467 
	}
}

472 
	$e1000_desc_unu£d
(
e1000_rög
 *
rög
)

474 i‡(
rög
->
√xt_to_˛ón
 >Ñög->
√xt_to_u£
)

475  
rög
->
√xt_to_˛ón
 -Ñög->
√xt_to_u£
 - 1;

477  
rög
->
cou¡
 +Ñög->
√xt_to_˛ón
 -Ñög->
√xt_to_u£
 - 1;

478 
	}
}

480 #ifde‡
HAVE_HW_TIME_STAMP


495 
	$e1000e_sy°im_to_hwt°amp
(
e1000_ad≠ãr
 *
ad≠ãr
,

496 
skb_sh¨ed_hwt°amps
 *
hwt°amps
,

497 
u64
 
sy°im
)

499 
u64
 
ns
;

500 
Êags
;

502 
	`•ö_lock_úqßve
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

503 
ns
 = 
	`timecou¡î_cyc2time
(&
ad≠ãr
->
tc
, 
sy°im
);

504 
	`•ö_u∆ock_úqª°‹e
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

506 
	`mem£t
(
hwt°amps
, 0, (*hwtstamps));

507 
hwt°amps
->
hwt°amp
 = 
	`ns_to_ktime
(
ns
);

508 
	}
}

520 
	$e1000e_rx_hwt°amp
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
°©us
,

521 
sk_buff
 *
skb
)

523 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

524 
u64
 
rx°mp
;

526 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
) ||

527 !(
°©us
 & 
E1000_RXDEXT_STATERR_TST
) ||

528 !(
	`î32
(
TSYNCRXCTL
Ë& 
E1000_TSYNCRXCTL_VALID
))

538 
rx°mp
 = (
u64
)
	`î32
(
RXSTMPL
);

539 
rx°mp
 |(
u64
)
	`î32
(
RXSTMPH
) << 32;

540 
	`e1000e_sy°im_to_hwt°amp
(
ad≠ãr
, 
	`skb_hwt°amps
(
skb
), 
rx°mp
);

542 
ad≠ãr
->
Êags2
 &~
FLAG2_CHECK_RX_HWTSTAMP
;

543 
	}
}

553 
	$e1000_ª˚ive_skb
(
e1000_ad≠ãr
 *
ad≠ãr
,

554 
√t_devi˚
 *
√tdev
, 
sk_buff
 *
skb
,

555 
u32
 
°©îr
, 
__À16
 
vœn
)

557 #i‚de‡
CONFIG_E1000E_NAPI


558 
ªt
;

560 #i‚de‡
HAVE_VLAN_RX_REGISTER


561 
u16
 
èg
 = 
	`À16_to_˝u
(
vœn
);

564 #ifde‡
HAVE_HW_TIME_STAMP


565 
	`e1000e_rx_hwt°amp
(
ad≠ãr
, 
°©îr
, 
skb
);

568 
skb
->
¥Ÿocﬁ
 = 
	`ëh_ty≥_å™s
(skb, 
√tdev
);

570 #ifde‡
CONFIG_E1000E_NAPI


571 #ifde‡
HAVE_VLAN_RX_REGISTER


572 #ifde‡
NETIF_F_HW_VLAN_TX


573 i‡(
ad≠ãr
->
vlgΩ
 && (
°©îr
 & 
E1000_RXD_STAT_VP
))

574 
	`vœn_gro_ª˚ive
(&
ad≠ãr
->
«pi
,ád≠ãr->
vlgΩ
,

575 
	`À16_to_˝u
(
vœn
), 
skb
);

578 
	`«pi_gro_ª˚ive
(&
ad≠ãr
->
«pi
, 
skb
);

580 i‡(
°©îr
 & 
E1000_RXD_STAT_VP
)

581 
	`__vœn_hwac˚l_put_èg
(
skb
, 
	`ht⁄s
(
ETH_P_8021Q
), 
èg
);

583 
	`«pi_gro_ª˚ive
(&
ad≠ãr
->
«pi
, 
skb
);

586 #ifde‡
HAVE_VLAN_RX_REGISTER


587 #ifde‡
NETIF_F_HW_VLAN_TX


588 i‡(
ad≠ãr
->
vlgΩ
 && (
°©îr
 & 
E1000_RXD_STAT_VP
))

589 
ªt
 = 
	`vœn_hwac˚l_rx
(
skb
, 
ad≠ãr
->
vlgΩ
, 
	`À16_to_˝u
(
vœn
));

592 
ªt
 = 
	`√tif_rx
(
skb
);

594 i‡(
°©îr
 & 
E1000_RXD_STAT_VP
)

595 
	`__vœn_hwac˚l_put_èg
(
skb
, 
	`ht⁄s
(
ETH_P_8021Q
), 
èg
);

597 
ªt
 = 
	`√tif_rx
(
skb
);

599 i‡(
	`u∆ikñy
(
ªt
 =
NET_RX_DROP
))

600 
ad≠ãr
->
rx_dr›≥d_backlog
++;

602 #i‚de‡
NETIF_F_GRO


604 
√tdev
->
œ°_rx
 = 
jiffõs
;

606 
	}
}

615 
	$e1000_rx_checksum
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
°©us_îr
,

616 
sk_buff
 *
skb
)

618 
u16
 
°©us
 = (u16)
°©us_îr
;

619 
u8
 
îr‹s
 = (u8)(
°©us_îr
 >> 24);

621 
	`skb_checksum_n⁄e_as£π
(
skb
);

624 #ifde‡
HAVE_NDO_SET_FEATURES


625 i‡(!(
ad≠ãr
->
√tdev
->
„©uªs
 & 
NETIF_F_RXCSUM
))

627 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_RX_CSUM_ENABLED
))

632 i‡(
°©us
 & 
E1000_RXD_STAT_IXSM
)

636 i‡(
îr‹s
 & (
E1000_RXD_ERR_TCPE
 | 
E1000_RXD_ERR_IPE
)) {

638 
ad≠ãr
->
hw_csum_îr
++;

643 i‡(!(
°©us
 & (
E1000_RXD_STAT_TCPCS
 | 
E1000_RXD_STAT_UDPCS
)))

647 
skb
->
ù_summed
 = 
CHECKSUM_UNNECESSARY
;

648 
ad≠ãr
->
hw_csum_good
++;

649 
	}
}

651 
	$e1000e_upd©e_rdt_wa
(
e1000_rög
 *
rx_rög
, 
i
)

653 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

654 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

655 
s32
 
ªt_vÆ
 = 
	`__ew32_¥ï¨e
(
hw
);

657 
	`wrôñ
(
i
, 
rx_rög
->
èû
);

659 i‡(
	`u∆ikñy
(!
ªt_vÆ
 && (
i
 !
	`ªadl
(
rx_rög
->
èû
)))) {

660 
u32
 
r˘l
 = 
	`î32
(
RCTL
);

661 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

662 
	`e_îr
("ME firmware caused invalid RDT -Ñesetting\n");

663 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

665 
	}
}

667 
	$e1000e_upd©e_tdt_wa
(
e1000_rög
 *
tx_rög
, 
i
)

669 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

670 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

671 
s32
 
ªt_vÆ
 = 
	`__ew32_¥ï¨e
(
hw
);

673 
	`wrôñ
(
i
, 
tx_rög
->
èû
);

675 i‡(
	`u∆ikñy
(!
ªt_vÆ
 && (
i
 !
	`ªadl
(
tx_rög
->
èû
)))) {

676 
u32
 
t˘l
 = 
	`î32
(
TCTL
);

677 
	`ew32
(
TCTL
, 
t˘l
 & ~
E1000_TCTL_EN
);

678 
	`e_îr
("ME firmware caused invalid TDT -Ñesetting\n");

679 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

681 
	}
}

687 
	$e1000_Æloc_rx_buf„rs
(
e1000_rög
 *
rx_rög
,

688 
˛ó√d_cou¡
, 
gÂ_t
 
gÂ
)

690 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

691 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

692 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

693 
e1000_rx_desc_exãnded
 *
rx_desc
;

694 
e1000_buf„r
 *
buf„r_öfo
;

695 
sk_buff
 *
skb
;

696 
i
;

697 
bufsz
 = 
ad≠ãr
->
rx_buf„r_Àn
;

699 
i
 = 
rx_rög
->
√xt_to_u£
;

700 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

702 
˛ó√d_cou¡
--) {

703 
skb
 = 
buf„r_öfo
->skb;

704 i‡(
skb
) {

705 
	`skb_åim
(
skb
, 0);

706 
m≠_skb
;

709 
skb
 = 
	`__√tdev_Æloc_skb_ù_Æign
(
√tdev
, 
bufsz
, 
gÂ
);

710 i‡(!
skb
) {

712 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

716 
buf„r_öfo
->
skb
 = skb;

717 
m≠_skb
:

718 
buf„r_öfo
->
dma
 =

719 
	`dma_m≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
skb
->
d©a
,

720 
ad≠ãr
->
rx_buf„r_Àn
, 
DMA_FROM_DEVICE
);

721 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
)) {

722 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
), "Rx DMA map failed\n");

723 
ad≠ãr
->
rx_dma_Áûed
++;

727 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

728 
rx_desc
->
ªad
.
buf„r_addr
 = 
	`˝u_to_À64
(
buf„r_öfo
->
dma
);

730 i‡(
	`u∆ikñy
(!(
i
 & (
E1000_RX_BUFFER_WRITE
 - 1)))) {

736 
	`wmb
();

737 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

738 
	`e1000e_upd©e_rdt_wa
(
rx_rög
, 
i
);

740 
	`wrôñ
(
i
, 
rx_rög
->
èû
);

742 
i
++;

743 i‡(
i
 =
rx_rög
->
cou¡
)

744 
i
 = 0;

745 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

748 
rx_rög
->
√xt_to_u£
 = 
i
;

749 
	}
}

755 
	$e1000_Æloc_rx_buf„rs_ps
(
e1000_rög
 *
rx_rög
,

756 
˛ó√d_cou¡
, 
gÂ_t
 
gÂ
)

758 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

759 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

760 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

761 
e1000_rx_desc_∑ckë_•lô
 *
rx_desc
;

762 
e1000_buf„r
 *
buf„r_öfo
;

763 
e1000_ps_∑ge
 *
ps_∑ge
;

764 
sk_buff
 *
skb
;

765 
i
, 
j
;

767 
i
 = 
rx_rög
->
√xt_to_u£
;

768 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

770 
˛ó√d_cou¡
--) {

771 
rx_desc
 = 
	`E1000_RX_DESC_PS
(*
rx_rög
, 
i
);

773 
j
 = 0; j < 
PS_PAGE_BUFFERS
; j++) {

774 
ps_∑ge
 = &
buf„r_öfo
->
ps_∑ges
[
j
];

775 i‡(
j
 >
ad≠ãr
->
rx_ps_∑ges
) {

777 
rx_desc
->
ªad
.
buf„r_addr
[
j
 + 1] =

778 ~
	`˝u_to_À64
(0);

781 i‡(!
ps_∑ge
->
∑ge
) {

782 
ps_∑ge
->
∑ge
 = 
	`Æloc_∑ges_node
(
ad≠ãr
->
node
,

783 
gÂ
, 0);

784 i‡(!
ps_∑ge
->
∑ge
) {

785 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

786 
no_buf„rs
;

788 
ps_∑ge
->
dma
 = 
	`dma_m≠_∑ge
(
	`pci_dev_to_dev
(
pdev
),

789 
ps_∑ge
->
∑ge
,

790 0, 
PAGE_SIZE
,

791 
DMA_FROM_DEVICE
);

792 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
),

793 
ps_∑ge
->
dma
)) {

794 
	`dev_îr
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

796 
ad≠ãr
->
rx_dma_Áûed
++;

797 
no_buf„rs
;

804 
rx_desc
->
ªad
.
buf„r_addr
[
j
 + 1] =

805 
	`˝u_to_À64
(
ps_∑ge
->
dma
);

808 
skb
 = 
	`__√tdev_Æloc_skb_ù_Æign
(
√tdev
, 
ad≠ãr
->
rx_ps_bsize0
,

809 
gÂ
);

811 i‡(!
skb
) {

812 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

816 
buf„r_öfo
->
skb
 = skb;

817 
buf„r_öfo
->
dma
 =

818 
	`dma_m≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
skb
->
d©a
,

819 
ad≠ãr
->
rx_ps_bsize0
, 
DMA_FROM_DEVICE
);

820 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
)) {

821 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
), "Rx DMA map failed\n");

822 
ad≠ãr
->
rx_dma_Áûed
++;

824 
	`dev_k‰ì_skb_™y
(
skb
);

825 
buf„r_öfo
->
skb
 = 
NULL
;

829 
rx_desc
->
ªad
.
buf„r_addr
[0] = 
	`˝u_to_À64
(
buf„r_öfo
->
dma
);

831 i‡(
	`u∆ikñy
(!(
i
 & (
E1000_RX_BUFFER_WRITE
 - 1)))) {

837 
	`wmb
();

838 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

839 
	`e1000e_upd©e_rdt_wa
(
rx_rög
, 
i
 << 1);

841 
	`wrôñ
(
i
 << 1, 
rx_rög
->
èû
);

844 
i
++;

845 i‡(
i
 =
rx_rög
->
cou¡
)

846 
i
 = 0;

847 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

850 
no_buf„rs
:

851 
rx_rög
->
√xt_to_u£
 = 
i
;

852 
	}
}

854 #ifde‡
CONFIG_E1000E_NAPI


861 
	$e1000_Æloc_jumbo_rx_buf„rs
(
e1000_rög
 *
rx_rög
,

862 
˛ó√d_cou¡
, 
gÂ_t
 
gÂ
)

864 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

865 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

866 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

867 
e1000_rx_desc_exãnded
 *
rx_desc
;

868 
e1000_buf„r
 *
buf„r_öfo
;

869 
sk_buff
 *
skb
;

870 
i
;

871 
bufsz
 = 256 - 16;

873 
i
 = 
rx_rög
->
√xt_to_u£
;

874 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

876 
˛ó√d_cou¡
--) {

877 
skb
 = 
buf„r_öfo
->skb;

878 i‡(
skb
) {

879 
	`skb_åim
(
skb
, 0);

880 
check_∑ge
;

883 
skb
 = 
	`__√tdev_Æloc_skb_ù_Æign
(
√tdev
, 
bufsz
, 
gÂ
);

884 i‡(
	`u∆ikñy
(!
skb
)) {

886 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

890 
buf„r_öfo
->
skb
 = skb;

891 
check_∑ge
:

893 i‡(!
buf„r_öfo
->
∑ge
) {

894 
buf„r_öfo
->
∑ge
 = 
	`Æloc_∑ges_node
(
ad≠ãr
->
node
,

895 
gÂ
, 0);

896 i‡(
	`u∆ikñy
(!
buf„r_öfo
->
∑ge
)) {

897 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

902 i‡(!
buf„r_öfo
->
dma
) {

903 
buf„r_öfo
->
dma
 = 
	`dma_m≠_∑ge
(
	`pci_dev_to_dev
(
pdev
),

904 
buf„r_öfo
->
∑ge
, 0,

905 
PAGE_SIZE
,

906 
DMA_FROM_DEVICE
);

907 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
),

908 
buf„r_öfo
->
dma
)) {

909 
ad≠ãr
->
Æloc_rx_buff_Áûed
++;

914 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

915 
rx_desc
->
ªad
.
buf„r_addr
 = 
	`˝u_to_À64
(
buf„r_öfo
->
dma
);

917 i‡(
	`u∆ikñy
(++
i
 =
rx_rög
->
cou¡
))

918 
i
 = 0;

919 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

922 i‡(
	`likñy
(
rx_rög
->
√xt_to_u£
 !
i
)) {

923 
rx_rög
->
√xt_to_u£
 = 
i
;

924 i‡(
	`u∆ikñy
(
i
-- == 0))

925 
i
 = (
rx_rög
->
cou¡
 - 1);

932 
	`wmb
();

933 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

934 
	`e1000e_upd©e_rdt_wa
(
rx_rög
, 
i
);

936 
	`wrôñ
(
i
, 
rx_rög
->
èû
);

938 
	}
}

941 #ifde‡
NETIF_F_RXHASH


942 
ölöe
 
	$e1000_rx_hash
(
√t_devi˚
 *
√tdev
, 
__À32
 
rss
,

943 
sk_buff
 *
skb
)

945 i‡(
√tdev
->
„©uªs
 & 
NETIF_F_RXHASH
)

946 
skb
->
rxhash
 = 
	`À32_to_˝u
(
rss
);

947 
	}
}

957 #ifde‡
CONFIG_E1000E_NAPI


958 
boﬁ
 
	$e1000_˛ón_rx_úq
(
e1000_rög
 *
rx_rög
, *
w‹k_d⁄e
,

959 
w‹k_to_do
)

961 
boﬁ
 
	$e1000_˛ón_rx_úq
(
e1000_rög
 *
rx_rög
)

964 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

965 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

966 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

967 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

968 
e1000_rx_desc_exãnded
 *
rx_desc
, *
√xt_rxd
;

969 
e1000_buf„r
 *
buf„r_öfo
, *
√xt_buf„r
;

970 
u32
 
Àngth
, 
°©îr
;

971 
i
;

972 
˛ó√d_cou¡
 = 0;

973 
boﬁ
 
˛ó√d
 = 
Ál£
;

974 
tŸÆ_rx_byãs
 = 0, 
tŸÆ_rx_∑ckës
 = 0;

976 
i
 = 
rx_rög
->
√xt_to_˛ón
;

977 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

978 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
uµî
.
°©us_îr‹
);

979 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

981 
°©îr
 & 
E1000_RXD_STAT_DD
) {

982 
sk_buff
 *
skb
;

984 #ifde‡
CONFIG_E1000E_NAPI


985 i‡(*
w‹k_d⁄e
 >
w‹k_to_do
)

987 (*
w‹k_d⁄e
)++;

989 
	`rmb
();

991 
skb
 = 
buf„r_öfo
->skb;

992 
buf„r_öfo
->
skb
 = 
NULL
;

994 
	`¥e„tch
(
skb
->
d©a
 - 
NET_IP_ALIGN
);

996 
i
++;

997 i‡(
i
 =
rx_rög
->
cou¡
)

998 
i
 = 0;

999 
√xt_rxd
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

1000 
	`¥e„tch
(
√xt_rxd
);

1002 
√xt_buf„r
 = &
rx_rög
->
buf„r_öfo
[
i
];

1004 
˛ó√d
 = 
åue
;

1005 
˛ó√d_cou¡
++;

1006 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
,

1007 
ad≠ãr
->
rx_buf„r_Àn
, 
DMA_FROM_DEVICE
);

1008 
buf„r_öfo
->
dma
 = 0;

1010 
Àngth
 = 
	`À16_to_˝u
(
rx_desc
->
wb
.
uµî
.length);

1018 i‡(
	`u∆ikñy
(!(
°©îr
 & 
E1000_RXD_STAT_EOP
)))

1019 
ad≠ãr
->
Êags2
 |
FLAG2_IS_DISCARDING
;

1021 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_IS_DISCARDING
) {

1023 
	`e_dbg
("ReceiveÖacket consumed multiple buffers\n");

1025 
buf„r_öfo
->
skb
 = skb;

1026 i‡(
°©îr
 & 
E1000_RXD_STAT_EOP
)

1027 
ad≠ãr
->
Êags2
 &~
FLAG2_IS_DISCARDING
;

1028 
√xt_desc
;

1031 i‡(
	`u∆ikñy
((
°©îr
 & 
E1000_RXDEXT_ERR_FRAME_ERR_MASK
) &&

1032 !(
√tdev
->
„©uªs
 & 
NETIF_F_RXALL
))) {

1034 
buf„r_öfo
->
skb
 = skb;

1035 
√xt_desc
;

1039 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_CRC_STRIPPING
)) {

1044 i‡(
√tdev
->
„©uªs
 & 
NETIF_F_RXFCS
)

1045 
tŸÆ_rx_byãs
 -= 4;

1047 
Àngth
 -= 4;

1050 
tŸÆ_rx_byãs
 +
Àngth
;

1051 
tŸÆ_rx_∑ckës
++;

1057 i‡(
Àngth
 < 
c›ybªak
) {

1058 
sk_buff
 *
√w_skb
 =

1059 
	`√tdev_Æloc_skb_ù_Æign
(
√tdev
, 
Àngth
);

1060 i‡(
√w_skb
) {

1061 
	`skb_c›y_to_löór_d©a_off£t
(
√w_skb
,

1062 -
NET_IP_ALIGN
,

1063 (
skb
->
d©a
 -

1064 
NET_IP_ALIGN
),

1065 (
Àngth
 +

1066 
NET_IP_ALIGN
));

1068 
buf„r_öfo
->
skb
 = skb;

1069 
skb
 = 
√w_skb
;

1074 
	`skb_put
(
skb
, 
Àngth
);

1077 
	`e1000_rx_checksum
(
ad≠ãr
, 
°©îr
, 
skb
);

1079 #ifde‡
NETIF_F_RXHASH


1080 
	`e1000_rx_hash
(
√tdev
, 
rx_desc
->
wb
.
lowî
.
hi_dw‹d
.
rss
, 
skb
);

1083 
	`e1000_ª˚ive_skb
(
ad≠ãr
, 
√tdev
, 
skb
, 
°©îr
,

1084 
rx_desc
->
wb
.
uµî
.
vœn
);

1086 
√xt_desc
:

1087 
rx_desc
->
wb
.
uµî
.
°©us_îr‹
 &
	`˝u_to_À32
(~0xFF);

1090 i‡(
˛ó√d_cou¡
 >
E1000_RX_BUFFER_WRITE
) {

1091 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
,

1092 
GFP_ATOMIC
);

1093 
˛ó√d_cou¡
 = 0;

1097 
rx_desc
 = 
√xt_rxd
;

1098 
buf„r_öfo
 = 
√xt_buf„r
;

1100 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
uµî
.
°©us_îr‹
);

1102 
rx_rög
->
√xt_to_˛ón
 = 
i
;

1104 
˛ó√d_cou¡
 = 
	`e1000_desc_unu£d
(
rx_rög
);

1105 i‡(
˛ó√d_cou¡
)

1106 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
, 
GFP_ATOMIC
);

1108 
ad≠ãr
->
tŸÆ_rx_byãs
 +=Åotal_rx_bytes;

1109 
ad≠ãr
->
tŸÆ_rx_∑ckës
 +=Åotal_rx_packets;

1110 #ifde‡
HAVE_NDO_GET_STATS64


1111 #ñi‡
	`deföed
(
HAVE_NETDEV_STATS_IN_NETDEV
)

1112 
√tdev
->
°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1113 
√tdev
->
°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1115 
ad≠ãr
->
√t_°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1116 
ad≠ãr
->
√t_°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1118  
˛ó√d
;

1119 
	}
}

1121 
	$e1000_put_txbuf
(
e1000_rög
 *
tx_rög
,

1122 
e1000_buf„r
 *
buf„r_öfo
)

1124 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

1126 i‡(
buf„r_öfo
->
dma
) {

1127 i‡(
buf„r_öfo
->
m≠≥d_as_∑ge
)

1128 
	`dma_unm≠_∑ge
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

1129 
buf„r_öfo
->
dma
, buf„r_öfo->
Àngth
,

1130 
DMA_TO_DEVICE
);

1132 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

1133 
buf„r_öfo
->
dma
, buf„r_öfo->
Àngth
,

1134 
DMA_TO_DEVICE
);

1135 
buf„r_öfo
->
dma
 = 0;

1137 i‡(
buf„r_öfo
->
skb
) {

1138 
	`dev_k‰ì_skb_™y
(
buf„r_öfo
->
skb
);

1139 
buf„r_öfo
->
skb
 = 
NULL
;

1141 
buf„r_öfo
->
time_°amp
 = 0;

1142 
	}
}

1144 
	$e1000_¥öt_hw_h™g
(
w‹k_°ru˘
 *
w‹k
)

1146 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
,

1147 
e1000_ad≠ãr
,

1148 
¥öt_h™g_èsk
);

1149 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

1150 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

1151 
i
 = 
tx_rög
->
√xt_to_˛ón
;

1152 
e›
 = 
tx_rög
->
buf„r_öfo
[
i
].
√xt_to_w©ch
;

1153 
e1000_tx_desc
 *
e›_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
e›
);

1154 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1155 
u16
 
phy_°©us
, 
phy_1000t_°©us
, 
phy_ext_°©us
;

1156 
u16
 
pci_°©us
;

1158 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

1161 i‡(!
ad≠ãr
->
tx_h™g_ªcheck
 && (ad≠ãr->
Êags2
 & 
FLAG2_DMA_BURST
)) {

1165 
	`ew32
(
TIDV
, 
ad≠ãr
->
tx_öt_dñay
 | 
E1000_TIDV_FPD
);

1167 
	`e1e_Êush
();

1171 
	`ew32
(
TIDV
, 
ad≠ãr
->
tx_öt_dñay
 | 
E1000_TIDV_FPD
);

1173 
	`e1e_Êush
();

1174 
ad≠ãr
->
tx_h™g_ªcheck
 = 
åue
;

1177 
ad≠ãr
->
tx_h™g_ªcheck
 = 
Ál£
;

1179 i‡(
	`î32
(
	`TDH
(0)Ë=î32(
	`TDT
(0))) {

1180 
	`e_dbg
("false hang detected, ignoring\n");

1185 
	`√tif_°›_queue
(
√tdev
);

1187 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy_°©us
);

1188 
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
phy_1000t_°©us
);

1189 
	`e1e_Ωhy
(
hw
, 
MII_ESTATUS
, &
phy_ext_°©us
);

1191 
	`pci_ªad_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
PCI_STATUS
, &
pci_°©us
);

1194 
	`e_îr
("Detected Hardware Unit Hang:\n"

1209 
	`ªadl
(
tx_rög
->
hód
),Ñódl—x_rög->
èû
),Åx_rög->
√xt_to_u£
,

1210 
tx_rög
->
√xt_to_˛ón
,Åx_rög->
buf„r_öfo
[
e›
].
time_°amp
,

1211 
e›
, 
jiffõs
, 
e›_desc
->
uµî
.
fõlds
.
°©us
, 
	`î32
(
STATUS
),

1212 
phy_°©us
, 
phy_1000t_°©us
, 
phy_ext_°©us
, 
pci_°©us
);

1214 
	`e1000e_dump
(
ad≠ãr
);

1217 i‡((
hw
->
mac
.
ty≥
 =
e1000_pchœn
Ë&& (
	`î32
(
CTRL
Ë& 
E1000_CTRL_TFCE
))

1218 
	`e_îr
("TryÅurning off TxÖause (flow control) viaÉthtool\n");

1219 
	}
}

1221 #ifde‡
HAVE_HW_TIME_STAMP


1230 
	$e1000e_tx_hwt°amp_w‹k
(
w‹k_°ru˘
 *
w‹k
)

1232 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
, e1000_adapter,

1233 
tx_hwt°amp_w‹k
);

1234 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1236 i‡(!
ad≠ãr
->
tx_hwt°amp_skb
)

1239 i‡(
	`î32
(
TSYNCTXCTL
Ë& 
E1000_TSYNCTXCTL_VALID
) {

1240 
skb_sh¨ed_hwt°amps
 
shhwt°amps
;

1241 
u64
 
tx°mp
;

1243 
tx°mp
 = 
	`î32
(
TXSTMPL
);

1244 
tx°mp
 |(
u64
)
	`î32
(
TXSTMPH
) << 32;

1246 
	`e1000e_sy°im_to_hwt°amp
(
ad≠ãr
, &
shhwt°amps
, 
tx°mp
);

1248 
	`skb_t°amp_tx
(
ad≠ãr
->
tx_hwt°amp_skb
, &
shhwt°amps
);

1249 
	`dev_k‰ì_skb_™y
(
ad≠ãr
->
tx_hwt°amp_skb
);

1250 
ad≠ãr
->
tx_hwt°amp_skb
 = 
NULL
;

1253 
	`scheduÀ_w‹k
(&
ad≠ãr
->
tx_hwt°amp_w‹k
);

1255 
	}
}

1265 
boﬁ
 
	$e1000_˛ón_tx_úq
(
e1000_rög
 *
tx_rög
)

1267 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

1268 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

1269 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1270 
e1000_tx_desc
 *
tx_desc
, *
e›_desc
;

1271 
e1000_buf„r
 *
buf„r_öfo
;

1272 
i
, 
e›
;

1273 
cou¡
 = 0;

1274 
tŸÆ_tx_byãs
 = 0, 
tŸÆ_tx_∑ckës
 = 0;

1275 
byãs_com∂
 = 0, 
pkts_com∂
 = 0;

1277 
i
 = 
tx_rög
->
√xt_to_˛ón
;

1278 
e›
 = 
tx_rög
->
buf„r_öfo
[
i
].
√xt_to_w©ch
;

1279 
e›_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
e›
);

1281 (
e›_desc
->
uµî
.
d©a
 & 
	`˝u_to_À32
(
E1000_TXD_STAT_DD
)) &&

1282 (
cou¡
 < 
tx_rög
->count)) {

1283 
boﬁ
 
˛ó√d
 = 
Ál£
;

1284 
	`rmb
();

1285 ; !
˛ó√d
; 
cou¡
++) {

1286 
tx_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
i
);

1287 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

1288 
˛ó√d
 = (
i
 =
e›
);

1290 i‡(
˛ó√d
) {

1291 
tŸÆ_tx_∑ckës
 +
buf„r_öfo
->
£gs
;

1292 
tŸÆ_tx_byãs
 +
buf„r_öfo
->
byãcou¡
;

1293 i‡(
buf„r_öfo
->
skb
) {

1294 
byãs_com∂
 +
buf„r_öfo
->
skb
->
Àn
;

1295 
pkts_com∂
++;

1299 
	`e1000_put_txbuf
(
tx_rög
, 
buf„r_öfo
);

1300 
tx_desc
->
uµî
.
d©a
 = 0;

1302 
i
++;

1303 i‡(
i
 =
tx_rög
->
cou¡
)

1304 
i
 = 0;

1307 i‡(
i
 =
tx_rög
->
√xt_to_u£
)

1309 
e›
 = 
tx_rög
->
buf„r_öfo
[
i
].
√xt_to_w©ch
;

1310 
e›_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
e›
);

1313 
tx_rög
->
√xt_to_˛ón
 = 
i
;

1315 
	`√tdev_com∂ëed_queue
(
√tdev
, 
pkts_com∂
, 
byãs_com∂
);

1317 
	#TX_WAKE_THRESHOLD
 32

	)

1318 i‡(
cou¡
 && 
	`√tif_ˇºõr_ok
(
√tdev
) &&

1319 
	`e1000_desc_unu£d
(
tx_rög
Ë>
TX_WAKE_THRESHOLD
) {

1323 
	`smp_mb
();

1325 i‡(
	`√tif_queue_°›≥d
(
√tdev
) &&

1326 !(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))) {

1327 
	`√tif_wake_queue
(
√tdev
);

1328 ++
ad≠ãr
->
ª°¨t_queue
;

1332 i‡(
ad≠ãr
->
dëe˘_tx_hung
) {

1336 
ad≠ãr
->
dëe˘_tx_hung
 = 
Ál£
;

1337 i‡(
tx_rög
->
buf„r_öfo
[
i
].
time_°amp
 &&

1338 
	`time_a·î
(
jiffõs
, 
tx_rög
->
buf„r_öfo
[
i
].
time_°amp


1339 + (
ad≠ãr
->
tx_timeout_Á˘‹
 * 
HZ
)) &&

1340 !(
	`î32
(
STATUS
Ë& 
E1000_STATUS_TXOFF
))

1341 
	`scheduÀ_w‹k
(&
ad≠ãr
->
¥öt_h™g_èsk
);

1343 
ad≠ãr
->
tx_h™g_ªcheck
 = 
Ál£
;

1345 
ad≠ãr
->
tŸÆ_tx_byãs
 +=Åotal_tx_bytes;

1346 
ad≠ãr
->
tŸÆ_tx_∑ckës
 +=Åotal_tx_packets;

1347 #ifde‡
HAVE_NDO_GET_STATS64


1348 #ñi‡
	`deföed
(
HAVE_NETDEV_STATS_IN_NETDEV
)

1349 
√tdev
->
°©s
.
tx_byãs
 +
tŸÆ_tx_byãs
;

1350 
√tdev
->
°©s
.
tx_∑ckës
 +
tŸÆ_tx_∑ckës
;

1352 
ad≠ãr
->
√t_°©s
.
tx_byãs
 +
tŸÆ_tx_byãs
;

1353 
ad≠ãr
->
√t_°©s
.
tx_∑ckës
 +
tŸÆ_tx_∑ckës
;

1355  
cou¡
 < 
tx_rög
->count;

1356 
	}
}

1365 #ifde‡
CONFIG_E1000E_NAPI


1366 
boﬁ
 
	$e1000_˛ón_rx_úq_ps
(
e1000_rög
 *
rx_rög
, *
w‹k_d⁄e
,

1367 
w‹k_to_do
)

1369 
boﬁ
 
	$e1000_˛ón_rx_úq_ps
(
e1000_rög
 *
rx_rög
)

1372 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

1373 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1374 
e1000_rx_desc_∑ckë_•lô
 *
rx_desc
, *
√xt_rxd
;

1375 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

1376 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1377 
e1000_buf„r
 *
buf„r_öfo
, *
√xt_buf„r
;

1378 
e1000_ps_∑ge
 *
ps_∑ge
;

1379 
sk_buff
 *
skb
;

1380 
i
, 
j
;

1381 
u32
 
Àngth
, 
°©îr
;

1382 
˛ó√d_cou¡
 = 0;

1383 
boﬁ
 
˛ó√d
 = 
Ál£
;

1384 
tŸÆ_rx_byãs
 = 0, 
tŸÆ_rx_∑ckës
 = 0;

1386 
i
 = 
rx_rög
->
√xt_to_˛ón
;

1387 
rx_desc
 = 
	`E1000_RX_DESC_PS
(*
rx_rög
, 
i
);

1388 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
middÀ
.
°©us_îr‹
);

1389 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

1391 
°©îr
 & 
E1000_RXD_STAT_DD
) {

1392 #ifde‡
CONFIG_E1000E_NAPI


1393 i‡(*
w‹k_d⁄e
 >
w‹k_to_do
)

1395 (*
w‹k_d⁄e
)++;

1397 
skb
 = 
buf„r_öfo
->skb;

1398 
	`rmb
();

1401 
	`¥e„tch
(
skb
->
d©a
 - 
NET_IP_ALIGN
);

1403 
i
++;

1404 i‡(
i
 =
rx_rög
->
cou¡
)

1405 
i
 = 0;

1406 
√xt_rxd
 = 
	`E1000_RX_DESC_PS
(*
rx_rög
, 
i
);

1407 
	`¥e„tch
(
√xt_rxd
);

1409 
√xt_buf„r
 = &
rx_rög
->
buf„r_öfo
[
i
];

1411 
˛ó√d
 = 
åue
;

1412 
˛ó√d_cou¡
++;

1413 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
,

1414 
ad≠ãr
->
rx_ps_bsize0
, 
DMA_FROM_DEVICE
);

1415 
buf„r_öfo
->
dma
 = 0;

1418 i‡(!(
°©îr
 & 
E1000_RXD_STAT_EOP
))

1419 
ad≠ãr
->
Êags2
 |
FLAG2_IS_DISCARDING
;

1421 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_IS_DISCARDING
) {

1422 
	`e_dbg
("Packet Split buffers didn'tÖick upÅhe fullÖacket\n");

1423 
	`dev_k‰ì_skb_úq
(
skb
);

1424 i‡(
°©îr
 & 
E1000_RXD_STAT_EOP
)

1425 
ad≠ãr
->
Êags2
 &~
FLAG2_IS_DISCARDING
;

1426 
√xt_desc
;

1429 i‡(
	`u∆ikñy
((
°©îr
 & 
E1000_RXDEXT_ERR_FRAME_ERR_MASK
) &&

1430 !(
√tdev
->
„©uªs
 & 
NETIF_F_RXALL
))) {

1431 
	`dev_k‰ì_skb_úq
(
skb
);

1432 
√xt_desc
;

1435 
Àngth
 = 
	`À16_to_˝u
(
rx_desc
->
wb
.
middÀ
.
Àngth0
);

1437 i‡(!
Àngth
) {

1438 
	`e_dbg
("LastÖart ofÅheÖacket spanning multiple descriptors\n");

1439 
	`dev_k‰ì_skb_úq
(
skb
);

1440 
√xt_desc
;

1444 
	`skb_put
(
skb
, 
Àngth
);

1446 #ifde‡
CONFIG_E1000E_NAPI


1451 
l1
 = 
	`À16_to_˝u
(
rx_desc
->
wb
.
uµî
.
Àngth
[0]);

1458 i‡(
l1
 && (l1 <
c›ybªak
) &&

1459 ((
Àngth
 + 
l1
Ë<
ad≠ãr
->
rx_ps_bsize0
)) {

1460 
u8
 *
vaddr
;

1462 
ps_∑ge
 = &
buf„r_öfo
->
ps_∑ges
[0];

1468 
	`dma_sync_sögÀ_f‹_˝u
(
	`pci_dev_to_dev
(
pdev
),

1469 
ps_∑ge
->
dma
,

1470 
PAGE_SIZE
,

1471 
DMA_FROM_DEVICE
);

1472 
vaddr
 = 
	`km≠_©omic
(
ps_∑ge
->
∑ge
);

1473 
	`mem˝y
(
	`skb_èû_poöãr
(
skb
), 
vaddr
, 
l1
);

1474 
	`kunm≠_©omic
(
vaddr
);

1475 
	`dma_sync_sögÀ_f‹_devi˚
(
	`pci_dev_to_dev
(
pdev
),

1476 
ps_∑ge
->
dma
,

1477 
PAGE_SIZE
,

1478 
DMA_FROM_DEVICE
);

1481 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_CRC_STRIPPING
)) {

1482 i‡(!(
√tdev
->
„©uªs
 & 
NETIF_F_RXFCS
))

1483 
l1
 -= 4;

1486 
	`skb_put
(
skb
, 
l1
);

1487 
c›yd⁄e
;

1492 
j
 = 0; j < 
PS_PAGE_BUFFERS
; j++) {

1493 
Àngth
 = 
	`À16_to_˝u
(
rx_desc
->
wb
.
uµî
.Àngth[
j
]);

1494 i‡(!
Àngth
)

1497 
ps_∑ge
 = &
buf„r_öfo
->
ps_∑ges
[
j
];

1498 
	`dma_unm≠_∑ge
(
	`pci_dev_to_dev
(
pdev
), 
ps_∑ge
->
dma
,

1499 
PAGE_SIZE
, 
DMA_FROM_DEVICE
);

1500 
ps_∑ge
->
dma
 = 0;

1501 
	`skb_fûl_∑ge_desc
(
skb
, 
j
, 
ps_∑ge
->
∑ge
, 0, 
Àngth
);

1502 
ps_∑ge
->
∑ge
 = 
NULL
;

1503 
skb
->
Àn
 +
Àngth
;

1504 
skb
->
d©a_Àn
 +
Àngth
;

1505 
skb
->
åuesize
 +
PAGE_SIZE
;

1511 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_CRC_STRIPPING
)) {

1512 i‡(!(
√tdev
->
„©uªs
 & 
NETIF_F_RXFCS
))

1513 
	`pskb_åim
(
skb
, skb->
Àn
 - 4);

1515 #ifde‡
CONFIG_E1000E_NAPI


1516 
c›yd⁄e
:

1518 
tŸÆ_rx_byãs
 +
skb
->
Àn
;

1519 
tŸÆ_rx_∑ckës
++;

1521 
	`e1000_rx_checksum
(
ad≠ãr
, 
°©îr
, 
skb
);

1523 #ifde‡
NETIF_F_RXHASH


1524 
	`e1000_rx_hash
(
√tdev
, 
rx_desc
->
wb
.
lowî
.
hi_dw‹d
.
rss
, 
skb
);

1527 i‡(
rx_desc
->
wb
.
uµî
.
hódî_°©us
 &

1528 
	`˝u_to_À16
(
E1000_RXDPS_HDRSTAT_HDRSP
))

1529 
ad≠ãr
->
rx_hdr_•lô
++;

1531 
	`e1000_ª˚ive_skb
(
ad≠ãr
, 
√tdev
, 
skb
, 
°©îr
,

1532 
rx_desc
->
wb
.
middÀ
.
vœn
);

1534 
√xt_desc
:

1535 
rx_desc
->
wb
.
middÀ
.
°©us_îr‹
 &
	`˝u_to_À32
(~0xFF);

1536 
buf„r_öfo
->
skb
 = 
NULL
;

1539 i‡(
˛ó√d_cou¡
 >
E1000_RX_BUFFER_WRITE
) {

1540 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
,

1541 
GFP_ATOMIC
);

1542 
˛ó√d_cou¡
 = 0;

1546 
rx_desc
 = 
√xt_rxd
;

1547 
buf„r_öfo
 = 
√xt_buf„r
;

1549 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
middÀ
.
°©us_îr‹
);

1551 
rx_rög
->
√xt_to_˛ón
 = 
i
;

1553 
˛ó√d_cou¡
 = 
	`e1000_desc_unu£d
(
rx_rög
);

1554 i‡(
˛ó√d_cou¡
)

1555 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
, 
GFP_ATOMIC
);

1557 
ad≠ãr
->
tŸÆ_rx_byãs
 +=Åotal_rx_bytes;

1558 
ad≠ãr
->
tŸÆ_rx_∑ckës
 +=Åotal_rx_packets;

1559 #ifde‡
HAVE_NDO_GET_STATS64


1560 #ñi‡
	`deföed
(
HAVE_NETDEV_STATS_IN_NETDEV
)

1561 
√tdev
->
°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1562 
√tdev
->
°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1564 
ad≠ãr
->
√t_°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1565 
ad≠ãr
->
√t_°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1567  
˛ó√d
;

1568 
	}
}

1570 #ifde‡
CONFIG_E1000E_NAPI


1574 
	$e1000_c⁄sume_∑ge
(
e1000_buf„r
 *
bi
, 
sk_buff
 *
skb
,

1575 
u16
 
Àngth
)

1577 
bi
->
∑ge
 = 
NULL
;

1578 
skb
->
Àn
 +
Àngth
;

1579 
skb
->
d©a_Àn
 +
Àngth
;

1580 
skb
->
åuesize
 +
PAGE_SIZE
;

1581 
	}
}

1590 
boﬁ
 
	$e1000_˛ón_jumbo_rx_úq
(
e1000_rög
 *
rx_rög
, *
w‹k_d⁄e
,

1591 
w‹k_to_do
)

1593 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

1594 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

1595 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1596 
e1000_rx_desc_exãnded
 *
rx_desc
, *
√xt_rxd
;

1597 
e1000_buf„r
 *
buf„r_öfo
, *
√xt_buf„r
;

1598 
u32
 
Àngth
, 
°©îr
;

1599 
i
;

1600 
˛ó√d_cou¡
 = 0;

1601 
boﬁ
 
˛ó√d
 = 
Ál£
;

1602 
tŸÆ_rx_byãs
 = 0, 
tŸÆ_rx_∑ckës
 = 0;

1603 
skb_sh¨ed_öfo
 *
shöfo
;

1605 
i
 = 
rx_rög
->
√xt_to_˛ón
;

1606 
rx_desc
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

1607 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
uµî
.
°©us_îr‹
);

1608 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

1610 
°©îr
 & 
E1000_RXD_STAT_DD
) {

1611 
sk_buff
 *
skb
;

1613 i‡(*
w‹k_d⁄e
 >
w‹k_to_do
)

1615 (*
w‹k_d⁄e
)++;

1616 
	`rmb
();

1618 
skb
 = 
buf„r_öfo
->skb;

1619 
buf„r_öfo
->
skb
 = 
NULL
;

1621 ++
i
;

1622 i‡(
i
 =
rx_rög
->
cou¡
)

1623 
i
 = 0;

1624 
√xt_rxd
 = 
	`E1000_RX_DESC_EXT
(*
rx_rög
, 
i
);

1625 
	`¥e„tch
(
√xt_rxd
);

1627 
√xt_buf„r
 = &
rx_rög
->
buf„r_öfo
[
i
];

1629 
˛ó√d
 = 
åue
;

1630 
˛ó√d_cou¡
++;

1631 
	`dma_unm≠_∑ge
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
,

1632 
PAGE_SIZE
, 
DMA_FROM_DEVICE
);

1633 
buf„r_öfo
->
dma
 = 0;

1635 
Àngth
 = 
	`À16_to_˝u
(
rx_desc
->
wb
.
uµî
.length);

1638 i‡(
	`u∆ikñy
((
°©îr
 & 
E1000_RXD_STAT_EOP
) &&

1639 ((
°©îr
 & 
E1000_RXDEXT_ERR_FRAME_ERR_MASK
) &&

1640 !(
√tdev
->
„©uªs
 & 
NETIF_F_RXALL
)))) {

1642 
buf„r_öfo
->
skb
 = skb;

1644 i‡(
rx_rög
->
rx_skb_t›
)

1645 
	`dev_k‰ì_skb_úq
(
rx_rög
->
rx_skb_t›
);

1646 
rx_rög
->
rx_skb_t›
 = 
NULL
;

1647 
√xt_desc
;

1649 
	#rxt›
 (
rx_rög
->
rx_skb_t›
)

	)

1650 i‡(!(
°©îr
 & 
E1000_RXD_STAT_EOP
)) {

1652 i‡(!
rxt›
) {

1654 
rxt›
 = 
skb
;

1655 
	`skb_fûl_∑ge_desc
(
rxt›
, 0, 
buf„r_öfo
->
∑ge
,

1656 0, 
Àngth
);

1659 
shöfo
 = 
	`skb_shöfo
(
rxt›
);

1660 
	`skb_fûl_∑ge_desc
(
rxt›
, 
shöfo
->
ƒ_‰ags
,

1661 
buf„r_öfo
->
∑ge
, 0,

1662 
Àngth
);

1664 
buf„r_öfo
->
skb
 = skb;

1666 
	`e1000_c⁄sume_∑ge
(
buf„r_öfo
, 
rxt›
, 
Àngth
);

1667 
√xt_desc
;

1669 i‡(
rxt›
) {

1671 
shöfo
 = 
	`skb_shöfo
(
rxt›
);

1672 
	`skb_fûl_∑ge_desc
(
rxt›
, 
shöfo
->
ƒ_‰ags
,

1673 
buf„r_öfo
->
∑ge
, 0,

1674 
Àngth
);

1678 
buf„r_öfo
->
skb
 = skb;

1679 
skb
 = 
rxt›
;

1680 
rxt›
 = 
NULL
;

1681 
	`e1000_c⁄sume_∑ge
(
buf„r_öfo
, 
skb
, 
Àngth
);

1686 i‡(
Àngth
 <
c›ybªak
 &&

1687 
	`skb_èûroom
(
skb
Ë>
Àngth
) {

1688 
u8
 *
vaddr
;

1689 
vaddr
 = 
	`km≠_©omic
(
buf„r_öfo
->
∑ge
);

1690 
	`mem˝y
(
	`skb_èû_poöãr
(
skb
), 
vaddr
,

1691 
Àngth
);

1692 
	`kunm≠_©omic
(
vaddr
);

1696 
	`skb_put
(
skb
, 
Àngth
);

1698 
	`skb_fûl_∑ge_desc
(
skb
, 0,

1699 
buf„r_öfo
->
∑ge
, 0,

1700 
Àngth
);

1701 
	`e1000_c⁄sume_∑ge
(
buf„r_öfo
, 
skb
,

1702 
Àngth
);

1708 
	`e1000_rx_checksum
(
ad≠ãr
, 
°©îr
, 
skb
);

1710 #ifde‡
NETIF_F_RXHASH


1711 
	`e1000_rx_hash
(
√tdev
, 
rx_desc
->
wb
.
lowî
.
hi_dw‹d
.
rss
, 
skb
);

1715 
tŸÆ_rx_byãs
 +
skb
->
Àn
;

1716 
tŸÆ_rx_∑ckës
++;

1719 i‡(!
	`pskb_may_puŒ
(
skb
, 
ETH_HLEN
)) {

1720 
	`e_îr
("pskb_may_pull failed.\n");

1721 
	`dev_k‰ì_skb_úq
(
skb
);

1722 
√xt_desc
;

1725 
	`e1000_ª˚ive_skb
(
ad≠ãr
, 
√tdev
, 
skb
, 
°©îr
,

1726 
rx_desc
->
wb
.
uµî
.
vœn
);

1728 
√xt_desc
:

1729 
rx_desc
->
wb
.
uµî
.
°©us_îr‹
 &
	`˝u_to_À32
(~0xFF);

1732 i‡(
	`u∆ikñy
(
˛ó√d_cou¡
 >
E1000_RX_BUFFER_WRITE
)) {

1733 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
,

1734 
GFP_ATOMIC
);

1735 
˛ó√d_cou¡
 = 0;

1739 
rx_desc
 = 
√xt_rxd
;

1740 
buf„r_öfo
 = 
√xt_buf„r
;

1742 
°©îr
 = 
	`À32_to_˝u
(
rx_desc
->
wb
.
uµî
.
°©us_îr‹
);

1744 
rx_rög
->
√xt_to_˛ón
 = 
i
;

1746 
˛ó√d_cou¡
 = 
	`e1000_desc_unu£d
(
rx_rög
);

1747 i‡(
˛ó√d_cou¡
)

1748 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
˛ó√d_cou¡
, 
GFP_ATOMIC
);

1750 
ad≠ãr
->
tŸÆ_rx_byãs
 +=Åotal_rx_bytes;

1751 
ad≠ãr
->
tŸÆ_rx_∑ckës
 +=Åotal_rx_packets;

1752 #ifde‡
HAVE_NDO_GET_STATS64


1753 #ñi‡
	`deföed
(
HAVE_NETDEV_STATS_IN_NETDEV
)

1754 
√tdev
->
°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1755 
√tdev
->
°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1757 
ad≠ãr
->
√t_°©s
.
rx_byãs
 +
tŸÆ_rx_byãs
;

1758 
ad≠ãr
->
√t_°©s
.
rx_∑ckës
 +
tŸÆ_rx_∑ckës
;

1760  
˛ó√d
;

1761 
	}
}

1768 
	$e1000_˛ón_rx_rög
(
e1000_rög
 *
rx_rög
)

1770 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

1771 
e1000_buf„r
 *
buf„r_öfo
;

1772 
e1000_ps_∑ge
 *
ps_∑ge
;

1773 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

1774 
i
, 
j
;

1777 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

1778 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

1779 i‡(
buf„r_öfo
->
dma
) {

1780 i‡(
ad≠ãr
->
˛ón_rx
 =
e1000_˛ón_rx_úq
)

1781 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
),

1782 
buf„r_öfo
->
dma
,

1783 
ad≠ãr
->
rx_buf„r_Àn
,

1784 
DMA_FROM_DEVICE
);

1785 #ifde‡
CONFIG_E1000E_NAPI


1786 i‡(
ad≠ãr
->
˛ón_rx
 =
e1000_˛ón_jumbo_rx_úq
)

1787 
	`dma_unm≠_∑ge
(
	`pci_dev_to_dev
(
pdev
),

1788 
buf„r_öfo
->
dma
, 
PAGE_SIZE
,

1789 
DMA_FROM_DEVICE
);

1791 i‡(
ad≠ãr
->
˛ón_rx
 =
e1000_˛ón_rx_úq_ps
)

1792 
	`dma_unm≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
),

1793 
buf„r_öfo
->
dma
,

1794 
ad≠ãr
->
rx_ps_bsize0
,

1795 
DMA_FROM_DEVICE
);

1796 
buf„r_öfo
->
dma
 = 0;

1799 i‡(
buf„r_öfo
->
∑ge
) {

1800 
	`put_∑ge
(
buf„r_öfo
->
∑ge
);

1801 
buf„r_öfo
->
∑ge
 = 
NULL
;

1804 i‡(
buf„r_öfo
->
skb
) {

1805 
	`dev_k‰ì_skb
(
buf„r_öfo
->
skb
);

1806 
buf„r_öfo
->
skb
 = 
NULL
;

1809 
j
 = 0; j < 
PS_PAGE_BUFFERS
; j++) {

1810 
ps_∑ge
 = &
buf„r_öfo
->
ps_∑ges
[
j
];

1811 i‡(!
ps_∑ge
->
∑ge
)

1813 
	`dma_unm≠_∑ge
(
	`pci_dev_to_dev
(
pdev
), 
ps_∑ge
->
dma
,

1814 
PAGE_SIZE
, 
DMA_FROM_DEVICE
);

1815 
ps_∑ge
->
dma
 = 0;

1816 
	`put_∑ge
(
ps_∑ge
->
∑ge
);

1817 
ps_∑ge
->
∑ge
 = 
NULL
;

1821 #ifde‡
CONFIG_E1000E_NAPI


1823 i‡(
rx_rög
->
rx_skb_t›
) {

1824 
	`dev_k‰ì_skb
(
rx_rög
->
rx_skb_t›
);

1825 
rx_rög
->
rx_skb_t›
 = 
NULL
;

1830 
	`mem£t
(
rx_rög
->
desc
, 0,Ñx_rög->
size
);

1832 
rx_rög
->
√xt_to_˛ón
 = 0;

1833 
rx_rög
->
√xt_to_u£
 = 0;

1834 
ad≠ãr
->
Êags2
 &~
FLAG2_IS_DISCARDING
;

1836 
	`wrôñ
(0, 
rx_rög
->
hód
);

1837 i‡(
rx_rög
->
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

1838 
	`e1000e_upd©e_rdt_wa
(
rx_rög
, 0);

1840 
	`wrôñ
(0, 
rx_rög
->
èû
);

1841 
	}
}

1843 
	$e1000e_downshi·_w‹k¨ound
(
w‹k_°ru˘
 *
w‹k
)

1845 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
,

1846 
e1000_ad≠ãr
,

1847 
downshi·_èsk
);

1849 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

1852 
	`e1000e_gig_downshi·_w‹k¨ound_ich8œn
(&
ad≠ãr
->
hw
);

1853 
	}
}

1855 #i‚de‡
CONFIG_E1000E_NAPI


1856 
e1000_£t_ôr
(
e1000_ad≠ãr
 *
ad≠ãr
);

1863 
úqªtu∫_t
 
	$e1000_öå_msi
(
__Æways_unu£d
 
úq
, *
d©a
)

1865 
√t_devi˚
 *
√tdev
 = 
d©a
;

1866 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1867 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1868 #i‚de‡
CONFIG_E1000E_NAPI


1869 
i
;

1871 
u32
 
i¸
 = 
	`î32
(
ICR
);

1874 i‡(
i¸
 & 
E1000_ICR_LSC
) {

1875 
hw
->
mac
.
gë_lök_°©us
 = 
åue
;

1879 i‡((
ad≠ãr
->
Êags
 & 
FLAG_LSC_GIG_SPEED_DROP
) &&

1880 (!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
)))

1881 
	`scheduÀ_w‹k
(&
ad≠ãr
->
downshi·_èsk
);

1887 i‡(
	`√tif_ˇºõr_ok
(
√tdev
) &&

1888 
ad≠ãr
->
Êags
 & 
FLAG_RX_NEEDS_RESTART
) {

1890 
u32
 
r˘l
 = 
	`î32
(
RCTL
);

1891 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

1892 
ad≠ãr
->
Êags
 |
FLAG_RESTART_NOW
;

1895 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

1896 
	`mod_timî
(&
ad≠ãr
->
w©chdog_timî
, 
jiffõs
 + 1);

1900 i‡((
i¸
 & 
E1000_ICR_ECCER
Ë&& (
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
)) {

1901 
u32
 
pbecc°s
 = 
	`î32
(
PBECCSTS
);

1903 
ad≠ãr
->
c‹r_îr‹s
 +=

1904 
pbecc°s
 & 
E1000_PBECCSTS_CORR_ERR_CNT_MASK
;

1905 
ad≠ãr
->
unc‹r_îr‹s
 +=

1906 (
pbecc°s
 & 
E1000_PBECCSTS_UNCORR_ERR_CNT_MASK
) >>

1907 
E1000_PBECCSTS_UNCORR_ERR_CNT_SHIFT
;

1910 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

1913  
IRQ_HANDLED
;

1915 #ifde‡
CONFIG_E1000E_NAPI


1916 i‡(
	`«pi_scheduÀ_¥ï
(&
ad≠ãr
->
«pi
)) {

1917 
ad≠ãr
->
tŸÆ_tx_byãs
 = 0;

1918 
ad≠ãr
->
tŸÆ_tx_∑ckës
 = 0;

1919 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

1920 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

1921 
	`__«pi_scheduÀ
(&
ad≠ãr
->
«pi
);

1924 
ad≠ãr
->
tŸÆ_tx_byãs
 = 0;

1925 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

1926 
ad≠ãr
->
tŸÆ_tx_∑ckës
 = 0;

1927 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

1929 
i
 = 0; i < 
E1000_MAX_INTR
; i++) {

1930 
rx_˛ó√d
 = 
ad≠ãr
->
	`˛ón_rx
◊d≠ãr->
rx_rög
);

1931 
tx_˛ó√d_com∂ëe
 = 
	`e1000_˛ón_tx_úq
(
ad≠ãr
->
tx_rög
);

1932 i‡(!
rx_˛ó√d
 && 
tx_˛ó√d_com∂ëe
)

1936 i‡(
	`likñy
(
ad≠ãr
->
ôr_£âög
 & 3))

1937 
	`e1000_£t_ôr
(
ad≠ãr
);

1940  
IRQ_HANDLED
;

1941 
	}
}

1948 
úqªtu∫_t
 
	$e1000_öå
(
__Æways_unu£d
 
úq
, *
d©a
)

1950 
√t_devi˚
 *
√tdev
 = 
d©a
;

1951 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

1952 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

1953 #i‚de‡
CONFIG_E1000E_NAPI


1954 
i
;

1955 
rx_˛ó√d
, 
tx_˛ó√d_com∂ëe
;

1957 
u32
 
r˘l
, 
i¸
 = 
	`î32
(
ICR
);

1959 i‡(!
i¸
 || 
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

1960  
IRQ_NONE
;

1962 #ifde‡
CONFIG_E1000E_NAPI


1966 i‡(!(
i¸
 & 
E1000_ICR_INT_ASSERTED
))

1967  
IRQ_NONE
;

1975 i‡(
i¸
 & 
E1000_ICR_LSC
) {

1976 
hw
->
mac
.
gë_lök_°©us
 = 
åue
;

1980 i‡((
ad≠ãr
->
Êags
 & 
FLAG_LSC_GIG_SPEED_DROP
) &&

1981 (!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
)))

1982 
	`scheduÀ_w‹k
(&
ad≠ãr
->
downshi·_èsk
);

1989 i‡(
	`√tif_ˇºõr_ok
(
√tdev
) &&

1990 (
ad≠ãr
->
Êags
 & 
FLAG_RX_NEEDS_RESTART
)) {

1992 
r˘l
 = 
	`î32
(
RCTL
);

1993 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

1994 
ad≠ãr
->
Êags
 |
FLAG_RESTART_NOW
;

1997 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

1998 
	`mod_timî
(&
ad≠ãr
->
w©chdog_timî
, 
jiffõs
 + 1);

2002 i‡((
i¸
 & 
E1000_ICR_ECCER
Ë&& (
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
)) {

2003 
u32
 
pbecc°s
 = 
	`î32
(
PBECCSTS
);

2005 
ad≠ãr
->
c‹r_îr‹s
 +=

2006 
pbecc°s
 & 
E1000_PBECCSTS_CORR_ERR_CNT_MASK
;

2007 
ad≠ãr
->
unc‹r_îr‹s
 +=

2008 (
pbecc°s
 & 
E1000_PBECCSTS_UNCORR_ERR_CNT_MASK
) >>

2009 
E1000_PBECCSTS_UNCORR_ERR_CNT_SHIFT
;

2012 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

2015  
IRQ_HANDLED
;

2017 #ifde‡
CONFIG_E1000E_NAPI


2018 i‡(
	`«pi_scheduÀ_¥ï
(&
ad≠ãr
->
«pi
)) {

2019 
ad≠ãr
->
tŸÆ_tx_byãs
 = 0;

2020 
ad≠ãr
->
tŸÆ_tx_∑ckës
 = 0;

2021 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

2022 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

2023 
	`__«pi_scheduÀ
(&
ad≠ãr
->
«pi
);

2026 
ad≠ãr
->
tŸÆ_tx_byãs
 = 0;

2027 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

2028 
ad≠ãr
->
tŸÆ_tx_∑ckës
 = 0;

2029 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

2031 
i
 = 0; i < 
E1000_MAX_INTR
; i++) {

2032 
rx_˛ó√d
 = 
ad≠ãr
->
	`˛ón_rx
◊d≠ãr->
rx_rög
);

2033 
tx_˛ó√d_com∂ëe
 = 
	`e1000_˛ón_tx_úq
(
ad≠ãr
->
tx_rög
);

2034 i‡(!
rx_˛ó√d
 && 
tx_˛ó√d_com∂ëe
)

2038 i‡(
	`likñy
(
ad≠ãr
->
ôr_£âög
 & 3))

2039 
	`e1000_£t_ôr
(
ad≠ãr
);

2042  
IRQ_HANDLED
;

2043 
	}
}

2045 
úqªtu∫_t
 
	$e1000_msix_Ÿhî
(
__Æways_unu£d
 
úq
, *
d©a
)

2047 
√t_devi˚
 *
√tdev
 = 
d©a
;

2048 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2049 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2050 
u32
 
i¸
 = 
	`î32
(
ICR
);

2052 i‡(!(
i¸
 & 
E1000_ICR_INT_ASSERTED
)) {

2053 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

2054 
	`ew32
(
IMS
, 
E1000_IMS_OTHER
);

2055  
IRQ_NONE
;

2058 i‡(
i¸
 & 
ad≠ãr
->
eüc_mask
)

2059 
	`ew32
(
ICS
, (
i¸
 & 
ad≠ãr
->
eüc_mask
));

2061 i‡(
i¸
 & 
E1000_ICR_OTHER
) {

2062 i‡(!(
i¸
 & 
E1000_ICR_LSC
))

2063 
no_lök_öãºu±
;

2064 
hw
->
mac
.
gë_lök_°©us
 = 
åue
;

2066 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

2067 
	`mod_timî
(&
ad≠ãr
->
w©chdog_timî
, 
jiffõs
 + 1);

2070 
no_lök_öãºu±
:

2071 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

2072 
	`ew32
(
IMS
, 
E1000_IMS_LSC
 | 
E1000_IMS_OTHER
);

2074  
IRQ_HANDLED
;

2075 
	}
}

2077 
úqªtu∫_t
 
	$e1000_öå_msix_tx
(
__Æways_unu£d
 
úq
, *
d©a
)

2079 
√t_devi˚
 *
√tdev
 = 
d©a
;

2080 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2081 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2082 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

2084 
ad≠ãr
->
tŸÆ_tx_byãs
 = 0;

2085 
ad≠ãr
->
tŸÆ_tx_∑ckës
 = 0;

2087 i‡(!
	`e1000_˛ón_tx_úq
(
tx_rög
))

2089 
	`ew32
(
ICS
, 
tx_rög
->
ims_vÆ
);

2091  
IRQ_HANDLED
;

2092 
	}
}

2094 
úqªtu∫_t
 
	$e1000_öå_msix_rx
(
__Æways_unu£d
 
úq
, *
d©a
)

2096 
√t_devi˚
 *
√tdev
 = 
d©a
;

2097 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2098 
e1000_rög
 *
rx_rög
 = 
ad≠ãr
->rx_ring;

2099 #i‚de‡
CONFIG_E1000E_NAPI


2100 
i
;

2101 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2107 i‡(
rx_rög
->
£t_ôr
) {

2108 
	`wrôñ
(1000000000 / (
rx_rög
->
ôr_vÆ
 * 256),

2109 
rx_rög
->
ôr_ªgi°î
);

2110 
rx_rög
->
£t_ôr
 = 0;

2112 #ifde‡
CONFIG_E1000E_NAPI


2113 i‡(
	`«pi_scheduÀ_¥ï
(&
ad≠ãr
->
«pi
)) {

2114 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

2115 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

2116 
	`__«pi_scheduÀ
(&
ad≠ãr
->
«pi
);

2119 
ad≠ãr
->
tŸÆ_rx_byãs
 = 0;

2120 
ad≠ãr
->
tŸÆ_rx_∑ckës
 = 0;

2122 
i
 = 0; i < 
E1000_MAX_INTR
; i++) {

2123 
rx_˛ó√d
 = 
ad≠ãr
->
	`˛ón_rx
(
rx_rög
);

2124 i‡(!
rx_˛ó√d
)

2125 
out
;

2130 
	`ew32
(
ICS
, 
rx_rög
->
ims_vÆ
);

2132 
out
:

2134  
IRQ_HANDLED
;

2135 
	}
}

2143 
	$e1000_c⁄figuª_msix
(
e1000_ad≠ãr
 *
ad≠ãr
)

2145 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2146 
e1000_rög
 *
rx_rög
 = 
ad≠ãr
->rx_ring;

2147 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

2148 
ve˘‹
 = 0;

2149 
u32
 
˘æ_ext
, 
iv¨
 = 0;

2151 
ad≠ãr
->
eüc_mask
 = 0;

2154 i‡(
hw
->
mac
.
ty≥
 =
e1000_82574
) {

2155 
u32
 
rf˘l
 = 
	`î32
(
RFCTL
);

2156 
rf˘l
 |
E1000_RFCTL_ACK_DIS
;

2157 
	`ew32
(
RFCTL
, 
rf˘l
);

2161 
rx_rög
->
ims_vÆ
 = 
E1000_IMS_RXQ0
;

2162 
ad≠ãr
->
eüc_mask
 |
rx_rög
->
ims_vÆ
;

2163 i‡(
rx_rög
->
ôr_vÆ
)

2164 
	`wrôñ
(1000000000 / (
rx_rög
->
ôr_vÆ
 * 256),

2165 
rx_rög
->
ôr_ªgi°î
);

2167 
	`wrôñ
(1, 
rx_rög
->
ôr_ªgi°î
);

2168 
iv¨
 = 
E1000_IVAR_INT_ALLOC_VALID
 | 
ve˘‹
;

2171 
tx_rög
->
ims_vÆ
 = 
E1000_IMS_TXQ0
;

2172 
ve˘‹
++;

2173 i‡(
tx_rög
->
ôr_vÆ
)

2174 
	`wrôñ
(1000000000 / (
tx_rög
->
ôr_vÆ
 * 256),

2175 
tx_rög
->
ôr_ªgi°î
);

2177 
	`wrôñ
(1, 
tx_rög
->
ôr_ªgi°î
);

2178 
ad≠ãr
->
eüc_mask
 |
tx_rög
->
ims_vÆ
;

2179 
iv¨
 |((
E1000_IVAR_INT_ALLOC_VALID
 | 
ve˘‹
) << 8);

2182 
ve˘‹
++;

2183 
iv¨
 |((
E1000_IVAR_INT_ALLOC_VALID
 | 
ve˘‹
) << 16);

2184 i‡(
rx_rög
->
ôr_vÆ
)

2185 
	`wrôñ
(1000000000 / (
rx_rög
->
ôr_vÆ
 * 256),

2186 
hw
->
hw_addr
 + 
	`E1000_EITR_82574
(
ve˘‹
));

2188 
	`wrôñ
(1, 
hw
->
hw_addr
 + 
	`E1000_EITR_82574
(
ve˘‹
));

2191 
iv¨
 |= (1 << 31);

2193 
	`ew32
(
IVAR
, 
iv¨
);

2196 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

2197 
˘æ_ext
 |
E1000_CTRL_EXT_PBA_CLR
;

2200 
	`ew32
(
IAM
, ~
E1000_EIAC_MASK_82574
 | 
E1000_IMS_OTHER
);

2201 
˘æ_ext
 |
E1000_CTRL_EXT_EIAME
;

2202 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

2203 
	`e1e_Êush
();

2204 
	}
}

2206 
	$e1000e_ª£t_öãºu±_ˇ∑bûôy
(
e1000_ad≠ãr
 *
ad≠ãr
)

2208 i‡(
ad≠ãr
->
msix_íåõs
) {

2209 
	`pci_dißbÀ_msix
(
ad≠ãr
->
pdev
);

2210 
	`k‰ì
(
ad≠ãr
->
msix_íåõs
);

2211 
ad≠ãr
->
msix_íåõs
 = 
NULL
;

2212 } i‡(
ad≠ãr
->
Êags
 & 
FLAG_MSI_ENABLED
) {

2213 
	`pci_dißbÀ_msi
(
ad≠ãr
->
pdev
);

2214 
ad≠ãr
->
Êags
 &~
FLAG_MSI_ENABLED
;

2216 
	}
}

2224 
	$e1000e_£t_öãºu±_ˇ∑bûôy
(
e1000_ad≠ãr
 *
ad≠ãr
)

2226 
îr
;

2227 
i
;

2229 
ad≠ãr
->
öt_mode
) {

2230 
E1000E_INT_MODE_MSIX
:

2231 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_MSIX
) {

2232 
ad≠ãr
->
num_ve˘‹s
 = 3;

2233 
ad≠ãr
->
msix_íåõs
 =

2234 
	`kzÆloc_node
(
ad≠ãr
->
num_ve˘‹s
 *

2235 (
msix_íåy
), 
GFP_KERNEL
,

2236 
ad≠ãr
->
node
);

2237 i‡(
ad≠ãr
->
msix_íåõs
) {

2238 
i
 = 0; i < 
ad≠ãr
->
num_ve˘‹s
; i++)

2239 
ad≠ãr
->
msix_íåõs
[
i
].
íåy
 = i;

2241 
îr
 = 
	`pci_íabÀ_msix
(
ad≠ãr
->
pdev
,

2242 
ad≠ãr
->
msix_íåõs
,

2243 
ad≠ãr
->
num_ve˘‹s
);

2244 i‡(
îr
 == 0)

2248 
	`e_îr
("FailedÅo initialize MSI-X interrupts. Falling backÅo MSI interrupts.\n");

2249 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

2251 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_MSI
;

2253 
E1000E_INT_MODE_MSI
:

2254 i‡(!
	`pci_íabÀ_msi
(
ad≠ãr
->
pdev
)) {

2255 
ad≠ãr
->
Êags
 |
FLAG_MSI_ENABLED
;

2257 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_LEGACY
;

2258 
	`e_îr
("FailedÅo initialize MSI interrupts. Falling backÅoÜegacy interrupts.\n");

2261 
E1000E_INT_MODE_LEGACY
:

2267 
ad≠ãr
->
num_ve˘‹s
 = 1;

2268 
	}
}

2276 
	$e1000_ªque°_msix
(
e1000_ad≠ãr
 *
ad≠ãr
)

2278 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

2279 
îr
 = 0, 
ve˘‹
 = 0;

2281 i‡(
	`°æí
(
√tdev
->
«me
Ë< (
IFNAMSIZ
 - 5))

2282 
	`¢¥ötf
(
ad≠ãr
->
rx_rög
->
«me
,

2283 (
ad≠ãr
->
rx_rög
->
«me
) - 1,

2284 "%s-rx-0", 
√tdev
->
«me
);

2286 
	`mem˝y
(
ad≠ãr
->
rx_rög
->
«me
, 
√tdev
->«me, 
IFNAMSIZ
);

2287 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector,

2288 
e1000_öå_msix_rx
, 0, 
ad≠ãr
->
rx_rög
->
«me
,

2289 
√tdev
);

2290 i‡(
îr
)

2291  
îr
;

2292 
ad≠ãr
->
rx_rög
->
ôr_ªgi°î
 =ád≠ãr->
hw
.
hw_addr
 +

2293 
	`E1000_EITR_82574
(
ve˘‹
);

2294 
ad≠ãr
->
rx_rög
->
ôr_vÆ
 =ád≠ãr->
ôr
;

2295 
ve˘‹
++;

2297 i‡(
	`°æí
(
√tdev
->
«me
Ë< (
IFNAMSIZ
 - 5))

2298 
	`¢¥ötf
(
ad≠ãr
->
tx_rög
->
«me
,

2299 (
ad≠ãr
->
tx_rög
->
«me
) - 1,

2300 "%s-tx-0", 
√tdev
->
«me
);

2302 
	`mem˝y
(
ad≠ãr
->
tx_rög
->
«me
, 
√tdev
->«me, 
IFNAMSIZ
);

2303 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector,

2304 
e1000_öå_msix_tx
, 0, 
ad≠ãr
->
tx_rög
->
«me
,

2305 
√tdev
);

2306 i‡(
îr
)

2307  
îr
;

2308 
ad≠ãr
->
tx_rög
->
ôr_ªgi°î
 =ád≠ãr->
hw
.
hw_addr
 +

2309 
	`E1000_EITR_82574
(
ve˘‹
);

2310 
ad≠ãr
->
tx_rög
->
ôr_vÆ
 =ád≠ãr->
ôr
;

2311 
ve˘‹
++;

2313 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector,

2314 
e1000_msix_Ÿhî
, 0, 
√tdev
->
«me
,Çetdev);

2315 i‡(
îr
)

2316  
îr
;

2318 
	`e1000_c⁄figuª_msix
(
ad≠ãr
);

2321 
	}
}

2329 
	$e1000_ªque°_úq
(
e1000_ad≠ãr
 *
ad≠ãr
)

2331 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

2332 
îr
;

2334 i‡(
ad≠ãr
->
msix_íåõs
) {

2335 
îr
 = 
	`e1000_ªque°_msix
(
ad≠ãr
);

2336 i‡(!
îr
)

2337  
îr
;

2339 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

2340 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_MSI
;

2341 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

2343 i‡(
ad≠ãr
->
Êags
 & 
FLAG_MSI_ENABLED
) {

2344 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
pdev
->
úq
, 
e1000_öå_msi
, 0,

2345 
√tdev
->
«me
,Çetdev);

2346 i‡(!
îr
)

2347  
îr
;

2350 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

2351 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_LEGACY
;

2354 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
pdev
->
úq
, 
e1000_öå
, 
IRQF_SHARED
,

2355 
√tdev
->
«me
,Çetdev);

2356 i‡(
îr
)

2357 
	`e_îr
("U«bÀÅÿÆloˇã i¡îru±, Eº‹: %d\n", 
îr
);

2359  
îr
;

2360 
	}
}

2362 
	$e1000_‰ì_úq
(
e1000_ad≠ãr
 *
ad≠ãr
)

2364 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

2366 i‡(
ad≠ãr
->
msix_íåõs
) {

2367 
ve˘‹
 = 0;

2369 
	`‰ì_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].ve˘‹, 
√tdev
);

2370 
ve˘‹
++;

2372 
	`‰ì_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].ve˘‹, 
√tdev
);

2373 
ve˘‹
++;

2376 
	`‰ì_úq
(
ad≠ãr
->
msix_íåõs
[
ve˘‹
].ve˘‹, 
√tdev
);

2380 
	`‰ì_úq
(
ad≠ãr
->
pdev
->
úq
, 
√tdev
);

2381 
	}
}

2386 
	$e1000_úq_dißbÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

2388 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2390 
	`ew32
(
IMC
, ~0);

2391 i‡(
ad≠ãr
->
msix_íåõs
)

2392 
	`ew32
(
EIAC_82574
, 0);

2393 
	`e1e_Êush
();

2395 i‡(
ad≠ãr
->
msix_íåõs
) {

2396 
i
;

2397 
i
 = 0; i < 
ad≠ãr
->
num_ve˘‹s
; i++)

2398 
	`synchr⁄ize_úq
(
ad≠ãr
->
msix_íåõs
[
i
].
ve˘‹
);

2400 
	`synchr⁄ize_úq
(
ad≠ãr
->
pdev
->
úq
);

2402 
	}
}

2407 
	$e1000_úq_íabÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

2409 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2411 i‡(
ad≠ãr
->
msix_íåõs
) {

2412 
	`ew32
(
EIAC_82574
, 
ad≠ãr
->
eüc_mask
 & 
E1000_EIAC_MASK_82574
);

2413 
	`ew32
(
IMS
, 
ad≠ãr
->
eüc_mask
 | 
E1000_IMS_OTHER
 | 
E1000_IMS_LSC
);

2414 } i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

2415 
	`ew32
(
IMS
, 
IMS_ENABLE_MASK
 | 
E1000_IMS_ECCER
);

2417 
	`ew32
(
IMS
, 
IMS_ENABLE_MASK
);

2419 
	`e1e_Êush
();

2420 
	}
}

2431 
	$e1000e_gë_hw_c⁄åﬁ
(
e1000_ad≠ãr
 *
ad≠ãr
)

2433 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2434 
u32
 
˘æ_ext
;

2435 
u32
 
swsm
;

2438 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_SWSM_ON_LOAD
) {

2439 
swsm
 = 
	`î32
(
SWSM
);

2440 
	`ew32
(
SWSM
, 
swsm
 | 
E1000_SWSM_DRV_LOAD
);

2441 } i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_CTRLEXT_ON_LOAD
) {

2442 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

2443 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
 | 
E1000_CTRL_EXT_DRV_LOAD
);

2445 
	}
}

2457 
	$e1000e_ªÀa£_hw_c⁄åﬁ
(
e1000_ad≠ãr
 *
ad≠ãr
)

2459 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2460 
u32
 
˘æ_ext
;

2461 
u32
 
swsm
;

2464 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_SWSM_ON_LOAD
) {

2465 
swsm
 = 
	`î32
(
SWSM
);

2466 
	`ew32
(
SWSM
, 
swsm
 & ~
E1000_SWSM_DRV_LOAD
);

2467 } i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_CTRLEXT_ON_LOAD
) {

2468 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

2469 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
 & ~
E1000_CTRL_EXT_DRV_LOAD
);

2471 
	}
}

2476 
	$e1000_Æloc_rög_dma
(
e1000_ad≠ãr
 *
ad≠ãr
,

2477 
e1000_rög
 *
rög
)

2479 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

2480 
ﬁd_node
 = 
	`dev_to_node
(
	`pci_dev_to_dev
(
pdev
));

2481 
ªtvÆ
 = 0;

2486 i‡(
ad≠ãr
->
node
 != -1)

2487 
	`£t_dev_node
(
	`pci_dev_to_dev
(
pdev
), 
ad≠ãr
->
node
);

2488 
rög
->
desc
 =

2489 
	`dma_Æloc_cohîít
(
	`pci_dev_to_dev
(
pdev
), 
rög
->
size
, &rög->
dma
,

2490 
GFP_KERNEL
);

2491 i‡(!
rög
->
desc
)

2492 
ªtvÆ
 = -
ENOMEM
;

2494 i‡(
ad≠ãr
->
node
 != -1)

2495 
	`£t_dev_node
(
	`pci_dev_to_dev
(
pdev
), 
ﬁd_node
);

2496  
ªtvÆ
;

2497 
	}
}

2505 
	$e1000e_£tup_tx_ªsour˚s
(
e1000_rög
 *
tx_rög
)

2507 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

2508 
îr
 = -
ENOMEM
, 
size
;

2510 
size
 = (
e1000_buf„r
Ë* 
tx_rög
->
cou¡
;

2511 
tx_rög
->
buf„r_öfo
 = 
	`vzÆloc_node
(
size
, 
ad≠ãr
->
node
);

2512 i‡(!
tx_rög
->
buf„r_öfo
)

2513 
îr
;

2516 
tx_rög
->
size
 =Åx_rög->
cou¡
 * (
e1000_tx_desc
);

2517 
tx_rög
->
size
 = 
	`ALIGN
(tx_ring->size, 4096);

2519 
îr
 = 
	`e1000_Æloc_rög_dma
(
ad≠ãr
, 
tx_rög
);

2520 i‡(
îr
)

2521 
îr
;

2523 
tx_rög
->
√xt_to_u£
 = 0;

2524 
tx_rög
->
√xt_to_˛ón
 = 0;

2527 
îr
:

2528 
	`v‰ì
(
tx_rög
->
buf„r_öfo
);

2529 
	`e_îr
("UnableÅoállocate memory forÅheÅransmit descriptorÑing\n");

2530  
îr
;

2531 
	}
}

2539 
	$e1000e_£tup_rx_ªsour˚s
(
e1000_rög
 *
rx_rög
)

2541 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

2542 
e1000_buf„r
 *
buf„r_öfo
;

2543 
i
, 
size
, 
desc_Àn
, 
îr
 = -
ENOMEM
;

2545 
size
 = (
e1000_buf„r
Ë* 
rx_rög
->
cou¡
;

2546 
rx_rög
->
buf„r_öfo
 = 
	`vzÆloc_node
(
size
, 
ad≠ãr
->
node
);

2547 i‡(!
rx_rög
->
buf„r_öfo
)

2548 
îr
;

2550 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

2551 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

2552 
buf„r_öfo
->
ps_∑ges
 = 
	`kzÆloc_node
(
PS_PAGE_BUFFERS
 *

2554 
e1000_ps_∑ge
),

2555 
GFP_KERNEL
, 
ad≠ãr
->
node
);

2556 i‡(!
buf„r_öfo
->
ps_∑ges
)

2557 
îr_∑ges
;

2560 
desc_Àn
 = (
e1000_rx_desc_∑ckë_•lô
);

2563 
rx_rög
->
size
 =Ñx_rög->
cou¡
 * 
desc_Àn
;

2564 
rx_rög
->
size
 = 
	`ALIGN
(rx_ring->size, 4096);

2566 
îr
 = 
	`e1000_Æloc_rög_dma
(
ad≠ãr
, 
rx_rög
);

2567 i‡(
îr
)

2568 
îr_∑ges
;

2570 
rx_rög
->
√xt_to_˛ón
 = 0;

2571 
rx_rög
->
√xt_to_u£
 = 0;

2572 
rx_rög
->
rx_skb_t›
 = 
NULL
;

2576 
îr_∑ges
:

2577 
i
 = 0; i < 
rx_rög
->
cou¡
; i++) {

2578 
buf„r_öfo
 = &
rx_rög
->buf„r_öfo[
i
];

2579 
	`k‰ì
(
buf„r_öfo
->
ps_∑ges
);

2581 
îr
:

2582 
	`v‰ì
(
rx_rög
->
buf„r_öfo
);

2583 
	`e_îr
("UnableÅoállocate memory forÅheÑeceive descriptorÑing\n");

2584  
îr
;

2585 
	}
}

2591 
	$e1000_˛ón_tx_rög
(
e1000_rög
 *
tx_rög
)

2593 #ifde‡
CONFIG_BQL


2594 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

2596 
e1000_buf„r
 *
buf„r_öfo
;

2597 
size
;

2598 
i
;

2600 
i
 = 0; i < 
tx_rög
->
cou¡
; i++) {

2601 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

2602 
	`e1000_put_txbuf
(
tx_rög
, 
buf„r_öfo
);

2605 
	`√tdev_ª£t_queue
(
ad≠ãr
->
√tdev
);

2606 
size
 = (
e1000_buf„r
Ë* 
tx_rög
->
cou¡
;

2607 
	`mem£t
(
tx_rög
->
buf„r_öfo
, 0, 
size
);

2609 
	`mem£t
(
tx_rög
->
desc
, 0,Åx_rög->
size
);

2611 
tx_rög
->
√xt_to_u£
 = 0;

2612 
tx_rög
->
√xt_to_˛ón
 = 0;

2614 
	`wrôñ
(0, 
tx_rög
->
hód
);

2615 i‡(
tx_rög
->
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

2616 
	`e1000e_upd©e_tdt_wa
(
tx_rög
, 0);

2618 
	`wrôñ
(0, 
tx_rög
->
èû
);

2619 
	}
}

2627 
	$e1000e_‰ì_tx_ªsour˚s
(
e1000_rög
 *
tx_rög
)

2629 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

2630 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

2632 
	`e1000_˛ón_tx_rög
(
tx_rög
);

2634 
	`v‰ì
(
tx_rög
->
buf„r_öfo
);

2635 
tx_rög
->
buf„r_öfo
 = 
NULL
;

2637 
	`dma_‰ì_cohîít
(
	`pci_dev_to_dev
(
pdev
), 
tx_rög
->
size
,Åx_rög->
desc
,

2638 
tx_rög
->
dma
);

2639 
tx_rög
->
desc
 = 
NULL
;

2640 
	}
}

2648 
	$e1000e_‰ì_rx_ªsour˚s
(
e1000_rög
 *
rx_rög
)

2650 
e1000_ad≠ãr
 *
ad≠ãr
 = 
rx_rög
->adapter;

2651 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

2652 
i
;

2654 
	`e1000_˛ón_rx_rög
(
rx_rög
);

2656 
i
 = 0; i < 
rx_rög
->
cou¡
; i++)

2657 
	`k‰ì
(
rx_rög
->
buf„r_öfo
[
i
].
ps_∑ges
);

2659 
	`v‰ì
(
rx_rög
->
buf„r_öfo
);

2660 
rx_rög
->
buf„r_öfo
 = 
NULL
;

2662 
	`dma_‰ì_cohîít
(
	`pci_dev_to_dev
(
pdev
), 
rx_rög
->
size
,Ñx_rög->
desc
,

2663 
rx_rög
->
dma
);

2664 
rx_rög
->
desc
 = 
NULL
;

2665 
	}
}

2683 
	$e1000_upd©e_ôr
(
u16
 
ôr_£âög
, 
∑ckës
, 
byãs
)

2685 
ªtvÆ
 = 
ôr_£âög
;

2687 i‡(
∑ckës
 == 0)

2688  
ôr_£âög
;

2690 
ôr_£âög
) {

2691 
lowe°_œãncy
:

2693 i‡(
byãs
 / 
∑ckës
 > 8000)

2694 
ªtvÆ
 = 
bulk_œãncy
;

2695 i‡((
∑ckës
 < 5Ë&& (
byãs
 > 512))

2696 
ªtvÆ
 = 
low_œãncy
;

2698 
low_œãncy
:

2699 i‡(
byãs
 > 10000) {

2701 i‡(
byãs
 / 
∑ckës
 > 8000)

2702 
ªtvÆ
 = 
bulk_œãncy
;

2703 i‡((
∑ckës
 < 10Ë|| ((
byãs
 /Öackets) > 1200))

2704 
ªtvÆ
 = 
bulk_œãncy
;

2705 i‡((
∑ckës
 > 35))

2706 
ªtvÆ
 = 
lowe°_œãncy
;

2707 } i‡(
byãs
 / 
∑ckës
 > 2000) {

2708 
ªtvÆ
 = 
bulk_œãncy
;

2709 } i‡(
∑ckës
 <2 && 
byãs
 < 512) {

2710 
ªtvÆ
 = 
lowe°_œãncy
;

2713 
bulk_œãncy
:

2714 i‡(
byãs
 > 25000) {

2715 i‡(
∑ckës
 > 35)

2716 
ªtvÆ
 = 
low_œãncy
;

2717 } i‡(
byãs
 < 6000) {

2718 
ªtvÆ
 = 
low_œãncy
;

2723  
ªtvÆ
;

2724 
	}
}

2726 
	$e1000_£t_ôr
(
e1000_ad≠ãr
 *
ad≠ãr
)

2728 
u16
 
cuºít_ôr
;

2729 
u32
 
√w_ôr
 = 
ad≠ãr
->
ôr
;

2732 i‡(
ad≠ãr
->
lök_•ìd
 !
SPEED_1000
) {

2733 
cuºít_ôr
 = 0;

2734 
√w_ôr
 = 4000;

2735 
£t_ôr_now
;

2738 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_AIM
) {

2739 
√w_ôr
 = 0;

2740 
£t_ôr_now
;

2743 
ad≠ãr
->
tx_ôr
 = 
	`e1000_upd©e_ôr
(adapter->tx_itr,

2744 
ad≠ãr
->
tŸÆ_tx_∑ckës
,

2745 
ad≠ãr
->
tŸÆ_tx_byãs
);

2747 i‡(
ad≠ãr
->
ôr_£âög
 =3 &&ád≠ãr->
tx_ôr
 =
lowe°_œãncy
)

2748 
ad≠ãr
->
tx_ôr
 = 
low_œãncy
;

2750 
ad≠ãr
->
rx_ôr
 = 
	`e1000_upd©e_ôr
(adapter->rx_itr,

2751 
ad≠ãr
->
tŸÆ_rx_∑ckës
,

2752 
ad≠ãr
->
tŸÆ_rx_byãs
);

2754 i‡(
ad≠ãr
->
ôr_£âög
 =3 &&ád≠ãr->
rx_ôr
 =
lowe°_œãncy
)

2755 
ad≠ãr
->
rx_ôr
 = 
low_œãncy
;

2757 
cuºít_ôr
 = 
	`max
(
ad≠ãr
->
rx_ôr
,ád≠ãr->
tx_ôr
);

2760 
cuºít_ôr
) {

2761 
lowe°_œãncy
:

2762 
√w_ôr
 = 70000;

2764 
low_œãncy
:

2765 
√w_ôr
 = 20000;

2767 
bulk_œãncy
:

2768 
√w_ôr
 = 4000;

2774 
£t_ôr_now
:

2775 i‡(
√w_ôr
 !
ad≠ãr
->
ôr
) {

2780 
√w_ôr
 =Çew_ô∏> 
ad≠ãr
->
ôr
 ?

2781 
	`mö
(
ad≠ãr
->
ôr
 + (
√w_ôr
 >> 2),Çew_itr) :Çew_itr;

2782 
ad≠ãr
->
ôr
 = 
√w_ôr
;

2783 
ad≠ãr
->
rx_rög
->
ôr_vÆ
 = 
√w_ôr
;

2784 i‡(
ad≠ãr
->
msix_íåõs
)

2785 
ad≠ãr
->
rx_rög
->
£t_ôr
 = 1;

2787 
	`e1000e_wrôe_ôr
(
ad≠ãr
, 
√w_ôr
);

2789 
	}
}

2800 
	$e1000e_wrôe_ôr
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
ôr
)

2802 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2803 
u32
 
√w_ôr
 = 
ôr
 ? 1000000000 / (itr * 256) : 0;

2805 i‡(
ad≠ãr
->
msix_íåõs
) {

2806 
ve˘‹
;

2808 
ve˘‹
 = 0; ve˘‹ < 
ad≠ãr
->
num_ve˘‹s
; vector++)

2809 
	`wrôñ
(
√w_ôr
, 
hw
->
hw_addr
 + 
	`E1000_EITR_82574
(
ve˘‹
));

2811 
	`ew32
(
ITR
, 
√w_ôr
);

2813 
	}
}

2819 #ifde‡
HAVE_CONFIG_HOTPLUG


2820 
__devöô
 
	$e1000_Æloc_queues
(
e1000_ad≠ãr
 *
ad≠ãr
)

2822 
	$e1000_Æloc_queues
(
e1000_ad≠ãr
 *
ad≠ãr
)

2825 
size
 = (
e1000_rög
);

2827 
ad≠ãr
->
tx_rög
 = 
	`kzÆloc_node
(
size
, 
GFP_KERNEL
,ád≠ãr->
node
);

2828 i‡(!
ad≠ãr
->
tx_rög
)

2829 
îr
;

2830 
ad≠ãr
->
tx_rög
->
cou¡
 =ád≠ãr->
tx_rög_cou¡
;

2831 
ad≠ãr
->
tx_rög
->adapter =ádapter;

2833 
ad≠ãr
->
rx_rög
 = 
	`kzÆloc_node
(
size
, 
GFP_KERNEL
,ád≠ãr->
node
);

2834 i‡(!
ad≠ãr
->
rx_rög
)

2835 
îr
;

2836 
ad≠ãr
->
rx_rög
->
cou¡
 =ád≠ãr->
rx_rög_cou¡
;

2837 
ad≠ãr
->
rx_rög
->adapter =ádapter;

2840 
îr
:

2841 
	`e_îr
("UnableÅoállocate memory for queues\n");

2842 
	`k‰ì
(
ad≠ãr
->
rx_rög
);

2843 
	`k‰ì
(
ad≠ãr
->
tx_rög
);

2844  -
ENOMEM
;

2845 
	}
}

2847 #ifde‡
CONFIG_E1000E_NAPI


2853 
	$e1000e_pﬁl
(
«pi_°ru˘
 *
«pi
, 
weight
)

2855 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
«pi
, e1000_adapter,

2856 
«pi
);

2857 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2858 
√t_devi˚
 *
pﬁl_dev
 = 
ad≠ãr
->
√tdev
;

2859 
tx_˛ó√d
 = 1, 
w‹k_d⁄e
 = 0;

2861 
ad≠ãr
 = 
	`√tdev_¥iv
(
pﬁl_dev
);

2863 i‡(!
ad≠ãr
->
msix_íåõs
 ||

2864 (
ad≠ãr
->
rx_rög
->
ims_vÆ
 &ád≠ãr->
tx_rög
->ims_val))

2865 
tx_˛ó√d
 = 
	`e1000_˛ón_tx_úq
(
ad≠ãr
->
tx_rög
);

2867 
ad≠ãr
->
	`˛ón_rx
◊d≠ãr->
rx_rög
, &
w‹k_d⁄e
, 
weight
);

2869 i‡(!
tx_˛ó√d
)

2870 
w‹k_d⁄e
 = 
weight
;

2872 #i‚de‡
HAVE_NETDEV_NAPI_LIST


2874 i‡(!
	`√tif_ru¬ög
(
ad≠ãr
->
√tdev
))

2875 
w‹k_d⁄e
 = 0;

2879 i‡(
w‹k_d⁄e
 < 
weight
) {

2880 i‡(
ad≠ãr
->
ôr_£âög
 & 3)

2881 
	`e1000_£t_ôr
(
ad≠ãr
);

2882 
	`«pi_com∂ëe
(
«pi
);

2883 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
)) {

2884 i‡(
ad≠ãr
->
msix_íåõs
)

2885 
	`ew32
(
IMS
, 
ad≠ãr
->
rx_rög
->
ims_vÆ
);

2887 
	`e1000_úq_íabÀ
(
ad≠ãr
);

2891  
w‹k_d⁄e
;

2892 
	}
}

2895 #i‡
deföed
(
NETIF_F_HW_VLAN_RX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_RX
)

2896 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


2897 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


2898 
	$e1000_vœn_rx_add_vid
(
√t_devi˚
 *
√tdev
,

2899 
__Æways_unu£d
 
__be16
 
¥Ÿo
, 
u16
 
vid
)

2901 
	$e1000_vœn_rx_add_vid
(
√t_devi˚
 *
√tdev
, 
u16
 
vid
)

2904 
	$e1000_vœn_rx_add_vid
(
√t_devi˚
 *
√tdev
, 
u16
 
vid
)

2907 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2908 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2909 
u32
 
v·a
, 
ödex
;

2912 i‡((
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 &

2913 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
) &&

2914 (
vid
 =
ad≠ãr
->
mng_vœn_id
))

2915 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


2922 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

2923 
ödex
 = (
vid
 >> 5) & 0x7F;

2924 
v·a
 = 
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_VFTA
, 
ödex
);

2925 
v·a
 |(1 << (
vid
 & 0x1F));

2926 
hw
->
mac
.
›s
.
	`wrôe_v·a
(hw, 
ödex
, 
v·a
);

2928 #i‚de‡
HAVE_NETDEV_VLAN_FEATURES


2933 i‡(
ad≠ãr
->
vlgΩ
) {

2934 
vœn_group
 *
vlgΩ
 = 
ad≠ãr
->vlgrp;

2935 
√t_devi˚
 *
v_√tdev
 = 
	`vœn_group_gë_devi˚
(
vlgΩ
, 
vid
);

2936 i‡(
v_√tdev
) {

2937 
v_√tdev
->
„©uªs
 |
√tdev
->features;

2938 
	`vœn_group_£t_devi˚
(
vlgΩ
, 
vid
, 
v_√tdev
);

2942 #i‚de‡
HAVE_VLAN_RX_REGISTER


2944 
	`£t_bô
(
vid
, 
ad≠ãr
->
a˘ive_vœns
);

2946 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


2950 
	}
}

2952 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


2953 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


2954 
	$e1000_vœn_rx_kûl_vid
(
√t_devi˚
 *
√tdev
,

2955 
__Æways_unu£d
 
__be16
 
¥Ÿo
, 
u16
 
vid
)

2957 
	$e1000_vœn_rx_kûl_vid
(
√t_devi˚
 *
√tdev
, 
u16
 
vid
)

2960 
	$e1000_vœn_rx_kûl_vid
(
√t_devi˚
 *
√tdev
, 
u16
 
vid
)

2963 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

2964 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

2965 
u32
 
v·a
, 
ödex
;

2967 #ifde‡
HAVE_VLAN_RX_REGISTER


2968 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

2969 
	`e1000_úq_dißbÀ
(
ad≠ãr
);

2971 
	`vœn_group_£t_devi˚
(
ad≠ãr
->
vlgΩ
, 
vid
, 
NULL
);

2973 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

2974 
	`e1000_úq_íabÀ
(
ad≠ãr
);

2977 i‡((
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 &

2978 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
) &&

2979 (
vid
 =
ad≠ãr
->
mng_vœn_id
)) {

2981 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

2982 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


2990 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

2991 
ödex
 = (
vid
 >> 5) & 0x7F;

2992 
v·a
 = 
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_VFTA
, 
ödex
);

2993 
v·a
 &~(1 << (
vid
 & 0x1F));

2994 
hw
->
mac
.
›s
.
	`wrôe_v·a
(hw, 
ödex
, 
v·a
);

2996 #i‚de‡
HAVE_VLAN_RX_REGISTER


2998 
	`˛ór_bô
(
vid
, 
ad≠ãr
->
a˘ive_vœns
);

3000 #ifde‡
HAVE_INT_NDO_VLAN_RX_ADD_VID


3004 
	}
}

3006 #i‚de‡
HAVE_VLAN_RX_REGISTER


3011 
	$e1000e_vœn_fûãr_dißbÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

3013 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

3014 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3015 
u32
 
r˘l
;

3017 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

3019 
r˘l
 = 
	`î32
(
RCTL
);

3020 
r˘l
 &~(
E1000_RCTL_VFE
 | 
E1000_RCTL_CFIEN
);

3021 
	`ew32
(
RCTL
, 
r˘l
);

3023 i‡(
ad≠ãr
->
mng_vœn_id
 !(
u16
)
E1000_MNG_VLAN_NONE
) {

3024 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3025 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
),

3026 
ad≠ãr
->
mng_vœn_id
);

3028 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
ad≠ãr
->
mng_vœn_id
);

3030 
ad≠ãr
->
mng_vœn_id
 = 
E1000_MNG_VLAN_NONE
;

3033 
	}
}

3039 
	$e1000e_vœn_fûãr_íabÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

3041 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3042 
u32
 
r˘l
;

3044 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

3046 
r˘l
 = 
	`î32
(
RCTL
);

3047 
r˘l
 |
E1000_RCTL_VFE
;

3048 
r˘l
 &~
E1000_RCTL_CFIEN
;

3049 
	`ew32
(
RCTL
, 
r˘l
);

3051 
	}
}

3057 
	$e1000e_vœn_°rù_dißbÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

3059 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3060 
u32
 
˘æ
;

3063 
˘æ
 = 
	`î32
(
CTRL
);

3064 
˘æ
 &~
E1000_CTRL_VME
;

3065 
	`ew32
(
CTRL
, 
˘æ
);

3066 
	}
}

3072 
	$e1000e_vœn_°rù_íabÀ
(
e1000_ad≠ãr
 *
ad≠ãr
)

3074 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3075 
u32
 
˘æ
;

3078 
˘æ
 = 
	`î32
(
CTRL
);

3079 
˘æ
 |
E1000_CTRL_VME
;

3080 
	`ew32
(
CTRL
, 
˘æ
);

3081 
	}
}

3084 
	$e1000_upd©e_mng_vœn
(
e1000_ad≠ãr
 *
ad≠ãr
)

3086 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

3087 
u16
 
vid
 = 
ad≠ãr
->
hw
.
mng_cookõ
.
vœn_id
;

3088 
u16
 
ﬁd_vid
 = 
ad≠ãr
->
mng_vœn_id
;

3090 #ifde‡
HAVE_VLAN_RX_REGISTER


3091 i‡(!
ad≠ãr
->
vlgΩ
)

3094 i‡(!
	`vœn_group_gë_devi˚
(
ad≠ãr
->
vlgΩ
, 
vid
)) {

3095 
ad≠ãr
->
mng_vœn_id
 = 
E1000_MNG_VLAN_NONE
;

3096 i‡(
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 &

3097 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
) {

3098 
	`e1000_vœn_rx_add_vid
(
√tdev
, 
vid
);

3099 
ad≠ãr
->
mng_vœn_id
 = 
vid
;

3102 i‡((
ﬁd_vid
 !(
u16
)
E1000_MNG_VLAN_NONE
) &&

3103 (
vid
 !
ﬁd_vid
) &&

3104 !
	`vœn_group_gë_devi˚
(
ad≠ãr
->
vlgΩ
, 
ﬁd_vid
))

3105 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
ﬁd_vid
);

3107 
ad≠ãr
->
mng_vœn_id
 = 
vid
;

3110 i‡(
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 & 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
) {

3111 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3112 
	`e1000_vœn_rx_add_vid
(
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
), 
vid
);

3114 
	`e1000_vœn_rx_add_vid
(
√tdev
, 
vid
);

3116 
ad≠ãr
->
mng_vœn_id
 = 
vid
;

3119 i‡((
ﬁd_vid
 !(
u16
)
E1000_MNG_VLAN_NONE
Ë&& (
vid
 != old_vid))

3120 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3121 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
), 
ﬁd_vid
);

3123 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
ﬁd_vid
);

3126 
	}
}

3128 #ifde‡
HAVE_VLAN_RX_REGISTER


3129 
	$e1000_vœn_rx_ªgi°î
(
√t_devi˚
 *
√tdev
,

3130 
vœn_group
 *
gΩ
)

3132 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

3133 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3134 
u32
 
˘æ
, 
r˘l
;

3136 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

3137 
	`e1000_úq_dißbÀ
(
ad≠ãr
);

3138 
ad≠ãr
->
vlgΩ
 = 
gΩ
;

3140 i‡(
gΩ
) {

3142 
˘æ
 = 
	`î32
(
CTRL
);

3143 
˘æ
 |
E1000_CTRL_VME
;

3144 
	`ew32
(
CTRL
, 
˘æ
);

3146 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

3148 
r˘l
 = 
	`î32
(
RCTL
);

3149 
r˘l
 &~
E1000_RCTL_CFIEN
;

3150 
	`ew32
(
RCTL
, 
r˘l
);

3151 
	`e1000_upd©e_mng_vœn
(
ad≠ãr
);

3155 
˘æ
 = 
	`î32
(
CTRL
);

3156 
˘æ
 &~
E1000_CTRL_VME
;

3157 
	`ew32
(
CTRL
, 
˘æ
);

3159 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
) {

3160 i‡(
ad≠ãr
->
mng_vœn_id
 !(
u16
)
E1000_MNG_VLAN_NONE
) {

3161 
	`e1000_vœn_rx_kûl_vid
(
√tdev
,

3162 
ad≠ãr
->
mng_vœn_id
);

3163 
ad≠ãr
->
mng_vœn_id
 = 
E1000_MNG_VLAN_NONE
;

3168 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

3169 
	`e1000_úq_íabÀ
(
ad≠ãr
);

3170 
	}
}

3173 
	$e1000_ª°‹e_vœn
(
e1000_ad≠ãr
 *
ad≠ãr
)

3175 
u16
 
vid
;

3177 #ifde‡
HAVE_VLAN_RX_REGISTER


3178 
	`e1000_vœn_rx_ªgi°î
(
ad≠ãr
->
√tdev
,ád≠ãr->
vlgΩ
);

3180 i‡(!
ad≠ãr
->
vlgΩ
)

3183 
vid
 = 0; vid < 
VLAN_N_VID
; vid++) {

3184 i‡(!
	`vœn_group_gë_devi˚
(
ad≠ãr
->
vlgΩ
, 
vid
))

3186 
	`e1000_vœn_rx_add_vid
(
ad≠ãr
->
√tdev
, 
vid
);

3189 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3190 
	`e1000_vœn_rx_add_vid
(
ad≠ãr
->
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
), 0);

3192 
	`e1000_vœn_rx_add_vid
(
ad≠ãr
->
√tdev
, 0);

3195 
	`f‹_óch_£t_bô
(
vid
, 
ad≠ãr
->
a˘ive_vœns
, 
VLAN_N_VID
)

3196 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3197 
	`e1000_vœn_rx_add_vid
(
ad≠ãr
->
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
), 
vid
);

3199 
	`e1000_vœn_rx_add_vid
(
ad≠ãr
->
√tdev
, 
vid
);

3202 
	}
}

3205 
	$e1000_öô_m™agóbûôy_±
(
e1000_ad≠ãr
 *
ad≠ãr
)

3207 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3208 
u32
 
m™c
, 
m™c2h
, 
mdef
, 
i
, 
j
;

3210 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_MNG_PT_ENABLED
))

3213 
m™c
 = 
	`î32
(
MANC
);

3219 
m™c
 |
E1000_MANC_EN_MNG2HOST
;

3220 
m™c2h
 = 
	`î32
(
MANC2H
);

3222 
hw
->
mac
.
ty≥
) {

3224 
m™c2h
 |(
E1000_MANC2H_PORT_623
 | 
E1000_MANC2H_PORT_664
);

3226 
e1000_82574
:

3227 
e1000_82583
:

3231 
i
 = 0, 
j
 = 0; i < 8; i++) {

3232 
mdef
 = 
	`î32
(
	`MDEF
(
i
));

3235 i‡(
mdef
 & ~(
E1000_MDEF_PORT_623
 | 
E1000_MDEF_PORT_664
))

3239 i‡(
mdef
)

3240 
m™c2h
 |(1 << 
i
);

3242 
j
 |
mdef
;

3245 i‡(
j
 =(
E1000_MDEF_PORT_623
 | 
E1000_MDEF_PORT_664
))

3249 
i
 = 0, 
j
 = 0; i < 8; i++)

3250 i‡(
	`î32
(
	`MDEF
(
i
)) == 0) {

3251 
	`ew32
(
	`MDEF
(
i
), (
E1000_MDEF_PORT_623
 |

3252 
E1000_MDEF_PORT_664
));

3253 
m™c2h
 |= (1 << 1);

3254 
j
++;

3258 i‡(!
j
)

3259 
	`e_w¨n
("UnableÅo create IPMIÖass-through filter\n");

3263 
	`ew32
(
MANC2H
, 
m™c2h
);

3264 
	`ew32
(
MANC
, 
m™c
);

3265 
	}
}

3273 
	$e1000_c⁄figuª_tx
(
e1000_ad≠ãr
 *
ad≠ãr
)

3275 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3276 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

3277 
u64
 
tdba
;

3278 
u32
 
tdÀn
, 
t˘l
, 
èrc
;

3281 
tdba
 = 
tx_rög
->
dma
;

3282 
tdÀn
 = 
tx_rög
->
cou¡
 * (
e1000_tx_desc
);

3283 
	`ew32
(
	`TDBAL
(0), (
tdba
 & 
	`DMA_BIT_MASK
(32)));

3284 
	`ew32
(
	`TDBAH
(0), (
tdba
 >> 32));

3285 
	`ew32
(
	`TDLEN
(0), 
tdÀn
);

3286 
	`ew32
(
	`TDH
(0), 0);

3287 
	`ew32
(
	`TDT
(0), 0);

3288 
tx_rög
->
hód
 = 
ad≠ãr
->
hw
.
hw_addr
 + 
	`E1000_TDH
(0);

3289 
tx_rög
->
èû
 = 
ad≠ãr
->
hw
.
hw_addr
 + 
	`E1000_TDT
(0);

3292 
	`ew32
(
TIDV
, 
ad≠ãr
->
tx_öt_dñay
);

3294 
	`ew32
(
TADV
, 
ad≠ãr
->
tx_abs_öt_dñay
);

3296 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DMA_BURST
) {

3297 
u32
 
txd˘l
 = 
	`î32
(
	`TXDCTL
(0));

3298 
txd˘l
 &~(
E1000_TXDCTL_PTHRESH
 | 
E1000_TXDCTL_HTHRESH
 |

3299 
E1000_TXDCTL_WTHRESH
);

3309 
txd˘l
 |
E1000_TXDCTL_DMA_BURST_ENABLE
;

3310 
	`ew32
(
	`TXDCTL
(0), 
txd˘l
);

3313 
	`ew32
(
	`TXDCTL
(1), 
	`î32
(TXDCTL(0)));

3316 
t˘l
 = 
	`î32
(
TCTL
);

3317 
t˘l
 &~
E1000_TCTL_CT
;

3318 
t˘l
 |
E1000_TCTL_PSP
 | 
E1000_TCTL_RTLC
 |

3319 (
E1000_COLLISION_THRESHOLD
 << 
E1000_CT_SHIFT
);

3321 i‡(
ad≠ãr
->
Êags
 & 
FLAG_TARC_SPEED_MODE_BIT
) {

3322 
èrc
 = 
	`î32
(
	`TARC
(0));

3326 
	#SPEED_MODE_BIT
 (1 << 21)

	)

3327 
èrc
 |
SPEED_MODE_BIT
;

3328 
	`ew32
(
	`TARC
(0), 
èrc
);

3332 i‡(
ad≠ãr
->
Êags
 & 
FLAG_TARC_SET_BIT_ZERO
) {

3333 
èrc
 = 
	`î32
(
	`TARC
(0));

3334 
èrc
 |= 1;

3335 
	`ew32
(
	`TARC
(0), 
èrc
);

3336 
èrc
 = 
	`î32
(
	`TARC
(1));

3337 
èrc
 |= 1;

3338 
	`ew32
(
	`TARC
(1), 
èrc
);

3342 
ad≠ãr
->
txd_cmd
 = 
E1000_TXD_CMD_EOP
 | 
E1000_TXD_CMD_IFCS
;

3345 i‡(
ad≠ãr
->
tx_öt_dñay
)

3346 
ad≠ãr
->
txd_cmd
 |
E1000_TXD_CMD_IDE
;

3349 
ad≠ãr
->
txd_cmd
 |
E1000_TXD_CMD_RS
;

3351 
	`ew32
(
TCTL
, 
t˘l
);

3353 
hw
->
mac
.
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(hw);

3354 
	}
}

3360 
	#PAGE_USE_COUNT
(
S
Ë(((SË>> 
PAGE_SHIFT
) + \

3361 (((
S
Ë& (
PAGE_SIZE
 - 1)Ë? 1 : 0))

	)

3362 
	$e1000_£tup_r˘l
(
e1000_ad≠ãr
 *
ad≠ãr
)

3364 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3365 
u32
 
r˘l
, 
rf˘l
;

3366 
u32
 
∑ges
 = 0;

3369 i‡((
hw
->
mac
.
ty≥
 >
e1000_pch2œn
) &&

3370 (
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_DATA_LEN
) &&

3371 
	`e1000_lv_jumbo_w‹k¨ound_ich8œn
(
hw
, 
åue
))

3372 
	`e_dbg
("failedÅoÉnable jumbo frame workaround mode\n");

3375 
r˘l
 = 
	`î32
(
RCTL
);

3376 
r˘l
 &~(3 << 
E1000_RCTL_MO_SHIFT
);

3377 
r˘l
 |
E1000_RCTL_EN
 | 
E1000_RCTL_BAM
 |

3378 
E1000_RCTL_LBM_NO
 | 
E1000_RCTL_RDMTS_HALF
 |

3379 (
ad≠ãr
->
hw
.
mac
.
mc_fûãr_ty≥
 << 
E1000_RCTL_MO_SHIFT
);

3382 
r˘l
 &~
E1000_RCTL_SBP
;

3385 i‡(
ad≠ãr
->
√tdev
->
mtu
 <
ETH_DATA_LEN
)

3386 
r˘l
 &~
E1000_RCTL_LPE
;

3388 
r˘l
 |
E1000_RCTL_LPE
;

3394 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_CRC_STRIPPING
)

3395 
r˘l
 |
E1000_RCTL_SECRC
;

3398 i‡((
hw
->
mac
.
ty≥
 =
e1000_pchœn
Ë&& (
r˘l
 & 
E1000_RCTL_LPE
)) {

3399 
u32
 
mac_d©a
;

3400 
u16
 
phy_d©a
;

3402 
	`e1e_Ωhy
(
hw
, 
	`PHY_REG
(770, 26), &
phy_d©a
);

3403 
phy_d©a
 &= 0xfff8;

3404 
phy_d©a
 |= (1 << 2);

3405 
	`e1e_wphy
(
hw
, 
	`PHY_REG
(770, 26), 
phy_d©a
);

3407 
mac_d©a
 = 
	`î32
(
FFLT_DBG
);

3408 
mac_d©a
 |= (1 << 17);

3409 
	`ew32
(
FFLT_DBG
, 
mac_d©a
);

3411 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82577
) {

3412 
	`e1e_Ωhy
(
hw
, 22, &
phy_d©a
);

3413 
phy_d©a
 &= 0x0fff;

3414 
phy_d©a
 |= (1 << 14);

3415 
	`e1e_wphy
(
hw
, 0x10, 0x2823);

3416 
	`e1e_wphy
(
hw
, 0x11, 0x0003);

3417 
	`e1e_wphy
(
hw
, 22, 
phy_d©a
);

3422 
r˘l
 &~
E1000_RCTL_SZ_4096
;

3423 
r˘l
 |
E1000_RCTL_BSEX
;

3424 
ad≠ãr
->
rx_buf„r_Àn
) {

3427 
r˘l
 |
E1000_RCTL_SZ_2048
;

3428 
r˘l
 &~
E1000_RCTL_BSEX
;

3431 
r˘l
 |
E1000_RCTL_SZ_4096
;

3434 
r˘l
 |
E1000_RCTL_SZ_8192
;

3437 
r˘l
 |
E1000_RCTL_SZ_16384
;

3442 
rf˘l
 = 
	`î32
(
RFCTL
);

3443 
rf˘l
 |
E1000_RFCTL_EXTEN
;

3444 
	`ew32
(
RFCTL
, 
rf˘l
);

3460 
∑ges
 = 
	`PAGE_USE_COUNT
(
ad≠ãr
->
√tdev
->
mtu
);

3461 i‡((
∑ges
 <3Ë&& (
PAGE_SIZE
 <16384Ë&& (
r˘l
 & 
E1000_RCTL_LPE
))

3462 
ad≠ãr
->
rx_ps_∑ges
 = 
∑ges
;

3464 
ad≠ãr
->
rx_ps_∑ges
 = 0;

3466 i‡(
ad≠ãr
->
rx_ps_∑ges
) {

3467 
u32
 
p§˘l
 = 0;

3470 
r˘l
 |
E1000_RCTL_DTYP_PS
;

3472 
p§˘l
 |
ad≠ãr
->
rx_ps_bsize0
 >> 
E1000_PSRCTL_BSIZE0_SHIFT
;

3474 
ad≠ãr
->
rx_ps_∑ges
) {

3476 
p§˘l
 |
PAGE_SIZE
 << 
E1000_PSRCTL_BSIZE3_SHIFT
;

3479 
p§˘l
 |
PAGE_SIZE
 << 
E1000_PSRCTL_BSIZE2_SHIFT
;

3482 
p§˘l
 |
PAGE_SIZE
 >> 
E1000_PSRCTL_BSIZE1_SHIFT
;

3486 
	`ew32
(
PSRCTL
, 
p§˘l
);

3490 i‡(
ad≠ãr
->
√tdev
->
„©uªs
 & 
NETIF_F_RXALL
) {

3494 
r˘l
 |(
E1000_RCTL_SBP
 |

3495 
E1000_RCTL_BAM
 |

3496 
E1000_RCTL_PMCF
);

3498 
r˘l
 &~(
E1000_RCTL_VFE
 |

3499 
E1000_RCTL_DPF
 |

3500 
E1000_RCTL_CFIEN
);

3506 
	`ew32
(
RCTL
, 
r˘l
);

3508 
ad≠ãr
->
Êags
 &~
FLAG_RESTART_NOW
;

3509 
	}
}

3517 
	$e1000_c⁄figuª_rx
(
e1000_ad≠ãr
 *
ad≠ãr
)

3519 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3520 
e1000_rög
 *
rx_rög
 = 
ad≠ãr
->rx_ring;

3521 
u64
 
rdba
;

3522 
u32
 
rdÀn
, 
r˘l
, 
rxcsum
, 
˘æ_ext
;

3524 i‡(
ad≠ãr
->
rx_ps_∑ges
) {

3526 
rdÀn
 = 
rx_rög
->
cou¡
 *

3527 (
e1000_rx_desc_∑ckë_•lô
);

3528 
ad≠ãr
->
˛ón_rx
 = 
e1000_˛ón_rx_úq_ps
;

3529 
ad≠ãr
->
Æloc_rx_buf
 = 
e1000_Æloc_rx_buf„rs_ps
;

3530 #ifde‡
CONFIG_E1000E_NAPI


3531 } i‡(
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
) {

3532 
rdÀn
 = 
rx_rög
->
cou¡
 * (
e1000_rx_desc_exãnded
);

3533 
ad≠ãr
->
˛ón_rx
 = 
e1000_˛ón_jumbo_rx_úq
;

3534 
ad≠ãr
->
Æloc_rx_buf
 = 
e1000_Æloc_jumbo_rx_buf„rs
;

3537 
rdÀn
 = 
rx_rög
->
cou¡
 * (
e1000_rx_desc_exãnded
);

3538 
ad≠ãr
->
˛ón_rx
 = 
e1000_˛ón_rx_úq
;

3539 
ad≠ãr
->
Æloc_rx_buf
 = 
e1000_Æloc_rx_buf„rs
;

3543 
r˘l
 = 
	`î32
(
RCTL
);

3544 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_NO_DISABLE_RX
))

3545 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

3546 
	`e1e_Êush
();

3547 
	`u¶ìp_ønge
(10000, 20000);

3549 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DMA_BURST
) {

3558 
	`ew32
(
	`RXDCTL
(0), 
E1000_RXDCTL_DMA_BURST_ENABLE
);

3559 
	`ew32
(
	`RXDCTL
(1), 
E1000_RXDCTL_DMA_BURST_ENABLE
);

3564 i‡(
ad≠ãr
->
rx_öt_dñay
 =
DEFAULT_RDTR
)

3565 
ad≠ãr
->
rx_öt_dñay
 = 
BURST_RDTR
;

3566 i‡(
ad≠ãr
->
rx_abs_öt_dñay
 =
DEFAULT_RADV
)

3567 
ad≠ãr
->
rx_abs_öt_dñay
 = 
BURST_RADV
;

3571 
	`ew32
(
RDTR
, 
ad≠ãr
->
rx_öt_dñay
);

3574 
	`ew32
(
RADV
, 
ad≠ãr
->
rx_abs_öt_dñay
);

3575 i‡((
ad≠ãr
->
ôr_£âög
 !0Ë&& (ad≠ãr->
ôr
 != 0))

3576 
	`e1000e_wrôe_ôr
(
ad≠ãr
,ád≠ãr->
ôr
);

3578 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

3579 #ifde‡
CONFIG_E1000E_NAPI


3581 
˘æ_ext
 |
E1000_CTRL_EXT_IAME
;

3582 
	`ew32
(
IAM
, 0xffffffff);

3584 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

3585 
	`e1e_Êush
();

3590 
rdba
 = 
rx_rög
->
dma
;

3591 
	`ew32
(
	`RDBAL
(0), (
rdba
 & 
	`DMA_BIT_MASK
(32)));

3592 
	`ew32
(
	`RDBAH
(0), (
rdba
 >> 32));

3593 
	`ew32
(
	`RDLEN
(0), 
rdÀn
);

3594 
	`ew32
(
	`RDH
(0), 0);

3595 
	`ew32
(
	`RDT
(0), 0);

3596 
rx_rög
->
hód
 = 
ad≠ãr
->
hw
.
hw_addr
 + 
	`E1000_RDH
(0);

3597 
rx_rög
->
èû
 = 
ad≠ãr
->
hw
.
hw_addr
 + 
	`E1000_RDT
(0);

3600 
rxcsum
 = 
	`î32
(
RXCSUM
);

3601 #ifde‡
HAVE_NDO_SET_FEATURES


3602 i‡(
ad≠ãr
->
√tdev
->
„©uªs
 & 
NETIF_F_RXCSUM
)

3604 i‡(
ad≠ãr
->
Êags
 & 
FLAG_RX_CSUM_ENABLED
)

3606 
rxcsum
 |
E1000_RXCSUM_TUOFL
;

3608 
rxcsum
 &~
E1000_RXCSUM_TUOFL
;

3609 
	`ew32
(
RXCSUM
, 
rxcsum
);

3614 i‡(
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_DATA_LEN
) {

3615 
u32
 
œt
 =

3616 ((
	`î32
(
PBA
Ë& 
E1000_PBA_RXA_MASK
) * 1024 -

3617 
ad≠ãr
->
max_‰ame_size
) * 8 / 1000;

3619 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
) {

3620 
u32
 
rxd˘l
 = 
	`î32
(
	`RXDCTL
(0));

3621 
	`ew32
(
	`RXDCTL
(0), 
rxd˘l
 | 0x3);

3623 #ifde‡
HAVE_PM_QOS_REQUEST_ACTIVE


3624 
	`pm_qos_upd©e_ªque°
(&
ad≠ãr
->
√tdev
->
pm_qos_ªq
, 
œt
);

3625 #ñi‡
	`deföed
(
HAVE_PM_QOS_REQUEST_LIST
)

3626 
	`pm_qos_upd©e_ªque°
(
ad≠ãr
->
√tdev
->
pm_qos_ªq
, 
œt
);

3628 
	`pm_qos_upd©e_ªquúemít
(
PM_QOS_CPU_DMA_LATENCY
,

3629 
ad≠ãr
->
√tdev
->
«me
, 
œt
);

3632 #ifde‡
HAVE_PM_QOS_REQUEST_ACTIVE


3633 
	`pm_qos_upd©e_ªque°
(&
ad≠ãr
->
√tdev
->
pm_qos_ªq
,

3634 
PM_QOS_DEFAULT_VALUE
);

3635 #ñi‡
	`deföed
(
HAVE_PM_QOS_REQUEST_LIST
)

3636 
	`pm_qos_upd©e_ªque°
(
ad≠ãr
->
√tdev
->
pm_qos_ªq
,

3637 
PM_QOS_DEFAULT_VALUE
);

3639 
	`pm_qos_upd©e_ªquúemít
(
PM_QOS_CPU_DMA_LATENCY
,

3640 
ad≠ãr
->
√tdev
->
«me
,

3641 
PM_QOS_DEFAULT_VALUE
);

3646 
	`ew32
(
RCTL
, 
r˘l
);

3647 
	}
}

3658 
	$e1000e_wrôe_mc_addr_li°
(
√t_devi˚
 *
√tdev
)

3660 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

3661 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3662 #ifde‡
NETDEV_HW_ADDR_T_MULTICAST


3663 
√tdev_hw_addr
 *
ha
;

3665 
dev_mc_li°
 *
ha
;

3667 
u8
 *
mè_li°
;

3668 
i
;

3670 i‡(
	`√tdev_mc_em±y
(
√tdev
)) {

3672 
hw
->
mac
.
›s
.
	`upd©e_mc_addr_li°
(hw, 
NULL
, 0);

3676 
mè_li°
 = 
	`kzÆloc
(
	`√tdev_mc_cou¡
(
√tdev
Ë* 
ETH_ALEN
, 
GFP_ATOMIC
);

3677 i‡(!
mè_li°
)

3678  -
ENOMEM
;

3681 
i
 = 0;

3682 
	`√tdev_f‹_óch_mc_addr
(
ha
, 
√tdev
)

3683 #ifde‡
NETDEV_HW_ADDR_T_MULTICAST


3684 
	`mem˝y
(
mè_li°
 + (
i
++ * 
ETH_ALEN
), 
ha
->
addr
, ETH_ALEN);

3686 
	`mem˝y
(
mè_li°
 + (
i
++ * 
ETH_ALEN
), 
ha
->
dmi_addr
, ETH_ALEN);

3689 
hw
->
mac
.
›s
.
	`upd©e_mc_addr_li°
(hw, 
mè_li°
, 
i
);

3690 
	`k‰ì
(
mè_li°
);

3692  
	`√tdev_mc_cou¡
(
√tdev
);

3693 
	}
}

3695 #ifde‡
HAVE_SET_RX_MODE


3705 
	$e1000e_wrôe_uc_addr_li°
(
√t_devi˚
 *
√tdev
)

3707 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

3708 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3709 
ør_íåõs
 = 
hw
->
mac
.
ør_íåy_cou¡
;

3710 
cou¡
 = 0;

3713 
ør_íåõs
--;

3716 i‡(
ad≠ãr
->
Êags
 & 
FLAG_RESET_OVERWRITES_LAA
)

3717 
ør_íåõs
--;

3720 i‡(
	`√tdev_uc_cou¡
(
√tdev
Ë> 
ør_íåõs
)

3721  -
ENOMEM
;

3723 i‡(!
	`√tdev_uc_em±y
(
√tdev
Ë&& 
ør_íåõs
) {

3724 #ifde‡
NETDEV_HW_ADDR_T_UNICAST


3725 
√tdev_hw_addr
 *
ha
;

3727 
dev_mc_li°
 *
ha
;

3733 
	`√tdev_f‹_óch_uc_addr
(
ha
, 
√tdev
) {

3734 i‡(!
ør_íåõs
)

3736 #ifde‡
NETDEV_HW_ADDR_T_UNICAST


3737 
hw
->
mac
.
›s
.
	`ør_£t
(hw, 
ha
->
addr
, 
ør_íåõs
--);

3739 
hw
->
mac
.
›s
.
	`ør_£t
(hw, 
ha
->
da_addr
, 
ør_íåõs
--);

3741 
cou¡
++;

3746 ; 
ør_íåõs
 > 0;Ñar_entries--) {

3747 
	`ew32
(
	`RAH
(
ør_íåõs
), 0);

3748 
	`ew32
(
	`RAL
(
ør_íåõs
), 0);

3750 
	`e1e_Êush
();

3752  
cou¡
;

3753 
	}
}

3765 
	$e1000e_£t_rx_mode
(
√t_devi˚
 *
√tdev
)

3767 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

3768 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3769 
u32
 
r˘l
;

3771 i‡(
	`pm_ru¡ime_su•íded
((
	`√tdev_to_dev
(
√tdev
))->
∑ª¡
))

3775 
r˘l
 = 
	`î32
(
RCTL
);

3778 
r˘l
 &~(
E1000_RCTL_UPE
 | 
E1000_RCTL_MPE
);

3780 i‡(
√tdev
->
Êags
 & 
IFF_PROMISC
) {

3781 
r˘l
 |(
E1000_RCTL_UPE
 | 
E1000_RCTL_MPE
);

3782 #ifde‡
HAVE_VLAN_RX_REGISTER


3783 
r˘l
 &~
E1000_RCTL_VFE
;

3786 
	`e1000e_vœn_fûãr_dißbÀ
(
ad≠ãr
);

3789 
cou¡
;

3791 i‡(
√tdev
->
Êags
 & 
IFF_ALLMULTI
) {

3792 
r˘l
 |
E1000_RCTL_MPE
;

3798 
cou¡
 = 
	`e1000e_wrôe_mc_addr_li°
(
√tdev
);

3799 i‡(
cou¡
 < 0)

3800 
r˘l
 |
E1000_RCTL_MPE
;

3802 #ifde‡
HAVE_VLAN_RX_REGISTER


3803 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
)

3804 
r˘l
 |
E1000_RCTL_VFE
;

3806 
	`e1000e_vœn_fûãr_íabÀ
(
ad≠ãr
);

3808 #ifde‡
HAVE_SET_RX_MODE


3813 
cou¡
 = 
	`e1000e_wrôe_uc_addr_li°
(
√tdev
);

3814 i‡(
cou¡
 < 0)

3815 
r˘l
 |
E1000_RCTL_UPE
;

3819 
	`ew32
(
RCTL
, 
r˘l
);

3820 #i‚de‡
HAVE_VLAN_RX_REGISTER


3822 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


3823 i‡(
√tdev
->
„©uªs
 & 
NETIF_F_HW_VLAN_CTAG_RX
)

3825 i‡(
√tdev
->
„©uªs
 & 
NETIF_F_HW_VLAN_RX
)

3827 
	`e1000e_vœn_°rù_íabÀ
(
ad≠ãr
);

3829 
	`e1000e_vœn_°rù_dißbÀ
(
ad≠ãr
);

3831 
	}
}

3833 #ifde‡
NETIF_F_RXHASH


3834 
	$e1000e_£tup_rss_hash
(
e1000_ad≠ãr
 *
ad≠ãr
)

3836 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3837 
u32
 
mrqc
, 
rxcsum
;

3838 
i
;

3839 c⁄° 
u32
 
rsskey
[10] = {

3845 
i
 = 0; i < 10; i++)

3846 
	`ew32
(
	`RSSRK
(
i
), 
rsskey
[i]);

3849 
i
 = 0; i < 32; i++)

3850 
	`ew32
(
	`RETA
(
i
), 0);

3855 
rxcsum
 = 
	`î32
(
RXCSUM
);

3856 
rxcsum
 |
E1000_RXCSUM_PCSD
;

3858 
	`ew32
(
RXCSUM
, 
rxcsum
);

3860 
mrqc
 = (
E1000_MRQC_RSS_FIELD_IPV4
 |

3861 
E1000_MRQC_RSS_FIELD_IPV4_TCP
 |

3862 
E1000_MRQC_RSS_FIELD_IPV6
 |

3863 
E1000_MRQC_RSS_FIELD_IPV6_TCP
 |

3864 
E1000_MRQC_RSS_FIELD_IPV6_TCP_EX
);

3866 
	`ew32
(
MRQC
, 
mrqc
);

3867 
	}
}

3870 #ifde‡
HAVE_HW_TIME_STAMP


3879 #i‚de‡
HAVE_PTP_1588_CLOCK


3882 
s32
 
	$e1000e_gë_ba£_timöˇ
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 *
timöˇ
)

3884 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3885 
u32
 
öcvÆue
, 
ö˝îiod
, 
shi·
;

3888 i‡((
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) &&

3889 !(
	`î32
(
TSYNCTXCTL
Ë& 
E1000_TSYNCTXCTL_ENABLED
) &&

3890 !(
	`î32
(
TSYNCRXCTL
Ë& 
E1000_TSYNCRXCTL_ENABLED
)) {

3891 
u32
 
„xävm7
 = 
	`î32
(
FEXTNVM7
);

3893 i‡(!(
„xävm7
 & (1 << 0))) {

3894 
	`ew32
(
FEXTNVM7
, 
„xävm7
 | (1 << 0));

3895 
	`e1e_Êush
();

3899 
hw
->
mac
.
ty≥
) {

3900 
e1000_pch2œn
:

3901 
e1000_pch_Õt
:

3905 i‡((
hw
->
mac
.
ty≥
 !
e1000_pch_Õt
) ||

3906 (
	`î32
(
TSYNCRXCTL
Ë& 
E1000_TSYNCRXCTL_SYSCFI
)) {

3908 
ö˝îiod
 = 
INCPERIOD_96MHz
;

3909 
öcvÆue
 = 
INCVALUE_96MHz
;

3910 
shi·
 = 
INCVALUE_SHIFT_96MHz
;

3911 
ad≠ãr
->
cc
.
shi·
 = shi· + 
INCPERIOD_SHIFT_96MHz
;

3915 
e1000_82574
:

3916 
e1000_82583
:

3918 
ö˝îiod
 = 
INCPERIOD_25MHz
;

3919 
öcvÆue
 = 
INCVALUE_25MHz
;

3920 
shi·
 = 
INCVALUE_SHIFT_25MHz
;

3921 
ad≠ãr
->
cc
.
shi·
 = shift;

3924  -
EINVAL
;

3927 *
timöˇ
 = ((
ö˝îiod
 << 
E1000_TIMINCA_INCPERIOD_SHIFT
) |

3928 ((
öcvÆue
 << 
shi·
Ë& 
E1000_TIMINCA_INCVALUE_MASK
));

3931 
	}
}

3948 
	$e1000e_c⁄fig_hwt°amp
(
e1000_ad≠ãr
 *
ad≠ãr
)

3950 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

3951 
hwt°amp_c⁄fig
 *
c⁄fig
 = &
ad≠ãr
->hwtstamp_config;

3952 
u32
 
tsync_tx_˘l
 = 
E1000_TSYNCTXCTL_ENABLED
;

3953 
u32
 
tsync_rx_˘l
 = 
E1000_TSYNCRXCTL_ENABLED
;

3954 #ifde‡
HAVE_PTP_1588_CLOCK


3955 
u32
 
rxmål
 = 0;

3956 
u16
 
rxudp
 = 0;

3957 
boﬁ
 
is_l4
 = 
Ál£
;

3958 
boﬁ
 
is_l2
 = 
Ál£
;

3960 
u32
 
ªgvÆ
;

3961 
s32
 
ªt_vÆ
;

3963 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
))

3964  -
EINVAL
;

3967 i‡(
c⁄fig
->
Êags
)

3968  -
EINVAL
;

3970 
c⁄fig
->
tx_ty≥
) {

3971 
HWTSTAMP_TX_OFF
:

3972 
tsync_tx_˘l
 = 0;

3974 
HWTSTAMP_TX_ON
:

3977  -
ERANGE
;

3980 
c⁄fig
->
rx_fûãr
) {

3981 
HWTSTAMP_FILTER_NONE
:

3982 
tsync_rx_˘l
 = 0;

3984 #ifde‡
HAVE_PTP_1588_CLOCK


3985 
HWTSTAMP_FILTER_PTP_V1_L4_SYNC
:

3986 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L4_V1
;

3987 
rxmål
 = 
E1000_RXMTRL_PTP_V1_SYNC_MESSAGE
;

3988 
is_l4
 = 
åue
;

3990 
HWTSTAMP_FILTER_PTP_V1_L4_DELAY_REQ
:

3991 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L4_V1
;

3992 
rxmål
 = 
E1000_RXMTRL_PTP_V1_DELAY_REQ_MESSAGE
;

3993 
is_l4
 = 
åue
;

3995 
HWTSTAMP_FILTER_PTP_V2_L2_SYNC
:

3997 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L2_V2
;

3998 
rxmål
 = 
E1000_RXMTRL_PTP_V2_SYNC_MESSAGE
;

3999 
is_l2
 = 
åue
;

4001 
HWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ
:

4003 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L2_V2
;

4004 
rxmål
 = 
E1000_RXMTRL_PTP_V2_DELAY_REQ_MESSAGE
;

4005 
is_l2
 = 
åue
;

4007 
HWTSTAMP_FILTER_PTP_V2_L4_SYNC
:

4011 
HWTSTAMP_FILTER_PTP_V2_SYNC
:

4013 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L2_L4_V2
;

4014 
rxmål
 = 
E1000_RXMTRL_PTP_V2_SYNC_MESSAGE
;

4015 
is_l2
 = 
åue
;

4016 
is_l4
 = 
åue
;

4018 
HWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ
:

4022 
HWTSTAMP_FILTER_PTP_V2_DELAY_REQ
:

4024 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_L2_L4_V2
;

4025 
rxmål
 = 
E1000_RXMTRL_PTP_V2_DELAY_REQ_MESSAGE
;

4026 
is_l2
 = 
åue
;

4027 
is_l4
 = 
åue
;

4029 
HWTSTAMP_FILTER_PTP_V2_L4_EVENT
:

4030 
HWTSTAMP_FILTER_PTP_V2_L2_EVENT
:

4034 
HWTSTAMP_FILTER_PTP_V2_EVENT
:

4035 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_EVENT_V2
;

4036 
c⁄fig
->
rx_fûãr
 = 
HWTSTAMP_FILTER_PTP_V2_EVENT
;

4037 
is_l2
 = 
åue
;

4038 
is_l4
 = 
åue
;

4040 
HWTSTAMP_FILTER_PTP_V1_L4_EVENT
:

4046 
HWTSTAMP_FILTER_ALL
:

4047 #ifde‡
HAVE_PTP_1588_CLOCK


4048 
is_l2
 = 
åue
;

4049 
is_l4
 = 
åue
;

4051 
tsync_rx_˘l
 |
E1000_TSYNCRXCTL_TYPE_ALL
;

4052 
c⁄fig
->
rx_fûãr
 = 
HWTSTAMP_FILTER_ALL
;

4055  -
ERANGE
;

4059 
ªgvÆ
 = 
	`î32
(
TSYNCTXCTL
);

4060 
ªgvÆ
 &~
E1000_TSYNCTXCTL_ENABLED
;

4061 
ªgvÆ
 |
tsync_tx_˘l
;

4062 
	`ew32
(
TSYNCTXCTL
, 
ªgvÆ
);

4063 i‡((
	`î32
(
TSYNCTXCTL
Ë& 
E1000_TSYNCTXCTL_ENABLED
) !=

4064 (
ªgvÆ
 & 
E1000_TSYNCTXCTL_ENABLED
)) {

4065 
	`e_îr
("Timesync Tx ControlÑegisterÇot setásÉxpected\n");

4066  -
EAGAIN
;

4070 
ªgvÆ
 = 
	`î32
(
TSYNCRXCTL
);

4071 
ªgvÆ
 &~(
E1000_TSYNCRXCTL_ENABLED
 | 
E1000_TSYNCRXCTL_TYPE_MASK
);

4072 
ªgvÆ
 |
tsync_rx_˘l
;

4073 
	`ew32
(
TSYNCRXCTL
, 
ªgvÆ
);

4074 i‡((
	`î32
(
TSYNCRXCTL
Ë& (
E1000_TSYNCRXCTL_ENABLED
 |

4075 
E1000_TSYNCRXCTL_TYPE_MASK
)) !=

4076 (
ªgvÆ
 & (
E1000_TSYNCRXCTL_ENABLED
 |

4077 
E1000_TSYNCRXCTL_TYPE_MASK
))) {

4078 
	`e_îr
("Timesync Rx ControlÑegisterÇot setásÉxpected\n");

4079  -
EAGAIN
;

4081 #ifde‡
HAVE_PTP_1588_CLOCK


4083 i‡(
is_l2
)

4084 
rxmål
 |
ETH_P_1588
;

4087 
	`ew32
(
RXMTRL
, 
rxmål
);

4090 i‡(
is_l4
) {

4091 
rxudp
 = 
PTP_EV_PORT
;

4092 
	`˝u_to_be16s
(&
rxudp
);

4094 
	`ew32
(
RXUDP
, 
rxudp
);

4096 
	`e1e_Êush
();

4100 
	`î32
(
RXSTMPH
);

4101 
	`î32
(
TXSTMPH
);

4104 
ªt_vÆ
 = 
	`e1000e_gë_ba£_timöˇ
(
ad≠ãr
, &
ªgvÆ
);

4105 i‡(
ªt_vÆ
)

4106  
ªt_vÆ
;

4107 
	`ew32
(
TIMINCA
, 
ªgvÆ
);

4110 
	`timecou¡î_öô
(&
ad≠ãr
->
tc
, &ad≠ãr->
cc
,

4111 
	`ktime_to_ns
(
	`ktime_gë_ªÆ
()));

4114 
	}
}

4121 
	$e1000_c⁄figuª
(
e1000_ad≠ãr
 *
ad≠ãr
)

4123 
e1000_rög
 *
rx_rög
 = 
ad≠ãr
->rx_ring;

4125 
	`e1000e_£t_rx_mode
(
ad≠ãr
->
√tdev
);

4127 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

4128 
	`e1000_ª°‹e_vœn
(
ad≠ãr
);

4130 
	`e1000_öô_m™agóbûôy_±
(
ad≠ãr
);

4132 
	`e1000_c⁄figuª_tx
(
ad≠ãr
);

4134 #ifde‡
NETIF_F_RXHASH


4135 i‡(
ad≠ãr
->
√tdev
->
„©uªs
 & 
NETIF_F_RXHASH
)

4136 
	`e1000e_£tup_rss_hash
(
ad≠ãr
);

4138 
	`e1000_£tup_r˘l
(
ad≠ãr
);

4139 
	`e1000_c⁄figuª_rx
(
ad≠ãr
);

4140 
ad≠ãr
->
	`Æloc_rx_buf
(
rx_rög
, 
	`e1000_desc_unu£d
‘x_rög), 
GFP_KERNEL
);

4141 
	}
}

4151 
	$e1000e_powî_up_phy
(
e1000_ad≠ãr
 *
ad≠ãr
)

4153 i‡(
ad≠ãr
->
hw
.
phy
.
›s
.
powî_up
)

4154 
ad≠ãr
->
hw
.
phy
.
›s
.
	`powî_up
(&adapter->hw);

4156 
ad≠ãr
->
hw
.
mac
.
›s
.
	`£tup_lök
(&adapter->hw);

4157 
	}
}

4165 
	$e1000_powî_down_phy
(
e1000_ad≠ãr
 *
ad≠ãr
)

4167 i‡(
ad≠ãr
->
hw
.
phy
.
›s
.
powî_down
)

4168 
ad≠ãr
->
hw
.
phy
.
›s
.
	`powî_down
(&adapter->hw);

4169 
	}
}

4179 
	$e1000e_ª£t
(
e1000_ad≠ãr
 *
ad≠ãr
)

4181 
e1000_mac_öfo
 *
mac
 = &
ad≠ãr
->
hw
.mac;

4182 
e1000_fc_öfo
 *
fc
 = &
ad≠ãr
->
hw
.fc;

4183 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4184 
u32
 
tx_•a˚
, 
mö_tx_•a˚
, 
mö_rx_•a˚
;

4185 
u32
 
pba
 = 
ad≠ãr
->pba;

4186 
u16
 
hwm
;

4189 
	`ew32
(
PBA
, 
pba
);

4191 i‡(
ad≠ãr
->
max_‰ame_size
 > 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
) {

4199 
pba
 = 
	`î32
(
PBA
);

4201 
tx_•a˚
 = 
pba
 >> 16;

4203 
pba
 &= 0xffff;

4207 
mö_tx_•a˚
 = (
ad≠ãr
->
max_‰ame_size
 +

4208 (
e1000_tx_desc
Ë- 
ETH_FCS_LEN
) * 2;

4209 
mö_tx_•a˚
 = 
	`ALIGN
(min_tx_space, 1024);

4210 
mö_tx_•a˚
 >>= 10;

4212 
mö_rx_•a˚
 = 
ad≠ãr
->
max_‰ame_size
;

4213 
mö_rx_•a˚
 = 
	`ALIGN
(min_rx_space, 1024);

4214 
mö_rx_•a˚
 >>= 10;

4220 i‡((
tx_•a˚
 < 
mö_tx_•a˚
) &&

4221 ((
mö_tx_•a˚
 - 
tx_•a˚
Ë< 
pba
)) {

4222 
pba
 -
mö_tx_•a˚
 - 
tx_•a˚
;

4227 i‡(
pba
 < 
mö_rx_•a˚
)

4228 
pba
 = 
mö_rx_•a˚
;

4231 
	`ew32
(
PBA
, 
pba
);

4242 i‡(
ad≠ãr
->
Êags
 & 
FLAG_DISABLE_FC_PAUSE_TIME
)

4243 
fc
->
∑u£_time
 = 0xFFFF;

4245 
fc
->
∑u£_time
 = 
E1000_FC_PAUSE_TIME
;

4246 
fc
->
£nd_x⁄
 = 
åue
;

4247 
fc
->
cuºít_mode
 = fc->
ªque°ed_mode
;

4249 
hw
->
mac
.
ty≥
) {

4250 
e1000_ich9œn
:

4251 
e1000_ich10œn
:

4252 i‡(
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_DATA_LEN
) {

4253 
pba
 = 14;

4254 
	`ew32
(
PBA
, 
pba
);

4255 
fc
->
high_w©î
 = 0x2800;

4256 
fc
->
low_w©î
 = fc->
high_w©î
 - 8;

4261 
hwm
 = 
	`mö
(((
pba
 << 10) * 9 / 10),

4262 ((
pba
 << 10Ë- 
ad≠ãr
->
max_‰ame_size
));

4264 
fc
->
high_w©î
 = 
hwm
 & 
E1000_FCRTH_RTH
;

4265 
fc
->
low_w©î
 = fc->
high_w©î
 - 8;

4267 
e1000_pchœn
:

4271 i‡(
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_DATA_LEN
) {

4272 
fc
->
high_w©î
 = 0x3500;

4273 
fc
->
low_w©î
 = 0x1500;

4275 
fc
->
high_w©î
 = 0x5000;

4276 
fc
->
low_w©î
 = 0x3000;

4278 
fc
->
ª‰esh_time
 = 0x1000;

4280 
e1000_pch2œn
:

4281 
e1000_pch_Õt
:

4282 
fc
->
ª‰esh_time
 = 0x0400;

4284 i‡(
ad≠ãr
->
√tdev
->
mtu
 <
ETH_DATA_LEN
) {

4285 
fc
->
high_w©î
 = 0x05C20;

4286 
fc
->
low_w©î
 = 0x05048;

4287 
fc
->
∑u£_time
 = 0x0650;

4291 
pba
 = 14;

4292 
	`ew32
(
PBA
, 
pba
);

4293 
fc
->
high_w©î
 = ((
pba
 << 10Ë* 9 / 10Ë& 
E1000_FCRTH_RTH
;

4294 
fc
->
low_w©î
 = ((
pba
 << 10Ë* 8 / 10Ë& 
E1000_FCRTL_RTL
;

4303 
ad≠ãr
->
tx_fifo_limô
 = 
	`mö_t
(
u32
, ((
	`î32
(
PBA
) >> 16) << 10) - 96,

4309 i‡(
ad≠ãr
->
ôr_£âög
 & 0x3) {

4310 i‡((
ad≠ãr
->
max_‰ame_size
 * 2Ë> (
pba
 << 10)) {

4311 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_AIM
)) {

4312 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

4314 
ad≠ãr
->
Êags2
 |
FLAG2_DISABLE_AIM
;

4315 
	`e1000e_wrôe_ôr
(
ad≠ãr
, 0);

4317 } i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_AIM
) {

4318 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

4320 
ad≠ãr
->
Êags2
 &~
FLAG2_DISABLE_AIM
;

4321 
ad≠ãr
->
ôr
 = 20000;

4322 
	`e1000e_wrôe_ôr
(
ad≠ãr
,ád≠ãr->
ôr
);

4327 
mac
->
›s
.
	`ª£t_hw
(
hw
);

4332 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
)

4333 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

4335 
	`ew32
(
WUC
, 0);

4337 i‡(
mac
->
›s
.
	`öô_hw
(
hw
))

4338 
	`e_îr
("Hardware Error\n");

4340 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

4341 
	`e1000_upd©e_mng_vœn
(
ad≠ãr
);

4344 
	`ew32
(
VET
, 
ETH_P_8021Q
);

4347 
	`e1000e_ª£t_ad≠tive
(
hw
);

4349 #ifde‡
HAVE_HW_TIME_STAMP


4351 
	`e1000e_c⁄fig_hwt°amp
(
ad≠ãr
);

4355 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_EEE
) {

4356 
s32
 
ªt_vÆ
;

4357 
u16
 
adv_addr
;

4359 
hw
->
phy
.
ty≥
) {

4360 
e1000_phy_82579
:

4361 
adv_addr
 = 
I82579_EEE_ADVERTISEMENT
;

4363 
e1000_phy_i217
:

4364 
adv_addr
 = 
I217_EEE_ADVERTISEMENT
;

4367 
	`dev_îr
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

4372 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

4373 i‡(
ªt_vÆ
) {

4374 
	`dev_îr
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

4379 
	`e1000_wrôe_emi_ªg_locked
(
hw
, 
adv_addr
,

4380 
hw
->
dev_•ec
.
ich8œn
.
ìe_dißbÀ
 ?

4381 0 : 
ad≠ãr
->
ìe_advît
);

4383 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

4386 i‡(!
	`√tif_ru¬ög
(
ad≠ãr
->
√tdev
) &&

4387 !
	`ã°_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
))

4388 
	`e1000_powî_down_phy
(
ad≠ãr
);

4390 
	`e1000_gë_phy_öfo
(
hw
);

4392 i‡((
ad≠ãr
->
Êags
 & 
FLAG_HAS_SMART_POWER_DOWN
) &&

4393 !(
ad≠ãr
->
Êags
 & 
FLAG_SMART_POWER_DOWN
)) {

4394 
u16
 
phy_d©a
 = 0;

4399 
	`e1e_Ωhy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, &
phy_d©a
);

4400 
phy_d©a
 &~
IGP02E1000_PM_SPD
;

4401 
	`e1e_wphy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, 
phy_d©a
);

4403 
	}
}

4405 
	$e1000e_up
(
e1000_ad≠ãr
 *
ad≠ãr
)

4407 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4410 
	`e1000_c⁄figuª
(
ad≠ãr
);

4412 
	`˛ór_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

4414 i‡(
ad≠ãr
->
msix_íåõs
)

4415 
	`e1000_c⁄figuª_msix
(
ad≠ãr
);

4416 
	`e1000_úq_íabÀ
(
ad≠ãr
);

4418 
	`√tif_°¨t_queue
(
ad≠ãr
->
√tdev
);

4421 i‡(
ad≠ãr
->
msix_íåõs
)

4422 
	`ew32
(
ICS
, 
E1000_ICS_LSC
 | 
E1000_ICR_OTHER
);

4424 
	`ew32
(
ICS
, 
E1000_ICS_LSC
);

4427 
	}
}

4429 
	$e1000e_Êush_des¸ùt‹s
(
e1000_ad≠ãr
 *
ad≠ãr
)

4431 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4433 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_DMA_BURST
))

4437 
	`ew32
(
TIDV
, 
ad≠ãr
->
tx_öt_dñay
 | 
E1000_TIDV_FPD
);

4438 
	`ew32
(
RDTR
, 
ad≠ãr
->
rx_öt_dñay
 | 
E1000_RDTR_FPD
);

4441 
	`e1e_Êush
();

4446 
	`ew32
(
TIDV
, 
ad≠ãr
->
tx_öt_dñay
 | 
E1000_TIDV_FPD
);

4447 
	`ew32
(
RDTR
, 
ad≠ãr
->
rx_öt_dñay
 | 
E1000_RDTR_FPD
);

4450 
	`e1e_Êush
();

4451 
	}
}

4453 #ifde‡
HAVE_NDO_GET_STATS64


4454 
e1000e_upd©e_°©s
(
e1000_ad≠ãr
 *
ad≠ãr
);

4462 
	$e1000e_down
(
e1000_ad≠ãr
 *
ad≠ãr
, 
boﬁ
 
ª£t
)

4464 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

4465 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4466 
u32
 
t˘l
, 
r˘l
;

4471 
	`£t_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

4474 
r˘l
 = 
	`î32
(
RCTL
);

4475 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_NO_DISABLE_RX
))

4476 
	`ew32
(
RCTL
, 
r˘l
 & ~
E1000_RCTL_EN
);

4479 
	`√tif_°›_queue
(
√tdev
);

4482 
t˘l
 = 
	`î32
(
TCTL
);

4483 
t˘l
 &~
E1000_TCTL_EN
;

4484 
	`ew32
(
TCTL
, 
t˘l
);

4487 
	`e1e_Êush
();

4488 
	`u¶ìp_ønge
(10000, 20000);

4490 
	`e1000_úq_dißbÀ
(
ad≠ãr
);

4492 #ifde‡
CONFIG_E1000E_NAPI


4493 
	`«pi_synchr⁄ize
(&
ad≠ãr
->
«pi
);

4496 
	`dñ_timî_sync
(&
ad≠ãr
->
w©chdog_timî
);

4497 
	`dñ_timî_sync
(&
ad≠ãr
->
phy_öfo_timî
);

4499 
	`√tif_ˇºõr_off
(
√tdev
);

4501 #ifde‡
HAVE_NDO_GET_STATS64


4502 
	`•ö_lock
(&
ad≠ãr
->
°©s64_lock
);

4503 
	`e1000e_upd©e_°©s
(
ad≠ãr
);

4504 
	`•ö_u∆ock
(&
ad≠ãr
->
°©s64_lock
);

4507 
	`e1000e_Êush_des¸ùt‹s
(
ad≠ãr
);

4508 
	`e1000_˛ón_tx_rög
(
ad≠ãr
->
tx_rög
);

4509 
	`e1000_˛ón_rx_rög
(
ad≠ãr
->
rx_rög
);

4511 
ad≠ãr
->
lök_•ìd
 = 0;

4512 
ad≠ãr
->
lök_du∂ex
 = 0;

4515 i‡((
hw
->
mac
.
ty≥
 >
e1000_pch2œn
) &&

4516 (
ad≠ãr
->
√tdev
->
mtu
 > 
ETH_DATA_LEN
) &&

4517 
	`e1000_lv_jumbo_w‹k¨ound_ich8œn
(
hw
, 
Ál£
))

4518 
	`e_dbg
("failedÅo disable jumbo frame workaround mode\n");

4520 #ifde‡
HAVE_PCI_ERS


4521 i‡(
ª£t
 && !
	`pci_ch™√l_ofÊöe
(
ad≠ãr
->
pdev
))

4523 i‡(
ª£t
)

4525 
	`e1000e_ª£t
(
ad≠ãr
);

4526 
	}
}

4528 
	$e1000e_ªöô_locked
(
e1000_ad≠ãr
 *
ad≠ãr
)

4530 
	`might_¶ìp
();

4531 
	`ã°_™d_£t_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
))

4532 
	`u¶ìp_ønge
(1000, 2000);

4533 
	`e1000e_down
(
ad≠ãr
, 
åue
);

4534 
	`e1000e_up
(
ad≠ãr
);

4535 
	`˛ór_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
);

4536 
	}
}

4538 #ifde‡
HAVE_HW_TIME_STAMP


4543 
cy˛e_t
 
	$e1000e_cy˛ecou¡î_ªad
(c⁄° 
cy˛ecou¡î
 *
cc
)

4545 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
cc
, e1000_adapter,

4546 
cc
);

4547 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4548 
cy˛e_t
 
sy°im
;

4551 
sy°im
 = (
cy˛e_t
)
	`î32
(
SYSTIML
);

4552 
sy°im
 |(
cy˛e_t
)
	`î32
(
SYSTIMH
) << 32;

4554  
sy°im
;

4555 
	}
}

4566 #ifde‡
HAVE_CONFIG_HOTPLUG


4567 
__devöô
 
	$e1000_sw_öô
(
e1000_ad≠ãr
 *
ad≠ãr
)

4569 
	$e1000_sw_öô
(
e1000_ad≠ãr
 *
ad≠ãr
)

4572 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

4574 
ad≠ãr
->
rx_buf„r_Àn
 = 
ETH_FRAME_LEN
 + 
VLAN_HLEN
 + 
ETH_FCS_LEN
;

4575 
ad≠ãr
->
rx_ps_bsize0
 = 128;

4576 
ad≠ãr
->
max_‰ame_size
 = 
√tdev
->
mtu
 + 
ETH_HLEN
 + 
ETH_FCS_LEN
;

4577 
ad≠ãr
->
mö_‰ame_size
 = 
ETH_ZLEN
 + 
ETH_FCS_LEN
;

4578 
ad≠ãr
->
tx_rög_cou¡
 = 
E1000_DEFAULT_TXD
;

4579 
ad≠ãr
->
rx_rög_cou¡
 = 
E1000_DEFAULT_RXD
;

4581 #ifde‡
HAVE_NDO_GET_STATS64


4582 
	`•ö_lock_öô
(&
ad≠ãr
->
°©s64_lock
);

4585 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

4587 i‡(
	`e1000_Æloc_queues
(
ad≠ãr
))

4588  -
ENOMEM
;

4590 #ifde‡
HAVE_HW_TIME_STAMP


4592 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
) {

4593 
ad≠ãr
->
cc
.
ªad
 = 
e1000e_cy˛ecou¡î_ªad
;

4594 
ad≠ãr
->
cc
.
mask
 = 
	`CLOCKSOURCE_MASK
(64);

4595 
ad≠ãr
->
cc
.
mu…
 = 1;

4598 
	`•ö_lock_öô
(&
ad≠ãr
->
sy°im_lock
);

4599 
	`INIT_WORK
(&
ad≠ãr
->
tx_hwt°amp_w‹k
, 
e1000e_tx_hwt°amp_w‹k
);

4604 
	`e1000_úq_dißbÀ
(
ad≠ãr
);

4606 
	`£t_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

4608 
	}
}

4615 
úqªtu∫_t
 
	$e1000_öå_msi_ã°
(
__Æways_unu£d
 
úq
, *
d©a
)

4617 
√t_devi˚
 *
√tdev
 = 
d©a
;

4618 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

4619 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4620 
u32
 
i¸
 = 
	`î32
(
ICR
);

4622 
	`e_dbg
("i¸ i†%08X\n", 
i¸
);

4623 i‡(
i¸
 & 
E1000_ICR_RXSEQ
) {

4624 
ad≠ãr
->
Êags
 &~
FLAG_MSI_TEST_FAILED
;

4628 
	`wmb
();

4631  
IRQ_HANDLED
;

4632 
	}
}

4640 
	$e1000_ã°_msi_öãºu±
(
e1000_ad≠ãr
 *
ad≠ãr
)

4642 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

4643 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4644 
îr
;

4648 
	`î32
(
ICR
);

4651 
	`e1000_‰ì_úq
(
ad≠ãr
);

4652 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

4657 
ad≠ãr
->
Êags
 |
FLAG_MSI_TEST_FAILED
;

4659 
îr
 = 
	`pci_íabÀ_msi
(
ad≠ãr
->
pdev
);

4660 i‡(
îr
)

4661 
msi_ã°_Áûed
;

4663 
îr
 = 
	`ªque°_úq
(
ad≠ãr
->
pdev
->
úq
, 
e1000_öå_msi_ã°
, 0,

4664 
√tdev
->
«me
,Çetdev);

4665 i‡(
îr
) {

4666 
	`pci_dißbÀ_msi
(
ad≠ãr
->
pdev
);

4667 
msi_ã°_Áûed
;

4673 
	`wmb
();

4675 
	`e1000_úq_íabÀ
(
ad≠ãr
);

4678 
	`ew32
(
ICS
, 
E1000_ICS_RXSEQ
);

4679 
	`e1e_Êush
();

4680 
	`m¶ìp
(100);

4682 
	`e1000_úq_dißbÀ
(
ad≠ãr
);

4684 
	`rmb
();

4686 i‡(
ad≠ãr
->
Êags
 & 
FLAG_MSI_TEST_FAILED
) {

4687 
ad≠ãr
->
öt_mode
 = 
E1000E_INT_MODE_LEGACY
;

4688 
	`e_öfo
("MSI interruptÅest failed, usingÜegacy interrupt.\n");

4690 
	`e_dbg
("MSI interruptÅest succeeded!\n");

4693 
	`‰ì_úq
(
ad≠ãr
->
pdev
->
úq
, 
√tdev
);

4694 
	`pci_dißbÀ_msi
(
ad≠ãr
->
pdev
);

4696 
msi_ã°_Áûed
:

4697 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

4698  
	`e1000_ªque°_úq
(
ad≠ãr
);

4699 
	}
}

4707 
	$e1000_ã°_msi
(
e1000_ad≠ãr
 *
ad≠ãr
)

4709 
îr
;

4710 
u16
 
pci_cmd
;

4712 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_MSI_ENABLED
))

4716 
	`pci_ªad_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
PCI_COMMAND
, &
pci_cmd
);

4717 i‡(
pci_cmd
 & 
PCI_COMMAND_SERR
)

4718 
	`pci_wrôe_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
PCI_COMMAND
,

4719 
pci_cmd
 & ~
PCI_COMMAND_SERR
);

4721 
îr
 = 
	`e1000_ã°_msi_öãºu±
(
ad≠ãr
);

4724 i‡(
pci_cmd
 & 
PCI_COMMAND_SERR
) {

4725 
	`pci_ªad_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
PCI_COMMAND
, &
pci_cmd
);

4726 
pci_cmd
 |
PCI_COMMAND_SERR
;

4727 
	`pci_wrôe_c⁄fig_w‹d
(
ad≠ãr
->
pdev
, 
PCI_COMMAND
, 
pci_cmd
);

4730  
îr
;

4731 
	}
}

4745 
	$e1000_›í
(
√t_devi˚
 *
√tdev
)

4747 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

4748 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4749 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

4750 
îr
;

4752 
ad≠ãr
->
pdev
 =Ödev;

4754 i‡(
	`ã°_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
))

4755  -
EBUSY
;

4757 
	`pm_ru¡ime_gë_sync
(
	`pci_dev_to_dev
(
pdev
));

4759 
	`√tif_ˇºõr_off
(
√tdev
);

4762 
îr
 = 
	`e1000e_£tup_tx_ªsour˚s
(
ad≠ãr
->
tx_rög
);

4763 i‡(
îr
)

4764 
îr_£tup_tx
;

4767 
îr
 = 
	`e1000e_£tup_rx_ªsour˚s
(
ad≠ãr
->
rx_rög
);

4768 i‡(
îr
)

4769 
îr_£tup_rx
;

4774 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
) {

4775 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

4776 
	`e1000e_ª£t
(
ad≠ãr
);

4779 
	`e1000e_powî_up_phy
(
ad≠ãr
);

4781 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

4782 
ad≠ãr
->
mng_vœn_id
 = 
E1000_MNG_VLAN_NONE
;

4783 i‡((
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 & 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
))

4784 
	`e1000_upd©e_mng_vœn
(
ad≠ãr
);

4788 #ifde‡
HAVE_PM_QOS_REQUEST_ACTIVE


4789 
	`pm_qos_add_ªque°
(&
ad≠ãr
->
√tdev
->
pm_qos_ªq
, 
PM_QOS_CPU_DMA_LATENCY
,

4790 
PM_QOS_DEFAULT_VALUE
);

4791 #ñi‡
	`deföed
(
HAVE_PM_QOS_REQUEST_LIST
)

4792 
ad≠ãr
->
√tdev
->
pm_qos_ªq
 = 
	`pm_qos_add_ªque°
(
PM_QOS_CPU_DMA_LATENCY
,

4793 
PM_QOS_DEFAULT_VALUE
);

4795 
	`pm_qos_add_ªquúemít
(
PM_QOS_CPU_DMA_LATENCY
, 
ad≠ãr
->
√tdev
->
«me
,

4796 
PM_QOS_DEFAULT_VALUE
);

4804 
	`e1000_c⁄figuª
(
ad≠ãr
);

4806 
îr
 = 
	`e1000_ªque°_úq
(
ad≠ãr
);

4807 i‡(
îr
)

4808 
îr_ªq_úq
;

4814 i‡(
ad≠ãr
->
öt_mode
 !
E1000E_INT_MODE_LEGACY
) {

4815 
îr
 = 
	`e1000_ã°_msi
(
ad≠ãr
);

4816 i‡(
îr
) {

4817 
	`e_îr
("Interruptállocation failed\n");

4818 
îr_ªq_úq
;

4823 
	`˛ór_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

4825 #ifde‡
CONFIG_E1000E_NAPI


4826 
	`«pi_íabÀ
(&
ad≠ãr
->
«pi
);

4829 
	`e1000_úq_íabÀ
(
ad≠ãr
);

4831 
ad≠ãr
->
tx_h™g_ªcheck
 = 
Ál£
;

4832 
	`√tif_°¨t_queue
(
√tdev
);

4834 
hw
->
mac
.
gë_lök_°©us
 = 
åue
;

4835 
	`pm_ru¡ime_put
(
	`pci_dev_to_dev
(
pdev
));

4838 i‡(
ad≠ãr
->
msix_íåõs
)

4839 
	`ew32
(
ICS
, 
E1000_ICS_LSC
 | 
E1000_ICR_OTHER
);

4841 
	`ew32
(
ICS
, 
E1000_ICS_LSC
);

4845 
îr_ªq_úq
:

4846 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

4847 
	`e1000_powî_down_phy
(
ad≠ãr
);

4848 
	`e1000e_‰ì_rx_ªsour˚s
(
ad≠ãr
->
rx_rög
);

4849 
îr_£tup_rx
:

4850 
	`e1000e_‰ì_tx_ªsour˚s
(
ad≠ãr
->
tx_rög
);

4851 
îr_£tup_tx
:

4852 
	`e1000e_ª£t
(
ad≠ãr
);

4853 
	`pm_ru¡ime_put_sync
(
	`pci_dev_to_dev
(
pdev
));

4855  
îr
;

4856 
	}
}

4869 
	$e1000_˛o£
(
√t_devi˚
 *
√tdev
)

4871 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

4872 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

4873 
cou¡
 = 
E1000_CHECK_RESET_COUNT
;

4875 
ad≠ãr
->
pdev
 =Ödev;

4877 
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
Ë&& 
cou¡
--)

4878 
	`u¶ìp_ønge
(10000, 20000);

4880 
	`WARN_ON
(
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
));

4882 
	`pm_ru¡ime_gë_sync
(
	`pci_dev_to_dev
(
pdev
));

4884 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
)) {

4885 
	`e1000e_down
(
ad≠ãr
, 
åue
);

4886 
	`e1000_‰ì_úq
(
ad≠ãr
);

4889 
	`¥_öfo
("%†NIC Lök i†Down\n", 
ad≠ãr
->
√tdev
->
«me
);

4891 #ifde‡
CONFIG_E1000E_NAPI


4892 
	`«pi_dißbÀ
(&
ad≠ãr
->
«pi
);

4895 
	`e1000e_‰ì_tx_ªsour˚s
(
ad≠ãr
->
tx_rög
);

4896 
	`e1000e_‰ì_rx_ªsour˚s
(
ad≠ãr
->
rx_rög
);

4898 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

4902 #ifde‡
HAVE_VLAN_RX_REGISTER


4903 i‡((
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 &

4904 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
) &&

4905 !(
ad≠ãr
->
vlgΩ
 &&

4906 
	`vœn_group_gë_devi˚
(
ad≠ãr
->
vlgΩ
,ád≠ãr->
mng_vœn_id
)))

4908 i‡(
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 & 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
)

4910 #ifde‡
NETIF_F_HW_VLAN_CTAG_RX


4911 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
	`ht⁄s
(
ETH_P_8021Q
),

4912 
ad≠ãr
->
mng_vœn_id
);

4914 
	`e1000_vœn_rx_kûl_vid
(
√tdev
, 
ad≠ãr
->
mng_vœn_id
);

4921 i‡((
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
) &&

4922 !
	`ã°_bô
(
__E1000_TESTING
, &
ad≠ãr
->
°©e
))

4923 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

4925 #ifde‡
HAVE_PM_QOS_REQUEST_ACTIVE


4926 
	`pm_qos_ªmove_ªque°
(&
ad≠ãr
->
√tdev
->
pm_qos_ªq
);

4927 #ñi‡
	`deföed
(
HAVE_PM_QOS_REQUEST_LIST
)

4928 
	`pm_qos_ªmove_ªque°
(
ad≠ãr
->
√tdev
->
pm_qos_ªq
);

4929 
ad≠ãr
->
√tdev
->
pm_qos_ªq
 = 
NULL
;

4931 
	`pm_qos_ªmove_ªquúemít
(
PM_QOS_CPU_DMA_LATENCY
,

4932 
ad≠ãr
->
√tdev
->
«me
);

4935 
	`pm_ru¡ime_put_sync
(
	`pci_dev_to_dev
(
pdev
));

4938 
	}
}

4947 
	$e1000_£t_mac
(
√t_devi˚
 *
√tdev
, *
p
)

4949 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

4950 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4951 
sockaddr
 *
addr
 = 
p
;

4953 i‡(!
	`is_vÆid_ëhî_addr
((*)(
addr
->
ß_d©a
)))

4954  -
EADDRNOTAVAIL
;

4956 
	`mem˝y
(
√tdev
->
dev_addr
, 
addr
->
ß_d©a
,Çëdev->
addr_Àn
);

4957 
	`mem˝y
(
ad≠ãr
->
hw
.
mac
.
addr
,áddr->
ß_d©a
, 
√tdev
->
addr_Àn
);

4959 
hw
->
mac
.
›s
.
	`ør_£t
(&
ad≠ãr
->hw,ád≠ãr->hw.mac.
addr
, 0);

4961 i‡(
ad≠ãr
->
Êags
 & 
FLAG_RESET_OVERWRITES_LAA
) {

4963 
	`e1000e_£t_œa_°©e_82571
(&
ad≠ãr
->
hw
, 1);

4972 
hw
->
mac
.
›s
.
	`ør_£t
(&
ad≠ãr
->hw,ád≠ãr->hw.mac.
addr
,

4973 
ad≠ãr
->
hw
.
mac
.
ør_íåy_cou¡
 - 1);

4977 
	}
}

4987 
	$e1000e_upd©e_phy_èsk
(
w‹k_°ru˘
 *
w‹k
)

4989 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
,

4990 
e1000_ad≠ãr
,

4991 
upd©e_phy_èsk
);

4992 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

4994 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

4997 
	`e1000_gë_phy_öfo
(
hw
);

5000 i‡(
hw
->
phy
.
ty≥
 =
e1000_phy_82579
)

5001 
	`e1000_£t_ìe_pchœn
(
hw
);

5002 
	}
}

5011 
	$e1000_upd©e_phy_öfo
(
d©a
)

5013 
e1000_ad≠ãr
 *
ad≠ãr
 = (e1000_ad≠ã∏*)
d©a
;

5015 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

5018 
	`scheduÀ_w‹k
(&
ad≠ãr
->
upd©e_phy_èsk
);

5019 
	}
}

5027 
	$e1000e_upd©e_phy_°©s
(
e1000_ad≠ãr
 *
ad≠ãr
)

5029 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5030 
s32
 
ªt_vÆ
;

5031 
u16
 
phy_d©a
;

5033 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

5034 i‡(
ªt_vÆ
)

5040 
hw
->
phy
.
addr
 = 1;

5041 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
IGP01E1000_PHY_PAGE_SELECT
,

5042 &
phy_d©a
);

5043 i‡(
ªt_vÆ
)

5044 
ªÀa£
;

5045 i‡(
phy_d©a
 !(
HV_STATS_PAGE
 << 
IGP_PAGE_SHIFT
)) {

5046 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`£t_∑ge
(hw,

5047 
HV_STATS_PAGE
 << 
IGP_PAGE_SHIFT
);

5048 i‡(
ªt_vÆ
)

5049 
ªÀa£
;

5053 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_SCC_UPPER
, &
phy_d©a
);

5054 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_SCC_LOWER
, &
phy_d©a
);

5055 i‡(!
ªt_vÆ
)

5056 
ad≠ãr
->
°©s
.
scc
 +
phy_d©a
;

5059 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_ECOL_UPPER
, &
phy_d©a
);

5060 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_ECOL_LOWER
, &
phy_d©a
);

5061 i‡(!
ªt_vÆ
)

5062 
ad≠ãr
->
°©s
.
ecﬁ
 +
phy_d©a
;

5065 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_MCC_UPPER
, &
phy_d©a
);

5066 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_MCC_LOWER
, &
phy_d©a
);

5067 i‡(!
ªt_vÆ
)

5068 
ad≠ãr
->
°©s
.
mcc
 +
phy_d©a
;

5071 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_LATECOL_UPPER
, &
phy_d©a
);

5072 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_LATECOL_LOWER
, &
phy_d©a
);

5073 i‡(!
ªt_vÆ
)

5074 
ad≠ãr
->
°©s
.
œãcﬁ
 +
phy_d©a
;

5077 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_COLC_UPPER
, &
phy_d©a
);

5078 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_COLC_LOWER
, &
phy_d©a
);

5079 i‡(!
ªt_vÆ
)

5080 
hw
->
mac
.
cﬁlisi⁄_dñè
 = 
phy_d©a
;

5083 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_DC_UPPER
, &
phy_d©a
);

5084 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_DC_LOWER
, &
phy_d©a
);

5085 i‡(!
ªt_vÆ
)

5086 
ad≠ãr
->
°©s
.
dc
 +
phy_d©a
;

5089 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_TNCRS_UPPER
, &
phy_d©a
);

5090 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(hw, 
HV_TNCRS_LOWER
, &
phy_d©a
);

5091 i‡(!
ªt_vÆ
)

5092 
ad≠ãr
->
°©s
.
ä¸s
 +
phy_d©a
;

5094 
ªÀa£
:

5095 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

5096 
	}
}

5102 #ifde‡
HAVE_NDO_GET_STATS64


5103 
	$e1000e_upd©e_°©s
(
e1000_ad≠ãr
 *
ad≠ãr
)

5105 
	$e1000e_upd©e_°©s
(
e1000_ad≠ãr
 *
ad≠ãr
)

5108 #ifde‡
HAVE_NETDEV_STATS_IN_NETDEV


5109 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

5111 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5112 #ifde‡
HAVE_PCI_ERS


5113 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

5119 i‡(
ad≠ãr
->
lök_•ìd
 == 0)

5121 #ifde‡
HAVE_PCI_ERS


5122 i‡(
	`pci_ch™√l_ofÊöe
(
pdev
))

5126 
ad≠ãr
->
°©s
.
¸˚ºs
 +
	`î32
(
CRCERRS
);

5127 
ad≠ãr
->
°©s
.
g¥c
 +
	`î32
(
GPRC
);

5128 
ad≠ãr
->
°©s
.
g‹c
 +
	`î32
(
GORCL
);

5129 
	`î32
(
GORCH
);

5130 
ad≠ãr
->
°©s
.
b¥c
 +
	`î32
(
BPRC
);

5131 
ad≠ãr
->
°©s
.
m¥c
 +
	`î32
(
MPRC
);

5132 
ad≠ãr
->
°©s
.
roc
 +
	`î32
(
ROC
);

5134 
ad≠ãr
->
°©s
.
mpc
 +
	`î32
(
MPC
);

5137 i‡(
ad≠ãr
->
lök_du∂ex
 =
HALF_DUPLEX
) {

5138 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_PHY_STATS
) {

5139 
	`e1000e_upd©e_phy_°©s
(
ad≠ãr
);

5141 
ad≠ãr
->
°©s
.
scc
 +
	`î32
(
SCC
);

5142 
ad≠ãr
->
°©s
.
ecﬁ
 +
	`î32
(
ECOL
);

5143 
ad≠ãr
->
°©s
.
mcc
 +
	`î32
(
MCC
);

5144 
ad≠ãr
->
°©s
.
œãcﬁ
 +
	`î32
(
LATECOL
);

5145 
ad≠ãr
->
°©s
.
dc
 +
	`î32
(
DC
);

5147 
hw
->
mac
.
cﬁlisi⁄_dñè
 = 
	`î32
(
COLC
);

5149 i‡((
hw
->
mac
.
ty≥
 !
e1000_82574
) &&

5150 (
hw
->
mac
.
ty≥
 !
e1000_82583
))

5151 
ad≠ãr
->
°©s
.
ä¸s
 +
	`î32
(
TNCRS
);

5153 
ad≠ãr
->
°©s
.
cﬁc
 +
hw
->
mac
.
cﬁlisi⁄_dñè
;

5156 
ad≠ãr
->
°©s
.
x⁄rxc
 +
	`î32
(
XONRXC
);

5157 
ad≠ãr
->
°©s
.
x⁄txc
 +
	`î32
(
XONTXC
);

5158 
ad≠ãr
->
°©s
.
xof‰xc
 +
	`î32
(
XOFFRXC
);

5159 
ad≠ãr
->
°©s
.
xof·xc
 +
	`î32
(
XOFFTXC
);

5160 
ad≠ãr
->
°©s
.
g±c
 +
	`î32
(
GPTC
);

5161 
ad≠ãr
->
°©s
.
gŸc
 +
	`î32
(
GOTCL
);

5162 
	`î32
(
GOTCH
);

5163 
ad≠ãr
->
°©s
.
∫bc
 +
	`î32
(
RNBC
);

5164 
ad≠ãr
->
°©s
.
ruc
 +
	`î32
(
RUC
);

5166 
ad≠ãr
->
°©s
.
m±c
 +
	`î32
(
MPTC
);

5167 
ad≠ãr
->
°©s
.
b±c
 +
	`î32
(
BPTC
);

5171 
hw
->
mac
.
tx_∑ckë_dñè
 = 
	`î32
(
TPT
);

5172 
ad≠ãr
->
°©s
.
çt
 +
hw
->
mac
.
tx_∑ckë_dñè
;

5174 
ad≠ãr
->
°©s
.
Æg√ºc
 +
	`î32
(
ALGNERRC
);

5175 
ad≠ãr
->
°©s
.
rxîrc
 +
	`î32
(
RXERRC
);

5176 
ad≠ãr
->
°©s
.
˚xãº
 +
	`î32
(
CEXTERR
);

5177 
ad≠ãr
->
°©s
.
ts˘c
 +
	`î32
(
TSCTC
);

5178 
ad≠ãr
->
°©s
.
ts˘fc
 +
	`î32
(
TSCTFC
);

5181 #ifde‡
HAVE_NETDEV_STATS_IN_NETDEV


5182 
√tdev
->
°©s
.
mu…iˇ°
 = 
ad≠ãr
->°©s.
m¥c
;

5183 
√tdev
->
°©s
.
cﬁlisi⁄s
 = 
ad≠ãr
->°©s.
cﬁc
;

5185 
ad≠ãr
->
√t_°©s
.
mu…iˇ°
 =ád≠ãr->
°©s
.
m¥c
;

5186 
ad≠ãr
->
√t_°©s
.
cﬁlisi⁄s
 =ád≠ãr->
°©s
.
cﬁc
;

5194 #ifde‡
HAVE_NETDEV_STATS_IN_NETDEV


5195 
√tdev
->
°©s
.
rx_îr‹s
 = 
ad≠ãr
->°©s.
rxîrc
 +

5197 
ad≠ãr
->
√t_°©s
.
rx_îr‹s
 =ád≠ãr->
°©s
.
rxîrc
 +

5199 
ad≠ãr
->
°©s
.
¸˚ºs
 +ád≠ãr->°©s.
Æg√ºc
 +

5200 
ad≠ãr
->
°©s
.
ruc
 +ád≠ãr->°©s.
roc
 +ád≠ãr->°©s.
˚xãº
;

5201 #ifde‡
HAVE_NETDEV_STATS_IN_NETDEV


5202 
√tdev
->
°©s
.
rx_Àngth_îr‹s
 = 
ad≠ãr
->°©s.
ruc
 +

5203 
ad≠ãr
->
°©s
.
roc
;

5204 
√tdev
->
°©s
.
rx_¸c_îr‹s
 = 
ad≠ãr
->°©s.
¸˚ºs
;

5205 
√tdev
->
°©s
.
rx_‰ame_îr‹s
 = 
ad≠ãr
->°©s.
Æg√ºc
;

5206 
√tdev
->
°©s
.
rx_mis£d_îr‹s
 = 
ad≠ãr
->°©s.
mpc
;

5208 
ad≠ãr
->
√t_°©s
.
rx_Àngth_îr‹s
 =ád≠ãr->
°©s
.
ruc
 +

5209 
ad≠ãr
->
°©s
.
roc
;

5210 
ad≠ãr
->
√t_°©s
.
rx_¸c_îr‹s
 =ád≠ãr->
°©s
.
¸˚ºs
;

5211 
ad≠ãr
->
√t_°©s
.
rx_‰ame_îr‹s
 =ád≠ãr->
°©s
.
Æg√ºc
;

5212 
ad≠ãr
->
√t_°©s
.
rx_mis£d_îr‹s
 =ád≠ãr->
°©s
.
mpc
;

5216 #ifde‡
HAVE_NETDEV_STATS_IN_NETDEV


5217 
√tdev
->
°©s
.
tx_îr‹s
 = 
ad≠ãr
->°©s.
ecﬁ
 +ád≠ãr->°©s.
œãcﬁ
;

5218 
√tdev
->
°©s
.
tx_ab‹ãd_îr‹s
 = 
ad≠ãr
->°©s.
ecﬁ
;

5219 
√tdev
->
°©s
.
tx_wödow_îr‹s
 = 
ad≠ãr
->°©s.
œãcﬁ
;

5220 
√tdev
->
°©s
.
tx_ˇºõr_îr‹s
 = 
ad≠ãr
->°©s.
ä¸s
;

5222 
ad≠ãr
->
√t_°©s
.
tx_îr‹s
 =ád≠ãr->
°©s
.
ecﬁ
 +

5223 
ad≠ãr
->
°©s
.
œãcﬁ
;

5224 
ad≠ãr
->
√t_°©s
.
tx_ab‹ãd_îr‹s
 =ád≠ãr->
°©s
.
ecﬁ
;

5225 
ad≠ãr
->
√t_°©s
.
tx_wödow_îr‹s
 =ád≠ãr->
°©s
.
œãcﬁ
;

5226 
ad≠ãr
->
√t_°©s
.
tx_ˇºõr_îr‹s
 =ád≠ãr->
°©s
.
ä¸s
;

5232 
ad≠ãr
->
°©s
.
mg±c
 +
	`î32
(
MGTPTC
);

5233 
ad≠ãr
->
°©s
.
mg¥c
 +
	`î32
(
MGTPRC
);

5234 
ad≠ãr
->
°©s
.
mgpdc
 +
	`î32
(
MGTPDC
);

5237 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

5238 
u32
 
pbecc°s
 = 
	`î32
(
PBECCSTS
);

5239 
ad≠ãr
->
c‹r_îr‹s
 +=

5240 
pbecc°s
 & 
E1000_PBECCSTS_CORR_ERR_CNT_MASK
;

5241 
ad≠ãr
->
unc‹r_îr‹s
 +=

5242 (
pbecc°s
 & 
E1000_PBECCSTS_UNCORR_ERR_CNT_MASK
) >>

5243 
E1000_PBECCSTS_UNCORR_ERR_CNT_SHIFT
;

5245 
	}
}

5247 #ifde‡
SIOCGMIIPHY


5252 
	$e1000_phy_ªad_°©us
(
e1000_ad≠ãr
 *
ad≠ãr
)

5254 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5255 
e1000_phy_ªgs
 *
phy
 = &
ad≠ãr
->
phy_ªgs
;

5257 i‡(!
	`pm_ru¡ime_su•íded
((
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
))->
∑ª¡
) &&

5258 (
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
) &&

5259 (
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
)) {

5260 
ªt_vÆ
;

5262 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy
->
bm¸
);

5263 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy
->
bm§
);

5264 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_ADVERTISE
, &
phy
->
advîti£
);

5265 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_LPA
, &
phy
->
Õa
);

5266 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_EXPANSION
, &
phy
->
ex∑nsi⁄
);

5267 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_CTRL1000
, &
phy
->
˘æ1000
);

5268 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
phy
->
°©1000
);

5269 
ªt_vÆ
 |
	`e1e_Ωhy
(
hw
, 
MII_ESTATUS
, &
phy
->
e°©us
);

5270 i‡(
ªt_vÆ
)

5271 
	`e_w¨n
("ErrorÑeading PHYÑegister\n");

5276 
phy
->
bm¸
 = (
BMCR_SPEED1000
 | 
BMCR_ANENABLE
 | 
BMCR_FULLDPLX
);

5277 
phy
->
bm§
 = (
BMSR_100FULL
 | 
BMSR_100HALF
 | 
BMSR_10FULL
 |

5278 
BMSR_10HALF
 | 
BMSR_ESTATEN
 | 
BMSR_ANEGCAPABLE
 |

5279 
BMSR_ERCAP
);

5280 
phy
->
advîti£
 = (
ADVERTISE_PAUSE_ASYM
 | 
ADVERTISE_PAUSE_CAP
 |

5281 
ADVERTISE_ALL
 | 
ADVERTISE_CSMA
);

5282 
phy
->
Õa
 = 0;

5283 
phy
->
ex∑nsi⁄
 = 
EXPANSION_ENABLENPAGE
;

5284 
phy
->
˘æ1000
 = 
ADVERTISE_1000FULL
;

5285 
phy
->
°©1000
 = 0;

5286 
phy
->
e°©us
 = (
ESTATUS_1000_TFULL
 | 
ESTATUS_1000_THALF
);

5288 
	}
}

5291 
	$e1000_¥öt_lök_öfo
(
e1000_ad≠ãr
 *
ad≠ãr
)

5293 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5294 
u32
 
˘æ
 = 
	`î32
(
CTRL
);

5297 
	`¥_öfo
("%s NIC Link is Up %d Mbps %s Duplex, Flow Control: %s\n",

5298 
ad≠ãr
->
√tdev
->
«me
,ád≠ãr->
lök_•ìd
,

5299 
ad≠ãr
->
lök_du∂ex
 =
FULL_DUPLEX
 ? "Full" : "Half",

5300 (
˘æ
 & 
E1000_CTRL_TFCE
Ë&& (˘æ & 
E1000_CTRL_RFCE
) ? "Rx/Tx" :

5301 (
˘æ
 & 
E1000_CTRL_RFCE
) ? "Rx" :

5302 (
˘æ
 & 
E1000_CTRL_TFCE
) ? "Tx" : "None");

5303 
	}
}

5305 
boﬁ
 
	$e1000e_has_lök
(
e1000_ad≠ãr
 *
ad≠ãr
)

5307 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5308 
boﬁ
 
lök_a˘ive
 = 
Ál£
;

5309 
s32
 
ªt_vÆ
 = 0;

5316 
hw
->
phy
.
medü_ty≥
) {

5317 
e1000_medü_ty≥_c›≥r
:

5318 i‡(
hw
->
mac
.
gë_lök_°©us
) {

5319 
ªt_vÆ
 = 
hw
->
mac
.
›s
.
	`check_f‹_lök
(hw);

5320 
lök_a˘ive
 = !
hw
->
mac
.
gë_lök_°©us
;

5322 
lök_a˘ive
 = 
åue
;

5325 
e1000_medü_ty≥_fibî
:

5326 
ªt_vÆ
 = 
hw
->
mac
.
›s
.
	`check_f‹_lök
(hw);

5327 
lök_a˘ive
 = !!(
	`î32
(
STATUS
Ë& 
E1000_STATUS_LU
);

5329 
e1000_medü_ty≥_öã∫Æ_£rdes
:

5330 
ªt_vÆ
 = 
hw
->
mac
.
›s
.
	`check_f‹_lök
(hw);

5331 
lök_a˘ive
 = 
ad≠ãr
->
hw
.
mac
.
£rdes_has_lök
;

5334 
e1000_medü_ty≥_unknown
:

5338 i‡((
ªt_vÆ
 =
E1000_ERR_PHY
Ë&& (
hw
->
phy
.
ty≥
 =
e1000_phy_igp_3
) &&

5339 (
	`î32
(
CTRL
Ë& 
E1000_PHY_CTRL_GBE_DISABLE
)) {

5341 
	`e_öfo
("Gigabit has been disabled, downgrading speed\n");

5344  
lök_a˘ive
;

5345 
	}
}

5347 
	$e1000e_íabÀ_ª˚ives
(
e1000_ad≠ãr
 *
ad≠ãr
)

5350 i‡((
ad≠ãr
->
Êags
 & 
FLAG_RX_NEEDS_RESTART
) &&

5351 (
ad≠ãr
->
Êags
 & 
FLAG_RESTART_NOW
)) {

5352 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5353 
u32
 
r˘l
 = 
	`î32
(
RCTL
);

5354 
	`ew32
(
RCTL
, 
r˘l
 | 
E1000_RCTL_EN
);

5355 
ad≠ãr
->
Êags
 &~
FLAG_RESTART_NOW
;

5357 
	}
}

5359 
	$e1000e_check_82574_phy_w‹k¨ound
(
e1000_ad≠ãr
 *
ad≠ãr
)

5361 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5366 i‡(
	`e1000_check_phy_82574
(
hw
))

5367 
ad≠ãr
->
phy_h™g_cou¡
++;

5369 
ad≠ãr
->
phy_h™g_cou¡
 = 0;

5371 i‡(
ad≠ãr
->
phy_h™g_cou¡
 > 1) {

5372 
ad≠ãr
->
phy_h™g_cou¡
 = 0;

5373 
	`e_dbg
("PHYáppears hung -Ñesetting\n");

5374 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

5376 
	}
}

5382 
	$e1000_w©chdog
(
d©a
)

5384 
e1000_ad≠ãr
 *
ad≠ãr
 = (e1000_ad≠ã∏*)
d©a
;

5387 
	`scheduÀ_w‹k
(&
ad≠ãr
->
w©chdog_èsk
);

5390 
	}
}

5392 
	$e1000_w©chdog_èsk
(
w‹k_°ru˘
 *
w‹k
)

5394 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
,

5395 
e1000_ad≠ãr
,

5396 
w©chdog_èsk
);

5397 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

5398 
e1000_mac_öfo
 *
mac
 = &
ad≠ãr
->
hw
.mac;

5399 
e1000_phy_öfo
 *
phy
 = &
ad≠ãr
->
hw
.phy;

5400 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

5401 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5402 
u32
 
lök
, 
t˘l
;

5404 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

5407 
lök
 = 
	`e1000e_has_lök
(
ad≠ãr
);

5408 i‡((
	`√tif_ˇºõr_ok
(
√tdev
)Ë&& 
lök
) {

5410 
	`pm_ru¡ime_ªsume
(
√tdev
->
dev
.
∑ª¡
);

5412 
	`e1000e_íabÀ_ª˚ives
(
ad≠ãr
);

5413 
lök_up
;

5415 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

5416 i‡((
	`e1000e_íabÀ_tx_pkt_fûãrög
(
hw
)) &&

5417 (
ad≠ãr
->
mng_vœn_id
 !ad≠ãr->
hw
.
mng_cookõ
.
vœn_id
))

5418 
	`e1000_upd©e_mng_vœn
(
ad≠ãr
);

5421 i‡(
lök
) {

5422 i‡(!
	`√tif_ˇºõr_ok
(
√tdev
)) {

5423 
boﬁ
 
txb2b
 = 
åue
;

5426 
	`pm_ru¡ime_ªsume
(
√tdev
->
dev
.
∑ª¡
);

5428 #ifde‡
SIOCGMIIPHY


5430 
	`e1000_phy_ªad_°©us
(
ad≠ãr
);

5432 
mac
->
›s
.
	`gë_lök_up_öfo
(&
ad≠ãr
->
hw
,

5433 &
ad≠ãr
->
lök_•ìd
,

5434 &
ad≠ãr
->
lök_du∂ex
);

5435 
	`e1000_¥öt_lök_öfo
(
ad≠ãr
);

5438 
	`e1000e_check_downshi·
(
hw
);

5439 i‡(
phy
->
•ìd_downgøded
)

5440 
	`√tdev_w¨n
(
√tdev
,

5446 i‡((
hw
->
phy
.
ty≥
 =
e1000_phy_igp_3
 ||

5447 
hw
->
phy
.
ty≥
 =
e1000_phy_bm
) &&

5448 (
hw
->
mac
.
aut⁄eg
) &&

5449 (
ad≠ãr
->
lök_•ìd
 =
SPEED_10
 ||

5450 
ad≠ãr
->
lök_•ìd
 =
SPEED_100
) &&

5451 (
ad≠ãr
->
lök_du∂ex
 =
HALF_DUPLEX
)) {

5452 
u16
 
aut⁄eg_exp
;

5454 
	`e1e_Ωhy
(
hw
, 
MII_EXPANSION
, &
aut⁄eg_exp
);

5456 i‡(!(
aut⁄eg_exp
 & 
EXPANSION_NWAY
))

5457 
	`e_öfo
("Autonegotiated half duplex butÜinkÖartner cannotáutoneg. Try forcing full duplex ifÜink gets many collisions.\n");

5461 
ad≠ãr
->
tx_timeout_Á˘‹
 = 1;

5462 
ad≠ãr
->
lök_•ìd
) {

5463 
SPEED_10
:

5464 
txb2b
 = 
Ál£
;

5465 
ad≠ãr
->
tx_timeout_Á˘‹
 = 16;

5467 
SPEED_100
:

5468 
txb2b
 = 
Ál£
;

5469 
ad≠ãr
->
tx_timeout_Á˘‹
 = 10;

5476 i‡((
ad≠ãr
->
Êags
 & 
FLAG_TARC_SPEED_MODE_BIT
) &&

5477 !
txb2b
) {

5478 
u32
 
èrc0
;

5479 
èrc0
 = 
	`î32
(
	`TARC
(0));

5480 
èrc0
 &~
SPEED_MODE_BIT
;

5481 
	`ew32
(
	`TARC
(0), 
èrc0
);

5483 #ifde‡
NETIF_F_TSO


5487 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_TSO_FORCE
)) {

5488 
ad≠ãr
->
lök_•ìd
) {

5489 
SPEED_10
:

5490 
SPEED_100
:

5491 
	`e_öfo
("10/100 speed: disabling TSO\n");

5492 
√tdev
->
„©uªs
 &~
NETIF_F_TSO
;

5493 #ifde‡
NETIF_F_TSO6


5494 
√tdev
->
„©uªs
 &~
NETIF_F_TSO6
;

5497 
SPEED_1000
:

5498 
√tdev
->
„©uªs
 |
NETIF_F_TSO
;

5499 #ifde‡
NETIF_F_TSO6


5500 
√tdev
->
„©uªs
 |
NETIF_F_TSO6
;

5513 
t˘l
 = 
	`î32
(
TCTL
);

5514 
t˘l
 |
E1000_TCTL_EN
;

5515 
	`ew32
(
TCTL
, 
t˘l
);

5520 i‡(
phy
->
›s
.
cfg_⁄_lök_up
)

5521 
phy
->
›s
.
	`cfg_⁄_lök_up
(
hw
);

5523 
	`√tif_ˇºõr_⁄
(
√tdev
);

5525 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

5526 
	`mod_timî
(&
ad≠ãr
->
phy_öfo_timî
,

5527 
	`round_jiffõs
(
jiffõs
 + 2 * 
HZ
));

5530 i‡(
	`√tif_ˇºõr_ok
(
√tdev
)) {

5531 
ad≠ãr
->
lök_•ìd
 = 0;

5532 
ad≠ãr
->
lök_du∂ex
 = 0;

5534 
	`¥_öfo
("%†NIC Lök i†Down\n", 
ad≠ãr
->
√tdev
->
«me
);

5535 
	`√tif_ˇºõr_off
(
√tdev
);

5541 i‡(
ad≠ãr
->
Êags
 & 
FLAG_RX_NEEDS_RESTART
)

5542 
ad≠ãr
->
Êags
 |
FLAG_RESTART_NOW
;

5544 
	`pm_scheduÀ_su•íd
(
√tdev
->
dev
.
∑ª¡
,

5545 
LINK_TIMEOUT
);

5549 
lök_up
:

5550 #ifde‡
HAVE_NDO_GET_STATS64


5551 
	`•ö_lock
(&
ad≠ãr
->
°©s64_lock
);

5553 
	`e1000e_upd©e_°©s
(
ad≠ãr
);

5555 
mac
->
tx_∑ckë_dñè
 = 
ad≠ãr
->
°©s
.
çt
 -ád≠ãr->
çt_ﬁd
;

5556 
ad≠ãr
->
çt_ﬁd
 =ád≠ãr->
°©s
.
çt
;

5557 
mac
->
cﬁlisi⁄_dñè
 = 
ad≠ãr
->
°©s
.
cﬁc
 -ád≠ãr->
cﬁc_ﬁd
;

5558 
ad≠ãr
->
cﬁc_ﬁd
 =ád≠ãr->
°©s
.
cﬁc
;

5560 
ad≠ãr
->
g‹c
 =ád≠ãr->
°©s
.g‹¯-ád≠ãr->
g‹c_ﬁd
;

5561 
ad≠ãr
->
g‹c_ﬁd
 =ád≠ãr->
°©s
.
g‹c
;

5562 
ad≠ãr
->
gŸc
 =ád≠ãr->
°©s
.gŸ¯-ád≠ãr->
gŸc_ﬁd
;

5563 
ad≠ãr
->
gŸc_ﬁd
 =ád≠ãr->
°©s
.
gŸc
;

5564 #ifde‡
HAVE_NDO_GET_STATS64


5565 
	`•ö_u∆ock
(&
ad≠ãr
->
°©s64_lock
);

5572 i‡(!
	`√tif_ˇºõr_ok
(
√tdev
) &&

5573 (
	`e1000_desc_unu£d
(
tx_rög
Ë+ 1 <Åx_rög->
cou¡
))

5574 
ad≠ãr
->
Êags
 |
FLAG_RESTART_NOW
;

5577 i‡(
ad≠ãr
->
Êags
 & 
FLAG_RESTART_NOW
) {

5578 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

5583 
	`e1000e_upd©e_ad≠tive
(&
ad≠ãr
->
hw
);

5586 i‡(
ad≠ãr
->
ôr_£âög
 == 4) {

5591 
u32
 
goc
 = (
ad≠ãr
->
gŸc
 +ád≠ãr->
g‹c
) / 10000;

5592 
u32
 
dif
 = (
ad≠ãr
->
gŸc
 >ád≠ãr->
g‹c
 ?

5593 
ad≠ãr
->
gŸc
 -ád≠ãr->
g‹c
 :

5594 
ad≠ãr
->
g‹c
 -ád≠ãr->
gŸc
) / 10000;

5595 
u32
 
ôr
 = 
goc
 > 0 ? (
dif
 * 6000 / goc + 2000) : 8000;

5597 
	`e1000e_wrôe_ôr
(
ad≠ãr
, 
ôr
);

5601 i‡(
ad≠ãr
->
msix_íåõs
)

5602 
	`ew32
(
ICS
, 
ad≠ãr
->
rx_rög
->
ims_vÆ
);

5604 
	`ew32
(
ICS
, 
E1000_ICS_RXDMT0
);

5607 
	`e1000e_Êush_des¸ùt‹s
(
ad≠ãr
);

5610 
ad≠ãr
->
dëe˘_tx_hung
 = 
åue
;

5615 i‡(
	`e1000e_gë_œa_°©e_82571
(
hw
))

5616 
hw
->
mac
.
›s
.
	`ør_£t
(hw, 
ad≠ãr
->hw.mac.
addr
, 0);

5618 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_CHECK_PHY_HANG
)

5619 
	`e1000e_check_82574_phy_w‹k¨ound
(
ad≠ãr
);

5621 #ifde‡
HAVE_HW_TIME_STAMP


5623 i‡(
ad≠ãr
->
hwt°amp_c⁄fig
.
rx_fûãr
 !
HWTSTAMP_FILTER_NONE
) {

5624 i‡((
ad≠ãr
->
Êags2
 & 
FLAG2_CHECK_RX_HWTSTAMP
) &&

5625 (
	`î32
(
TSYNCRXCTL
Ë& 
E1000_TSYNCRXCTL_VALID
)) {

5626 
	`î32
(
RXSTMPH
);

5627 
ad≠ãr
->
rx_hwt°amp_˛óªd
++;

5629 
ad≠ãr
->
Êags2
 |
FLAG2_CHECK_RX_HWTSTAMP
;

5635 i‡(!
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

5636 
	`mod_timî
(&
ad≠ãr
->
w©chdog_timî
,

5637 
	`round_jiffõs
(
jiffõs
 + 2 * 
HZ
));

5638 
	}
}

5640 
	#E1000_TX_FLAGS_CSUM
 0x00000001

	)

5641 
	#E1000_TX_FLAGS_VLAN
 0x00000002

	)

5642 
	#E1000_TX_FLAGS_TSO
 0x00000004

	)

5643 
	#E1000_TX_FLAGS_IPV4
 0x00000008

	)

5644 
	#E1000_TX_FLAGS_NO_FCS
 0x00000010

	)

5645 
	#E1000_TX_FLAGS_HWTSTAMP
 0x00000020

	)

5646 
	#E1000_TX_FLAGS_VLAN_MASK
 0xffff0000

	)

5647 
	#E1000_TX_FLAGS_VLAN_SHIFT
 16

	)

5649 
	$e1000_tso
(
e1000_rög
 *
tx_rög
, 
sk_buff
 *
skb
)

5651 #ifde‡
NETIF_F_TSO


5652 
e1000_c⁄ãxt_desc
 *
c⁄ãxt_desc
;

5653 
e1000_buf„r
 *
buf„r_öfo
;

5654 
i
;

5655 
u32
 
cmd_Àngth
 = 0;

5656 
u16
 
ùc£
 = 0, 
mss
;

5657 
u8
 
ùcss
, 
ùcso
, 
tucss
, 
tucso
, 
hdr_Àn
;

5659 i‡(!
	`skb_is_gso
(
skb
))

5662 i‡(
	`skb_hódî_˛⁄ed
(
skb
)) {

5663 
îr
 = 
	`pskb_ex∑nd_hód
(
skb
, 0, 0, 
GFP_ATOMIC
);

5665 i‡(
îr
)

5666  
îr
;

5669 
hdr_Àn
 = 
	`skb_å™•‹t_off£t
(
skb
Ë+ 
	`t˝_hdæí
(skb);

5670 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

5671 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IP
)) {

5672 
ùhdr
 *
ùh
 = 
	`ù_hdr
(
skb
);

5673 
ùh
->
tŸ_Àn
 = 0;

5674 
ùh
->
check
 = 0;

5675 
	`t˝_hdr
(
skb
)->
check
 = ~
	`csum_t˝udp_magic
(
ùh
->
ßddr
, iph->
daddr
,

5676 0, 
IPPROTO_TCP
, 0);

5677 
cmd_Àngth
 = 
E1000_TXD_CMD_IP
;

5678 
ùc£
 = 
	`skb_å™•‹t_off£t
(
skb
) - 1;

5679 #ifde‡
NETIF_F_TSO6


5680 } i‡(
	`skb_is_gso_v6
(
skb
)) {

5681 
	`ùv6_hdr
(
skb
)->
∑ylﬂd_Àn
 = 0;

5682 
	`t˝_hdr
(
skb
)->
check
 = ~
	`csum_ùv6_magic
(&
	`ùv6_hdr
(skb)->
ßddr
,

5683 &
	`ùv6_hdr
(
skb
)->
daddr
,

5684 0, 
IPPROTO_TCP
, 0);

5685 
ùc£
 = 0;

5688 
ùcss
 = 
	`skb_√tw‹k_off£t
(
skb
);

5689 
ùcso
 = (*)&(
	`ù_hdr
(
skb
)->
check
Ë- (*)skb->
d©a
;

5690 
tucss
 = 
	`skb_å™•‹t_off£t
(
skb
);

5691 
tucso
 = (*)&(
	`t˝_hdr
(
skb
)->
check
Ë- (*)skb->
d©a
;

5693 
cmd_Àngth
 |(
E1000_TXD_CMD_DEXT
 | 
E1000_TXD_CMD_TSE
 |

5694 
E1000_TXD_CMD_TCP
 | (
skb
->
Àn
 - (
hdr_Àn
)));

5696 
i
 = 
tx_rög
->
√xt_to_u£
;

5697 
c⁄ãxt_desc
 = 
	`E1000_CONTEXT_DESC
(*
tx_rög
, 
i
);

5698 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5700 
c⁄ãxt_desc
->
lowî_£tup
.
ù_fõlds
.
ùcss
 = ipcss;

5701 
c⁄ãxt_desc
->
lowî_£tup
.
ù_fõlds
.
ùcso
 = ipcso;

5702 
c⁄ãxt_desc
->
lowî_£tup
.
ù_fõlds
.
ùc£
 = 
	`˝u_to_À16
(ipcse);

5703 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tucss
 =Åucss;

5704 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tucso
 =Åucso;

5705 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tuc£
 = 0;

5706 
c⁄ãxt_desc
->
t˝_£g_£tup
.
fõlds
.
mss
 = 
	`˝u_to_À16
(mss);

5707 
c⁄ãxt_desc
->
t˝_£g_£tup
.
fõlds
.
hdr_Àn
 = hdr_len;

5708 
c⁄ãxt_desc
->
cmd_™d_Àngth
 = 
	`˝u_to_À32
(
cmd_Àngth
);

5710 
buf„r_öfo
->
time_°amp
 = 
jiffõs
;

5711 
buf„r_öfo
->
√xt_to_w©ch
 = 
i
;

5713 
i
++;

5714 i‡(
i
 =
tx_rög
->
cou¡
)

5715 
i
 = 0;

5716 
tx_rög
->
√xt_to_u£
 = 
i
;

5722 
	}
}

5724 
boﬁ
 
	$e1000_tx_csum
(
e1000_rög
 *
tx_rög
, 
sk_buff
 *
skb
)

5726 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

5727 
e1000_c⁄ãxt_desc
 *
c⁄ãxt_desc
;

5728 
e1000_buf„r
 *
buf„r_öfo
;

5729 
i
;

5730 
u8
 
css
;

5731 
u32
 
cmd_Àn
 = 
E1000_TXD_CMD_DEXT
;

5732 
__be16
 
¥Ÿocﬁ
;

5734 i‡(
skb
->
ù_summed
 !
CHECKSUM_PARTIAL
)

5737 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

5738 i‡(
skb
->
¥Ÿocﬁ
 =
	`˝u_to_be16
(
ETH_P_8021Q
))

5739 
¥Ÿocﬁ
 = 
	`vœn_ëh_hdr
(
skb
)->
h_vœn_íˇpsuœãd_¥Ÿo
;

5741 
¥Ÿocﬁ
 = 
skb
->protocol;

5743 
¥Ÿocﬁ
 = 
skb
->protocol;

5746 
¥Ÿocﬁ
) {

5747 
	`˝u_to_be16
(
ETH_P_IP
):

5748 i‡(
	`ù_hdr
(
skb
)->
¥Ÿocﬁ
 =
IPPROTO_TCP
)

5749 
cmd_Àn
 |
E1000_TXD_CMD_TCP
;

5751 
	`˝u_to_be16
(
ETH_P_IPV6
):

5753 i‡(
	`ùv6_hdr
(
skb
)->
√xthdr
 =
IPPROTO_TCP
)

5754 
cmd_Àn
 |
E1000_TXD_CMD_TCP
;

5757 i‡(
	`u∆ikñy
(
	`√t_øãlimô
()))

5758 
	`e_w¨n
("checksum_partialÖroto=%x!\n",

5759 
	`be16_to_˝u
(
¥Ÿocﬁ
));

5763 
css
 = 
	`skb_checksum_°¨t_off£t
(
skb
);

5765 
i
 = 
tx_rög
->
√xt_to_u£
;

5766 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5767 
c⁄ãxt_desc
 = 
	`E1000_CONTEXT_DESC
(*
tx_rög
, 
i
);

5769 
c⁄ãxt_desc
->
lowî_£tup
.
ù_c⁄fig
 = 0;

5770 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tucss
 = 
css
;

5771 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tucso
 = 
css
 + 
skb
->
csum_off£t
;

5772 
c⁄ãxt_desc
->
uµî_£tup
.
t˝_fõlds
.
tuc£
 = 0;

5773 
c⁄ãxt_desc
->
t˝_£g_£tup
.
d©a
 = 0;

5774 
c⁄ãxt_desc
->
cmd_™d_Àngth
 = 
	`˝u_to_À32
(
cmd_Àn
);

5776 
buf„r_öfo
->
time_°amp
 = 
jiffõs
;

5777 
buf„r_öfo
->
√xt_to_w©ch
 = 
i
;

5779 
i
++;

5780 i‡(
i
 =
tx_rög
->
cou¡
)

5781 
i
 = 0;

5782 
tx_rög
->
√xt_to_u£
 = 
i
;

5785 
	}
}

5787 
	$e1000_tx_m≠
(
e1000_rög
 *
tx_rög
, 
sk_buff
 *
skb
,

5788 
fú°
, 
max_≥r_txd
,

5789 
ƒ_‰ags
)

5791 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

5792 
pci_dev
 *
pdev
 = 
ad≠ãr
->pdev;

5793 
e1000_buf„r
 *
buf„r_öfo
;

5794 
Àn
 = 
	`skb_hódÀn
(
skb
);

5795 
off£t
 = 0, 
size
, 
cou¡
 = 0, 
i
;

5796 
f
, 
byãcou¡
, 
£gs
;

5798 
i
 = 
tx_rög
->
√xt_to_u£
;

5800 
Àn
) {

5801 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5802 
size
 = 
	`mö
(
Àn
, 
max_≥r_txd
);

5804 
buf„r_öfo
->
Àngth
 = 
size
;

5805 
buf„r_öfo
->
time_°amp
 = 
jiffõs
;

5806 
buf„r_öfo
->
√xt_to_w©ch
 = 
i
;

5807 
buf„r_öfo
->
dma
 = 
	`dma_m≠_sögÀ
(
	`pci_dev_to_dev
(
pdev
),

5808 
skb
->
d©a
 + 
off£t
,

5809 
size
, 
DMA_TO_DEVICE
);

5810 
buf„r_öfo
->
m≠≥d_as_∑ge
 = 
Ál£
;

5811 i‡(
	`dma_m≠pög_îr‹
(
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
))

5812 
dma_îr‹
;

5814 
Àn
 -
size
;

5815 
off£t
 +
size
;

5816 
cou¡
++;

5818 i‡(
Àn
) {

5819 
i
++;

5820 i‡(
i
 =
tx_rög
->
cou¡
)

5821 
i
 = 0;

5825 
f
 = 0; f < 
ƒ_‰ags
; f++) {

5826 c⁄° 
skb_‰ag_°ru˘
 *
‰ag
;

5828 
‰ag
 = &
	`skb_shöfo
(
skb
)->
‰ags
[
f
];

5829 
Àn
 = 
	`skb_‰ag_size
(
‰ag
);

5830 
off£t
 = 0;

5832 
Àn
) {

5833 
i
++;

5834 i‡(
i
 =
tx_rög
->
cou¡
)

5835 
i
 = 0;

5837 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5838 
size
 = 
	`mö
(
Àn
, 
max_≥r_txd
);

5840 
buf„r_öfo
->
Àngth
 = 
size
;

5841 
buf„r_öfo
->
time_°amp
 = 
jiffõs
;

5842 
buf„r_öfo
->
√xt_to_w©ch
 = 
i
;

5843 
buf„r_öfo
->
dma
 =

5844 
	`skb_‰ag_dma_m≠
(
	`pci_dev_to_dev
(
pdev
), 
‰ag
, 
off£t
,

5845 
size
, 
DMA_TO_DEVICE
);

5846 
buf„r_öfo
->
m≠≥d_as_∑ge
 = 
åue
;

5847 i‡(
dma_m≠pög_îr‹


5848 (
	`pci_dev_to_dev
(
pdev
), 
buf„r_öfo
->
dma
))

5849 
dma_îr‹
;

5851 
Àn
 -
size
;

5852 
off£t
 +
size
;

5853 
cou¡
++;

5857 #ifde‡
NETIF_F_TSO


5858 
£gs
 = 
	`skb_shöfo
(
skb
)->
gso_£gs
 ? : 1;

5860 
£gs
 = 1;

5863 
byãcou¡
 = ((
£gs
 - 1Ë* 
	`skb_hódÀn
(
skb
)Ë+ skb->
Àn
;

5865 
tx_rög
->
buf„r_öfo
[
i
].
skb
 = skb;

5866 
tx_rög
->
buf„r_öfo
[
i
].
£gs
 = segs;

5867 
tx_rög
->
buf„r_öfo
[
i
].
byãcou¡
 = bytecount;

5868 
tx_rög
->
buf„r_öfo
[
fú°
].
√xt_to_w©ch
 = 
i
;

5870  
cou¡
;

5872 
dma_îr‹
:

5873 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
), "Tx DMA map failed\n");

5874 
buf„r_öfo
->
dma
 = 0;

5875 i‡(
cou¡
)

5876 
cou¡
--;

5878 
cou¡
--) {

5879 i‡(
i
 == 0)

5880 
i
 +
tx_rög
->
cou¡
;

5881 
i
--;

5882 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5883 
	`e1000_put_txbuf
(
tx_rög
, 
buf„r_öfo
);

5887 
	}
}

5889 
	$e1000_tx_queue
(
e1000_rög
 *
tx_rög
, 
tx_Êags
, 
cou¡
)

5891 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

5892 
e1000_tx_desc
 *
tx_desc
 = 
NULL
;

5893 
e1000_buf„r
 *
buf„r_öfo
;

5894 
u32
 
txd_uµî
 = 0, 
txd_lowî
 = 
E1000_TXD_CMD_IFCS
;

5895 
i
;

5897 i‡(
tx_Êags
 & 
E1000_TX_FLAGS_TSO
) {

5898 
txd_lowî
 |
E1000_TXD_CMD_DEXT
 | 
E1000_TXD_DTYP_D
 |

5899 
E1000_TXD_CMD_TSE
;

5900 
txd_uµî
 |
E1000_TXD_POPTS_TXSM
 << 8;

5902 i‡(
tx_Êags
 & 
E1000_TX_FLAGS_IPV4
)

5903 
txd_uµî
 |
E1000_TXD_POPTS_IXSM
 << 8;

5906 i‡(
tx_Êags
 & 
E1000_TX_FLAGS_CSUM
) {

5907 
txd_lowî
 |
E1000_TXD_CMD_DEXT
 | 
E1000_TXD_DTYP_D
;

5908 
txd_uµî
 |
E1000_TXD_POPTS_TXSM
 << 8;

5911 i‡(
tx_Êags
 & 
E1000_TX_FLAGS_VLAN
) {

5912 
txd_lowî
 |
E1000_TXD_CMD_VLE
;

5913 
txd_uµî
 |(
tx_Êags
 & 
E1000_TX_FLAGS_VLAN_MASK
);

5916 i‡(
	`u∆ikñy
(
tx_Êags
 & 
E1000_TX_FLAGS_NO_FCS
))

5917 
txd_lowî
 &~(
E1000_TXD_CMD_IFCS
);

5919 #ifde‡
HAVE_HW_TIME_STAMP


5920 i‡(
	`u∆ikñy
(
tx_Êags
 & 
E1000_TX_FLAGS_HWTSTAMP
)) {

5921 
txd_lowî
 |
E1000_TXD_CMD_DEXT
 | 
E1000_TXD_DTYP_D
;

5922 
txd_uµî
 |
E1000_TXD_EXTCMD_TSTAMP
;

5926 
i
 = 
tx_rög
->
√xt_to_u£
;

5929 
buf„r_öfo
 = &
tx_rög
->buf„r_öfo[
i
];

5930 
tx_desc
 = 
	`E1000_TX_DESC
(*
tx_rög
, 
i
);

5931 
tx_desc
->
buf„r_addr
 = 
	`˝u_to_À64
(
buf„r_öfo
->
dma
);

5932 
tx_desc
->
lowî
.
d©a
 = 
	`˝u_to_À32
(
txd_lowî
 |

5933 
buf„r_öfo
->
Àngth
);

5934 
tx_desc
->
uµî
.
d©a
 = 
	`˝u_to_À32
(
txd_uµî
);

5936 
i
++;

5937 i‡(
i
 =
tx_rög
->
cou¡
)

5938 
i
 = 0;

5939 } --
cou¡
 > 0);

5941 
tx_desc
->
lowî
.
d©a
 |
	`˝u_to_À32
(
ad≠ãr
->
txd_cmd
);

5944 i‡(
	`u∆ikñy
(
tx_Êags
 & 
E1000_TX_FLAGS_NO_FCS
))

5945 
tx_desc
->
lowî
.
d©a
 &~(
	`˝u_to_À32
(
E1000_TXD_CMD_IFCS
));

5952 
	`wmb
();

5954 
tx_rög
->
√xt_to_u£
 = 
i
;

5956 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_PCIM2PCI_ARBITER_WA
)

5957 
	`e1000e_upd©e_tdt_wa
(
tx_rög
, 
i
);

5959 
	`wrôñ
(
i
, 
tx_rög
->
èû
);

5964 
	`mmiowb
();

5965 
	}
}

5967 
	#MINIMUM_DHCP_PACKET_SIZE
 282

	)

5968 
	$e1000_å™s„r_dh˝_öfo
(
e1000_ad≠ãr
 *
ad≠ãr
,

5969 
sk_buff
 *
skb
)

5971 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

5972 
u16
 
Àngth
, 
off£t
;

5974 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

5975 i‡(
	`vœn_tx_èg_¥e£¡
(
skb
) &&

5976 !((
	`vœn_tx_èg_gë
(
skb
Ë=
ad≠ãr
->
hw
.
mng_cookõ
.
vœn_id
) &&

5977 (
ad≠ãr
->
hw
.
mng_cookõ
.
°©us
 &

5978 
E1000_MNG_DHCP_COOKIE_STATUS_VLAN
)))

5982 i‡(
skb
->
Àn
 <
MINIMUM_DHCP_PACKET_SIZE
)

5985 i‡(((
ëhhdr
 *)
skb
->
d©a
)->
h_¥Ÿo
 !
	`ht⁄s
(
ETH_P_IP
))

5989 c⁄° 
ùhdr
 *
ù
 = (ùhd∏*)((
u8
 *)
skb
->
d©a
 + 14);

5990 
udphdr
 *
udp
;

5992 i‡(
ù
->
¥Ÿocﬁ
 !
IPPROTO_UDP
)

5995 
udp
 = (
udphdr
 *)((
u8
 *)
ù
 + (ù->
ihl
 << 2));

5996 i‡(
	`¡ohs
(
udp
->
de°
) != 67)

5999 
off£t
 = (
u8
 *)
udp
 + 8 - 
skb
->
d©a
;

6000 
Àngth
 = 
skb
->
Àn
 - 
off£t
;

6001  
	`e1000e_mng_wrôe_dh˝_öfo
(
hw
, (
u8
 *)
udp
 + 8, 
Àngth
);

6005 
	}
}

6007 
	$__e1000_maybe_°›_tx
(
e1000_rög
 *
tx_rög
, 
size
)

6009 
e1000_ad≠ãr
 *
ad≠ãr
 = 
tx_rög
->adapter;

6011 
	`√tif_°›_queue
(
ad≠ãr
->
√tdev
);

6016 
	`smp_mb
();

6021 i‡(
	`e1000_desc_unu£d
(
tx_rög
Ë< 
size
)

6022  -
EBUSY
;

6025 
	`√tif_°¨t_queue
(
ad≠ãr
->
√tdev
);

6026 ++
ad≠ãr
->
ª°¨t_queue
;

6028 
	}
}

6030 
	$e1000_maybe_°›_tx
(
e1000_rög
 *
tx_rög
, 
size
)

6032 
	`BUG_ON
(
size
 > 
tx_rög
->
cou¡
);

6034 i‡(
	`e1000_desc_unu£d
(
tx_rög
Ë>
size
)

6036  
	`__e1000_maybe_°›_tx
(
tx_rög
, 
size
);

6037 
	}
}

6039 
√tdev_tx_t
 
	$e1000_xmô_‰ame
(
sk_buff
 *
skb
,

6040 
√t_devi˚
 *
√tdev
)

6042 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6043 
e1000_rög
 *
tx_rög
 = 
ad≠ãr
->tx_ring;

6044 
fú°
;

6045 
tx_Êags
 = 0;

6046 
Àn
 = 
	`skb_hódÀn
(
skb
);

6047 
ƒ_‰ags
;

6048 
mss
;

6049 
cou¡
 = 0;

6050 
tso
;

6051 
f
;

6053 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
)) {

6054 
	`dev_k‰ì_skb_™y
(
skb
);

6055  
NETDEV_TX_OK
;

6058 i‡(
skb
->
Àn
 <= 0) {

6059 
	`dev_k‰ì_skb_™y
(
skb
);

6060  
NETDEV_TX_OK
;

6066 i‡(
	`u∆ikñy
(
skb
->
Àn
 < 17)) {

6067 i‡(
	`skb_∑d
(
skb
, 17 - skb->
Àn
))

6068  
NETDEV_TX_OK
;

6069 
skb
->
Àn
 = 17;

6070 
	`skb_£t_èû_poöãr
(
skb
, 17);

6072 #ifde‡
NETIF_F_TSO


6073 
mss
 = 
	`skb_shöfo
(
skb
)->
gso_size
;

6074 i‡(
mss
) {

6075 
u8
 
hdr_Àn
;

6081 
hdr_Àn
 = 
	`skb_å™•‹t_off£t
(
skb
Ë+ 
	`t˝_hdæí
(skb);

6085 i‡(
skb
->
d©a_Àn
 && (
hdr_Àn
 =
Àn
)) {

6086 
puŒ_size
;

6088 
puŒ_size
 = 
	`mö_t
(, 4, 
skb
->
d©a_Àn
);

6089 i‡(!
	`__pskb_puŒ_èû
(
skb
, 
puŒ_size
)) {

6090 
	`e_îr
("__pskb_pull_tail failed.\n");

6091 
	`dev_k‰ì_skb_™y
(
skb
);

6092  
NETDEV_TX_OK
;

6094 
Àn
 = 
	`skb_hódÀn
(
skb
);

6099 i‡((
mss
Ë|| (
skb
->
ù_summed
 =
CHECKSUM_PARTIAL
))

6100 
cou¡
++;

6101 
cou¡
++;

6103 
mss
 = 0;

6105 i‡(
skb
->
ù_summed
 =
CHECKSUM_PARTIAL
)

6106 
cou¡
++;

6109 
cou¡
 +
	`DIV_ROUND_UP
(
Àn
, 
ad≠ãr
->
tx_fifo_limô
);

6111 
ƒ_‰ags
 = 
	`skb_shöfo
(
skb
)->nr_frags;

6112 
f
 = 0; f < 
ƒ_‰ags
; f++)

6113 
cou¡
 +
	`DIV_ROUND_UP
(
	`skb_‰ag_size
(&
	`skb_shöfo
(
skb
)->
‰ags
[
f
]),

6114 
ad≠ãr
->
tx_fifo_limô
);

6116 i‡(
ad≠ãr
->
hw
.
mac
.
tx_pkt_fûãrög
)

6117 
	`e1000_å™s„r_dh˝_öfo
(
ad≠ãr
, 
skb
);

6122 i‡(
	`e1000_maybe_°›_tx
(
tx_rög
, 
cou¡
 + 2))

6123  
NETDEV_TX_BUSY
;

6125 #i‡
	`deföed
(
NETIF_F_HW_VLAN_TX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_TX
)

6126 i‡(
	`vœn_tx_èg_¥e£¡
(
skb
)) {

6127 
tx_Êags
 |
E1000_TX_FLAGS_VLAN
;

6128 
tx_Êags
 |(
	`vœn_tx_èg_gë
(
skb
Ë<< 
E1000_TX_FLAGS_VLAN_SHIFT
);

6131 
fú°
 = 
tx_rög
->
√xt_to_u£
;

6133 
tso
 = 
	`e1000_tso
(
tx_rög
, 
skb
);

6134 i‡(
tso
 < 0) {

6135 
	`dev_k‰ì_skb_™y
(
skb
);

6136  
NETDEV_TX_OK
;

6139 i‡(
tso
)

6140 
tx_Êags
 |
E1000_TX_FLAGS_TSO
;

6141 i‡(
	`e1000_tx_csum
(
tx_rög
, 
skb
))

6142 
tx_Êags
 |
E1000_TX_FLAGS_CSUM
;

6148 i‡(
skb
->
¥Ÿocﬁ
 =
	`ht⁄s
(
ETH_P_IP
))

6149 
tx_Êags
 |
E1000_TX_FLAGS_IPV4
;

6151 #ifde‡
IFF_SUPP_NOFCS


6152 i‡(
	`u∆ikñy
(
skb
->
no_fcs
))

6153 
tx_Êags
 |
E1000_TX_FLAGS_NO_FCS
;

6157 
cou¡
 = 
	`e1000_tx_m≠
(
tx_rög
, 
skb
, 
fú°
, 
ad≠ãr
->
tx_fifo_limô
,

6158 
ƒ_‰ags
);

6159 i‡(
cou¡
) {

6160 #ifde‡
HAVE_HW_TIME_STAMP


6161 #ifde‡
SKB_SHARED_TX_IS_UNION


6162 i‡(
	`u∆ikñy
((
	`skb_shöfo
(
skb
)->
tx_Êags
.
Êags
 &

6163 
SKBTX_HW_TSTAMP
Ë&& !
ad≠ãr
->
tx_hwt°amp_skb
)) {

6164 
	`skb_shöfo
(
skb
)->
tx_Êags
.
Êags
 |
SKBTX_IN_PROGRESS
;

6165 
tx_Êags
 |
E1000_TX_FLAGS_HWTSTAMP
;

6166 
ad≠ãr
->
tx_hwt°amp_skb
 = 
	`skb_gë
(
skb
);

6167 
	`scheduÀ_w‹k
(&
ad≠ãr
->
tx_hwt°amp_w‹k
);

6169 
	`skb_tx_time°amp
(
skb
);

6172 i‡(
	`u∆ikñy
((
	`skb_shöfo
(
skb
)->
tx_Êags
 & 
SKBTX_HW_TSTAMP
) &&

6173 !
ad≠ãr
->
tx_hwt°amp_skb
)) {

6174 
	`skb_shöfo
(
skb
)->
tx_Êags
 |
SKBTX_IN_PROGRESS
;

6175 
tx_Êags
 |
E1000_TX_FLAGS_HWTSTAMP
;

6176 
ad≠ãr
->
tx_hwt°amp_skb
 = 
	`skb_gë
(
skb
);

6177 
	`scheduÀ_w‹k
(&
ad≠ãr
->
tx_hwt°amp_w‹k
);

6179 
	`skb_tx_time°amp
(
skb
);

6183 
	`skb_tx_time°amp
(
skb
);

6186 
	`√tdev_£¡_queue
(
√tdev
, 
skb
->
Àn
);

6187 
	`e1000_tx_queue
(
tx_rög
, 
tx_Êags
, 
cou¡
);

6189 
	`e1000_maybe_°›_tx
(
tx_rög
,

6190 (
MAX_SKB_FRAGS
 *

6191 
	`DIV_ROUND_UP
(
PAGE_SIZE
,

6192 
ad≠ãr
->
tx_fifo_limô
) + 2));

6194 
	`dev_k‰ì_skb_™y
(
skb
);

6195 
tx_rög
->
buf„r_öfo
[
fú°
].
time_°amp
 = 0;

6196 
tx_rög
->
√xt_to_u£
 = 
fú°
;

6198 
√tdev
->
å™s_°¨t
 = 
jiffõs
;

6200  
NETDEV_TX_OK
;

6201 
	}
}

6207 
	$e1000_tx_timeout
(
√t_devi˚
 *
√tdev
)

6209 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6210 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

6212 
	`e_dbg
("NETDEV WATCHDOG:ÅransmitÅimed out -Ñesetting\n");

6215 
ad≠ãr
->
tx_timeout_cou¡
++;

6216 
	`scheduÀ_w‹k
(&
ad≠ãr
->
ª£t_èsk
);

6217 
	}
}

6219 
	$e1000_ª£t_èsk
(
w‹k_°ru˘
 *
w‹k
)

6221 
e1000_ad≠ãr
 *
ad≠ãr
;

6222 
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
, 
e1000_ad≠ãr
, 
ª£t_èsk
);

6225 i‡(
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
))

6228 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_RESTART_NOW
)) {

6229 
	`e1000e_dump
(
ad≠ãr
);

6230 
	`e_îr
("Resetádapter unexpectedly\n");

6232 
	`e1000e_ªöô_locked
(
ad≠ãr
);

6233 
	}
}

6235 #ifde‡
HAVE_NDO_GET_STATS64


6243 
π∆_lök_°©s64
 *
	$e1000e_gë_°©s64
(
√t_devi˚
 *
√tdev
,

6244 
π∆_lök_°©s64
 *
°©s
)

6246 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6248 
	`mem£t
(
°©s
, 0, (
π∆_lök_°©s64
));

6249 
	`•ö_lock
(&
ad≠ãr
->
°©s64_lock
);

6250 
	`e1000e_upd©e_°©s
(
ad≠ãr
);

6252 
°©s
->
rx_byãs
 = 
ad≠ãr
->°©s.
g‹c
;

6253 
°©s
->
rx_∑ckës
 = 
ad≠ãr
->°©s.
g¥c
;

6254 
°©s
->
tx_byãs
 = 
ad≠ãr
->°©s.
gŸc
;

6255 
°©s
->
tx_∑ckës
 = 
ad≠ãr
->°©s.
g±c
;

6256 
°©s
->
mu…iˇ°
 = 
ad≠ãr
->°©s.
m¥c
;

6257 
°©s
->
cﬁlisi⁄s
 = 
ad≠ãr
->°©s.
cﬁc
;

6264 
°©s
->
rx_îr‹s
 = 
ad≠ãr
->°©s.
rxîrc
 +

6265 
ad≠ãr
->
°©s
.
¸˚ºs
 +ád≠ãr->°©s.
Æg√ºc
 +

6266 
ad≠ãr
->
°©s
.
ruc
 +ád≠ãr->°©s.
roc
 +ád≠ãr->°©s.
˚xãº
;

6267 
°©s
->
rx_Àngth_îr‹s
 = 
ad≠ãr
->°©s.
ruc
 +ád≠ãr->°©s.
roc
;

6268 
°©s
->
rx_¸c_îr‹s
 = 
ad≠ãr
->°©s.
¸˚ºs
;

6269 
°©s
->
rx_‰ame_îr‹s
 = 
ad≠ãr
->°©s.
Æg√ºc
;

6270 
°©s
->
rx_mis£d_îr‹s
 = 
ad≠ãr
->°©s.
mpc
;

6273 
°©s
->
tx_îr‹s
 = 
ad≠ãr
->°©s.
ecﬁ
 +ád≠ãr->°©s.
œãcﬁ
;

6274 
°©s
->
tx_ab‹ãd_îr‹s
 = 
ad≠ãr
->°©s.
ecﬁ
;

6275 
°©s
->
tx_wödow_îr‹s
 = 
ad≠ãr
->°©s.
œãcﬁ
;

6276 
°©s
->
tx_ˇºõr_îr‹s
 = 
ad≠ãr
->°©s.
ä¸s
;

6280 
	`•ö_u∆ock
(&
ad≠ãr
->
°©s64_lock
);

6281  
°©s
;

6282 
	}
}

6291 
√t_devi˚_°©s
 *
	$e1000_gë_°©s
(
√t_devi˚
 *
√tdev
)

6293 #i‚de‡
HAVE_NETDEV_STATS_IN_NETDEV


6294 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6297  &
ad≠ãr
->
√t_°©s
;

6300  &
√tdev
->
°©s
;

6302 
	}
}

6312 
	$e1000_ch™ge_mtu
(
√t_devi˚
 *
√tdev
, 
√w_mtu
)

6314 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6315 
max_‰ame
 = 
√w_mtu
 + 
ETH_HLEN
 + 
ETH_FCS_LEN
;

6318 i‡((
max_‰ame
 > 
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
) &&

6319 !(
ad≠ãr
->
Êags
 & 
FLAG_HAS_JUMBO_FRAMES
)) {

6320 
	`e_îr
("Jumbo FramesÇot supported.\n");

6321  -
EINVAL
;

6325 i‡((
√w_mtu
 < 
ETH_ZLEN
 + 
ETH_FCS_LEN
 + 
VLAN_HLEN
) ||

6326 (
max_‰ame
 > 
ad≠ãr
->
max_hw_‰ame_size
)) {

6327 
	`e_îr
("Unsupported MTU setting\n");

6328  -
EINVAL
;

6332 i‡((
ad≠ãr
->
hw
.
mac
.
ty≥
 >
e1000_pch2œn
) &&

6333 !(
ad≠ãr
->
Êags2
 & 
FLAG2_CRC_STRIPPING
) &&

6334 (
√w_mtu
 > 
ETH_DATA_LEN
)) {

6335 
	`e_îr
("Jumbo FramesÇot supported onÅhis device when CRC stripping is disabled.\n");

6336  -
EINVAL
;

6339 
	`ã°_™d_£t_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
))

6340 
	`u¶ìp_ønge
(1000, 2000);

6342 
ad≠ãr
->
max_‰ame_size
 = 
max_‰ame
;

6343 
	`e_öfo
("ch™gög MTU from %dÅÿ%d\n", 
√tdev
->
mtu
, 
√w_mtu
);

6344 
√tdev
->
mtu
 = 
√w_mtu
;

6345 i‡(
	`√tif_ru¬ög
(
√tdev
))

6346 
	`e1000e_down
(
ad≠ãr
, 
åue
);

6356 i‡(
max_‰ame
 <= 2048)

6357 
ad≠ãr
->
rx_buf„r_Àn
 = 2048;

6358 #ifde‡
CONFIG_E1000E_NAPI


6360 
ad≠ãr
->
rx_buf„r_Àn
 = 4096;

6362 i‡(
max_‰ame
 <= 4096)

6363 
ad≠ãr
->
rx_buf„r_Àn
 = 4096;

6364 i‡(
max_‰ame
 <= 8192)

6365 
ad≠ãr
->
rx_buf„r_Àn
 = 8192;

6366 i‡(
max_‰ame
 <= 16384)

6367 
ad≠ãr
->
rx_buf„r_Àn
 = 16384;

6371 i‡((
max_‰ame
 =
ETH_FRAME_LEN
 + 
ETH_FCS_LEN
) ||

6372 (
max_‰ame
 =
ETH_FRAME_LEN
 + 
VLAN_HLEN
 + 
ETH_FCS_LEN
))

6373 
ad≠ãr
->
rx_buf„r_Àn
 = 
ETH_FRAME_LEN
 + 
VLAN_HLEN


6374 + 
ETH_FCS_LEN
;

6376 i‡(
	`√tif_ru¬ög
(
√tdev
))

6377 
	`e1000e_up
(
ad≠ãr
);

6379 
	`e1000e_ª£t
(
ad≠ãr
);

6381 
	`˛ór_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
);

6384 
	}
}

6386 #i‡
deföed
(
SIOCGMIIPHY
Ë|| deföed(
SIOCGMIIREG
Ë|| deföed(
SIOCSMIIREG
)

6387 
	$e1000_mii_io˘l
(
√t_devi˚
 *
√tdev
, 
i‰eq
 *
i‰
,

6388 
cmd
)

6390 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6391 
mii_io˘l_d©a
 *
d©a
 = 
	`if_mii
(
i‰
);

6393 i‡(
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
)

6394  -
EOPNOTSUPP
;

6396 
cmd
) {

6397 #ifde‡
SIOCGMIIPHY


6398 
SIOCGMIIPHY
:

6399 
d©a
->
phy_id
 = 
ad≠ãr
->
hw
.
phy
.
addr
;

6402 #ifde‡
SIOCGMIIREG


6403 
SIOCGMIIREG
:

6404 
	`e1000_phy_ªad_°©us
(
ad≠ãr
);

6406 
d©a
->
ªg_num
 & 0x1F) {

6407 
MII_BMCR
:

6408 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
bm¸
;

6410 
MII_BMSR
:

6411 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
bm§
;

6413 
MII_PHYSID1
:

6414 
d©a
->
vÆ_out
 = (
ad≠ãr
->
hw
.
phy
.
id
 >> 16);

6416 
MII_PHYSID2
:

6417 
d©a
->
vÆ_out
 = (
ad≠ãr
->
hw
.
phy
.
id
 & 0xFFFF);

6419 
MII_ADVERTISE
:

6420 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
advîti£
;

6422 
MII_LPA
:

6423 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
Õa
;

6425 
MII_EXPANSION
:

6426 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
ex∑nsi⁄
;

6428 
MII_CTRL1000
:

6429 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
˘æ1000
;

6431 
MII_STAT1000
:

6432 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
°©1000
;

6434 
MII_ESTATUS
:

6435 
d©a
->
vÆ_out
 = 
ad≠ãr
->
phy_ªgs
.
e°©us
;

6438  -
EIO
;

6442 #ifde‡
SIOCGMIIREG


6443 
SIOCSMIIREG
:

6446  -
EOPNOTSUPP
;

6449 
	}
}

6452 #i‡
deföed
(
SIOCSHWTSTAMP
Ë&& deföed(
HAVE_HW_TIME_STAMP
)

6469 
	$e1000e_hwt°amp_io˘l
(
√t_devi˚
 *
√tdev
, 
i‰eq
 *
i‰
)

6471 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6472 
hwt°amp_c⁄fig
 
c⁄fig
;

6473 
ªt_vÆ
;

6475 i‡(
	`c›y_‰om_u£r
(&
c⁄fig
, 
i‰
->
i‰_d©a
, (config)))

6476  -
EFAULT
;

6478 
ad≠ãr
->
hwt°amp_c⁄fig
 = 
c⁄fig
;

6480 
ªt_vÆ
 = 
	`e1000e_c⁄fig_hwt°amp
(
ad≠ãr
);

6481 i‡(
ªt_vÆ
)

6482  
ªt_vÆ
;

6484 
c⁄fig
 = 
ad≠ãr
->
hwt°amp_c⁄fig
;

6486 #ifde‡
HAVE_PTP_1588_CLOCK


6487 
c⁄fig
.
rx_fûãr
) {

6488 
HWTSTAMP_FILTER_PTP_V2_L4_SYNC
:

6489 
HWTSTAMP_FILTER_PTP_V2_L2_SYNC
:

6490 
HWTSTAMP_FILTER_PTP_V2_SYNC
:

6491 
HWTSTAMP_FILTER_PTP_V2_L4_DELAY_REQ
:

6492 
HWTSTAMP_FILTER_PTP_V2_L2_DELAY_REQ
:

6493 
HWTSTAMP_FILTER_PTP_V2_DELAY_REQ
:

6499 
c⁄fig
.
rx_fûãr
 = 
HWTSTAMP_FILTER_SOME
;

6506  
	`c›y_to_u£r
(
i‰
->
i‰_d©a
, &
c⁄fig
,

6507 (
c⁄fig
)Ë? -
EFAULT
 : 0;

6508 
	}
}

6511 
	$e1000_io˘l
(
√t_devi˚
 *
√tdev
, 
i‰eq
 *
i‰
, 
cmd
)

6513 
cmd
) {

6514 #ifde‡
SIOCGMIIPHY


6515 
SIOCGMIIPHY
:

6517 #ifde‡
SIOCGMIIREG


6518 
SIOCGMIIREG
:

6520 #ifde‡
SIOCSMIIREG


6521 
SIOCSMIIREG
:

6523 #i‡
	`deföed
(
SIOCGMIIPHY
Ë|| deföed(
SIOCGMIIREG
Ë|| deföed(
SIOCSMIIREG
)

6524  
	`e1000_mii_io˘l
(
√tdev
, 
i‰
, 
cmd
);

6526 #i‡
	`deföed
(
SIOCSHWTSTAMP
Ë&& deföed(
HAVE_HW_TIME_STAMP
)

6527 
SIOCSHWTSTAMP
:

6528  
	`e1000e_hwt°amp_io˘l
(
√tdev
, 
i‰
);

6530 #ifde‡
ETHTOOL_OPS_COMPAT


6531 
SIOCETHTOOL
:

6532  
	`ëhtoﬁ_io˘l
(
i‰
);

6535  -
EOPNOTSUPP
;

6537 
	}
}

6539 
	$e1000_öô_phy_wakeup
(
e1000_ad≠ãr
 *
ad≠ãr
, 
u32
 
wufc
)

6541 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

6542 
u32
 
i
, 
mac_ªg
, 
wuc
;

6543 
u16
 
phy_ªg
, 
wuc_íabÀ
;

6544 
ªtvÆ
;

6547 
	`e1000_c›y_rx_addrs_to_phy_ich8œn
(
hw
);

6549 
ªtvÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

6550 i‡(
ªtvÆ
) {

6551 
	`e_îr
("CouldÇotácquire PHY\n");

6552  
ªtvÆ
;

6556 
ªtvÆ
 = 
	`e1000_íabÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
wuc_íabÀ
);

6557 i‡(
ªtvÆ
)

6558 
ªÀa£
;

6561 
i
 = 0; i < 
ad≠ãr
->
hw
.
mac
.
mè_ªg_cou¡
; i++) {

6562 
mac_ªg
 = 
	`E1000_READ_REG_ARRAY
(
hw
, 
E1000_MTA
, 
i
);

6563 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_MTA
(
i
),

6564 (
u16
)(
mac_ªg
 & 0xFFFF));

6565 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(hw, 
	`BM_MTA
(
i
) + 1,

6566 (
u16
)((
mac_ªg
 >> 16) & 0xFFFF));

6570 
hw
->
phy
.
›s
.
	`ªad_ªg_∑ge
(&
ad≠ãr
->hw, 
BM_RCTL
, &
phy_ªg
);

6571 
mac_ªg
 = 
	`î32
(
RCTL
);

6572 i‡(
mac_ªg
 & 
E1000_RCTL_UPE
)

6573 
phy_ªg
 |
BM_RCTL_UPE
;

6574 i‡(
mac_ªg
 & 
E1000_RCTL_MPE
)

6575 
phy_ªg
 |
BM_RCTL_MPE
;

6576 
phy_ªg
 &~(
BM_RCTL_MO_MASK
);

6577 i‡(
mac_ªg
 & 
E1000_RCTL_MO_3
)

6578 
phy_ªg
 |(((
mac_ªg
 & 
E1000_RCTL_MO_3
Ë>> 
E1000_RCTL_MO_SHIFT
)

6579 << 
BM_RCTL_MO_SHIFT
);

6580 i‡(
mac_ªg
 & 
E1000_RCTL_BAM
)

6581 
phy_ªg
 |
BM_RCTL_BAM
;

6582 i‡(
mac_ªg
 & 
E1000_RCTL_PMCF
)

6583 
phy_ªg
 |
BM_RCTL_PMCF
;

6584 
mac_ªg
 = 
	`î32
(
CTRL
);

6585 i‡(
mac_ªg
 & 
E1000_CTRL_RFCE
)

6586 
phy_ªg
 |
BM_RCTL_RFCE
;

6587 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(&
ad≠ãr
->hw, 
BM_RCTL
, 
phy_ªg
);

6589 
wuc
 = 
E1000_WUC_PME_EN
;

6590 i‡(
wufc
 & (
E1000_WUFC_MAG
 | 
E1000_WUFC_LNKC
))

6591 
wuc
 |
E1000_WUC_APME
;

6594 
	`ew32
(
WUFC
, 
wufc
);

6595 
	`ew32
(
WUC
, (
E1000_WUC_PHY_WAKE
 | 
E1000_WUC_APMPME
 |

6596 
E1000_WUC_PME_STATUS
 | 
wuc
));

6599 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(&
ad≠ãr
->hw, 
BM_WUFC
, 
wufc
);

6600 
hw
->
phy
.
›s
.
	`wrôe_ªg_∑ge
(&
ad≠ãr
->hw, 
BM_WUC
, 
wuc
);

6603 
wuc_íabÀ
 |
BM_WUC_ENABLE_BIT
 | 
BM_WUC_HOST_WU_BIT
;

6604 
ªtvÆ
 = 
	`e1000_dißbÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
wuc_íabÀ
);

6605 i‡(
ªtvÆ
)

6606 
	`e_îr
("CouldÇot set PHY Host Wakeup bit\n");

6607 
ªÀa£
:

6608 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

6610  
ªtvÆ
;

6611 
	}
}

6613 
	$e1000e_pm_‰ìze
(
devi˚
 *
dev
)

6615 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
	`to_pci_dev
(
dev
));

6616 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6618 
	`√tif_devi˚_dëach
(
√tdev
);

6620 i‡(
	`√tif_ru¬ög
(
√tdev
)) {

6621 
cou¡
 = 
E1000_CHECK_RESET_COUNT
;

6623 
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
Ë&& 
cou¡
--)

6624 
	`u¶ìp_ønge
(10000, 20000);

6626 
	`WARN_ON
(
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
));

6629 
	`e1000e_down
(
ad≠ãr
, 
Ál£
);

6630 
	`e1000_‰ì_úq
(
ad≠ãr
);

6632 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

6635 
	`e1000e_dißbÀ_pcõ_ma°î
(&
ad≠ãr
->
hw
);

6638 
	}
}

6640 
	$__e1000_shutdown
(
pci_dev
 *
pdev
, 
boﬁ
 
ru¡ime
)

6642 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

6643 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6644 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

6645 
u32
 
˘æ
, 
˘æ_ext
, 
r˘l
, 
°©us
;

6647 
u32
 
wufc
 = 
ru¡ime
 ? 
E1000_WUFC_LNKC
 : 
ad≠ãr
->
wﬁ
;

6648 
ªtvÆ
 = 0;

6650 #ifde‡
USE_LEGACY_PM_SUPPORT


6651 
ªtvÆ
 = 
	`pci_ßve_°©e
(
pdev
);

6652 i‡(
ªtvÆ
)

6653  
ªtvÆ
;

6656 
°©us
 = 
	`î32
(
STATUS
);

6657 i‡(
°©us
 & 
E1000_STATUS_LU
)

6658 
wufc
 &~
E1000_WUFC_LNKC
;

6660 i‡(
wufc
) {

6661 
	`e1000_£tup_r˘l
(
ad≠ãr
);

6662 
	`e1000e_£t_rx_mode
(
√tdev
);

6665 i‡(
wufc
 & 
E1000_WUFC_MC
) {

6666 
r˘l
 = 
	`î32
(
RCTL
);

6667 
r˘l
 |
E1000_RCTL_MPE
;

6668 
	`ew32
(
RCTL
, 
r˘l
);

6671 
˘æ
 = 
	`î32
(
CTRL
);

6672 
˘æ
 |
E1000_CTRL_ADVD3WUC
;

6673 i‡(!(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_PHY_WAKEUP
))

6674 
˘æ
 |
E1000_CTRL_EN_PHY_PWR_MGMT
;

6675 
	`ew32
(
CTRL
, 
˘æ
);

6677 i‡(
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 =
e1000_medü_ty≥_fibî
 ||

6678 
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 ==

6679 
e1000_medü_ty≥_öã∫Æ_£rdes
) {

6681 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

6682 
˘æ_ext
 |
E1000_CTRL_EXT_SDP3_DATA
;

6683 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

6686 i‡(!
ru¡ime
)

6687 
	`e1000e_powî_up_phy
(
ad≠ãr
);

6689 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_ICH
)

6690 
	`e1000_su•íd_w‹k¨ounds_ich8œn
(&
ad≠ãr
->
hw
);

6692 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_PHY_WAKEUP
) {

6694 
ªtvÆ
 = 
	`e1000_öô_phy_wakeup
(
ad≠ãr
, 
wufc
);

6695 i‡(
ªtvÆ
)

6696  
ªtvÆ
;

6699 
	`ew32
(
WUFC
, 
wufc
);

6700 
	`ew32
(
WUC
, 
E1000_WUC_PME_EN
);

6703 
	`ew32
(
WUC
, 0);

6704 
	`ew32
(
WUFC
, 0);

6706 
	`e1000_powî_down_phy
(
ad≠ãr
);

6709 i‡(
ad≠ãr
->
hw
.
phy
.
ty≥
 =
e1000_phy_igp_3
) {

6710 
	`e1000e_igp3_phy_powîdown_w‹k¨ound_ich8œn
(&
ad≠ãr
->
hw
);

6711 } i‡(
hw
->
mac
.
ty≥
 =
e1000_pch_Õt
) {

6713 i‡(
	`ã°_bô
(
__E1000_SHUTDOWN
, &
ad≠ãr
->
°©e
))

6714 
ªtvÆ
 = 
	`e1000_dißbÀ_uÕ_Õt_Õ
(
hw
, 
åue
);

6715 i‡(!(
wufc
 & (
E1000_WUFC_EX
 | 
E1000_WUFC_MC
 |

6716 
E1000_WUFC_BC
)))

6720 
ªtvÆ
 = 
	`e1000_íabÀ_uÕ_Õt_Õ
(
hw
, !
ru¡ime
);

6722 i‡(
ªtvÆ
)

6723  
ªtvÆ
;

6729 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

6731 #ifde‡
USE_LEGACY_PM_SUPPORT


6732 
	`pci_dißbÀ_devi˚
(
pdev
);

6734 
	`pci_˛ór_ma°î
(
pdev
);

6742 i‡(
ad≠ãr
->
Êags
 & 
FLAG_IS_QUAD_PORT
) {

6743 
pci_dev
 *
us_dev
 = 
pdev
->
bus
->
£lf
;

6744 
u16
 
dev˘l
;

6746 
	`pcõ_ˇ∑bûôy_ªad_w‹d
(
us_dev
, 
PCI_EXP_DEVCTL
, &
dev˘l
);

6747 
	`pcõ_ˇ∑bûôy_wrôe_w‹d
(
us_dev
, 
PCI_EXP_DEVCTL
,

6748 (
dev˘l
 & ~
PCI_EXP_DEVCTL_CERE
));

6750 
	`pci_ßve_°©e
(
pdev
);

6751 
	`pci_¥ï¨e_to_¶ìp
(
pdev
);

6753 
	`pcõ_ˇ∑bûôy_wrôe_w‹d
(
us_dev
, 
PCI_EXP_DEVCTL
, 
dev˘l
);

6755 #ifde‡
USE_LEGACY_PM_SUPPORT


6757 
	`pci_¥ï¨e_to_¶ìp
(
pdev
);

6761 
	}
}

6763 #ifde‡
CONFIG_PCIEASPM


6764 
	$__e1000e_dißbÀ_a•m
(
pci_dev
 *
pdev
, 
u16
 
°©e
)

6766 
	`pci_dißbÀ_lök_°©e_locked
(
pdev
, 
°©e
);

6767 
	}
}

6769 
	$__e1000e_dißbÀ_a•m
(
pci_dev
 *
pdev
, 
u16
 
°©e
)

6771 
u16
 
a•m_˘l
 = 0;

6773 i‡(
°©e
 & 
PCIE_LINK_STATE_L0S
)

6774 
a•m_˘l
 |
PCI_EXP_LNKCTL_ASPM_L0S
;

6775 i‡(
°©e
 & 
PCIE_LINK_STATE_L1
)

6776 
a•m_˘l
 |
PCI_EXP_LNKCTL_ASPM_L1
;

6781 
	`pcõ_ˇ∑bûôy_˛ór_w‹d
(
pdev
, 
PCI_EXP_LNKCTL
, 
a•m_˘l
);

6783 i‡(
pdev
->
bus
->
£lf
)

6784 
	`pcõ_ˇ∑bûôy_˛ór_w‹d
(
pdev
->
bus
->
£lf
, 
PCI_EXP_LNKCTL
,

6785 
a•m_˘l
);

6786 
	}
}

6788 
	$e1000e_dißbÀ_a•m
(
pci_dev
 *
pdev
, 
u16
 
°©e
)

6790 
	`dev_öfo
(
	`pci_dev_to_dev
(
pdev
), "Disabling ASPM %s %s\n",

6791 (
°©e
 & 
PCIE_LINK_STATE_L0S
) ? "L0s" : "",

6792 (
°©e
 & 
PCIE_LINK_STATE_L1
) ? "L1" : "");

6794 
	`__e1000e_dißbÀ_a•m
(
pdev
, 
°©e
);

6795 
	}
}

6797 #ifde‡
CONFIG_PM


6798 
	$__e1000_ªsume
(
pci_dev
 *
pdev
)

6800 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

6801 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6802 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

6803 
u16
 
a•m_dißbÀ_Êag
 = 0;

6804 #ifde‡
USE_LEGACY_PM_SUPPORT


6805 
u32
 
îr
;

6808 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L0S
)

6809 
a•m_dißbÀ_Êag
 = 
PCIE_LINK_STATE_L0S
;

6810 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L1
)

6811 
a•m_dißbÀ_Êag
 |
PCIE_LINK_STATE_L1
;

6812 i‡(
a•m_dißbÀ_Êag
)

6813 
	`e1000e_dißbÀ_a•m
(
pdev
, 
a•m_dißbÀ_Êag
);

6815 #ifde‡
USE_LEGACY_PM_SUPPORT


6816 
	`pci_£t_powî_°©e
(
pdev
, 
PCI_D0
);

6817 
	`pci_ª°‹e_°©e
(
pdev
);

6818 
	`pci_ßve_°©e
(
pdev
);

6820 
îr
 = 
	`pci_íabÀ_devi˚_mem
(
pdev
);

6821 i‡(
îr
) {

6822 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

6824  
îr
;

6827 
	`pci_£t_ma°î
(
pdev
);

6829 
	`pci_íabÀ_wake
(
pdev
, 
PCI_D3hŸ
, 0);

6830 
	`pci_íabÀ_wake
(
pdev
, 
PCI_D3cﬁd
, 0);

6832 
	`pci_£t_ma°î
(
pdev
);

6835 i‡(
hw
->
mac
.
ty≥
 >
e1000_pch2œn
)

6836 
	`e1000_ªsume_w‹k¨ounds_pchœn
(&
ad≠ãr
->
hw
);

6838 
	`e1000e_powî_up_phy
(
ad≠ãr
);

6841 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_PHY_WAKEUP
) {

6842 
u16
 
phy_d©a
;

6844 
	`e1e_Ωhy
(&
ad≠ãr
->
hw
, 
BM_WUS
, &
phy_d©a
);

6845 i‡(
phy_d©a
) {

6846 
	`e_öfo
("PHY Wakeup cause - %s\n",

6847 
phy_d©a
 & 
E1000_WUS_EX
 ? "Unicast Packet" :

6848 
phy_d©a
 & 
E1000_WUS_MC
 ? "Multicast Packet" :

6849 
phy_d©a
 & 
E1000_WUS_BC
 ? "Broadcast Packet" :

6850 
phy_d©a
 & 
E1000_WUS_MAG
 ? "Magic Packet" :

6851 
phy_d©a
 & 
E1000_WUS_LNKC
 ?

6854 
	`e1e_wphy
(&
ad≠ãr
->
hw
, 
BM_WUS
, ~0);

6856 
u32
 
wus
 = 
	`î32
(
WUS
);

6857 i‡(
wus
) {

6858 
	`e_öfo
("MAC Wakeup cause - %s\n",

6859 
wus
 & 
E1000_WUS_EX
 ? "Unicast Packet" :

6860 
wus
 & 
E1000_WUS_MC
 ? "Multicast Packet" :

6861 
wus
 & 
E1000_WUS_BC
 ? "Broadcast Packet" :

6862 
wus
 & 
E1000_WUS_MAG
 ? "Magic Packet" :

6863 
wus
 & 
E1000_WUS_LNKC
 ? "Link Status Change" :

6866 
	`ew32
(
WUS
, ~0);

6869 
	`e1000e_ª£t
(
ad≠ãr
);

6871 
	`e1000_öô_m™agóbûôy_±
(
ad≠ãr
);

6877 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
))

6878 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

6881 
	}
}

6883 
	$e1000e_pm_thaw
(
devi˚
 *
dev
)

6885 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
	`to_pci_dev
(
dev
));

6886 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6888 
	`e1000e_£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

6889 i‡(
	`√tif_ru¬ög
(
√tdev
)) {

6890 
u32
 
îr
 = 
	`e1000_ªque°_úq
(
ad≠ãr
);

6892 i‡(
îr
)

6893  
îr
;

6895 
	`e1000e_up
(
ad≠ãr
);

6898 
	`√tif_devi˚_©èch
(
√tdev
);

6901 
	}
}

6903 #ifde‡
CONFIG_PM_SLEEP


6904 #i‚de‡
USE_LEGACY_PM_SUPPORT


6905 
	$e1000e_pm_su•íd
(
devi˚
 *
dev
)

6907 
	$e1000e_pm_su•íd
(
pci_dev
 *
pdev
, 
pm_mesßge_t
 
°©e
)

6910 #i‚de‡
USE_LEGACY_PM_SUPPORT


6911 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

6913 
	`e1000e_pm_‰ìze
(
dev
);

6915 
	`e1000e_pm_‰ìze
(
	`pci_dev_to_dev
(
pdev
));

6918  
	`__e1000_shutdown
(
pdev
, 
Ál£
);

6919 
	}
}

6921 #i‚de‡
USE_LEGACY_PM_SUPPORT


6922 
	$e1000e_pm_ªsume
(
devi˚
 *
dev
)

6924 
	$e1000e_pm_ªsume
(
pci_dev
 *
pdev
)

6927 #i‚de‡
USE_LEGACY_PM_SUPPORT


6928 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

6930 
rc
;

6932 
rc
 = 
	`__e1000_ªsume
(
pdev
);

6933 i‡(
rc
)

6934  
rc
;

6936 #i‚de‡
USE_LEGACY_PM_SUPPORT


6937  
	`e1000e_pm_thaw
(
dev
);

6939  
	`e1000e_pm_thaw
(
	`pci_dev_to_dev
(
pdev
));

6941 
	}
}

6944 #i‚de‡
USE_LEGACY_PM_SUPPORT


6945 #ifde‡
CONFIG_PM_RUNTIME


6946 
	$e1000e_pm_ru¡ime_idÀ
(
devi˚
 *
dev
)

6948 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

6949 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

6950 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6952 i‡(!
	`e1000e_has_lök
(
ad≠ãr
))

6953 
	`pm_scheduÀ_su•íd
(
dev
, 5 * 
MSEC_PER_SEC
);

6955  -
EBUSY
;

6956 
	}
}

6958 
	$e1000e_pm_ru¡ime_ªsume
(
devi˚
 *
dev
)

6960 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

6961 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

6962 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6963 
rc
;

6965 
rc
 = 
	`__e1000_ªsume
(
pdev
);

6966 i‡(
rc
)

6967  
rc
;

6969 i‡(
√tdev
->
Êags
 & 
IFF_UP
)

6970 
rc
 = 
	`e1000e_up
(
ad≠ãr
);

6972  
rc
;

6973 
	}
}

6975 
	$e1000e_pm_ru¡ime_su•íd
(
devi˚
 *
dev
)

6977 
pci_dev
 *
pdev
 = 
	`to_pci_dev
(
dev
);

6978 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

6979 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

6981 i‡(
√tdev
->
Êags
 & 
IFF_UP
) {

6982 
cou¡
 = 
E1000_CHECK_RESET_COUNT
;

6984 
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
Ë&& 
cou¡
--)

6985 
	`u¶ìp_ønge
(10000, 20000);

6987 
	`WARN_ON
(
	`ã°_bô
(
__E1000_RESETTING
, &
ad≠ãr
->
°©e
));

6990 
	`e1000e_down
(
ad≠ãr
, 
Ál£
);

6993 i‡(
	`__e1000_shutdown
(
pdev
, 
åue
)) {

6994 
	`e1000e_pm_ru¡ime_ªsume
(
dev
);

6995  -
EBUSY
;

6999 
	}
}

7004 #i‚de‡
USE_REBOOT_NOTIFIER


7005 
	$e1000_shutdown
(
pci_dev
 *
pdev
)

7007 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
	`pci_gë_drvd©a
(
pdev
));

7009 
	`£t_bô
(
__E1000_SHUTDOWN
, &
ad≠ãr
->
°©e
);

7011 
	`e1000e_pm_‰ìze
(&
pdev
->
dev
);

7013 
	`__e1000_shutdown
(
pdev
, 
Ál£
);

7014 
	}
}

7016 
pci_drivî
 
	ge1000_drivî
;

7017 
	$e1000_nŸify_ªboŸ
(
nŸifõr_block
 *
nb
, 
evít
,

7018 *
±r
)

7020 
pci_dev
 *
pdev
 = 
NULL
;

7022 
evít
) {

7023 
SYS_DOWN
:

7024 
SYS_HALT
:

7025 
SYS_POWER_OFF
:

7026 (
pdev
 = 
	`pci_föd_devi˚
(
PCI_ANY_ID
, PCI_ANY_ID,Ödev))) {

7027 i‡(
	`pci_dev_drivî
(
pdev
Ë=&
e1000_drivî
) {

7028 
	`e1000e_pm_‰ìze
(
	`pci_dev_to_dev
(
pdev
));

7029 
	`__e1000_shutdown
(
pdev
, 
Ál£
);

7034  
NOTIFY_DONE
;

7035 
	}
}

7037 
nŸifõr_block
 
	ge1000_nŸifõr_ªboŸ
 = {

7038 .
nŸifõr_ˇŒ
 = 
e1000_nŸify_ªboŸ
,

7039 .
	g√xt
 = 
NULL
,

7040 .
	g¥i‹ôy
 = 0

7044 #ifde‡
CONFIG_NET_POLL_CONTROLLER


7046 
úqªtu∫_t
 
	$e1000_öå_msix
(
__Æways_unu£d
 
úq
, *
d©a
)

7048 
√t_devi˚
 *
√tdev
 = 
d©a
;

7049 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7051 i‡(
ad≠ãr
->
msix_íåõs
) {

7052 
ve˘‹
, 
msix_úq
;

7054 
ve˘‹
 = 0;

7055 
msix_úq
 = 
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector;

7056 
	`dißbÀ_úq
(
msix_úq
);

7057 
	`e1000_öå_msix_rx
(
msix_úq
, 
√tdev
);

7058 
	`íabÀ_úq
(
msix_úq
);

7060 
ve˘‹
++;

7061 
msix_úq
 = 
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector;

7062 
	`dißbÀ_úq
(
msix_úq
);

7063 
	`e1000_öå_msix_tx
(
msix_úq
, 
√tdev
);

7064 
	`íabÀ_úq
(
msix_úq
);

7066 
ve˘‹
++;

7067 
msix_úq
 = 
ad≠ãr
->
msix_íåõs
[
ve˘‹
].vector;

7068 
	`dißbÀ_úq
(
msix_úq
);

7069 
	`e1000_msix_Ÿhî
(
msix_úq
, 
√tdev
);

7070 
	`íabÀ_úq
(
msix_úq
);

7073  
IRQ_HANDLED
;

7074 
	}
}

7084 
	$e1000_√çﬁl
(
√t_devi˚
 *
√tdev
)

7086 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7088 
ad≠ãr
->
öt_mode
) {

7089 
E1000E_INT_MODE_MSIX
:

7090 
	`e1000_öå_msix
(
ad≠ãr
->
pdev
->
úq
, 
√tdev
);

7092 
E1000E_INT_MODE_MSI
:

7093 
	`dißbÀ_úq
(
ad≠ãr
->
pdev
->
úq
);

7094 
	`e1000_öå_msi
(
ad≠ãr
->
pdev
->
úq
, 
√tdev
);

7095 
	`íabÀ_úq
(
ad≠ãr
->
pdev
->
úq
);

7098 
	`dißbÀ_úq
(
ad≠ãr
->
pdev
->
úq
);

7099 
	`e1000_öå
(
ad≠ãr
->
pdev
->
úq
, 
√tdev
);

7100 
	`íabÀ_úq
(
ad≠ãr
->
pdev
->
úq
);

7103 
	}
}

7106 #ifde‡
HAVE_PCI_ERS


7115 
pci_îs_ªsu…_t
 
	$e1000_io_îr‹_dëe˘ed
(
pci_dev
 *
pdev
,

7116 
pci_ch™√l_°©e_t
 
°©e
)

7118 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

7119 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7121 
	`√tif_devi˚_dëach
(
√tdev
);

7123 i‡(
°©e
 =
pci_ch™√l_io_≥rm_Áûuª
)

7124  
PCI_ERS_RESULT_DISCONNECT
;

7126 i‡(
	`√tif_ru¬ög
(
√tdev
))

7127 
	`e1000e_down
(
ad≠ãr
, 
åue
);

7128 
	`pci_dißbÀ_devi˚
(
pdev
);

7131  
PCI_ERS_RESULT_NEED_RESET
;

7132 
	}
}

7141 
pci_îs_ªsu…_t
 
	$e1000_io_¶Ÿ_ª£t
(
pci_dev
 *
pdev
)

7143 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

7144 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7145 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

7146 
u16
 
a•m_dißbÀ_Êag
 = 0;

7147 
îr
;

7148 
pci_îs_ªsu…_t
 
ªsu…
;

7150 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L0S
)

7151 
a•m_dißbÀ_Êag
 = 
PCIE_LINK_STATE_L0S
;

7152 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L1
)

7153 
a•m_dißbÀ_Êag
 |
PCIE_LINK_STATE_L1
;

7154 i‡(
a•m_dißbÀ_Êag
)

7155 
	`e1000e_dißbÀ_a•m
(
pdev
, 
a•m_dißbÀ_Êag
);

7157 
îr
 = 
	`pci_íabÀ_devi˚_mem
(
pdev
);

7158 i‡(
îr
) {

7159 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7161 
ªsu…
 = 
PCI_ERS_RESULT_DISCONNECT
;

7163 
	`pci_ª°‹e_°©e
(
pdev
);

7164 
	`pci_£t_ma°î
(
pdev
);

7165 
	`pci_ßve_°©e
(
pdev
);

7167 
	`pci_íabÀ_wake
(
pdev
, 
PCI_D3hŸ
, 0);

7168 
	`pci_íabÀ_wake
(
pdev
, 
PCI_D3cﬁd
, 0);

7170 
	`e1000e_ª£t
(
ad≠ãr
);

7171 
	`ew32
(
WUS
, ~0);

7172 
ªsu…
 = 
PCI_ERS_RESULT_RECOVERED
;

7175 
	`pci_˛ónup_´r_unc‹ª˘_îr‹_°©us
(
pdev
);

7177  
ªsu…
;

7178 
	}
}

7188 
	$e1000_io_ªsume
(
pci_dev
 *
pdev
)

7190 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

7191 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7193 
	`e1000_öô_m™agóbûôy_±
(
ad≠ãr
);

7195 i‡(
	`√tif_ru¬ög
(
√tdev
)) {

7196 i‡(
	`e1000e_up
(
ad≠ãr
)) {

7197 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7203 
	`√tif_devi˚_©èch
(
√tdev
);

7209 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
))

7210 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

7211 
	}
}

7214 
	$e1000_¥öt_devi˚_öfo
(
e1000_ad≠ãr
 *
ad≠ãr
)

7216 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

7217 
√t_devi˚
 *
√tdev
 = 
ad≠ãr
->netdev;

7218 
u32
 
ªt_vÆ
;

7219 
u8
 
pba_°r
[
E1000_PBANUM_LENGTH
];

7222 
	`e_öfo
("(PCI Express:2.5GT/s:%s) %02x:%02x:%02x:%02x:%02x:%02x\n",

7224 ((
hw
->
bus
.
width
 =
e1000_bus_width_pcõ_x4
) ? "Width x4" :

7227 
√tdev
->
dev_addr
[0],Çetdev->dev_addr[1],

7228 
√tdev
->
dev_addr
[2],Çetdev->dev_addr[3],

7229 
√tdev
->
dev_addr
[4],Çetdev->dev_addr[5]);

7230 
	`e_öfo
("Intel(R) PRO/%s Network Connection\n",

7231 (
hw
->
phy
.
ty≥
 =
e1000_phy_i„
) ? "10/100" : "1000");

7232 
ªt_vÆ
 = 
	`e1000_ªad_pba_°rög_gíîic
(
hw
, 
pba_°r
,

7233 
E1000_PBANUM_LENGTH
);

7234 i‡(
ªt_vÆ
)

7235 
	`°æ˝y
((*)
pba_°r
, "Unknown", (pba_str));

7236 
	`e_öfo
("MAC: %d, PHY: %d, PBA No: %s\n",

7237 
hw
->
mac
.
ty≥
, hw->
phy
.ty≥, 
pba_°r
);

7238 
	}
}

7240 
	$e1000_ì¥om_checks
(
e1000_ad≠ãr
 *
ad≠ãr
)

7242 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

7243 
ªt_vÆ
;

7244 
u16
 
buf
 = 0;

7246 i‡(
hw
->
mac
.
ty≥
 !
e1000_82573
)

7249 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_INIT_CONTROL2_REG
, 1, &
buf
);

7250 
	`À16_to_˝us
(&
buf
);

7251 i‡(!
ªt_vÆ
 && (!(
buf
 & (1 << 0)))) {

7253 
	`dev_w¨n
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

7256 
	}
}

7258 #ifde‡
HAVE_NDO_SET_FEATURES


7259 
	$e1000_£t_„©uªs
(
√t_devi˚
 *
√tdev
,

7260 
√tdev_„©uªs_t
 
„©uªs
)

7262 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7263 
√tdev_„©uªs_t
 
ch™ged
 = 
„©uªs
 ^ 
√tdev
->features;

7265 i‡(
ch™ged
 & (
NETIF_F_TSO
 | 
NETIF_F_TSO6
))

7266 
ad≠ãr
->
Êags
 |
FLAG_TSO_FORCE
;

7268 i‡(!(
ch™ged
 & (

7269 #i‡
	`deföed
(
NETIF_F_HW_VLAN_CTAG_TX
)

7270 
NETIF_F_HW_VLAN_CTAG_RX
 |

7271 
NETIF_F_HW_VLAN_CTAG_TX
 |

7272 #ñi‡
	`deföed
(
NETIF_F_HW_VLAN_TX
)

7273 
NETIF_F_HW_VLAN_RX
 | 
NETIF_F_HW_VLAN_TX
 |

7275 
NETIF_F_RXCSUM
 | 
NETIF_F_RXHASH
 | 
NETIF_F_RXFCS


7276 | 
NETIF_F_RXALL
)))

7279 i‡(
ch™ged
 & 
NETIF_F_RXFCS
) {

7280 i‡(
„©uªs
 & 
NETIF_F_RXFCS
) {

7281 
ad≠ãr
->
Êags2
 &~
FLAG2_CRC_STRIPPING
;

7286 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_DFLT_CRC_STRIPPING
)

7287 
ad≠ãr
->
Êags2
 |
FLAG2_CRC_STRIPPING
;

7289 
ad≠ãr
->
Êags2
 &~
FLAG2_CRC_STRIPPING
;

7293 
√tdev
->
„©uªs
 = features;

7295 i‡(
	`√tif_ru¬ög
(
√tdev
))

7296 
	`e1000e_ªöô_locked
(
ad≠ãr
);

7298 
	`e1000e_ª£t
(
ad≠ãr
);

7301 
	}
}

7304 #ifde‡
HAVE_NET_DEVICE_OPS


7305 c⁄° 
√t_devi˚_›s
 
	ge1000e_√tdev_›s
 = {

7306 .
ndo_›í
 = 
e1000_›í
,

7307 .
	gndo_°›
 = 
e1000_˛o£
,

7308 .
	gndo_°¨t_xmô
 = 
e1000_xmô_‰ame
,

7309 #ifde‡
HAVE_NDO_GET_STATS64


7310 .
	gndo_gë_°©s64
 = 
e1000e_gë_°©s64
,

7312 .
	gndo_gë_°©s
 = 
e1000_gë_°©s
,

7314 .
	gndo_£t_rx_mode
 = 
e1000e_£t_rx_mode
,

7315 .
	gndo_£t_mac_addªss
 = 
e1000_£t_mac
,

7316 .
	gndo_ch™ge_mtu
 = 
e1000_ch™ge_mtu
,

7317 .
	gndo_do_io˘l
 = 
e1000_io˘l
,

7318 .
	gndo_tx_timeout
 = 
e1000_tx_timeout
,

7319 .
	gndo_vÆid©e_addr
 = 
ëh_vÆid©e_addr
,

7321 #i‡
deföed
(
NETIF_F_HW_VLAN_RX
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_RX
)

7322 #ifde‡
HAVE_VLAN_RX_REGISTER


7323 .
	gndo_vœn_rx_ªgi°î
 = 
e1000_vœn_rx_ªgi°î
,

7325 .
	gndo_vœn_rx_add_vid
 = 
e1000_vœn_rx_add_vid
,

7326 .
	gndo_vœn_rx_kûl_vid
 = 
e1000_vœn_rx_kûl_vid
,

7328 #ifde‡
CONFIG_NET_POLL_CONTROLLER


7329 .
	gndo_pﬁl_c⁄åﬁÀr
 = 
e1000_√çﬁl
,

7331 #ifde‡
HAVE_NDO_SET_FEATURES


7332 .
	gndo_£t_„©uªs
 = 
e1000_£t_„©uªs
,

7348 #ifde‡
HAVE_CONFIG_HOTPLUG


7349 
__devöô
 
	$e1000_¥obe
(
pci_dev
 *
pdev
,

7350 c⁄° 
pci_devi˚_id
 *
ít
)

7352 
	$e1000_¥obe
(
pci_dev
 *
pdev
, c⁄° 
pci_devi˚_id
 *
ít
)

7355 
√t_devi˚
 *
√tdev
;

7356 
e1000_ad≠ãr
 *
ad≠ãr
;

7357 
e1000_hw
 *
hw
;

7358 c⁄° 
e1000_öfo
 *
ei
 = 
e1000_öfo_tbl
[
ít
->
drivî_d©a
];

7359 
ªsour˚_size_t
 
mmio_°¨t
, 
mmio_Àn
;

7360 
ªsour˚_size_t
 
Êash_°¨t
, 
Êash_Àn
;

7361 
ˇrds_found
;

7362 
u16
 
a•m_dißbÀ_Êag
 = 0;

7363 
i
, 
îr
, 
pci_usög_dac
;

7364 
u16
 
ì¥om_d©a
 = 0;

7365 
u16
 
ì¥om_≠me_mask
 = 
E1000_EEPROM_APME
;

7367 i‡(
ei
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L0S
)

7368 
a•m_dißbÀ_Êag
 = 
PCIE_LINK_STATE_L0S
;

7369 i‡(
ei
->
Êags2
 & 
FLAG2_DISABLE_ASPM_L1
)

7370 
a•m_dißbÀ_Êag
 |
PCIE_LINK_STATE_L1
;

7371 i‡(
a•m_dißbÀ_Êag
)

7372 
	`e1000e_dißbÀ_a•m
(
pdev
, 
a•m_dißbÀ_Êag
);

7374 
îr
 = 
	`pci_íabÀ_devi˚_mem
(
pdev
);

7375 i‡(
îr
)

7376  
îr
;

7378 
pci_usög_dac
 = 0;

7379 
îr
 = 
	`dma_£t_mask
(
	`pci_dev_to_dev
(
pdev
), 
	`DMA_BIT_MASK
(64));

7380 i‡(!
îr
) {

7381 
îr
 =

7382 
	`dma_£t_cohîít_mask
(
	`pci_dev_to_dev
(
pdev
),

7383 
	`DMA_BIT_MASK
(64));

7384 i‡(!
îr
)

7385 
pci_usög_dac
 = 1;

7387 
îr
 = 
	`dma_£t_mask
(
	`pci_dev_to_dev
(
pdev
), 
	`DMA_BIT_MASK
(32));

7388 i‡(
îr
) {

7389 
îr
 = 
	`dma_£t_cohîít_mask
(
	`pci_dev_to_dev
(
pdev
),

7390 
	`DMA_BIT_MASK
(32));

7391 i‡(
îr
) {

7392 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7394 
îr_dma
;

7399 
îr
 = 
	`pci_ªque°_£À˘ed_ªgi⁄s_ex˛usive
(
pdev
,

7400 
	`pci_£À˘_b¨s
(
pdev
, 
IORESOURCE_MEM
),

7401 
e1000e_drivî_«me
);

7402 i‡(
îr
)

7403 
îr_pci_ªg
;

7406 
	`pci_íabÀ_pcõ_îr‹_ªp‹tög
(
pdev
);

7408 
	`pci_£t_ma°î
(
pdev
);

7410 
îr
 = -
ENOMEM
;

7411 
√tdev
 = 
	`Æloc_ëhîdev
((
e1000_ad≠ãr
));

7412 i‡(!
√tdev
)

7413 
îr_Æloc_ëhîdev
;

7415 
	`SET_MODULE_OWNER
(
√tdev
);

7416 
	`SET_NETDEV_DEV
(
√tdev
, 
	`pci_dev_to_dev
(
pdev
));

7418 
√tdev
->
úq
 = 
pdev
->irq;

7420 
	`pci_£t_drvd©a
(
pdev
, 
√tdev
);

7421 #ifde‡
HAVE_PCI_ERS


7423 
îr
 = 
	`pci_ßve_°©e
(
pdev
);

7424 i‡(
îr
)

7425 
îr_i‹em≠
;

7427 
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7428 
hw
 = &
ad≠ãr
->hw;

7429 
ad≠ãr
->
node
 = -1;

7430 
ad≠ãr
->
√tdev
 =Çetdev;

7431 
ad≠ãr
->
pdev
 =Ödev;

7432 
ad≠ãr
->
ei
 =Éi;

7433 
ad≠ãr
->
pba
 = 
ei
->pba;

7434 
ad≠ãr
->
Êags
 = 
ei
->flags;

7435 
ad≠ãr
->
Êags2
 = 
ei
->flags2;

7436 
ad≠ãr
->
hw
.adapter =ádapter;

7437 
ad≠ãr
->
hw
.
mac
.
ty≥
 = 
ei
->mac;

7438 
ad≠ãr
->
max_hw_‰ame_size
 = 
ei
->max_hw_frame_size;

7439 
ad≠ãr
->
msg_íabÀ
 = 
	`√tif_msg_öô
(
debug
, 
DEFAULT_MSG_ENABLE
);

7441 
mmio_°¨t
 = 
	`pci_ªsour˚_°¨t
(
pdev
, 0);

7442 
mmio_Àn
 = 
	`pci_ªsour˚_Àn
(
pdev
, 0);

7444 
îr
 = -
EIO
;

7445 
ad≠ãr
->
hw
.
hw_addr
 = 
	`i‹em≠
(
mmio_°¨t
, 
mmio_Àn
);

7446 i‡(!
ad≠ãr
->
hw
.
hw_addr
)

7447 
îr_i‹em≠
;

7449 i‡((
ad≠ãr
->
Êags
 & 
FLAG_HAS_FLASH
) &&

7450 (
	`pci_ªsour˚_Êags
(
pdev
, 1Ë& 
IORESOURCE_MEM
)) {

7451 
Êash_°¨t
 = 
	`pci_ªsour˚_°¨t
(
pdev
, 1);

7452 
Êash_Àn
 = 
	`pci_ªsour˚_Àn
(
pdev
, 1);

7453 
ad≠ãr
->
hw
.
Êash_addªss
 = 
	`i‹em≠
(
Êash_°¨t
, 
Êash_Àn
);

7454 i‡(!
ad≠ãr
->
hw
.
Êash_addªss
)

7455 
îr_Êashm≠
;

7459 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_EEE
)

7460 
ad≠ãr
->
ìe_advît
 = 
MDIO_EEE_100TX
 | 
MDIO_EEE_1000T
;

7463 #ifde‡
HAVE_NET_DEVICE_OPS


7464 
√tdev
->
√tdev_›s
 = &
e1000e_√tdev_›s
;

7466 
√tdev
->
›í
 = &
e1000_›í
;

7467 
√tdev
->
°›
 = &
e1000_˛o£
;

7468 
√tdev
->
h¨d_°¨t_xmô
 = &
e1000_xmô_‰ame
;

7469 
√tdev
->
gë_°©s
 = &
e1000_gë_°©s
;

7470 #ifde‡
HAVE_SET_RX_MODE


7471 
√tdev
->
£t_rx_mode
 = &
e1000e_£t_rx_mode
;

7473 
√tdev
->
£t_mu…iˇ°_li°
 = &
e1000e_£t_rx_mode
;

7474 
√tdev
->
£t_mac_addªss
 = &
e1000_£t_mac
;

7475 
√tdev
->
ch™ge_mtu
 = &
e1000_ch™ge_mtu
;

7476 
√tdev
->
do_io˘l
 = &
e1000_io˘l
;

7477 
√tdev
->
tx_timeout
 = &
e1000_tx_timeout
;

7478 #ifde‡
NETIF_F_HW_VLAN_RX


7479 
√tdev
->
vœn_rx_ªgi°î
 = 
e1000_vœn_rx_ªgi°î
;

7480 
√tdev
->
vœn_rx_add_vid
 = 
e1000_vœn_rx_add_vid
;

7481 
√tdev
->
vœn_rx_kûl_vid
 = 
e1000_vœn_rx_kûl_vid
;

7483 #ifde‡
CONFIG_NET_POLL_CONTROLLER


7484 
√tdev
->
pﬁl_c⁄åﬁÀr
 = 
e1000_√çﬁl
;

7487 
	`e1000e_£t_ëhtoﬁ_›s
(
√tdev
);

7488 
√tdev
->
w©chdog_timeo
 = 5 * 
HZ
;

7489 #ifde‡
CONFIG_E1000E_NAPI


7490 
	`√tif_«pi_add
(
√tdev
, &
ad≠ãr
->
«pi
, 
e1000e_pﬁl
, 64);

7492 
	`°æ˝y
(
√tdev
->
«me
, 
	`pci_«me
(
pdev
), (netdev->name));

7494 
√tdev
->
mem_°¨t
 = 
mmio_°¨t
;

7495 
√tdev
->
mem_íd
 = 
mmio_°¨t
 + 
mmio_Àn
;

7497 
ad≠ãr
->
bd_numbî
 = 
ˇrds_found
++;

7499 
	`e1000e_check_›ti⁄s
(
ad≠ãr
);

7501 i‡(
ad≠ãr
->
node
 >= 0)

7502 
	`dev_öfo
(
	`pci_dev_to_dev
(
pdev
),

7504 
ad≠ãr
->
node
);

7507 
îr
 = 
	`e1000_sw_öô
(
ad≠ãr
);

7508 i‡(
îr
)

7509 
îr_sw_öô
;

7511 
	`mem˝y
(&
hw
->
mac
.
›s
, 
ei
->
mac_›s
, (hw->mac.ops));

7512 
	`mem˝y
(&
hw
->
nvm
.
›s
, 
ei
->
nvm_›s
, (hw->nvm.ops));

7513 
	`mem˝y
(&
hw
->
phy
.
›s
, 
ei
->
phy_›s
, (hw->phy.ops));

7515 
îr
 = 
ei
->
	`gë_v¨ü¡s
(
ad≠ãr
);

7516 i‡(
îr
)

7517 
îr_hw_öô
;

7519 
hw
->
mac
.
›s
.
	`gë_bus_öfo
(&
ad≠ãr
->hw);

7521 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_waô_to_com∂ëe
 = 0;

7524 i‡(
ad≠ãr
->
hw
.
phy
.
medü_ty≥
 =
e1000_medü_ty≥_c›≥r
) {

7525 
ad≠ãr
->
hw
.
phy
.
mdix
 = 
AUTO_ALL_MODES
;

7526 
ad≠ãr
->
hw
.
phy
.
dißbÀ_pﬁ¨ôy_c‹ª˘i⁄
 = 0;

7527 
ad≠ãr
->
hw
.
phy
.
ms_ty≥
 = 
e1000_ms_hw_deÁu…
;

7530 i‡(
hw
->
phy
.
›s
.
check_ª£t_block
 && hw->phy.›s.
	`check_ª£t_block
(hw))

7531 
	`dev_öfo
(
	`pci_dev_to_dev
(
pdev
),

7535 
√tdev
->
„©uªs
 = (
NETIF_F_SG
 |

7536 #i‡
	`deföed
(
NETIF_F_HW_VLAN_CTAG_TX
)

7537 
NETIF_F_HW_VLAN_CTAG_RX
 |

7538 
NETIF_F_HW_VLAN_CTAG_TX
 |

7539 #ñi‡
	`deföed
(
NETIF_F_HW_VLAN_TX
)

7540 
NETIF_F_HW_VLAN_RX
 |

7541 
NETIF_F_HW_VLAN_TX
 |

7543 #ifde‡
NETIF_F_TSO


7544 
NETIF_F_TSO
 |

7545 #ifde‡
NETIF_F_TSO6


7546 
NETIF_F_TSO6
 |

7549 #i‡
	`deföed
(
NETIF_F_RXHASH
)

7550 
NETIF_F_RXHASH
 |

7552 #ifde‡
NETIF_F_RXCSUM


7553 
NETIF_F_RXCSUM
 |

7555 
NETIF_F_HW_CSUM
);

7557 #ifde‡
HAVE_NDO_SET_FEATURES


7559 
√tdev
->
hw_„©uªs
 =Çëdev->
„©uªs
;

7560 
√tdev
->
hw_„©uªs
 |
NETIF_F_RXFCS
;

7561 #ifde‡
IFF_SUPP_NOFCS


7562 
√tdev
->
¥iv_Êags
 |
IFF_SUPP_NOFCS
;

7564 
√tdev
->
hw_„©uªs
 |
NETIF_F_RXALL
;

7566 #ifde‡
NETIF_F_GRO


7568 
√tdev
->
„©uªs
 |
NETIF_F_GRO
;

7572 #i‡
	`deföed
(
NETIF_F_HW_VLAN_FILTER
Ë|| deföed(
NETIF_F_HW_VLAN_CTAG_FILTER
)

7573 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_VLAN_FILTER
)

7574 #ifde‡
NETIF_F_HW_VLAN_CTAG_FILTER


7575 
√tdev
->
„©uªs
 |
NETIF_F_HW_VLAN_CTAG_FILTER
;

7577 
√tdev
->
„©uªs
 |
NETIF_F_HW_VLAN_FILTER
;

7581 #ifde‡
HAVE_NETDEV_VLAN_FEATURES


7582 
√tdev
->
vœn_„©uªs
 |(
NETIF_F_SG
 |

7583 #ifde‡
NETIF_F_TSO


7584 
NETIF_F_TSO
 |

7586 #ifde‡
NETIF_F_TSO6


7587 
NETIF_F_TSO6
 |

7589 
NETIF_F_HW_CSUM
);

7592 #ifde‡
IFF_UNICAST_FLT


7593 
√tdev
->
¥iv_Êags
 |
IFF_UNICAST_FLT
;

7596 i‡(
pci_usög_dac
) {

7597 
√tdev
->
„©uªs
 |
NETIF_F_HIGHDMA
;

7598 #ifde‡
HAVE_NETDEV_VLAN_FEATURES


7599 
√tdev
->
vœn_„©uªs
 |
NETIF_F_HIGHDMA
;

7603 i‡(
	`e1000e_íabÀ_mng_∑ss_thru
(&
ad≠ãr
->
hw
))

7604 
ad≠ãr
->
Êags
 |
FLAG_MNG_PT_ENABLED
;

7609 
ad≠ãr
->
hw
.
mac
.
›s
.
	`ª£t_hw
(&adapter->hw);

7614 
i
 = 0;; i++) {

7615 i‡(
	`e1000_vÆid©e_nvm_checksum
(&
ad≠ãr
->
hw
) >= 0)

7617 i‡(
i
 == 2) {

7618 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7620 
îr
 = -
EIO
;

7621 
îr_ì¥om
;

7625 
	`e1000_ì¥om_checks
(
ad≠ãr
);

7628 i‡(
	`e1000e_ªad_mac_addr
(&
ad≠ãr
->
hw
))

7629 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7632 
	`mem˝y
(
√tdev
->
dev_addr
, 
ad≠ãr
->
hw
.
mac
.
addr
,Çëdev->
addr_Àn
);

7633 #ifde‡
ETHTOOL_GPERMADDR


7634 
	`mem˝y
(
√tdev
->
≥rm_addr
, 
ad≠ãr
->
hw
.
mac
.
addr
,Çëdev->
addr_Àn
);

7637 i‡(!
	`is_vÆid_ëhî_addr
(
√tdev
->
dev_addr
)) {

7638 
	`dev_îr
(
	`pci_dev_to_dev
(
pdev
),

7640 
√tdev
->
dev_addr
[0],Çetdev->dev_addr[1],

7641 
√tdev
->
dev_addr
[2],Çetdev->dev_addr[3],

7642 
√tdev
->
dev_addr
[4],Çetdev->dev_addr[5]);

7643 
îr
 = -
EIO
;

7644 
îr_ì¥om
;

7647 
	`öô_timî
(&
ad≠ãr
->
w©chdog_timî
);

7648 
ad≠ãr
->
w©chdog_timî
.
fun˘i⁄
 = 
e1000_w©chdog
;

7649 
ad≠ãr
->
w©chdog_timî
.
d©a
 = ()adapter;

7651 
	`öô_timî
(&
ad≠ãr
->
phy_öfo_timî
);

7652 
ad≠ãr
->
phy_öfo_timî
.
fun˘i⁄
 = 
e1000_upd©e_phy_öfo
;

7653 
ad≠ãr
->
phy_öfo_timî
.
d©a
 = ()adapter;

7655 
	`INIT_WORK
(&
ad≠ãr
->
ª£t_èsk
, 
e1000_ª£t_èsk
);

7656 
	`INIT_WORK
(&
ad≠ãr
->
w©chdog_èsk
, 
e1000_w©chdog_èsk
);

7657 
	`INIT_WORK
(&
ad≠ãr
->
downshi·_èsk
, 
e1000e_downshi·_w‹k¨ound
);

7658 
	`INIT_WORK
(&
ad≠ãr
->
upd©e_phy_èsk
, 
e1000e_upd©e_phy_èsk
);

7659 
	`INIT_WORK
(&
ad≠ãr
->
¥öt_h™g_èsk
, 
e1000_¥öt_hw_h™g
);

7660 #i‚de‡
HAVE_ETHTOOL_SET_PHYS_ID


7661 
	`INIT_WORK
(&
ad≠ãr
->
Àd_blök_èsk
, 
e1000e_Àd_blök_èsk
);

7665 
ad≠ãr
->
hw
.
mac
.
aut⁄eg
 = 1;

7666 
ad≠ãr
->
fc_aut⁄eg
 = 
åue
;

7667 
ad≠ãr
->
hw
.
fc
.
ªque°ed_mode
 = 
e1000_fc_deÁu…
;

7668 
ad≠ãr
->
hw
.
fc
.
cuºít_mode
 = 
e1000_fc_deÁu…
;

7669 
ad≠ãr
->
hw
.
phy
.
aut⁄eg_advîti£d
 = 0x2f;

7672 
ad≠ãr
->
rx_rög
->
cou¡
 = 
E1000_DEFAULT_RXD
;

7673 
ad≠ãr
->
tx_rög
->
cou¡
 = 
E1000_DEFAULT_TXD
;

7678 i‡(
ad≠ãr
->
Êags
 & 
FLAG_APME_IN_WUC
) {

7680 
ì¥om_d©a
 = 
	`î32
(
WUC
);

7681 
ì¥om_≠me_mask
 = 
E1000_WUC_APME
;

7682 i‡((
hw
->
mac
.
ty≥
 > 
e1000_ich10œn
) &&

7683 (
ì¥om_d©a
 & 
E1000_WUC_PHY_WAKE
))

7684 
ad≠ãr
->
Êags2
 |
FLAG2_HAS_PHY_WAKEUP
;

7685 } i‡(
ad≠ãr
->
Êags
 & 
FLAG_APME_IN_CTRL3
) {

7686 i‡(
ad≠ãr
->
Êags
 & 
FLAG_APME_CHECK_PORT_B
 &&

7687 (
ad≠ãr
->
hw
.
bus
.
func
 == 1))

7688 
	`e1000_ªad_nvm
(&
ad≠ãr
->
hw
, 
NVM_INIT_CONTROL3_PORT_B
,

7689 1, &
ì¥om_d©a
);

7691 
	`e1000_ªad_nvm
(&
ad≠ãr
->
hw
, 
NVM_INIT_CONTROL3_PORT_A
,

7692 1, &
ì¥om_d©a
);

7696 i‡(
ì¥om_d©a
 & 
ì¥om_≠me_mask
)

7697 
ad≠ãr
->
ì¥om_wﬁ
 |
E1000_WUFC_MAG
;

7703 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_WOL
))

7704 
ad≠ãr
->
ì¥om_wﬁ
 = 0;

7707 
ad≠ãr
->
wﬁ
 =ád≠ãr->
ì¥om_wﬁ
;

7710 i‡(
ad≠ãr
->
wﬁ
 || (ad≠ãr->
Êags
 & 
FLAG_MNG_PT_ENABLED
) ||

7711 (
hw
->
mac
.
›s
.
	`check_mng_mode
(hw)))

7712 
	`devi˚_wakeup_íabÀ
(
	`pci_dev_to_dev
(
pdev
));

7715 
	`e1000_ªad_nvm
(&
ad≠ãr
->
hw
, 5, 1, &ad≠ãr->
ì¥om_vîs
);

7718 
	`e1000e_ª£t
(
ad≠ãr
);

7724 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
))

7725 
	`e1000e_gë_hw_c⁄åﬁ
(
ad≠ãr
);

7727 
	`°æ˝y
(
√tdev
->
«me
, "eth%d", (netdev->name));

7728 
îr
 = 
	`ªgi°î_√tdev
(
√tdev
);

7729 i‡(
îr
)

7730 
îr_ªgi°î
;

7733 
	`√tif_ˇºõr_off
(
√tdev
);

7736 
	`e1000e_±p_öô
(
ad≠ãr
);

7738 
	`e1000_¥öt_devi˚_öfo
(
ad≠ãr
);

7740 i‡(
	`pci_dev_run_wake
(
pdev
))

7741 
	`pm_ru¡ime_put_noidÀ
(
	`pci_dev_to_dev
(
pdev
));

7745 
îr_ªgi°î
:

7746 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_AMT
))

7747 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

7748 
îr_ì¥om
:

7749 i‡(
hw
->
phy
.
›s
.
check_ª£t_block
 && !hw->phy.›s.
	`check_ª£t_block
(hw))

7750 
	`e1000_phy_hw_ª£t
(&
ad≠ãr
->
hw
);

7751 
îr_hw_öô
:

7752 
	`k‰ì
(
ad≠ãr
->
tx_rög
);

7753 
	`k‰ì
(
ad≠ãr
->
rx_rög
);

7754 
îr_sw_öô
:

7755 i‡(
ad≠ãr
->
hw
.
Êash_addªss
)

7756 
	`iounm≠
(
ad≠ãr
->
hw
.
Êash_addªss
);

7757 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

7758 
îr_Êashm≠
:

7759 
	`iounm≠
(
ad≠ãr
->
hw
.
hw_addr
);

7760 
îr_i‹em≠
:

7761 
	`‰ì_√tdev
(
√tdev
);

7762 
îr_Æloc_ëhîdev
:

7763 
	`pci_ªÀa£_£À˘ed_ªgi⁄s
(
pdev
,

7764 
	`pci_£À˘_b¨s
(
pdev
, 
IORESOURCE_MEM
));

7765 
îr_pci_ªg
:

7766 
îr_dma
:

7767 
	`pci_dißbÀ_devi˚
(
pdev
);

7768  
îr
;

7769 
	}
}

7780 #ifde‡
HAVE_CONFIG_HOTPLUG


7781 
__devexô
 
	$e1000_ªmove
(
pci_dev
 *
pdev
)

7783 
	$e1000_ªmove
(
pci_dev
 *
pdev
)

7786 
√t_devi˚
 *
√tdev
 = 
	`pci_gë_drvd©a
(
pdev
);

7787 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`√tdev_¥iv
(
√tdev
);

7788 
boﬁ
 
down
 = 
	`ã°_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

7790 
	`e1000e_±p_ªmove
(
ad≠ãr
);

7795 i‡(!
down
)

7796 
	`£t_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

7797 
	`dñ_timî_sync
(&
ad≠ãr
->
w©chdog_timî
);

7798 
	`dñ_timî_sync
(&
ad≠ãr
->
phy_öfo_timî
);

7800 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
ª£t_èsk
);

7801 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
w©chdog_èsk
);

7802 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
downshi·_èsk
);

7803 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
upd©e_phy_èsk
);

7804 #i‚de‡
HAVE_ETHTOOL_SET_PHYS_ID


7805 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
Àd_blök_èsk
);

7807 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
¥öt_h™g_èsk
);

7809 #ifde‡
HAVE_HW_TIME_STAMP


7810 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
) {

7811 
	`ˇn˚l_w‹k_sync
(&
ad≠ãr
->
tx_hwt°amp_w‹k
);

7812 i‡(
ad≠ãr
->
tx_hwt°amp_skb
) {

7813 
	`dev_k‰ì_skb_™y
(
ad≠ãr
->
tx_hwt°amp_skb
);

7814 
ad≠ãr
->
tx_hwt°amp_skb
 = 
NULL
;

7820 i‡(!
down
)

7821 
	`˛ór_bô
(
__E1000_DOWN
, &
ad≠ãr
->
°©e
);

7822 
	`uƒegi°î_√tdev
(
√tdev
);

7824 i‡(
	`pci_dev_run_wake
(
pdev
))

7825 
	`pm_ru¡ime_gë_n‹esume
(
	`pci_dev_to_dev
(
pdev
));

7830 
	`e1000e_ªÀa£_hw_c⁄åﬁ
(
ad≠ãr
);

7832 
	`e1000e_ª£t_öãºu±_ˇ∑bûôy
(
ad≠ãr
);

7833 
	`k‰ì
(
ad≠ãr
->
tx_rög
);

7834 
	`k‰ì
(
ad≠ãr
->
rx_rög
);

7836 
	`iounm≠
(
ad≠ãr
->
hw
.
hw_addr
);

7837 i‡(
ad≠ãr
->
hw
.
Êash_addªss
)

7838 
	`iounm≠
(
ad≠ãr
->
hw
.
Êash_addªss
);

7839 
	`pci_ªÀa£_£À˘ed_ªgi⁄s
(
pdev
,

7840 
	`pci_£À˘_b¨s
(
pdev
, 
IORESOURCE_MEM
));

7842 
	`‰ì_√tdev
(
√tdev
);

7845 
	`pci_dißbÀ_pcõ_îr‹_ªp‹tög
(
pdev
);

7847 
	`pci_dißbÀ_devi˚
(
pdev
);

7848 
	}
}

7850 #ifde‡
HAVE_PCI_ERS


7852 #ifde‡
HAVE_CONST_STRUCT_PCI_ERROR_HANDLERS


7853 c⁄° 
pci_îr‹_h™dÀrs
 
	ge1000_îr_h™dÀr
 = {

7855 
pci_îr‹_h™dÀrs
 
e1000_îr_h™dÀr
 = {

7857 .
îr‹_dëe˘ed
 = 
e1000_io_îr‹_dëe˘ed
,

7858 .
	g¶Ÿ_ª£t
 = 
e1000_io_¶Ÿ_ª£t
,

7859 .
	gªsume
 = 
e1000_io_ªsume
,

7863 
DEFINE_PCI_DEVICE_TABLE
(
e1000_pci_tbl
) = {

7864 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_COPPER
), 
bﬂrd_82571
 },

7865 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_FIBER
), 
bﬂrd_82571
 },

7866 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_QUAD_COPPER
), 
bﬂrd_82571
 },

7867 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_QUAD_COPPER_LP
),

7868 
bﬂrd_82571
 },

7869 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_QUAD_FIBER
), 
bﬂrd_82571
 },

7870 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_SERDES
), 
bﬂrd_82571
 },

7871 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_SERDES_DUAL
), 
bﬂrd_82571
 },

7872 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571EB_SERDES_QUAD
), 
bﬂrd_82571
 },

7873 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82571PT_QUAD_COPPER
), 
bﬂrd_82571
 },

7875 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82572EI
), 
bﬂrd_82572
 },

7876 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82572EI_COPPER
), 
bﬂrd_82572
 },

7877 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82572EI_FIBER
), 
bﬂrd_82572
 },

7878 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82572EI_SERDES
), 
bﬂrd_82572
 },

7880 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82573E
), 
bﬂrd_82573
 },

7881 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82573E_IAMT
), 
bﬂrd_82573
 },

7882 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82573L
), 
bﬂrd_82573
 },

7884 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82574L
), 
bﬂrd_82574
 },

7885 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82574LA
), 
bﬂrd_82574
 },

7886 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_82583V
), 
bﬂrd_82583
 },

7888 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_80003ES2LAN_COPPER_DPT
),

7889 
bﬂrd_80003es2œn
 },

7890 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_80003ES2LAN_COPPER_SPT
),

7891 
bﬂrd_80003es2œn
 },

7892 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_80003ES2LAN_SERDES_DPT
),

7893 
bﬂrd_80003es2œn
 },

7894 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_80003ES2LAN_SERDES_SPT
),

7895 
bﬂrd_80003es2œn
 },

7897 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IFE
), 
bﬂrd_ich8œn
 },

7898 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IFE_G
), 
bﬂrd_ich8œn
 },

7899 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IFE_GT
), 
bﬂrd_ich8œn
 },

7900 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IGP_AMT
), 
bﬂrd_ich8œn
 },

7901 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IGP_C
), 
bﬂrd_ich8œn
 },

7902 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IGP_M
), 
bﬂrd_ich8œn
 },

7903 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_IGP_M_AMT
), 
bﬂrd_ich8œn
 },

7904 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH8_82567V_3
), 
bﬂrd_ich8œn
 },

7906 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IFE
), 
bﬂrd_ich9œn
 },

7907 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IFE_G
), 
bﬂrd_ich9œn
 },

7908 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IFE_GT
), 
bﬂrd_ich9œn
 },

7909 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IGP_AMT
), 
bﬂrd_ich9œn
 },

7910 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IGP_C
), 
bﬂrd_ich9œn
 },

7911 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_BM
), 
bﬂrd_ich9œn
 },

7912 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IGP_M
), 
bﬂrd_ich9œn
 },

7913 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IGP_M_AMT
), 
bﬂrd_ich9œn
 },

7914 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH9_IGP_M_V
), 
bﬂrd_ich9œn
 },

7916 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_R_BM_LM
), 
bﬂrd_ich9œn
 },

7917 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_R_BM_LF
), 
bﬂrd_ich9œn
 },

7918 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_R_BM_V
), 
bﬂrd_ich9œn
 },

7920 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_D_BM_LM
), 
bﬂrd_ich10œn
 },

7921 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_D_BM_LF
), 
bﬂrd_ich10œn
 },

7922 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_ICH10_D_BM_V
), 
bﬂrd_ich10œn
 },

7924 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_M_HV_LM
), 
bﬂrd_pchœn
 },

7925 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_M_HV_LC
), 
bﬂrd_pchœn
 },

7926 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_D_HV_DM
), 
bﬂrd_pchœn
 },

7927 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_D_HV_DC
), 
bﬂrd_pchœn
 },

7929 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH2_LV_LM
), 
bﬂrd_pch2œn
 },

7930 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH2_LV_V
), 
bﬂrd_pch2œn
 },

7932 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_LPT_I217_LM
), 
bﬂrd_pch_Õt
 },

7933 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_LPT_I217_V
), 
bﬂrd_pch_Õt
 },

7934 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_LPTLP_I218_LM
), 
bﬂrd_pch_Õt
 },

7935 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_LPTLP_I218_V
), 
bﬂrd_pch_Õt
 },

7936 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_I218_LM2
), 
bﬂrd_pch_Õt
 },

7937 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_I218_V2
), 
bﬂrd_pch_Õt
 },

7938 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_I218_LM3
), 
bﬂrd_pch_Õt
 },

7939 { 
PCI_VDEVICE
(
INTEL
, 
E1000_DEV_ID_PCH_I218_V3
), 
bﬂrd_pch_Õt
 },

7943 
MODULE_DEVICE_TABLE
(
pci
, 
e1000_pci_tbl
);

7945 #ifde‡
CONFIG_PM


7946 #i‚de‡
USE_LEGACY_PM_SUPPORT


7947 c⁄° 
dev_pm_›s
 
	ge1000_pm_›s
 = {

7948 .
su•íd
 = 
e1000e_pm_su•íd
,

7949 .
	gªsume
 = 
e1000e_pm_ªsume
,

7950 .
	g‰ìze
 = 
e1000e_pm_‰ìze
,

7951 .
	gthaw
 = 
e1000e_pm_thaw
,

7952 .
	gpowîoff
 = 
e1000e_pm_su•íd
,

7953 .
	gª°‹e
 = 
e1000e_pm_ªsume
,

7954 
SET_RUNTIME_PM_OPS
(
e1000e_pm_ru¡ime_su•íd
, 
e1000e_pm_ru¡ime_ªsume
,

7955 
e1000e_pm_ru¡ime_idÀ
)

7961 
pci_drivî
 
	ge1000_drivî
 = {

7962 .
«me
 = 
e1000e_drivî_«me
,

7963 .
	gid_èbÀ
 = 
e1000_pci_tbl
,

7964 .
	g¥obe
 = 
e1000_¥obe
,

7965 #ifde‡
HAVE_CONFIG_HOTPLUG


7966 .
	gªmove
 = 
__devexô_p
(
e1000_ªmove
),

7968 .
	gªmove
 = 
e1000_ªmove
,

7970 #ifde‡
CONFIG_PM


7971 #i‚de‡
USE_LEGACY_PM_SUPPORT


7972 .
	gdrivî
 = {

7973 .
pm
 = &
e1000_pm_›s
,

7975 #ñi‡
deföed
(
CONFIG_PM_SLEEP
)

7976 .
	gsu•íd
 = 
e1000e_pm_su•íd
,

7977 .
	gªsume
 = 
e1000e_pm_ªsume
,

7980 #i‚de‡
USE_REBOOT_NOTIFIER


7981 .
	gshutdown
 = 
e1000_shutdown
,

7983 #ifde‡
HAVE_PCI_ERS


7984 .
	gîr_h™dÀr
 = &
e1000_îr_h™dÀr


7994 
__öô
 
	$e1000_öô_moduÀ
()

7996 
ªt
;

7997 
	`¥_öfo
("Intel(R) PRO/1000 Network Driver - %s\n",

7998 
e1000e_drivî_vîsi⁄
);

7999 
	`¥_öfo
("Copyright(c) 1999 - 2013 Intel Corporation.\n");

8000 
ªt
 = 
	`pci_ªgi°î_drivî
(&
e1000_drivî
);

8001 #ifde‡
USE_REBOOT_NOTIFIER


8002 i‡(
ªt
 >= 0)

8003 
	`ªgi°î_ªboŸ_nŸifõr
(&
e1000_nŸifõr_ªboŸ
);

8006  
ªt
;

8007 
	}
}

8008 
moduÀ_öô
(
e1000_öô_moduÀ
);

8016 
__exô
 
	$e1000_exô_moduÀ
()

8018 #ifde‡
USE_REBOOT_NOTIFIER


8019 
	`uƒegi°î_ªboŸ_nŸifõr
(&
e1000_nŸifõr_ªboŸ
);

8021 
	`pci_uƒegi°î_drivî
(&
e1000_drivî
);

8022 
	}
}

8023 
moduÀ_exô
(
e1000_exô_moduÀ
);

8025 
MODULE_AUTHOR
("Intel Corporation, <linux.nics@intel.com>");

8026 
MODULE_DESCRIPTION
("Intel(R) PRO/1000 Network Driver");

8027 
MODULE_LICENSE
("GPL");

8028 
MODULE_VERSION
(
DRV_VERSION
);

	@nvm.c

29 
	~"e1000.h
"

38 
	$e1000_øi£_ìc_˛k
(
e1000_hw
 *
hw
, 
u32
 *
ìcd
)

40 *
ìcd
 = *ìcd | 
E1000_EECD_SK
;

41 
	`ew32
(
EECD
, *
ìcd
);

42 
	`e1e_Êush
();

43 
	`udñay
(
hw
->
nvm
.
dñay_u£c
);

44 
	}
}

53 
	$e1000_lowî_ìc_˛k
(
e1000_hw
 *
hw
, 
u32
 *
ìcd
)

55 *
ìcd
 = *ìcd & ~
E1000_EECD_SK
;

56 
	`ew32
(
EECD
, *
ìcd
);

57 
	`e1e_Êush
();

58 
	`udñay
(
hw
->
nvm
.
dñay_u£c
);

59 
	}
}

71 
	$e1000_shi·_out_ìc_bôs
(
e1000_hw
 *
hw
, 
u16
 
d©a
, u16 
cou¡
)

73 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

74 
u32
 
ìcd
 = 
	`î32
(
EECD
);

75 
u32
 
mask
;

77 
mask
 = 0x01 << (
cou¡
 - 1);

78 i‡(
nvm
->
ty≥
 =
e1000_nvm_ì¥om_•i
)

79 
ìcd
 |
E1000_EECD_DO
;

82 
ìcd
 &~
E1000_EECD_DI
;

84 i‡(
d©a
 & 
mask
)

85 
ìcd
 |
E1000_EECD_DI
;

87 
	`ew32
(
EECD
, 
ìcd
);

88 
	`e1e_Êush
();

90 
	`udñay
(
nvm
->
dñay_u£c
);

92 
	`e1000_øi£_ìc_˛k
(
hw
, &
ìcd
);

93 
	`e1000_lowî_ìc_˛k
(
hw
, &
ìcd
);

95 
mask
 >>= 1;

96 } 
mask
);

98 
ìcd
 &~
E1000_EECD_DI
;

99 
	`ew32
(
EECD
, 
ìcd
);

100 
	}
}

113 
u16
 
	$e1000_shi·_ö_ìc_bôs
(
e1000_hw
 *
hw
, 
u16
 
cou¡
)

115 
u32
 
ìcd
;

116 
u32
 
i
;

117 
u16
 
d©a
;

119 
ìcd
 = 
	`î32
(
EECD
);

120 
ìcd
 &~(
E1000_EECD_DO
 | 
E1000_EECD_DI
);

121 
d©a
 = 0;

123 
i
 = 0; i < 
cou¡
; i++) {

124 
d©a
 <<= 1;

125 
	`e1000_øi£_ìc_˛k
(
hw
, &
ìcd
);

127 
ìcd
 = 
	`î32
(
EECD
);

129 
ìcd
 &~
E1000_EECD_DI
;

130 i‡(
ìcd
 & 
E1000_EECD_DO
)

131 
d©a
 |= 1;

133 
	`e1000_lowî_ìc_˛k
(
hw
, &
ìcd
);

136  
d©a
;

137 
	}
}

147 
s32
 
	$e1000e_pﬁl_ìrd_ìwr_d⁄e
(
e1000_hw
 *
hw
, 
ì_ªg
)

149 
u32
 
©ãm±s
 = 100000;

150 
u32
 
i
, 
ªg
 = 0;

152 
i
 = 0; i < 
©ãm±s
; i++) {

153 i‡(
ì_ªg
 =
E1000_NVM_POLL_READ
)

154 
ªg
 = 
	`î32
(
EERD
);

156 
ªg
 = 
	`î32
(
EEWR
);

158 i‡(
ªg
 & 
E1000_NVM_RW_REG_DONE
)

161 
	`udñay
(5);

164  -
E1000_ERR_NVM
;

165 
	}
}

175 
s32
 
	$e1000e_acquúe_nvm
(
e1000_hw
 *
hw
)

177 
u32
 
ìcd
 = 
	`î32
(
EECD
);

178 
s32
 
timeout
 = 
E1000_NVM_GRANT_ATTEMPTS
;

180 
	`ew32
(
EECD
, 
ìcd
 | 
E1000_EECD_REQ
);

181 
ìcd
 = 
	`î32
(
EECD
);

182 
timeout
) {

183 i‡(
ìcd
 & 
E1000_EECD_GNT
)

185 
	`udñay
(5);

186 
ìcd
 = 
	`î32
(
EECD
);

187 
timeout
--;

190 i‡(!
timeout
) {

191 
ìcd
 &~
E1000_EECD_REQ
;

192 
	`ew32
(
EECD
, 
ìcd
);

193 
	`e_dbg
("CouldÇotácquire NVM grant\n");

194  -
E1000_ERR_NVM
;

198 
	}
}

206 
	$e1000_°™dby_nvm
(
e1000_hw
 *
hw
)

208 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

209 
u32
 
ìcd
 = 
	`î32
(
EECD
);

211 i‡(
nvm
->
ty≥
 =
e1000_nvm_ì¥om_•i
) {

213 
ìcd
 |
E1000_EECD_CS
;

214 
	`ew32
(
EECD
, 
ìcd
);

215 
	`e1e_Êush
();

216 
	`udñay
(
nvm
->
dñay_u£c
);

217 
ìcd
 &~
E1000_EECD_CS
;

218 
	`ew32
(
EECD
, 
ìcd
);

219 
	`e1e_Êush
();

220 
	`udñay
(
nvm
->
dñay_u£c
);

222 
	}
}

230 
	$e1000_°›_nvm
(
e1000_hw
 *
hw
)

232 
u32
 
ìcd
;

234 
ìcd
 = 
	`î32
(
EECD
);

235 i‡(
hw
->
nvm
.
ty≥
 =
e1000_nvm_ì¥om_•i
) {

237 
ìcd
 |
E1000_EECD_CS
;

238 
	`e1000_lowî_ìc_˛k
(
hw
, &
ìcd
);

240 
	}
}

248 
	$e1000e_ªÀa£_nvm
(
e1000_hw
 *
hw
)

250 
u32
 
ìcd
;

252 
	`e1000_°›_nvm
(
hw
);

254 
ìcd
 = 
	`î32
(
EECD
);

255 
ìcd
 &~
E1000_EECD_REQ
;

256 
	`ew32
(
EECD
, 
ìcd
);

257 
	}
}

265 
s32
 
	$e1000_ªady_nvm_ì¥om
(
e1000_hw
 *
hw
)

267 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

268 
u32
 
ìcd
 = 
	`î32
(
EECD
);

269 
u8
 
•i_°©_ªg
;

271 i‡(
nvm
->
ty≥
 =
e1000_nvm_ì¥om_•i
) {

272 
u16
 
timeout
 = 
NVM_MAX_RETRY_SPI
;

275 
ìcd
 &~(
E1000_EECD_CS
 | 
E1000_EECD_SK
);

276 
	`ew32
(
EECD
, 
ìcd
);

277 
	`e1e_Êush
();

278 
	`udñay
(1);

285 
timeout
) {

286 
	`e1000_shi·_out_ìc_bôs
(
hw
, 
NVM_RDSR_OPCODE_SPI
,

287 
hw
->
nvm
.
›code_bôs
);

288 
•i_°©_ªg
 = (
u8
)
	`e1000_shi·_ö_ìc_bôs
(
hw
, 8);

289 i‡(!(
•i_°©_ªg
 & 
NVM_STATUS_RDY_SPI
))

292 
	`udñay
(5);

293 
	`e1000_°™dby_nvm
(
hw
);

294 
timeout
--;

297 i‡(!
timeout
) {

298 
	`e_dbg
("SPI NVM StatusÉrror\n");

299  -
E1000_ERR_NVM
;

304 
	}
}

315 
s32
 
	$e1000e_ªad_nvm_ìrd
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
, u16 *
d©a
)

317 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

318 
u32
 
i
, 
ìrd
 = 0;

319 
s32
 
ªt_vÆ
 = 0;

324 i‡((
off£t
 >
nvm
->
w‹d_size
Ë|| (
w‹ds
 > (nvm->word_size - offset)) ||

325 (
w‹ds
 == 0)) {

326 
	`e_dbg
("nvmÖarameter(s) out of bounds\n");

327  -
E1000_ERR_NVM
;

330 
i
 = 0; i < 
w‹ds
; i++) {

331 
ìrd
 = ((
off£t
 + 
i
Ë<< 
E1000_NVM_RW_ADDR_SHIFT
) +

332 
E1000_NVM_RW_REG_START
;

334 
	`ew32
(
EERD
, 
ìrd
);

335 
ªt_vÆ
 = 
	`e1000e_pﬁl_ìrd_ìwr_d⁄e
(
hw
, 
E1000_NVM_POLL_READ
);

336 i‡(
ªt_vÆ
)

339 
d©a
[
i
] = (
	`î32
(
EERD
Ë>> 
E1000_NVM_RW_REG_DATA
);

342  
ªt_vÆ
;

343 
	}
}

357 
s32
 
	$e1000e_wrôe_nvm_•i
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
, u16 *
d©a
)

359 
e1000_nvm_öfo
 *
nvm
 = &
hw
->nvm;

360 
s32
 
ªt_vÆ
 = -
E1000_ERR_NVM
;

361 
u16
 
widx
 = 0;

366 i‡((
off£t
 >
nvm
->
w‹d_size
Ë|| (
w‹ds
 > (nvm->word_size - offset)) ||

367 (
w‹ds
 == 0)) {

368 
	`e_dbg
("nvmÖarameter(s) out of bounds\n");

369  -
E1000_ERR_NVM
;

372 
widx
 < 
w‹ds
) {

373 
u8
 
wrôe_›code
 = 
NVM_WRITE_OPCODE_SPI
;

375 
ªt_vÆ
 = 
nvm
->
›s
.
	`acquúe
(
hw
);

376 i‡(
ªt_vÆ
)

377  
ªt_vÆ
;

379 
ªt_vÆ
 = 
	`e1000_ªady_nvm_ì¥om
(
hw
);

380 i‡(
ªt_vÆ
) {

381 
nvm
->
›s
.
	`ªÀa£
(
hw
);

382  
ªt_vÆ
;

385 
	`e1000_°™dby_nvm
(
hw
);

388 
	`e1000_shi·_out_ìc_bôs
(
hw
, 
NVM_WREN_OPCODE_SPI
,

389 
nvm
->
›code_bôs
);

391 
	`e1000_°™dby_nvm
(
hw
);

396 i‡((
nvm
->
addªss_bôs
 =8Ë&& (
off£t
 >= 128))

397 
wrôe_›code
 |
NVM_A8_OPCODE_SPI
;

400 
	`e1000_shi·_out_ìc_bôs
(
hw
, 
wrôe_›code
, 
nvm
->
›code_bôs
);

401 
	`e1000_shi·_out_ìc_bôs
(
hw
, (
u16
)((
off£t
 + 
widx
) * 2),

402 
nvm
->
addªss_bôs
);

405 
widx
 < 
w‹ds
) {

406 
u16
 
w‹d_out
 = 
d©a
[
widx
];

407 
w‹d_out
 = (word_out >> 8) | (word_out << 8);

408 
	`e1000_shi·_out_ìc_bôs
(
hw
, 
w‹d_out
, 16);

409 
widx
++;

411 i‡((((
off£t
 + 
widx
Ë* 2Ë% 
nvm
->
∑ge_size
) == 0) {

412 
	`e1000_°™dby_nvm
(
hw
);

416 
	`u¶ìp_ønge
(10000, 20000);

417 
nvm
->
›s
.
	`ªÀa£
(
hw
);

420  
ªt_vÆ
;

421 
	}
}

432 
s32
 
	$e1000_ªad_pba_°rög_gíîic
(
e1000_hw
 *
hw
, 
u8
 *
pba_num
,

433 
u32
 
pba_num_size
)

435 
s32
 
ªt_vÆ
;

436 
u16
 
nvm_d©a
;

437 
u16
 
pba_±r
;

438 
u16
 
off£t
;

439 
u16
 
Àngth
;

441 i‡(
pba_num
 =
NULL
) {

442 
	`e_dbg
("PBA string buffer wasÇull\n");

443  -
E1000_ERR_INVALID_ARGUMENT
;

446 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_PBA_OFFSET_0
, 1, &
nvm_d©a
);

447 i‡(
ªt_vÆ
) {

448 
	`e_dbg
("NVM Read Error\n");

449  
ªt_vÆ
;

452 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
NVM_PBA_OFFSET_1
, 1, &
pba_±r
);

453 i‡(
ªt_vÆ
) {

454 
	`e_dbg
("NVM Read Error\n");

455  
ªt_vÆ
;

462 i‡(
nvm_d©a
 !
NVM_PBA_PTR_GUARD
) {

463 
	`e_dbg
("NVM PBAÇumber isÇot storedás string\n");

466 i‡(
pba_num_size
 < 
E1000_PBANUM_LENGTH
) {

467 
	`e_dbg
("PBA string bufferÅoo small\n");

468  
E1000_ERR_NO_SPACE
;

472 
pba_num
[0] = (
nvm_d©a
 >> 12) & 0xF;

473 
pba_num
[1] = (
nvm_d©a
 >> 8) & 0xF;

474 
pba_num
[2] = (
nvm_d©a
 >> 4) & 0xF;

475 
pba_num
[3] = 
nvm_d©a
 & 0xF;

476 
pba_num
[4] = (
pba_±r
 >> 12) & 0xF;

477 
pba_num
[5] = (
pba_±r
 >> 8) & 0xF;

478 
pba_num
[6] = '-';

479 
pba_num
[7] = 0;

480 
pba_num
[8] = (
pba_±r
 >> 4) & 0xF;

481 
pba_num
[9] = 
pba_±r
 & 0xF;

484 
pba_num
[10] = '\0';

487 
off£t
 = 0; offset < 10; offset++) {

488 i‡(
pba_num
[
off£t
] < 0xA)

489 
pba_num
[
off£t
] += '0';

490 i‡(
pba_num
[
off£t
] < 0x10)

491 
pba_num
[
off£t
] += 'A' - 0xA;

497 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
pba_±r
, 1, &
Àngth
);

498 i‡(
ªt_vÆ
) {

499 
	`e_dbg
("NVM Read Error\n");

500  
ªt_vÆ
;

503 i‡(
Àngth
 == 0xFFFF ||Üength == 0) {

504 
	`e_dbg
("NVM PBAÇumber section invalidÜength\n");

505  -
E1000_ERR_NVM_PBA_SECTION
;

508 i‡(
pba_num_size
 < (((
u32
)
Àngth
 * 2) - 1)) {

509 
	`e_dbg
("PBA string bufferÅoo small\n");

510  -
E1000_ERR_NO_SPACE
;

514 
pba_±r
++;

515 
Àngth
--;

517 
off£t
 = 0; off£à< 
Àngth
; offset++) {

518 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
pba_±r
 + 
off£t
, 1, &
nvm_d©a
);

519 i‡(
ªt_vÆ
) {

520 
	`e_dbg
("NVM Read Error\n");

521  
ªt_vÆ
;

523 
pba_num
[
off£t
 * 2] = (
u8
)(
nvm_d©a
 >> 8);

524 
pba_num
[(
off£t
 * 2Ë+ 1] = (
u8
)(
nvm_d©a
 & 0xFF);

526 
pba_num
[
off£t
 * 2] = '\0';

529 
	}
}

539 
s32
 
	$e1000_ªad_mac_addr_gíîic
(
e1000_hw
 *
hw
)

541 
u32
 
ør_high
;

542 
u32
 
ør_low
;

543 
u16
 
i
;

545 
ør_high
 = 
	`î32
(
	`RAH
(0));

546 
ør_low
 = 
	`î32
(
	`RAL
(0));

548 
i
 = 0; i < 
E1000_RAL_MAC_ADDR_LEN
; i++)

549 
hw
->
mac
.
≥rm_addr
[
i
] = (
u8
)(
ør_low
 >> (i * 8));

551 
i
 = 0; i < 
E1000_RAH_MAC_ADDR_LEN
; i++)

552 
hw
->
mac
.
≥rm_addr
[
i
 + 4] = (
u8
)(
ør_high
 >> (i * 8));

554 
i
 = 0; i < 
ETH_ALEN
; i++)

555 
hw
->
mac
.
addr
[
i
] = hw->mac.
≥rm_addr
[i];

558 
	}
}

567 
s32
 
	$e1000e_vÆid©e_nvm_checksum_gíîic
(
e1000_hw
 *
hw
)

569 
s32
 
ªt_vÆ
;

570 
u16
 
checksum
 = 0;

571 
u16
 
i
, 
nvm_d©a
;

573 
i
 = 0; i < (
NVM_CHECKSUM_REG
 + 1); i++) {

574 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
i
, 1, &
nvm_d©a
);

575 i‡(
ªt_vÆ
) {

576 
	`e_dbg
("NVM Read Error\n");

577  
ªt_vÆ
;

579 
checksum
 +
nvm_d©a
;

582 i‡(
checksum
 !(
u16
)
NVM_SUM
) {

583 
	`e_dbg
("NVM Checksum Invalid\n");

584  -
E1000_ERR_NVM
;

588 
	}
}

598 
s32
 
	$e1000e_upd©e_nvm_checksum_gíîic
(
e1000_hw
 *
hw
)

600 
s32
 
ªt_vÆ
;

601 
u16
 
checksum
 = 0;

602 
u16
 
i
, 
nvm_d©a
;

604 
i
 = 0; i < 
NVM_CHECKSUM_REG
; i++) {

605 
ªt_vÆ
 = 
	`e1000_ªad_nvm
(
hw
, 
i
, 1, &
nvm_d©a
);

606 i‡(
ªt_vÆ
) {

607 
	`e_dbg
("NVM Read Error while updating checksum.\n");

608  
ªt_vÆ
;

610 
checksum
 +
nvm_d©a
;

612 
checksum
 = (
u16
)
NVM_SUM
 - checksum;

613 
ªt_vÆ
 = 
	`e1000_wrôe_nvm
(
hw
, 
NVM_CHECKSUM_REG
, 1, &
checksum
);

614 i‡(
ªt_vÆ
)

615 
	`e_dbg
("NVM Write Error while updating checksum.\n");

617  
ªt_vÆ
;

618 
	}
}

627 
	$e1000e_ªlﬂd_nvm_gíîic
(
e1000_hw
 *
hw
)

629 
u32
 
˘æ_ext
;

631 
	`u¶ìp_ønge
(10, 20);

632 
˘æ_ext
 = 
	`î32
(
CTRL_EXT
);

633 
˘æ_ext
 |
E1000_CTRL_EXT_EE_RST
;

634 
	`ew32
(
CTRL_EXT
, 
˘æ_ext
);

635 
	`e1e_Êush
();

636 
	}
}

	@nvm.h

29 #i‚de‡
_E1000E_NVM_H_


30 
	#_E1000E_NVM_H_


	)

32 
s32
 
e1000e_acquúe_nvm
(
e1000_hw
 *
hw
);

34 
s32
 
e1000e_pﬁl_ìrd_ìwr_d⁄e
(
e1000_hw
 *
hw
, 
ì_ªg
);

35 
s32
 
e1000_ªad_mac_addr_gíîic
(
e1000_hw
 *
hw
);

36 
s32
 
e1000_ªad_pba_°rög_gíîic
(
e1000_hw
 *
hw
, 
u8
 *
pba_num
,

37 
u32
 
pba_num_size
);

38 
s32
 
e1000e_ªad_nvm_ìrd
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
, u16 *
d©a
);

39 
s32
 
e1000e_vÆid_Àd_deÁu…
(
e1000_hw
 *
hw
, 
u16
 *
d©a
);

40 
s32
 
e1000e_vÆid©e_nvm_checksum_gíîic
(
e1000_hw
 *
hw
);

41 
s32
 
e1000e_wrôe_nvm_•i
(
e1000_hw
 *
hw
, 
u16
 
off£t
, u16 
w‹ds
, u16 *
d©a
);

42 
s32
 
e1000e_upd©e_nvm_checksum_gíîic
(
e1000_hw
 *
hw
);

43 
e1000e_ªÀa£_nvm
(
e1000_hw
 *
hw
);

45 
	#E1000_STM_OPCODE
 0xDB00

	)

	@param.c

29 
	~<löux/√tdevi˚.h
>

30 
	~<löux/moduÀ.h
>

31 
	~<löux/pci.h
>

33 
	~"e1000.h
"

38 
	#E1000_MAX_NIC
 32

	)

40 
	#OPTION_UNSET
 -1

	)

41 
	#OPTION_DISABLED
 0

	)

42 
	#OPTION_ENABLED
 1

	)

44 
	#COPYBREAK_DEFAULT
 256

	)

45 
	gc›ybªak
 = 
COPYBREAK_DEFAULT
;

46 
moduÀ_∑øm
(
c›ybªak
, 
uöt
, 0644);

47 
MODULE_PARM_DESC
(
c›ybªak
,

54 
	#E1000_PARAM_INIT
 { [0 ... 
E1000_MAX_NIC
] = 
OPTION_UNSET
 }

	)

55 #i‚de‡
moduÀ_∑øm_¨øy


65 
	#E1000_PARAM
(
X
, 
desc
) \

66 c⁄° 
__devöôd©a
 
X
[
E1000_MAX_NIC
+1] = 
E1000_PARAM_INIT
; \

67 
num_
##
X
; \

68 
	`MODULE_PARM
(
X
, "1-" 
	`__MODULE_STRING
(
E1000_MAX_NIC
) "i"); \

69 
	`MODULE_PARM_DESC
(
X
, 
desc
);

	)

70 #ñi‡
deföed
(
HAVE_CONFIG_HOTPLUG
)

71 
	#E1000_PARAM
(
X
, 
desc
) \

72 
__devöôd©a
 
X
[
E1000_MAX_NIC
+1] \

73 
E1000_PARAM_INIT
; \

74 
num_
##
X
; \

75 
	`moduÀ_∑øm_¨øy_«med
(
X
, X, , &
num_
##X, 0); \

76 
	`MODULE_PARM_DESC
(
X
, 
desc
);

	)

78 
	#E1000_PARAM
(
X
, 
desc
) \

79 
X
[
E1000_MAX_NIC
+1] = 
E1000_PARAM_INIT
; \

80 
num_
##
X
; \

81 
	`moduÀ_∑øm_¨øy_«med
(
X
, X, , &
num_
##X, 0); \

82 
	`MODULE_PARM_DESC
(
X
, 
desc
);

	)

90 
E1000_PARAM
(
TxI¡Dñay
, "Transmit Interrupt Delay");

91 
	#DEFAULT_TIDV
 8

	)

92 
	#MAX_TXDELAY
 0xFFFF

	)

93 
	#MIN_TXDELAY
 0

	)

99 
E1000_PARAM
(
TxAbsI¡Dñay
, "Transmit Absolute Interrupt Delay");

100 
	#DEFAULT_TADV
 32

	)

101 
	#MAX_TXABSDELAY
 0xFFFF

	)

102 
	#MIN_TXABSDELAY
 0

	)

109 
E1000_PARAM
(
RxI¡Dñay
, "Receive Interrupt Delay");

110 
	#MAX_RXDELAY
 0xFFFF

	)

111 
	#MIN_RXDELAY
 0

	)

117 
E1000_PARAM
(
RxAbsI¡Dñay
, "Receive Absolute Interrupt Delay");

118 
	#MAX_RXABSDELAY
 0xFFFF

	)

119 
	#MIN_RXABSDELAY
 0

	)

125 
E1000_PARAM
(
I¡îru±ThrŸéeR©e
, "Interrupt Throttling Rate");

126 
	#DEFAULT_ITR
 3

	)

127 
	#MAX_ITR
 100000

	)

128 
	#MIN_ITR
 100

	)

144 
E1000_PARAM
(
I¡Mode
, "Interrupt Mode");

145 
	#MAX_INTMODE
 2

	)

146 
	#MIN_INTMODE
 0

	)

154 
E1000_PARAM
(
Sm¨tPowîDownE«bÀ
, "Enable PHY smartÖower down");

162 
E1000_PARAM
(
Kumî™LockLoss
, "Enable KumeranÜockÜoss workaround");

170 
E1000_PARAM
(
CrcSåùpög
,

179 
E1000_PARAM
(
EEE
, "Enable/disable onÖartsÅhat supportÅhe feature");

190 
E1000_PARAM
(
Node
, "[ROUTING] NodeÅoállocate memory on, default -1");

192 
	se1000_›ti⁄
 {

193 íum { 
	míabÀ_›ti⁄
, 
	mønge_›ti⁄
, 
	mli°_›ti⁄
 } 
	mty≥
;

194 c⁄° *
	m«me
;

195 c⁄° *
	mîr
;

196 
	mdef
;

200 
	mmö
;

201 
	mmax
;

202 } 
	mr
;

205 
	mƒ
;

206 
	se1000_›t_li°
 {

207 
	mi
;

208 *
	m°r
;

209 } *
	mp
;

210 } 
	ml
;

211 } 
	m¨g
;

214 #ifde‡
HAVE_CONFIG_HOTPLUG


215 
__devöô
 
	$e1000_vÆid©e_›ti⁄
(*
vÆue
,

216 c⁄° 
e1000_›ti⁄
 *
›t
,

217 
e1000_ad≠ãr
 *
ad≠ãr
)

219 
	$e1000_vÆid©e_›ti⁄
(*
vÆue
,

220 c⁄° 
e1000_›ti⁄
 *
›t
,

221 
e1000_ad≠ãr
 *
ad≠ãr
)

224 i‡(*
vÆue
 =
OPTION_UNSET
) {

225 *
vÆue
 = 
›t
->
def
;

229 
›t
->
ty≥
) {

230 
íabÀ_›ti⁄
:

231 *
vÆue
) {

232 
OPTION_ENABLED
:

233 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "%s Enabled\n",

234 
›t
->
«me
);

236 
OPTION_DISABLED
:

237 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "%s Disabled\n",

238 
›t
->
«me
);

242 
ønge_›ti⁄
:

243 i‡(*
vÆue
 >
›t
->
¨g
.
r
.
mö
 && *vÆuê<›t->¨g.r.
max
) {

244 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

245 "%†£àtÿ%i\n", 
›t
->
«me
, *
vÆue
);

249 
li°_›ti⁄
: {

250 
i
;

251 
e1000_›t_li°
 *
ít
;

253 
i
 = 0; i < 
›t
->
¨g
.
l
.
ƒ
; i++) {

254 
ít
 = &
›t
->
¨g
.
l
.
p
[
i
];

255 i‡(*
vÆue
 =
ít
->
i
) {

256 i‡(
ít
->
°r
[0] != '\0')

257 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
), "%s\n",

258 
ít
->
°r
);

265 
	`BUG
();

268 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

269 "InvÆid %†vÆuê•ecifõd (%iË%s\n", 
›t
->
«me
, *
vÆue
,

270 
›t
->
îr
);

271 *
vÆue
 = 
›t
->
def
;

273 
	}
}

284 #ifde‡
HAVE_CONFIG_HOTPLUG


285 
__devöô
 
	$e1000e_check_›ti⁄s
(
e1000_ad≠ãr
 *
ad≠ãr
)

287 
	$e1000e_check_›ti⁄s
(
e1000_ad≠ãr
 *
ad≠ãr
)

290 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

291 
bd
 = 
ad≠ãr
->
bd_numbî
;

293 i‡(
bd
 >
E1000_MAX_NIC
) {

294 
	`dev_nŸi˚
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

295 "W¨nög:Çÿc⁄figuøti⁄ f‹ bﬂrd #%i\n", 
bd
);

296 
	`dev_nŸi˚
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

302 c⁄° 
e1000_›ti⁄
 
›t
 = {

303 .
ty≥
 = 
ønge_›ti⁄
,

304 .
«me
 = "Transmit Interrupt Delay",

305 .
îr
 = "using default of "

306 
	`__MODULE_STRING
(
DEFAULT_TIDV
),

307 .
def
 = 
DEFAULT_TIDV
,

308 .
¨g
 = { .
r
 = { .
mö
 = 
MIN_TXDELAY
,

309 .
max
 = 
MAX_TXDELAY
 } }

312 i‡(
num_TxI¡Dñay
 > 
bd
) {

313 
ad≠ãr
->
tx_öt_dñay
 = 
TxI¡Dñay
[
bd
];

314 
	`e1000_vÆid©e_›ti⁄
(&
ad≠ãr
->
tx_öt_dñay
, &
›t
,

315 
ad≠ãr
);

317 
ad≠ãr
->
tx_öt_dñay
 = 
›t
.
def
;

322 c⁄° 
e1000_›ti⁄
 
›t
 = {

323 .
ty≥
 = 
ønge_›ti⁄
,

324 .
«me
 = "Transmit Absolute Interrupt Delay",

325 .
îr
 = "using default of "

326 
	`__MODULE_STRING
(
DEFAULT_TADV
),

327 .
def
 = 
DEFAULT_TADV
,

328 .
¨g
 = { .
r
 = { .
mö
 = 
MIN_TXABSDELAY
,

329 .
max
 = 
MAX_TXABSDELAY
 } }

332 i‡(
num_TxAbsI¡Dñay
 > 
bd
) {

333 
ad≠ãr
->
tx_abs_öt_dñay
 = 
TxAbsI¡Dñay
[
bd
];

334 
	`e1000_vÆid©e_›ti⁄
(&
ad≠ãr
->
tx_abs_öt_dñay
, &
›t
,

335 
ad≠ãr
);

337 
ad≠ãr
->
tx_abs_öt_dñay
 = 
›t
.
def
;

342 
e1000_›ti⁄
 
›t
 = {

343 .
ty≥
 = 
ønge_›ti⁄
,

344 .
«me
 = "Receive Interrupt Delay",

345 .
îr
 = "using default of "

346 
	`__MODULE_STRING
(
DEFAULT_RDTR
),

347 .
def
 = 
DEFAULT_RDTR
,

348 .
¨g
 = { .
r
 = { .
mö
 = 
MIN_RXDELAY
,

349 .
max
 = 
MAX_RXDELAY
 } }

352 i‡(
num_RxI¡Dñay
 > 
bd
) {

353 
ad≠ãr
->
rx_öt_dñay
 = 
RxI¡Dñay
[
bd
];

354 
	`e1000_vÆid©e_›ti⁄
(&
ad≠ãr
->
rx_öt_dñay
, &
›t
,

355 
ad≠ãr
);

357 
ad≠ãr
->
rx_öt_dñay
 = 
›t
.
def
;

362 c⁄° 
e1000_›ti⁄
 
›t
 = {

363 .
ty≥
 = 
ønge_›ti⁄
,

364 .
«me
 = "Receive Absolute Interrupt Delay",

365 .
îr
 = "using default of "

366 
	`__MODULE_STRING
(
DEFAULT_RADV
),

367 .
def
 = 
DEFAULT_RADV
,

368 .
¨g
 = { .
r
 = { .
mö
 = 
MIN_RXABSDELAY
,

369 .
max
 = 
MAX_RXABSDELAY
 } }

372 i‡(
num_RxAbsI¡Dñay
 > 
bd
) {

373 
ad≠ãr
->
rx_abs_öt_dñay
 = 
RxAbsI¡Dñay
[
bd
];

374 
	`e1000_vÆid©e_›ti⁄
(&
ad≠ãr
->
rx_abs_öt_dñay
, &
›t
,

375 
ad≠ãr
);

377 
ad≠ãr
->
rx_abs_öt_dñay
 = 
›t
.
def
;

382 c⁄° 
e1000_›ti⁄
 
›t
 = {

383 .
ty≥
 = 
ønge_›ti⁄
,

384 .
«me
 = "Interrupt Throttling Rate (ints/sec)",

385 .
îr
 = "using default of "

386 
	`__MODULE_STRING
(
DEFAULT_ITR
),

387 .
def
 = 
DEFAULT_ITR
,

388 .
¨g
 = { .
r
 = { .
mö
 = 
MIN_ITR
,

389 .
max
 = 
MAX_ITR
 } }

392 i‡(
num_I¡îru±ThrŸéeR©e
 > 
bd
) {

393 
ad≠ãr
->
ôr
 = 
I¡îru±ThrŸéeR©e
[
bd
];

400 i‡((
ad≠ãr
->
ôr
 > 4) &&

401 
	`e1000_vÆid©e_›ti⁄
(&
ad≠ãr
->
ôr
, &
›t
,ádapter))

402 
ad≠ãr
->
ôr
 = 
›t
.
def
;

407 
ad≠ãr
->
ôr
 = 
›t
.
def
;

412 i‡(
ad≠ãr
->
ôr
 > 4)

413 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

414 "%†£àtÿdeÁu… %d\n", 
›t
.
«me
,

415 
ad≠ãr
->
ôr
);

418 
ad≠ãr
->
ôr_£âög
 =ád≠ãr->
ôr
;

419 
ad≠ãr
->
ôr
) {

421 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

422 "%†tu∫ed off\n", 
›t
.
«me
);

425 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

426 "%†£àtÿdy«mi¯mode\n", 
›t
.
«me
);

427 
ad≠ãr
->
ôr
 = 20000;

430 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

432 
›t
.
«me
);

433 
ad≠ãr
->
ôr_£âög
 = 
›t
.
def
;

436 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

438 
›t
.
«me
);

439 
ad≠ãr
->
ôr
 = 20000;

442 
	`dev_öfo
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

444 
›t
.
«me
);

453 
ad≠ãr
->
ôr_£âög
 &= ~3;

459 
e1000_›ti⁄
 
›t
 = {

460 .
ty≥
 = 
ønge_›ti⁄
,

461 .
«me
 = "Interrupt Mode",

462 #i‚de‡
CONFIG_PCI_MSI


463 .
îr
 = "defaultingÅo 0 (legacy)",

464 .
def
 = 
E1000E_INT_MODE_LEGACY
,

465 .
¨g
 = { .
r
 = { .
mö
 = 0,

466 .
max
 = 0 } }

470 #ifde‡
CONFIG_PCI_MSI


471 i‡(
ad≠ãr
->
Êags
 & 
FLAG_HAS_MSIX
) {

472 
›t
.
îr
 = 
	`k°rdup
("defaultingÅo 2 (MSI-X)",

473 
GFP_KERNEL
);

474 
›t
.
def
 = 
E1000E_INT_MODE_MSIX
;

475 
›t
.
¨g
.
r
.
max
 = 
E1000E_INT_MODE_MSIX
;

477 
›t
.
îr
 = 
	`k°rdup
("deÁu…ögÅÿ1 (MSI)", 
GFP_KERNEL
);

478 
›t
.
def
 = 
E1000E_INT_MODE_MSI
;

479 
›t
.
¨g
.
r
.
max
 = 
E1000E_INT_MODE_MSI
;

482 i‡(!
›t
.
îr
) {

483 
	`dev_îr
(
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
),

489 i‡(
num_I¡Mode
 > 
bd
) {

490 
öt_mode
 = 
I¡Mode
[
bd
];

491 
	`e1000_vÆid©e_›ti⁄
(&
öt_mode
, &
›t
, 
ad≠ãr
);

492 
ad≠ãr
->
öt_mode
 = int_mode;

494 
ad≠ãr
->
öt_mode
 = 
›t
.
def
;

497 #ifde‡
CONFIG_PCI_MSI


498 
	`k‰ì
(
›t
.
îr
);

503 c⁄° 
e1000_›ti⁄
 
›t
 = {

504 .
ty≥
 = 
íabÀ_›ti⁄
,

505 .
«me
 = "PHY Smart Power Down",

506 .
îr
 = "defaultingÅo Disabled",

507 .
def
 = 
OPTION_DISABLED


510 i‡(
num_Sm¨tPowîDownE«bÀ
 > 
bd
) {

511 
•d
 = 
Sm¨tPowîDownE«bÀ
[
bd
];

512 
	`e1000_vÆid©e_›ti⁄
(&
•d
, &
›t
, 
ad≠ãr
);

513 i‡((
ad≠ãr
->
Êags
 & 
FLAG_HAS_SMART_POWER_DOWN
Ë&& 
•d
)

514 
ad≠ãr
->
Êags
 |
FLAG_SMART_POWER_DOWN
;

519 c⁄° 
e1000_›ti⁄
 
›t
 = {

520 .
ty≥
 = 
íabÀ_›ti⁄
,

521 .
«me
 = "CRC Stripping",

522 .
îr
 = "defaultingÅo Enabled",

523 .
def
 = 
OPTION_ENABLED


526 i‡(
num_CrcSåùpög
 > 
bd
) {

527 
¸c_°rùpög
 = 
CrcSåùpög
[
bd
];

528 
	`e1000_vÆid©e_›ti⁄
(&
¸c_°rùpög
, &
›t
, 
ad≠ãr
);

529 i‡(
¸c_°rùpög
 =
OPTION_ENABLED
) {

530 
ad≠ãr
->
Êags2
 |
FLAG2_CRC_STRIPPING
;

531 
ad≠ãr
->
Êags2
 |
FLAG2_DFLT_CRC_STRIPPING
;

534 
ad≠ãr
->
Êags2
 |
FLAG2_CRC_STRIPPING
;

535 
ad≠ãr
->
Êags2
 |
FLAG2_DFLT_CRC_STRIPPING
;

540 c⁄° 
e1000_›ti⁄
 
›t
 = {

541 .
ty≥
 = 
íabÀ_›ti⁄
,

542 .
«me
 = "Kumeran Lock Loss Workaround",

543 .
îr
 = "defaultingÅo Enabled",

544 .
def
 = 
OPTION_ENABLED


546 
boﬁ
 
íabÀd
 = 
›t
.
def
;

548 i‡(
num_Kumî™LockLoss
 > 
bd
) {

549 
km∫_lock_loss
 = 
Kumî™LockLoss
[
bd
];

550 
	`e1000_vÆid©e_›ti⁄
(&
km∫_lock_loss
, &
›t
, 
ad≠ãr
);

551 
íabÀd
 = 
km∫_lock_loss
;

554 i‡(
hw
->
mac
.
ty≥
 =
e1000_ich8œn
)

555 
	`e1000e_£t_km∫_lock_loss_w‹k¨ound_ich8œn
(
hw
,

556 
íabÀd
);

560 c⁄° 
e1000_›ti⁄
 
›t
 = {

561 .
ty≥
 = 
íabÀ_›ti⁄
,

562 .
«me
 = "EEE Support",

563 .
îr
 = "defaultingÅo Enabled (100T/1000T full)",

564 .
def
 = 
OPTION_ENABLED


567 i‡(
ad≠ãr
->
Êags2
 & 
FLAG2_HAS_EEE
) {

569 i‡(
num_EEE
 > 
bd
) {

570 
ìe
 = 
EEE
[
bd
];

571 
	`e1000_vÆid©e_›ti⁄
(&
ìe
, &
›t
, 
ad≠ãr
);

572 
hw
->
dev_•ec
.
ich8œn
.
ìe_dißbÀ
 = !
ìe
;

574 
hw
->
dev_•ec
.
ich8œn
.
ìe_dißbÀ
 = !
›t
.
def
;

580 
e1000_›ti⁄
 
›t
 = {

581 .
ty≥
 = 
ønge_›ti⁄
,

582 .
«me
 = "Node usedÅoállocate memory",

583 .
îr
 = "defaultingÅo -1 (disabled)",

584 #ifde‡
HAVE_EARLY_VMALLOC_NODE


585 .
def
 = 0,

587 .
def
 = -1,

589 .
¨g
 = { .
r
 = { .
mö
 = 0,

590 .
max
 = 
MAX_NUMNODES
 - 1 } }

592 
node
 = 
›t
.
def
;

599 i‡(
node
 == 0) {

601 
node
 = 
fú°_⁄löe_node
;

602 
›t
.
def
 = 
node
;

605 i‡(
num_Node
 > 
bd
) {

606 
node
 = 
Node
[
bd
];

607 
	`e1000_vÆid©e_›ti⁄
((*)&
node
, &
›t
,

608 
ad≠ãr
);

609 i‡(
node
 !
OPTION_UNSET
)

610 
	`e_öfo
("nodêu£d f‹áŒoˇti⁄: %d\n", 
node
);

614 i‡((
node
 !-1Ë&& !
	`node_⁄löe
(node)) {

615 
	`e_öfo
("ign‹ögÇodê£àtÿövÆid vÆuê%d\n", 
node
);

616 
node
 = 
›t
.
def
;

619 
ad≠ãr
->
node
 =Çode;

621 
	}
}

	@phy.c

29 
	~"e1000.h
"

31 
s32
 
e1000_waô_aut⁄eg
(
e1000_hw
 *
hw
);

32 
s32
 
e1000_ac˚ss_phy_wakeup_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

33 
u16
 *
d©a
, 
boﬁ
 
ªad
, boﬁ 
∑ge_£t
);

34 
u32
 
e1000_gë_phy_addr_f‹_hv_∑ge
(u32 
∑ge
);

35 
s32
 
e1000_ac˚ss_phy_debug_ªgs_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

36 
u16
 *
d©a
, 
boﬁ
 
ªad
);

39 c⁄° 
u16
 
	ge1000_m88_ˇbÀ_Àngth_èbÀ
[] = {

40 0, 50, 80, 110, 140, 140, 
E1000_CABLE_LENGTH_UNDEFINED


43 
	#M88E1000_CABLE_LENGTH_TABLE_SIZE
 \

44 ((
e1000_m88_ˇbÀ_Àngth_èbÀ
) / \

45 (
e1000_m88_ˇbÀ_Àngth_èbÀ
[0]))

	)

47 c⁄° 
u16
 
	ge1000_igp_2_ˇbÀ_Àngth_èbÀ
[] = {

58 
	#IGP02E1000_CABLE_LENGTH_TABLE_SIZE
 \

59 ((
e1000_igp_2_ˇbÀ_Àngth_èbÀ
) / \

60 (
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[0]))

	)

70 
s32
 
	$e1000e_check_ª£t_block_gíîic
(
e1000_hw
 *
hw
)

72 
u32
 
m™c
;

74 
m™c
 = 
	`î32
(
MANC
);

76  (
m™c
 & 
E1000_MANC_BLK_PHY_RST_ON_IDE
Ë? 
E1000_BLK_PHY_RESET
 : 0;

77 
	}
}

86 
s32
 
	$e1000e_gë_phy_id
(
e1000_hw
 *
hw
)

88 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

89 
s32
 
ªt_vÆ
 = 0;

90 
u16
 
phy_id
;

91 
u16
 
ªåy_cou¡
 = 0;

93 i‡(!
phy
->
›s
.
ªad_ªg
)

96 
ªåy_cou¡
 < 2) {

97 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_PHYSID1
, &
phy_id
);

98 i‡(
ªt_vÆ
)

99  
ªt_vÆ
;

101 
phy
->
id
 = (
u32
)(
phy_id
 << 16);

102 
	`u¶ìp_ønge
(20, 40);

103 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_PHYSID2
, &
phy_id
);

104 i‡(
ªt_vÆ
)

105  
ªt_vÆ
;

107 
phy
->
id
 |(
u32
)(
phy_id
 & 
PHY_REVISION_MASK
);

108 
phy
->
ªvisi⁄
 = (
u32
)(
phy_id
 & ~
PHY_REVISION_MASK
);

110 i‡(
phy
->
id
 !0 &&Öhy->id !
PHY_REVISION_MASK
)

113 
ªåy_cou¡
++;

117 
	}
}

125 
s32
 
	$e1000e_phy_ª£t_d•
(
e1000_hw
 *
hw
)

127 
s32
 
ªt_vÆ
;

129 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_GEN_CONTROL
, 0xC1);

130 i‡(
ªt_vÆ
)

131  
ªt_vÆ
;

133  
	`e1e_wphy
(
hw
, 
M88E1000_PHY_GEN_CONTROL
, 0);

134 
	}
}

145 
s32
 
	$e1000e_ªad_phy_ªg_mdic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

147 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

148 
u32
 
i
, 
mdic
 = 0;

150 i‡(
off£t
 > 
MAX_PHY_REG_ADDRESS
) {

151 
	`e_dbg
("PHY Addªs†%d i†ouào‡ønge\n", 
off£t
);

152  -
E1000_ERR_PARAM
;

159 
mdic
 = ((
off£t
 << 
E1000_MDIC_REG_SHIFT
) |

160 (
phy
->
addr
 << 
E1000_MDIC_PHY_SHIFT
) |

161 (
E1000_MDIC_OP_READ
));

163 
	`ew32
(
MDIC
, 
mdic
);

169 
i
 = 0; i < (
E1000_GEN_POLL_TIMEOUT
 * 3); i++) {

170 
	`udñay
(50);

171 
mdic
 = 
	`î32
(
MDIC
);

172 i‡(
mdic
 & 
E1000_MDIC_READY
)

175 i‡(!(
mdic
 & 
E1000_MDIC_READY
)) {

176 
	`e_dbg
("MDI Read didÇot complete\n");

177  -
E1000_ERR_PHY
;

179 i‡(
mdic
 & 
E1000_MDIC_ERROR
) {

180 
	`e_dbg
("MDI Error\n");

181  -
E1000_ERR_PHY
;

183 i‡(((
mdic
 & 
E1000_MDIC_REG_MASK
Ë>> 
E1000_MDIC_REG_SHIFT
Ë!
off£t
) {

184 
	`e_dbg
("MDI Read offsetÉrror -Ñequested %d,Ñeturned %d\n",

185 
off£t
,

186 (
mdic
 & 
E1000_MDIC_REG_MASK
Ë>> 
E1000_MDIC_REG_SHIFT
);

187  -
E1000_ERR_PHY
;

189 *
d©a
 = (
u16
)
mdic
;

194 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch2œn
)

195 
	`udñay
(100);

198 
	}
}

208 
s32
 
	$e1000e_wrôe_phy_ªg_mdic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

210 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

211 
u32
 
i
, 
mdic
 = 0;

213 i‡(
off£t
 > 
MAX_PHY_REG_ADDRESS
) {

214 
	`e_dbg
("PHY Addªs†%d i†ouào‡ønge\n", 
off£t
);

215  -
E1000_ERR_PARAM
;

222 
mdic
 = (((
u32
)
d©a
) |

223 (
off£t
 << 
E1000_MDIC_REG_SHIFT
) |

224 (
phy
->
addr
 << 
E1000_MDIC_PHY_SHIFT
) |

225 (
E1000_MDIC_OP_WRITE
));

227 
	`ew32
(
MDIC
, 
mdic
);

233 
i
 = 0; i < (
E1000_GEN_POLL_TIMEOUT
 * 3); i++) {

234 
	`udñay
(50);

235 
mdic
 = 
	`î32
(
MDIC
);

236 i‡(
mdic
 & 
E1000_MDIC_READY
)

239 i‡(!(
mdic
 & 
E1000_MDIC_READY
)) {

240 
	`e_dbg
("MDI Write didÇot complete\n");

241  -
E1000_ERR_PHY
;

243 i‡(
mdic
 & 
E1000_MDIC_ERROR
) {

244 
	`e_dbg
("MDI Error\n");

245  -
E1000_ERR_PHY
;

247 i‡(((
mdic
 & 
E1000_MDIC_REG_MASK
Ë>> 
E1000_MDIC_REG_SHIFT
Ë!
off£t
) {

248 
	`e_dbg
("MDI Write offsetÉrror -Ñequested %d,Ñeturned %d\n",

249 
off£t
,

250 (
mdic
 & 
E1000_MDIC_REG_MASK
Ë>> 
E1000_MDIC_REG_SHIFT
);

251  -
E1000_ERR_PHY
;

257 i‡(
hw
->
mac
.
ty≥
 =
e1000_pch2œn
)

258 
	`udñay
(100);

261 
	}
}

273 
s32
 
	$e1000e_ªad_phy_ªg_m88
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

275 
s32
 
ªt_vÆ
;

277 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

278 i‡(
ªt_vÆ
)

279  
ªt_vÆ
;

281 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

282 
d©a
);

284 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

286  
ªt_vÆ
;

287 
	}
}

298 
s32
 
	$e1000e_wrôe_phy_ªg_m88
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

300 
s32
 
ªt_vÆ
;

302 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

303 i‡(
ªt_vÆ
)

304  
ªt_vÆ
;

306 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

307 
d©a
);

309 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

311  
ªt_vÆ
;

312 
	}
}

323 
s32
 
	$e1000_£t_∑ge_igp
(
e1000_hw
 *
hw
, 
u16
 
∑ge
)

325 
	`e_dbg
("SëtögÖagê0x%x\n", 
∑ge
);

327 
hw
->
phy
.
addr
 = 1;

329  
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
IGP01E1000_PHY_PAGE_SELECT
, 
∑ge
);

330 
	}
}

343 
s32
 
	$__e1000e_ªad_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
,

344 
boﬁ
 
locked
)

346 
s32
 
ªt_vÆ
 = 0;

348 i‡(!
locked
) {

349 i‡(!
hw
->
phy
.
›s
.
acquúe
)

352 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

353 i‡(
ªt_vÆ
)

354  
ªt_vÆ
;

357 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
)

358 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
,

359 
IGP01E1000_PHY_PAGE_SELECT
,

360 (
u16
)
off£t
);

361 i‡(!
ªt_vÆ
)

362 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
,

363 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

364 
d©a
);

365 i‡(!
locked
)

366 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

368  
ªt_vÆ
;

369 
	}
}

381 
s32
 
	$e1000e_ªad_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

383  
	`__e1000e_ªad_phy_ªg_igp
(
hw
, 
off£t
, 
d©a
, 
Ál£
);

384 
	}
}

395 
s32
 
	$e1000e_ªad_phy_ªg_igp_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

397  
	`__e1000e_ªad_phy_ªg_igp
(
hw
, 
off£t
, 
d©a
, 
åue
);

398 
	}
}

410 
s32
 
	$__e1000e_wrôe_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
,

411 
boﬁ
 
locked
)

413 
s32
 
ªt_vÆ
 = 0;

415 i‡(!
locked
) {

416 i‡(!
hw
->
phy
.
›s
.
acquúe
)

419 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

420 i‡(
ªt_vÆ
)

421  
ªt_vÆ
;

424 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
)

425 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
,

426 
IGP01E1000_PHY_PAGE_SELECT
,

427 (
u16
)
off£t
);

428 i‡(!
ªt_vÆ
)

429 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 &

430 
off£t
, 
d©a
);

431 i‡(!
locked
)

432 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

434  
ªt_vÆ
;

435 
	}
}

446 
s32
 
	$e1000e_wrôe_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

448  
	`__e1000e_wrôe_phy_ªg_igp
(
hw
, 
off£t
, 
d©a
, 
Ál£
);

449 
	}
}

460 
s32
 
	$e1000e_wrôe_phy_ªg_igp_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

462  
	`__e1000e_wrôe_phy_ªg_igp
(
hw
, 
off£t
, 
d©a
, 
åue
);

463 
	}
}

476 
s32
 
	$__e1000_ªad_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
,

477 
boﬁ
 
locked
)

479 
u32
 
km∫˘æ°a
;

481 i‡(!
locked
) {

482 
s32
 
ªt_vÆ
 = 0;

484 i‡(!
hw
->
phy
.
›s
.
acquúe
)

487 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

488 i‡(
ªt_vÆ
)

489  
ªt_vÆ
;

492 
km∫˘æ°a
 = ((
off£t
 << 
E1000_KMRNCTRLSTA_OFFSET_SHIFT
) &

493 
E1000_KMRNCTRLSTA_OFFSET
Ë| 
E1000_KMRNCTRLSTA_REN
;

494 
	`ew32
(
KMRNCTRLSTA
, 
km∫˘æ°a
);

495 
	`e1e_Êush
();

497 
	`udñay
(2);

499 
km∫˘æ°a
 = 
	`î32
(
KMRNCTRLSTA
);

500 *
d©a
 = (
u16
)
km∫˘æ°a
;

502 i‡(!
locked
)

503 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

506 
	}
}

518 
s32
 
	$e1000e_ªad_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

520  
	`__e1000_ªad_km∫_ªg
(
hw
, 
off£t
, 
d©a
, 
Ál£
);

521 
	}
}

533 
s32
 
	$e1000e_ªad_km∫_ªg_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

535  
	`__e1000_ªad_km∫_ªg
(
hw
, 
off£t
, 
d©a
, 
åue
);

536 
	}
}

549 
s32
 
	$__e1000_wrôe_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
,

550 
boﬁ
 
locked
)

552 
u32
 
km∫˘æ°a
;

554 i‡(!
locked
) {

555 
s32
 
ªt_vÆ
 = 0;

557 i‡(!
hw
->
phy
.
›s
.
acquúe
)

560 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

561 i‡(
ªt_vÆ
)

562  
ªt_vÆ
;

565 
km∫˘æ°a
 = ((
off£t
 << 
E1000_KMRNCTRLSTA_OFFSET_SHIFT
) &

566 
E1000_KMRNCTRLSTA_OFFSET
Ë| 
d©a
;

567 
	`ew32
(
KMRNCTRLSTA
, 
km∫˘æ°a
);

568 
	`e1e_Êush
();

570 
	`udñay
(2);

572 i‡(!
locked
)

573 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

576 
	}
}

587 
s32
 
	$e1000e_wrôe_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

589  
	`__e1000_wrôe_km∫_ªg
(
hw
, 
off£t
, 
d©a
, 
Ál£
);

590 
	}
}

601 
s32
 
	$e1000e_wrôe_km∫_ªg_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

603  
	`__e1000_wrôe_km∫_ªg
(
hw
, 
off£t
, 
d©a
, 
åue
);

604 
	}
}

612 
s32
 
	$e1000_£t_ma°î_¶ave_mode
(
e1000_hw
 *
hw
)

614 
s32
 
ªt_vÆ
;

615 
u16
 
phy_d©a
;

618 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_CTRL1000
, &
phy_d©a
);

619 i‡(
ªt_vÆ
)

620  
ªt_vÆ
;

623 
hw
->
phy
.
‹igöÆ_ms_ty≥
 = (
phy_d©a
 & 
CTL1000_ENABLE_MASTER
) ?

624 ((
phy_d©a
 & 
CTL1000_AS_MASTER
) ?

625 
e1000_ms_f‹˚_ma°î
 : 
e1000_ms_f‹˚_¶ave
Ë: 
e1000_ms_auto
;

627 
hw
->
phy
.
ms_ty≥
) {

628 
e1000_ms_f‹˚_ma°î
:

629 
phy_d©a
 |(
CTL1000_ENABLE_MASTER
 | 
CTL1000_AS_MASTER
);

631 
e1000_ms_f‹˚_¶ave
:

632 
phy_d©a
 |
CTL1000_ENABLE_MASTER
;

633 
phy_d©a
 &~(
CTL1000_AS_MASTER
);

635 
e1000_ms_auto
:

636 
phy_d©a
 &~
CTL1000_ENABLE_MASTER
;

642  
	`e1e_wphy
(
hw
, 
MII_CTRL1000
, 
phy_d©a
);

643 
	}
}

651 
s32
 
	$e1000_c›≥r_lök_£tup_82577
(
e1000_hw
 *
hw
)

653 
s32
 
ªt_vÆ
;

654 
u16
 
phy_d©a
;

657 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82577_CFG_REG
, &
phy_d©a
);

658 i‡(
ªt_vÆ
)

659  
ªt_vÆ
;

661 
phy_d©a
 |
I82577_CFG_ASSERT_CRS_ON_TX
;

664 
phy_d©a
 |
I82577_CFG_ENABLE_DOWNSHIFT
;

666 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
I82577_CFG_REG
, 
phy_d©a
);

667 i‡(
ªt_vÆ
)

668  
ªt_vÆ
;

671 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82577_PHY_CTRL_2
, &
phy_d©a
);

672 i‡(
ªt_vÆ
)

673  
ªt_vÆ
;

674 
phy_d©a
 &~
I82577_PHY_CTRL2_MDIX_CFG_MASK
;

680 
hw
->
phy
.
mdix
) {

684 
phy_d©a
 |
I82577_PHY_CTRL2_MANUAL_MDIX
;

688 
phy_d©a
 |
I82577_PHY_CTRL2_AUTO_MDI_MDIX
;

691 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
I82577_PHY_CTRL_2
, 
phy_d©a
);

692 i‡(
ªt_vÆ
)

693  
ªt_vÆ
;

695  
	`e1000_£t_ma°î_¶ave_mode
(
hw
);

696 
	}
}

705 
s32
 
	$e1000e_c›≥r_lök_£tup_m88
(
e1000_hw
 *
hw
)

707 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

708 
s32
 
ªt_vÆ
;

709 
u16
 
phy_d©a
;

712 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

713 i‡(
ªt_vÆ
)

714  
ªt_vÆ
;

717 i‡(
phy
->
ty≥
 !
e1000_phy_bm
)

718 
phy_d©a
 |
M88E1000_PSCR_ASSERT_CRS_ON_TX
;

727 
phy_d©a
 &~
M88E1000_PSCR_AUTO_X_MODE
;

729 
phy
->
mdix
) {

731 
phy_d©a
 |
M88E1000_PSCR_MDI_MANUAL_MODE
;

734 
phy_d©a
 |
M88E1000_PSCR_MDIX_MANUAL_MODE
;

737 
phy_d©a
 |
M88E1000_PSCR_AUTO_X_1000T
;

741 
phy_d©a
 |
M88E1000_PSCR_AUTO_X_MODE
;

751 
phy_d©a
 &~
M88E1000_PSCR_POLARITY_REVERSAL
;

752 i‡(
phy
->
dißbÀ_pﬁ¨ôy_c‹ª˘i⁄
)

753 
phy_d©a
 |
M88E1000_PSCR_POLARITY_REVERSAL
;

756 i‡(
phy
->
ty≥
 =
e1000_phy_bm
) {

758 i‡(
phy
->
id
 =
BME1000_E_PHY_ID_R2
) {

759 
phy_d©a
 &~
BME1000_PSCR_ENABLE_DOWNSHIFT
;

760 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
,

761 
phy_d©a
);

762 i‡(
ªt_vÆ
)

763  
ªt_vÆ
;

765 
ªt_vÆ
 = 
phy
->
›s
.
	`commô
(
hw
);

766 i‡(
ªt_vÆ
) {

767 
	`e_dbg
("Error committingÅhe PHY changes\n");

768  
ªt_vÆ
;

772 
phy_d©a
 |
BME1000_PSCR_ENABLE_DOWNSHIFT
;

775 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, 
phy_d©a
);

776 i‡(
ªt_vÆ
)

777  
ªt_vÆ
;

779 i‡((
phy
->
ty≥
 =
e1000_phy_m88
) &&

780 (
phy
->
ªvisi⁄
 < 
E1000_REVISION_4
) &&

781 (
phy
->
id
 !
BME1000_E_PHY_ID_R2
)) {

785 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, &
phy_d©a
);

786 i‡(
ªt_vÆ
)

787  
ªt_vÆ
;

789 
phy_d©a
 |
M88E1000_EPSCR_TX_CLK_25
;

791 i‡((
phy
->
ªvisi⁄
 =2Ë&& (phy->
id
 =
M88E1111_I_PHY_ID
)) {

793 
phy_d©a
 &~
M88EC018_EPSCR_DOWNSHIFT_COUNTER_MASK
;

794 
phy_d©a
 |
M88EC018_EPSCR_DOWNSHIFT_COUNTER_5X
;

797 
phy_d©a
 &~(
M88E1000_EPSCR_MASTER_DOWNSHIFT_MASK
 |

798 
M88E1000_EPSCR_SLAVE_DOWNSHIFT_MASK
);

799 
phy_d©a
 |(
M88E1000_EPSCR_MASTER_DOWNSHIFT_1X
 |

800 
M88E1000_EPSCR_SLAVE_DOWNSHIFT_1X
);

802 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, 
phy_d©a
);

803 i‡(
ªt_vÆ
)

804  
ªt_vÆ
;

807 i‡((
phy
->
ty≥
 =
e1000_phy_bm
Ë&& (phy->
id
 =
BME1000_E_PHY_ID_R2
)) {

809 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 29, 0x0003);

810 i‡(
ªt_vÆ
)

811  
ªt_vÆ
;

814 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 30, 0x0000);

815 i‡(
ªt_vÆ
)

816  
ªt_vÆ
;

820 i‡(
phy
->
›s
.
commô
) {

821 
ªt_vÆ
 = 
phy
->
›s
.
	`commô
(
hw
);

822 i‡(
ªt_vÆ
) {

823 
	`e_dbg
("Error committingÅhe PHY changes\n");

824  
ªt_vÆ
;

828 i‡(
phy
->
ty≥
 =
e1000_phy_82578
) {

829 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, &
phy_d©a
);

830 i‡(
ªt_vÆ
)

831  
ªt_vÆ
;

834 
phy_d©a
 |
I82578_EPSCR_DOWNSHIFT_ENABLE
;

835 
phy_d©a
 &~
I82578_EPSCR_DOWNSHIFT_COUNTER_MASK
;

836 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, 
phy_d©a
);

837 i‡(
ªt_vÆ
)

838  
ªt_vÆ
;

842 
	}
}

851 
s32
 
	$e1000e_c›≥r_lök_£tup_igp
(
e1000_hw
 *
hw
)

853 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

854 
s32
 
ªt_vÆ
;

855 
u16
 
d©a
;

857 
ªt_vÆ
 = 
	`e1000_phy_hw_ª£t
(
hw
);

858 i‡(
ªt_vÆ
) {

859 
	`e_dbg
("ErrorÑesettingÅhe PHY.\n");

860  
ªt_vÆ
;

866 
	`m¶ìp
(100);

869 i‡(
hw
->
phy
.
›s
.
£t_d0_Õlu_°©e
) {

870 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`£t_d0_Õlu_°©e
(hw, 
Ál£
);

871 i‡(
ªt_vÆ
) {

872 
	`e_dbg
("Error Disabling LPLU D0\n");

873  
ªt_vÆ
;

877 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CTRL
, &
d©a
);

878 i‡(
ªt_vÆ
)

879  
ªt_vÆ
;

881 
d©a
 &~
IGP01E1000_PSCR_AUTO_MDIX
;

883 
phy
->
mdix
) {

885 
d©a
 &~
IGP01E1000_PSCR_FORCE_MDI_MDIX
;

888 
d©a
 |
IGP01E1000_PSCR_FORCE_MDI_MDIX
;

892 
d©a
 |
IGP01E1000_PSCR_AUTO_MDIX
;

895 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CTRL
, 
d©a
);

896 i‡(
ªt_vÆ
)

897  
ªt_vÆ
;

900 i‡(
hw
->
mac
.
aut⁄eg
) {

905 i‡(
phy
->
aut⁄eg_advîti£d
 =
ADVERTISE_1000_FULL
) {

907 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

908 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

909 i‡(
ªt_vÆ
)

910  
ªt_vÆ
;

912 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

913 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

914 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

915 i‡(
ªt_vÆ
)

916  
ªt_vÆ
;

919 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_CTRL1000
, &
d©a
);

920 i‡(
ªt_vÆ
)

921  
ªt_vÆ
;

923 
d©a
 &~
CTL1000_ENABLE_MASTER
;

924 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_CTRL1000
, 
d©a
);

925 i‡(
ªt_vÆ
)

926  
ªt_vÆ
;

929 
ªt_vÆ
 = 
	`e1000_£t_ma°î_¶ave_mode
(
hw
);

932  
ªt_vÆ
;

933 
	}
}

944 
s32
 
	$e1000_phy_£tup_aut⁄eg
(
e1000_hw
 *
hw
)

946 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

947 
s32
 
ªt_vÆ
;

948 
u16
 
mii_aut⁄eg_adv_ªg
;

949 
u16
 
mii_1000t_˘æ_ªg
 = 0;

951 
phy
->
aut⁄eg_advîti£d
 &phy->
aut⁄eg_mask
;

954 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_ADVERTISE
, &
mii_aut⁄eg_adv_ªg
);

955 i‡(
ªt_vÆ
)

956  
ªt_vÆ
;

958 i‡(
phy
->
aut⁄eg_mask
 & 
ADVERTISE_1000_FULL
) {

960 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_CTRL1000
, &
mii_1000t_˘æ_ªg
);

961 i‡(
ªt_vÆ
)

962  
ªt_vÆ
;

976 
mii_aut⁄eg_adv_ªg
 &~(
ADVERTISE_100FULL
 |

977 
ADVERTISE_100HALF
 |

978 
ADVERTISE_10FULL
 | 
ADVERTISE_10HALF
);

979 
mii_1000t_˘æ_ªg
 &~(
ADVERTISE_1000HALF
 | 
ADVERTISE_1000FULL
);

981 
	`e_dbg
("aut⁄eg_advîti£d %x\n", 
phy
->
aut⁄eg_advîti£d
);

984 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_10_HALF
) {

985 
	`e_dbg
("Advertise 10mb Half duplex\n");

986 
mii_aut⁄eg_adv_ªg
 |
ADVERTISE_10HALF
;

990 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_10_FULL
) {

991 
	`e_dbg
("Advertise 10mb Full duplex\n");

992 
mii_aut⁄eg_adv_ªg
 |
ADVERTISE_10FULL
;

996 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_100_HALF
) {

997 
	`e_dbg
("Advertise 100mb Half duplex\n");

998 
mii_aut⁄eg_adv_ªg
 |
ADVERTISE_100HALF
;

1002 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_100_FULL
) {

1003 
	`e_dbg
("Advertise 100mb Full duplex\n");

1004 
mii_aut⁄eg_adv_ªg
 |
ADVERTISE_100FULL
;

1008 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_1000_HALF
)

1009 
	`e_dbg
("Advertise 1000mb Half duplexÑequest denied!\n");

1012 i‡(
phy
->
aut⁄eg_advîti£d
 & 
ADVERTISE_1000_FULL
) {

1013 
	`e_dbg
("Advertise 1000mb Full duplex\n");

1014 
mii_1000t_˘æ_ªg
 |
ADVERTISE_1000FULL
;

1034 
hw
->
fc
.
cuºít_mode
) {

1035 
e1000_fc_n⁄e
:

1039 
mii_aut⁄eg_adv_ªg
 &=

1040 ~(
ADVERTISE_PAUSE_ASYM
 | 
ADVERTISE_PAUSE_CAP
);

1042 
e1000_fc_rx_∑u£
:

1052 
mii_aut⁄eg_adv_ªg
 |=

1053 (
ADVERTISE_PAUSE_ASYM
 | 
ADVERTISE_PAUSE_CAP
);

1055 
e1000_fc_tx_∑u£
:

1059 
mii_aut⁄eg_adv_ªg
 |
ADVERTISE_PAUSE_ASYM
;

1060 
mii_aut⁄eg_adv_ªg
 &~
ADVERTISE_PAUSE_CAP
;

1062 
e1000_fc_fuŒ
:

1066 
mii_aut⁄eg_adv_ªg
 |=

1067 (
ADVERTISE_PAUSE_ASYM
 | 
ADVERTISE_PAUSE_CAP
);

1070 
	`e_dbg
("Flow controlÖaram set incorrectly\n");

1071  -
E1000_ERR_CONFIG
;

1074 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_ADVERTISE
, 
mii_aut⁄eg_adv_ªg
);

1075 i‡(
ªt_vÆ
)

1076  
ªt_vÆ
;

1078 
	`e_dbg
("Auto-Neg Advîtisög %x\n", 
mii_aut⁄eg_adv_ªg
);

1080 i‡(
phy
->
aut⁄eg_mask
 & 
ADVERTISE_1000_FULL
)

1081 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_CTRL1000
, 
mii_1000t_˘æ_ªg
);

1083  
ªt_vÆ
;

1084 
	}
}

1095 
s32
 
	$e1000_c›≥r_lök_aut⁄eg
(
e1000_hw
 *
hw
)

1097 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1098 
s32
 
ªt_vÆ
;

1099 
u16
 
phy_˘æ
;

1104 
phy
->
aut⁄eg_advîti£d
 &phy->
aut⁄eg_mask
;

1109 i‡(!
phy
->
aut⁄eg_advîti£d
)

1110 
phy
->
aut⁄eg_advîti£d
 =Öhy->
aut⁄eg_mask
;

1112 
	`e_dbg
("Reconfiguringáuto-negádvertisementÖarams\n");

1113 
ªt_vÆ
 = 
	`e1000_phy_£tup_aut⁄eg
(
hw
);

1114 i‡(
ªt_vÆ
) {

1115 
	`e_dbg
("Error Setting up Auto-Negotiation\n");

1116  
ªt_vÆ
;

1118 
	`e_dbg
("Restarting Auto-Neg\n");

1123 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_˘æ
);

1124 i‡(
ªt_vÆ
)

1125  
ªt_vÆ
;

1127 
phy_˘æ
 |(
BMCR_ANENABLE
 | 
BMCR_ANRESTART
);

1128 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_˘æ
);

1129 i‡(
ªt_vÆ
)

1130  
ªt_vÆ
;

1135 i‡(
phy
->
aut⁄eg_waô_to_com∂ëe
) {

1136 
ªt_vÆ
 = 
	`e1000_waô_aut⁄eg
(
hw
);

1137 i‡(
ªt_vÆ
) {

1138 
	`e_dbg
("Error while waiting foráutonegÅo complete\n");

1139  
ªt_vÆ
;

1143 
hw
->
mac
.
gë_lök_°©us
 = 
åue
;

1145  
ªt_vÆ
;

1146 
	}
}

1157 
s32
 
	$e1000e_£tup_c›≥r_lök
(
e1000_hw
 *
hw
)

1159 
s32
 
ªt_vÆ
;

1160 
boﬁ
 
lök
;

1162 i‡(
hw
->
mac
.
aut⁄eg
) {

1166 
ªt_vÆ
 = 
	`e1000_c›≥r_lök_aut⁄eg
(
hw
);

1167 i‡(
ªt_vÆ
)

1168  
ªt_vÆ
;

1173 
	`e_dbg
("Forcing Speedánd Duplex\n");

1174 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`f‹˚_•ìd_du∂ex
(hw);

1175 i‡(
ªt_vÆ
) {

1176 
	`e_dbg
("Error Forcing Speedánd Duplex\n");

1177  
ªt_vÆ
;

1184 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
COPPER_LINK_UP_LIMIT
, 10,

1185 &
lök
);

1186 i‡(
ªt_vÆ
)

1187  
ªt_vÆ
;

1189 i‡(
lök
) {

1190 
	`e_dbg
("ValidÜinkÉstablished!!!\n");

1191 
hw
->
mac
.
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(hw);

1192 
ªt_vÆ
 = 
	`e1000e_c⁄fig_fc_a·î_lök_up
(
hw
);

1194 
	`e_dbg
("UnableÅoÉstablishÜink!!!\n");

1197  
ªt_vÆ
;

1198 
	}
}

1208 
s32
 
	$e1000e_phy_f‹˚_•ìd_du∂ex_igp
(
e1000_hw
 *
hw
)

1210 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1211 
s32
 
ªt_vÆ
;

1212 
u16
 
phy_d©a
;

1213 
boﬁ
 
lök
;

1215 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_d©a
);

1216 i‡(
ªt_vÆ
)

1217  
ªt_vÆ
;

1219 
	`e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
hw
, &
phy_d©a
);

1221 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_d©a
);

1222 i‡(
ªt_vÆ
)

1223  
ªt_vÆ
;

1228 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CTRL
, &
phy_d©a
);

1229 i‡(
ªt_vÆ
)

1230  
ªt_vÆ
;

1232 
phy_d©a
 &~
IGP01E1000_PSCR_AUTO_MDIX
;

1233 
phy_d©a
 &~
IGP01E1000_PSCR_FORCE_MDI_MDIX
;

1235 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CTRL
, 
phy_d©a
);

1236 i‡(
ªt_vÆ
)

1237  
ªt_vÆ
;

1239 
	`e_dbg
("IGP PSCR: %X\n", 
phy_d©a
);

1241 
	`udñay
(1);

1243 i‡(
phy
->
aut⁄eg_waô_to_com∂ëe
) {

1244 
	`e_dbg
("Waiting for forced speed/duplexÜink on IGPÖhy.\n");

1246 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1247 100000, &
lök
);

1248 i‡(
ªt_vÆ
)

1249  
ªt_vÆ
;

1251 i‡(!
lök
)

1252 
	`e_dbg
("LinkÅakingÜongerÅhanÉxpected.\n");

1255 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1256 100000, &
lök
);

1259  
ªt_vÆ
;

1260 
	}
}

1272 
s32
 
	$e1000e_phy_f‹˚_•ìd_du∂ex_m88
(
e1000_hw
 *
hw
)

1274 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1275 
s32
 
ªt_vÆ
;

1276 
u16
 
phy_d©a
;

1277 
boﬁ
 
lök
;

1282 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

1283 i‡(
ªt_vÆ
)

1284  
ªt_vÆ
;

1286 
phy_d©a
 &~
M88E1000_PSCR_AUTO_X_MODE
;

1287 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, 
phy_d©a
);

1288 i‡(
ªt_vÆ
)

1289  
ªt_vÆ
;

1291 
	`e_dbg
("M88E1000 PSCR: %X\n", 
phy_d©a
);

1293 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_d©a
);

1294 i‡(
ªt_vÆ
)

1295  
ªt_vÆ
;

1297 
	`e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
hw
, &
phy_d©a
);

1299 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_d©a
);

1300 i‡(
ªt_vÆ
)

1301  
ªt_vÆ
;

1304 i‡(
hw
->
phy
.
›s
.
commô
) {

1305 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`commô
(hw);

1306 i‡(
ªt_vÆ
)

1307  
ªt_vÆ
;

1310 i‡(
phy
->
aut⁄eg_waô_to_com∂ëe
) {

1311 
	`e_dbg
("Waiting for forced speed/duplexÜink on M88Öhy.\n");

1313 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1314 100000, &
lök
);

1315 i‡(
ªt_vÆ
)

1316  
ªt_vÆ
;

1318 i‡(!
lök
) {

1319 i‡(
hw
->
phy
.
ty≥
 !
e1000_phy_m88
) {

1320 
	`e_dbg
("LinkÅakingÜongerÅhanÉxpected.\n");

1325 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

1326 
M88E1000_PHY_PAGE_SELECT
,

1328 i‡(
ªt_vÆ
)

1329  
ªt_vÆ
;

1330 
ªt_vÆ
 = 
	`e1000e_phy_ª£t_d•
(
hw
);

1331 i‡(
ªt_vÆ
)

1332  
ªt_vÆ
;

1337 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1338 100000, &
lök
);

1339 i‡(
ªt_vÆ
)

1340  
ªt_vÆ
;

1343 i‡(
hw
->
phy
.
ty≥
 !
e1000_phy_m88
)

1346 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, &
phy_d©a
);

1347 i‡(
ªt_vÆ
)

1348  
ªt_vÆ
;

1354 
phy_d©a
 |
M88E1000_EPSCR_TX_CLK_25
;

1355 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_EXT_PHY_SPEC_CTRL
, 
phy_d©a
);

1356 i‡(
ªt_vÆ
)

1357  
ªt_vÆ
;

1362 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

1363 i‡(
ªt_vÆ
)

1364  
ªt_vÆ
;

1366 
phy_d©a
 |
M88E1000_PSCR_ASSERT_CRS_ON_TX
;

1367 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, 
phy_d©a
);

1369  
ªt_vÆ
;

1370 
	}
}

1380 
s32
 
	$e1000_phy_f‹˚_•ìd_du∂ex_i„
(
e1000_hw
 *
hw
)

1382 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1383 
s32
 
ªt_vÆ
;

1384 
u16
 
d©a
;

1385 
boﬁ
 
lök
;

1387 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
d©a
);

1388 i‡(
ªt_vÆ
)

1389  
ªt_vÆ
;

1391 
	`e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
hw
, &
d©a
);

1393 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
d©a
);

1394 i‡(
ªt_vÆ
)

1395  
ªt_vÆ
;

1398 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IFE_PHY_MDIX_CONTROL
, &
d©a
);

1399 i‡(
ªt_vÆ
)

1400  
ªt_vÆ
;

1402 
d©a
 &~
IFE_PMC_AUTO_MDIX
;

1403 
d©a
 &~
IFE_PMC_FORCE_MDIX
;

1405 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IFE_PHY_MDIX_CONTROL
, 
d©a
);

1406 i‡(
ªt_vÆ
)

1407  
ªt_vÆ
;

1409 
	`e_dbg
("IFE PMC: %X\n", 
d©a
);

1411 
	`udñay
(1);

1413 i‡(
phy
->
aut⁄eg_waô_to_com∂ëe
) {

1414 
	`e_dbg
("Waiting for forced speed/duplexÜink on IFEÖhy.\n");

1416 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1417 100000, &
lök
);

1418 i‡(
ªt_vÆ
)

1419  
ªt_vÆ
;

1421 i‡(!
lök
)

1422 
	`e_dbg
("LinkÅakingÜongerÅhanÉxpected.\n");

1425 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

1426 100000, &
lök
);

1427 i‡(
ªt_vÆ
)

1428  
ªt_vÆ
;

1432 
	}
}

1446 
	$e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
e1000_hw
 *
hw
, 
u16
 *
phy_˘æ
)

1448 
e1000_mac_öfo
 *
mac
 = &
hw
->mac;

1449 
u32
 
˘æ
;

1452 
hw
->
fc
.
cuºít_mode
 = 
e1000_fc_n⁄e
;

1455 
˘æ
 = 
	`î32
(
CTRL
);

1456 
˘æ
 |(
E1000_CTRL_FRCSPD
 | 
E1000_CTRL_FRCDPX
);

1457 
˘æ
 &~
E1000_CTRL_SPD_SEL
;

1460 
˘æ
 &~
E1000_CTRL_ASDE
;

1463 *
phy_˘æ
 &~
BMCR_ANENABLE
;

1466 i‡(
mac
->
f‹˚d_•ìd_du∂ex
 & 
E1000_ALL_HALF_DUPLEX
) {

1467 
˘æ
 &~
E1000_CTRL_FD
;

1468 *
phy_˘æ
 &~
BMCR_FULLDPLX
;

1469 
	`e_dbg
("Half Duplex\n");

1471 
˘æ
 |
E1000_CTRL_FD
;

1472 *
phy_˘æ
 |
BMCR_FULLDPLX
;

1473 
	`e_dbg
("Full Duplex\n");

1477 i‡(
mac
->
f‹˚d_•ìd_du∂ex
 & 
E1000_ALL_100_SPEED
) {

1478 
˘æ
 |
E1000_CTRL_SPD_100
;

1479 *
phy_˘æ
 |
BMCR_SPEED100
;

1480 *
phy_˘æ
 &~
BMCR_SPEED1000
;

1481 
	`e_dbg
("Forcing 100mb\n");

1483 
˘æ
 &~(
E1000_CTRL_SPD_1000
 | 
E1000_CTRL_SPD_100
);

1484 *
phy_˘æ
 &~(
BMCR_SPEED1000
 | 
BMCR_SPEED100
);

1485 
	`e_dbg
("Forcing 10mb\n");

1488 
hw
->
mac
.
›s
.
	`c⁄fig_cﬁlisi⁄_di°
(hw);

1490 
	`ew32
(
CTRL
, 
˘æ
);

1491 
	}
}

1507 
s32
 
	$e1000e_£t_d3_Õlu_°©e
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
)

1509 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1510 
s32
 
ªt_vÆ
;

1511 
u16
 
d©a
;

1513 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, &
d©a
);

1514 i‡(
ªt_vÆ
)

1515  
ªt_vÆ
;

1517 i‡(!
a˘ive
) {

1518 
d©a
 &~
IGP02E1000_PM_D3_LPLU
;

1519 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, 
d©a
);

1520 i‡(
ªt_vÆ
)

1521  
ªt_vÆ
;

1527 i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_⁄
) {

1528 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

1529 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

1530 i‡(
ªt_vÆ
)

1531  
ªt_vÆ
;

1533 
d©a
 |
IGP01E1000_PSCFR_SMART_SPEED
;

1534 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

1535 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

1536 i‡(
ªt_vÆ
)

1537  
ªt_vÆ
;

1538 } i‡(
phy
->
sm¨t_•ìd
 =
e1000_sm¨t_•ìd_off
) {

1539 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
,

1540 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

1541 i‡(
ªt_vÆ
)

1542  
ªt_vÆ
;

1544 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

1545 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
,

1546 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

1547 i‡(
ªt_vÆ
)

1548  
ªt_vÆ
;

1550 } i‡((
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_SPEED_DUPLEX
) ||

1551 (
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_NOT_GIG
) ||

1552 (
phy
->
aut⁄eg_advîti£d
 =
E1000_ALL_10_SPEED
)) {

1553 
d©a
 |
IGP02E1000_PM_D3_LPLU
;

1554 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP02E1000_PHY_POWER_MGMT
, 
d©a
);

1555 i‡(
ªt_vÆ
)

1556  
ªt_vÆ
;

1559 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, &
d©a
);

1560 i‡(
ªt_vÆ
)

1561  
ªt_vÆ
;

1563 
d©a
 &~
IGP01E1000_PSCFR_SMART_SPEED
;

1564 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
IGP01E1000_PHY_PORT_CONFIG
, 
d©a
);

1567  
ªt_vÆ
;

1568 
	}
}

1578 
s32
 
	$e1000e_check_downshi·
(
e1000_hw
 *
hw
)

1580 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1581 
s32
 
ªt_vÆ
;

1582 
u16
 
phy_d©a
, 
off£t
, 
mask
;

1584 
phy
->
ty≥
) {

1585 
e1000_phy_m88
:

1586 
e1000_phy_gg82563
:

1587 
e1000_phy_bm
:

1588 
e1000_phy_82578
:

1589 
off£t
 = 
M88E1000_PHY_SPEC_STATUS
;

1590 
mask
 = 
M88E1000_PSSR_DOWNSHIFT
;

1592 
e1000_phy_igp_2
:

1593 
e1000_phy_igp_3
:

1594 
off£t
 = 
IGP01E1000_PHY_LINK_HEALTH
;

1595 
mask
 = 
IGP01E1000_PLHR_SS_DOWNGRADE
;

1599 
phy
->
•ìd_downgøded
 = 
Ál£
;

1603 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
off£t
, &
phy_d©a
);

1605 i‡(!
ªt_vÆ
)

1606 
phy
->
•ìd_downgøded
 = !!(
phy_d©a
 & 
mask
);

1608  
ªt_vÆ
;

1609 
	}
}

1619 
s32
 
	$e1000_check_pﬁ¨ôy_m88
(
e1000_hw
 *
hw
)

1621 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1622 
s32
 
ªt_vÆ
;

1623 
u16
 
d©a
;

1625 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_STATUS
, &
d©a
);

1627 i‡(!
ªt_vÆ
)

1628 
phy
->
ˇbÀ_pﬁ¨ôy
 = ((
d©a
 & 
M88E1000_PSSR_REV_POLARITY
)

1629 ? 
e1000_ªv_pﬁ¨ôy_ªvî£d


1630 : 
e1000_ªv_pﬁ¨ôy_n‹mÆ
);

1632  
ªt_vÆ
;

1633 
	}
}

1644 
s32
 
	$e1000_check_pﬁ¨ôy_igp
(
e1000_hw
 *
hw
)

1646 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1647 
s32
 
ªt_vÆ
;

1648 
u16
 
d©a
, 
off£t
, 
mask
;

1653 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_STATUS
, &
d©a
);

1654 i‡(
ªt_vÆ
)

1655  
ªt_vÆ
;

1657 i‡((
d©a
 & 
IGP01E1000_PSSR_SPEED_MASK
) ==

1658 
IGP01E1000_PSSR_SPEED_1000MBPS
) {

1659 
off£t
 = 
IGP01E1000_PHY_PCS_INIT_REG
;

1660 
mask
 = 
IGP01E1000_PHY_POLARITY_MASK
;

1665 
off£t
 = 
IGP01E1000_PHY_PORT_STATUS
;

1666 
mask
 = 
IGP01E1000_PSSR_POLARITY_REVERSED
;

1669 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
off£t
, &
d©a
);

1671 i‡(!
ªt_vÆ
)

1672 
phy
->
ˇbÀ_pﬁ¨ôy
 = ((
d©a
 & 
mask
)

1673 ? 
e1000_ªv_pﬁ¨ôy_ªvî£d


1674 : 
e1000_ªv_pﬁ¨ôy_n‹mÆ
);

1676  
ªt_vÆ
;

1677 
	}
}

1685 
s32
 
	$e1000_check_pﬁ¨ôy_i„
(
e1000_hw
 *
hw
)

1687 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1688 
s32
 
ªt_vÆ
;

1689 
u16
 
phy_d©a
, 
off£t
, 
mask
;

1693 i‡(
phy
->
pﬁ¨ôy_c‹ª˘i⁄
) {

1694 
off£t
 = 
IFE_PHY_EXTENDED_STATUS_CONTROL
;

1695 
mask
 = 
IFE_PESC_POLARITY_REVERSED
;

1697 
off£t
 = 
IFE_PHY_SPECIAL_CONTROL
;

1698 
mask
 = 
IFE_PSC_FORCE_POLARITY
;

1701 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
off£t
, &
phy_d©a
);

1703 i‡(!
ªt_vÆ
)

1704 
phy
->
ˇbÀ_pﬁ¨ôy
 = ((
phy_d©a
 & 
mask
)

1705 ? 
e1000_ªv_pﬁ¨ôy_ªvî£d


1706 : 
e1000_ªv_pﬁ¨ôy_n‹mÆ
);

1708  
ªt_vÆ
;

1709 
	}
}

1718 
s32
 
	$e1000_waô_aut⁄eg
(
e1000_hw
 *
hw
)

1720 
s32
 
ªt_vÆ
 = 0;

1721 
u16
 
i
, 
phy_°©us
;

1724 
i
 = 
PHY_AUTO_NEG_LIMIT
; i > 0; i--) {

1725 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy_°©us
);

1726 i‡(
ªt_vÆ
)

1728 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy_°©us
);

1729 i‡(
ªt_vÆ
)

1731 i‡(
phy_°©us
 & 
BMSR_ANEGCOMPLETE
)

1733 
	`m¶ìp
(100);

1739  
ªt_vÆ
;

1740 
	}
}

1751 
s32
 
	$e1000e_phy_has_lök_gíîic
(
e1000_hw
 *
hw
, 
u32
 
ôî©i⁄s
,

1752 
u32
 
u£c_öãrvÆ
, 
boﬁ
 *
suc˚ss
)

1754 
s32
 
ªt_vÆ
 = 0;

1755 
u16
 
i
, 
phy_°©us
;

1757 
i
 = 0; i < 
ôî©i⁄s
; i++) {

1762 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy_°©us
);

1763 i‡(
ªt_vÆ
)

1768 
	`udñay
(
u£c_öãrvÆ
);

1769 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMSR
, &
phy_°©us
);

1770 i‡(
ªt_vÆ
)

1772 i‡(
phy_°©us
 & 
BMSR_LSTATUS
)

1774 i‡(
u£c_öãrvÆ
 >= 1000)

1775 
	`mdñay
(
u£c_öãrvÆ
 / 1000);

1777 
	`udñay
(
u£c_öãrvÆ
);

1780 *
suc˚ss
 = (
i
 < 
ôî©i⁄s
);

1782  
ªt_vÆ
;

1783 
	}
}

1800 
s32
 
	$e1000e_gë_ˇbÀ_Àngth_m88
(
e1000_hw
 *
hw
)

1802 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1803 
s32
 
ªt_vÆ
;

1804 
u16
 
phy_d©a
, 
ödex
;

1806 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_STATUS
, &
phy_d©a
);

1807 i‡(
ªt_vÆ
)

1808  
ªt_vÆ
;

1810 
ödex
 = ((
phy_d©a
 & 
M88E1000_PSSR_CABLE_LENGTH
) >>

1811 
M88E1000_PSSR_CABLE_LENGTH_SHIFT
);

1813 i‡(
ödex
 >
M88E1000_CABLE_LENGTH_TABLE_SIZE
 - 1)

1814  -
E1000_ERR_PHY
;

1816 
phy
->
mö_ˇbÀ_Àngth
 = 
e1000_m88_ˇbÀ_Àngth_èbÀ
[
ödex
];

1817 
phy
->
max_ˇbÀ_Àngth
 = 
e1000_m88_ˇbÀ_Àngth_èbÀ
[
ödex
 + 1];

1819 
phy
->
ˇbÀ_Àngth
 = (phy->
mö_ˇbÀ_Àngth
 +Öhy->
max_ˇbÀ_Àngth
) / 2;

1822 
	}
}

1835 
s32
 
	$e1000e_gë_ˇbÀ_Àngth_igp_2
(
e1000_hw
 *
hw
)

1837 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1838 
s32
 
ªt_vÆ
;

1839 
u16
 
phy_d©a
, 
i
, 
agc_vÆue
 = 0;

1840 
u16
 
cur_agc_ödex
, 
max_agc_ödex
 = 0;

1841 
u16
 
mö_agc_ödex
 = 
IGP02E1000_CABLE_LENGTH_TABLE_SIZE
 - 1;

1842 c⁄° 
u16
 
agc_ªg_¨øy
[
IGP02E1000_PHY_CHANNEL_NUM
] = {

1843 
IGP02E1000_PHY_AGC_A
,

1844 
IGP02E1000_PHY_AGC_B
,

1845 
IGP02E1000_PHY_AGC_C
,

1846 
IGP02E1000_PHY_AGC_D


1850 
i
 = 0; i < 
IGP02E1000_PHY_CHANNEL_NUM
; i++) {

1851 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
agc_ªg_¨øy
[
i
], &
phy_d©a
);

1852 i‡(
ªt_vÆ
)

1853  
ªt_vÆ
;

1860 
cur_agc_ödex
 = ((
phy_d©a
 >> 
IGP02E1000_AGC_LENGTH_SHIFT
) &

1861 
IGP02E1000_AGC_LENGTH_MASK
);

1864 i‡((
cur_agc_ödex
 >
IGP02E1000_CABLE_LENGTH_TABLE_SIZE
) ||

1865 (
cur_agc_ödex
 == 0))

1866  -
E1000_ERR_PHY
;

1869 i‡(
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
mö_agc_ödex
] >

1870 
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
cur_agc_ödex
])

1871 
mö_agc_ödex
 = 
cur_agc_ödex
;

1872 i‡(
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
max_agc_ödex
] <

1873 
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
cur_agc_ödex
])

1874 
max_agc_ödex
 = 
cur_agc_ödex
;

1876 
agc_vÆue
 +
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
cur_agc_ödex
];

1879 
agc_vÆue
 -(
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
mö_agc_ödex
] +

1880 
e1000_igp_2_ˇbÀ_Àngth_èbÀ
[
max_agc_ödex
]);

1881 
agc_vÆue
 /(
IGP02E1000_PHY_CHANNEL_NUM
 - 2);

1884 
phy
->
mö_ˇbÀ_Àngth
 = (((
agc_vÆue
 - 
IGP02E1000_AGC_RANGE
) > 0) ?

1885 (
agc_vÆue
 - 
IGP02E1000_AGC_RANGE
) : 0);

1886 
phy
->
max_ˇbÀ_Àngth
 = 
agc_vÆue
 + 
IGP02E1000_AGC_RANGE
;

1888 
phy
->
ˇbÀ_Àngth
 = (phy->
mö_ˇbÀ_Àngth
 +Öhy->
max_ˇbÀ_Àngth
) / 2;

1891 
	}
}

1903 
s32
 
	$e1000e_gë_phy_öfo_m88
(
e1000_hw
 *
hw
)

1905 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1906 
s32
 
ªt_vÆ
;

1907 
u16
 
phy_d©a
;

1908 
boﬁ
 
lök
;

1910 i‡(
phy
->
medü_ty≥
 !
e1000_medü_ty≥_c›≥r
) {

1911 
	`e_dbg
("Phy info is only valid for copper media\n");

1912  -
E1000_ERR_CONFIG
;

1915 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

1916 i‡(
ªt_vÆ
)

1917  
ªt_vÆ
;

1919 i‡(!
lök
) {

1920 
	`e_dbg
("Phy info is only valid ifÜink is up\n");

1921  -
E1000_ERR_CONFIG
;

1924 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_CTRL
, &
phy_d©a
);

1925 i‡(
ªt_vÆ
)

1926  
ªt_vÆ
;

1928 
phy
->
pﬁ¨ôy_c‹ª˘i⁄
 = !!(
phy_d©a
 &

1929 
M88E1000_PSCR_POLARITY_REVERSAL
);

1931 
ªt_vÆ
 = 
	`e1000_check_pﬁ¨ôy_m88
(
hw
);

1932 i‡(
ªt_vÆ
)

1933  
ªt_vÆ
;

1935 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
M88E1000_PHY_SPEC_STATUS
, &
phy_d©a
);

1936 i‡(
ªt_vÆ
)

1937  
ªt_vÆ
;

1939 
phy
->
is_mdix
 = !!(
phy_d©a
 & 
M88E1000_PSSR_MDIX
);

1941 i‡((
phy_d©a
 & 
M88E1000_PSSR_SPEED
Ë=
M88E1000_PSSR_1000MBS
) {

1942 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`gë_ˇbÀ_Àngth
(hw);

1943 i‡(
ªt_vÆ
)

1944  
ªt_vÆ
;

1946 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
phy_d©a
);

1947 i‡(
ªt_vÆ
)

1948  
ªt_vÆ
;

1950 
phy
->
loˇl_rx
 = (
phy_d©a
 & 
LPA_1000LOCALRXOK
)

1951 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

1953 
phy
->
ªmŸe_rx
 = (
phy_d©a
 & 
LPA_1000REMRXOK
)

1954 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

1957 
phy
->
ˇbÀ_Àngth
 = 
E1000_CABLE_LENGTH_UNDEFINED
;

1958 
phy
->
loˇl_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

1959 
phy
->
ªmŸe_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

1962  
ªt_vÆ
;

1963 
	}
}

1974 
s32
 
	$e1000e_gë_phy_öfo_igp
(
e1000_hw
 *
hw
)

1976 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

1977 
s32
 
ªt_vÆ
;

1978 
u16
 
d©a
;

1979 
boﬁ
 
lök
;

1981 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

1982 i‡(
ªt_vÆ
)

1983  
ªt_vÆ
;

1985 i‡(!
lök
) {

1986 
	`e_dbg
("Phy info is only valid ifÜink is up\n");

1987  -
E1000_ERR_CONFIG
;

1990 
phy
->
pﬁ¨ôy_c‹ª˘i⁄
 = 
åue
;

1992 
ªt_vÆ
 = 
	`e1000_check_pﬁ¨ôy_igp
(
hw
);

1993 i‡(
ªt_vÆ
)

1994  
ªt_vÆ
;

1996 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IGP01E1000_PHY_PORT_STATUS
, &
d©a
);

1997 i‡(
ªt_vÆ
)

1998  
ªt_vÆ
;

2000 
phy
->
is_mdix
 = !!(
d©a
 & 
IGP01E1000_PSSR_MDIX
);

2002 i‡((
d©a
 & 
IGP01E1000_PSSR_SPEED_MASK
) ==

2003 
IGP01E1000_PSSR_SPEED_1000MBPS
) {

2004 
ªt_vÆ
 = 
phy
->
›s
.
	`gë_ˇbÀ_Àngth
(
hw
);

2005 i‡(
ªt_vÆ
)

2006  
ªt_vÆ
;

2008 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
d©a
);

2009 i‡(
ªt_vÆ
)

2010  
ªt_vÆ
;

2012 
phy
->
loˇl_rx
 = (
d©a
 & 
LPA_1000LOCALRXOK
)

2013 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

2015 
phy
->
ªmŸe_rx
 = (
d©a
 & 
LPA_1000REMRXOK
)

2016 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

2018 
phy
->
ˇbÀ_Àngth
 = 
E1000_CABLE_LENGTH_UNDEFINED
;

2019 
phy
->
loˇl_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

2020 
phy
->
ªmŸe_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

2023  
ªt_vÆ
;

2024 
	}
}

2032 
s32
 
	$e1000_gë_phy_öfo_i„
(
e1000_hw
 *
hw
)

2034 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

2035 
s32
 
ªt_vÆ
;

2036 
u16
 
d©a
;

2037 
boﬁ
 
lök
;

2039 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

2040 i‡(
ªt_vÆ
)

2041  
ªt_vÆ
;

2043 i‡(!
lök
) {

2044 
	`e_dbg
("Phy info is only valid ifÜink is up\n");

2045  -
E1000_ERR_CONFIG
;

2048 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IFE_PHY_SPECIAL_CONTROL
, &
d©a
);

2049 i‡(
ªt_vÆ
)

2050  
ªt_vÆ
;

2051 
phy
->
pﬁ¨ôy_c‹ª˘i⁄
 = !(
d©a
 & 
IFE_PSC_AUTO_POLARITY_DISABLE
);

2053 i‡(
phy
->
pﬁ¨ôy_c‹ª˘i⁄
) {

2054 
ªt_vÆ
 = 
	`e1000_check_pﬁ¨ôy_i„
(
hw
);

2055 i‡(
ªt_vÆ
)

2056  
ªt_vÆ
;

2059 
phy
->
ˇbÀ_pﬁ¨ôy
 = ((
d©a
 & 
IFE_PSC_FORCE_POLARITY
)

2060 ? 
e1000_ªv_pﬁ¨ôy_ªvî£d


2061 : 
e1000_ªv_pﬁ¨ôy_n‹mÆ
);

2064 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
IFE_PHY_MDIX_CONTROL
, &
d©a
);

2065 i‡(
ªt_vÆ
)

2066  
ªt_vÆ
;

2068 
phy
->
is_mdix
 = !!(
d©a
 & 
IFE_PMC_MDIX_STATUS
);

2071 
phy
->
ˇbÀ_Àngth
 = 
E1000_CABLE_LENGTH_UNDEFINED
;

2072 
phy
->
loˇl_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

2073 
phy
->
ªmŸe_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

2076 
	}
}

2085 
s32
 
	$e1000e_phy_sw_ª£t
(
e1000_hw
 *
hw
)

2087 
s32
 
ªt_vÆ
;

2088 
u16
 
phy_˘æ
;

2090 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_˘æ
);

2091 i‡(
ªt_vÆ
)

2092  
ªt_vÆ
;

2094 
phy_˘æ
 |
BMCR_RESET
;

2095 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_˘æ
);

2096 i‡(
ªt_vÆ
)

2097  
ªt_vÆ
;

2099 
	`udñay
(1);

2101  
ªt_vÆ
;

2102 
	}
}

2113 
s32
 
	$e1000e_phy_hw_ª£t_gíîic
(
e1000_hw
 *
hw
)

2115 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

2116 
s32
 
ªt_vÆ
;

2117 
u32
 
˘æ
;

2119 i‡(
phy
->
›s
.
check_ª£t_block
) {

2120 
ªt_vÆ
 = 
phy
->
›s
.
	`check_ª£t_block
(
hw
);

2121 i‡(
ªt_vÆ
)

2125 
ªt_vÆ
 = 
phy
->
›s
.
	`acquúe
(
hw
);

2126 i‡(
ªt_vÆ
)

2127  
ªt_vÆ
;

2129 
˘æ
 = 
	`î32
(
CTRL
);

2130 
	`ew32
(
CTRL
, 
˘æ
 | 
E1000_CTRL_PHY_RST
);

2131 
	`e1e_Êush
();

2133 
	`udñay
(
phy
->
ª£t_dñay_us
);

2135 
	`ew32
(
CTRL
, 
˘æ
);

2136 
	`e1e_Êush
();

2138 
	`u¶ìp_ønge
(150, 300);

2140 
phy
->
›s
.
	`ªÀa£
(
hw
);

2142  
phy
->
›s
.
	`gë_cfg_d⁄e
(
hw
);

2143 
	}
}

2152 
s32
 
	$e1000e_gë_cfg_d⁄e_gíîic
(
e1000_hw
 
__Æways_unu£d
 *
hw
)

2154 
	`mdñay
(10);

2157 
	}
}

2165 
s32
 
	$e1000e_phy_öô_s¸ùt_igp3
(
e1000_hw
 *
hw
)

2167 
	`e_dbg
("Running IGP 3 PHY init script\n");

2171 
	`e1e_wphy
(
hw
, 0x2F5B, 0x9018);

2173 
	`e1e_wphy
(
hw
, 0x2F52, 0x0000);

2175 
	`e1e_wphy
(
hw
, 0x2FB1, 0x8B24);

2177 
	`e1e_wphy
(
hw
, 0x2FB2, 0xF8F0);

2179 
	`e1e_wphy
(
hw
, 0x2010, 0x10B0);

2181 
	`e1e_wphy
(
hw
, 0x2011, 0x0000);

2183 
	`e1e_wphy
(
hw
, 0x20DD, 0x249A);

2185 
	`e1e_wphy
(
hw
, 0x20DE, 0x00D3);

2187 
	`e1e_wphy
(
hw
, 0x28B4, 0x04CE);

2189 
	`e1e_wphy
(
hw
, 0x2F70, 0x29E4);

2191 
	`e1e_wphy
(
hw
, 0x0000, 0x0140);

2193 
	`e1e_wphy
(
hw
, 0x1F30, 0x1606);

2195 
	`e1e_wphy
(
hw
, 0x1F31, 0xB814);

2197 
	`e1e_wphy
(
hw
, 0x1F35, 0x002A);

2199 
	`e1e_wphy
(
hw
, 0x1F3E, 0x0067);

2201 
	`e1e_wphy
(
hw
, 0x1F54, 0x0065);

2203 
	`e1e_wphy
(
hw
, 0x1F55, 0x002A);

2205 
	`e1e_wphy
(
hw
, 0x1F56, 0x002A);

2207 
	`e1e_wphy
(
hw
, 0x1F72, 0x3FB0);

2209 
	`e1e_wphy
(
hw
, 0x1F76, 0xC0FF);

2211 
	`e1e_wphy
(
hw
, 0x1F77, 0x1DEC);

2213 
	`e1e_wphy
(
hw
, 0x1F78, 0xF9EF);

2215 
	`e1e_wphy
(
hw
, 0x1F79, 0x0210);

2217 
	`e1e_wphy
(
hw
, 0x1895, 0x0003);

2219 
	`e1e_wphy
(
hw
, 0x1796, 0x0008);

2221 
	`e1e_wphy
(
hw
, 0x1798, 0xD008);

2225 
	`e1e_wphy
(
hw
, 0x1898, 0xD918);

2227 
	`e1e_wphy
(
hw
, 0x187A, 0x0800);

2231 
	`e1e_wphy
(
hw
, 0x0019, 0x008D);

2233 
	`e1e_wphy
(
hw
, 0x001B, 0x2080);

2235 
	`e1e_wphy
(
hw
, 0x0014, 0x0045);

2237 
	`e1e_wphy
(
hw
, 0x0000, 0x1340);

2240 
	}
}

2248 
e1000_phy_ty≥
 
	$e1000e_gë_phy_ty≥_‰om_id
(
u32
 
phy_id
)

2250 
e1000_phy_ty≥
 
phy_ty≥
 = 
e1000_phy_unknown
;

2252 
phy_id
) {

2253 
M88E1000_I_PHY_ID
:

2254 
M88E1000_E_PHY_ID
:

2255 
M88E1111_I_PHY_ID
:

2256 
M88E1011_I_PHY_ID
:

2257 
phy_ty≥
 = 
e1000_phy_m88
;

2259 
IGP01E1000_I_PHY_ID
:

2260 
phy_ty≥
 = 
e1000_phy_igp_2
;

2262 
GG82563_E_PHY_ID
:

2263 
phy_ty≥
 = 
e1000_phy_gg82563
;

2265 
IGP03E1000_E_PHY_ID
:

2266 
phy_ty≥
 = 
e1000_phy_igp_3
;

2268 
IFE_E_PHY_ID
:

2269 
IFE_PLUS_E_PHY_ID
:

2270 
IFE_C_E_PHY_ID
:

2271 
phy_ty≥
 = 
e1000_phy_i„
;

2273 
BME1000_E_PHY_ID
:

2274 
BME1000_E_PHY_ID_R2
:

2275 
phy_ty≥
 = 
e1000_phy_bm
;

2277 
I82578_E_PHY_ID
:

2278 
phy_ty≥
 = 
e1000_phy_82578
;

2280 
I82577_E_PHY_ID
:

2281 
phy_ty≥
 = 
e1000_phy_82577
;

2283 
I82579_E_PHY_ID
:

2284 
phy_ty≥
 = 
e1000_phy_82579
;

2286 
I217_E_PHY_ID
:

2287 
phy_ty≥
 = 
e1000_phy_i217
;

2290 
phy_ty≥
 = 
e1000_phy_unknown
;

2293  
phy_ty≥
;

2294 
	}
}

2304 
s32
 
	$e1000e_dëîmöe_phy_addªss
(
e1000_hw
 *
hw
)

2306 
u32
 
phy_addr
 = 0;

2307 
u32
 
i
;

2308 
e1000_phy_ty≥
 
phy_ty≥
 = 
e1000_phy_unknown
;

2310 
hw
->
phy
.
id
 = 
phy_ty≥
;

2312 
phy_addr
 = 0;Öhy_add∏< 
E1000_MAX_PHY_ADDR
;Öhy_addr++) {

2313 
hw
->
phy
.
addr
 = 
phy_addr
;

2314 
i
 = 0;

2317 
	`e1000e_gë_phy_id
(
hw
);

2318 
phy_ty≥
 = 
	`e1000e_gë_phy_ty≥_‰om_id
(
hw
->
phy
.
id
);

2323 i‡(
phy_ty≥
 !
e1000_phy_unknown
)

2326 
	`u¶ìp_ønge
(1000, 2000);

2327 
i
++;

2328 } 
i
 < 10);

2331  -
E1000_ERR_PHY_TYPE
;

2332 
	}
}

2340 
u32
 
	$e1000_gë_phy_addr_f‹_bm_∑ge
(
u32
 
∑ge
, u32 
ªg
)

2342 
u32
 
phy_addr
 = 2;

2344 i‡((
∑ge
 >768Ë|| (∑gê=0 && 
ªg
 == 25) || (reg == 31))

2345 
phy_addr
 = 1;

2347  
phy_addr
;

2348 
	}
}

2359 
s32
 
	$e1000e_wrôe_phy_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

2361 
s32
 
ªt_vÆ
;

2362 
u32
 
∑ge
 = 
off£t
 >> 
IGP_PAGE_SHIFT
;

2364 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2365 i‡(
ªt_vÆ
)

2366  
ªt_vÆ
;

2369 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2370 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, &
d©a
,

2371 
Ál£
, false);

2372 
ªÀa£
;

2375 
hw
->
phy
.
addr
 = 
	`e1000_gë_phy_addr_f‹_bm_∑ge
(
∑ge
, 
off£t
);

2377 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2378 
u32
 
∑ge_shi·
, 
∑ge_£À˘
;

2384 i‡(
hw
->
phy
.
addr
 == 1) {

2385 
∑ge_shi·
 = 
IGP_PAGE_SHIFT
;

2386 
∑ge_£À˘
 = 
IGP01E1000_PHY_PAGE_SELECT
;

2388 
∑ge_shi·
 = 0;

2389 
∑ge_£À˘
 = 
BM_PHY_PAGE_SELECT
;

2393 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
,

2394 (
∑ge
 << 
∑ge_shi·
));

2395 i‡(
ªt_vÆ
)

2396 
ªÀa£
;

2399 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

2400 
d©a
);

2402 
ªÀa£
:

2403 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2404  
ªt_vÆ
;

2405 
	}
}

2417 
s32
 
	$e1000e_ªad_phy_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

2419 
s32
 
ªt_vÆ
;

2420 
u32
 
∑ge
 = 
off£t
 >> 
IGP_PAGE_SHIFT
;

2422 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2423 i‡(
ªt_vÆ
)

2424  
ªt_vÆ
;

2427 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2428 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, 
d©a
,

2429 
åue
, 
Ál£
);

2430 
ªÀa£
;

2433 
hw
->
phy
.
addr
 = 
	`e1000_gë_phy_addr_f‹_bm_∑ge
(
∑ge
, 
off£t
);

2435 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2436 
u32
 
∑ge_shi·
, 
∑ge_£À˘
;

2442 i‡(
hw
->
phy
.
addr
 == 1) {

2443 
∑ge_shi·
 = 
IGP_PAGE_SHIFT
;

2444 
∑ge_£À˘
 = 
IGP01E1000_PHY_PAGE_SELECT
;

2446 
∑ge_shi·
 = 0;

2447 
∑ge_£À˘
 = 
BM_PHY_PAGE_SELECT
;

2451 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
∑ge_£À˘
,

2452 (
∑ge
 << 
∑ge_shi·
));

2453 i‡(
ªt_vÆ
)

2454 
ªÀa£
;

2457 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

2458 
d©a
);

2459 
ªÀa£
:

2460 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2461  
ªt_vÆ
;

2462 
	}
}

2474 
s32
 
	$e1000e_ªad_phy_ªg_bm2
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

2476 
s32
 
ªt_vÆ
;

2477 
u16
 
∑ge
 = (u16)(
off£t
 >> 
IGP_PAGE_SHIFT
);

2479 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2480 i‡(
ªt_vÆ
)

2481  
ªt_vÆ
;

2484 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2485 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, 
d©a
,

2486 
åue
, 
Ál£
);

2487 
ªÀa£
;

2490 
hw
->
phy
.
addr
 = 1;

2492 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2494 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_PHY_PAGE_SELECT
,

2495 
∑ge
);

2497 i‡(
ªt_vÆ
)

2498 
ªÀa£
;

2501 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

2502 
d©a
);

2503 
ªÀa£
:

2504 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2505  
ªt_vÆ
;

2506 
	}
}

2517 
s32
 
	$e1000e_wrôe_phy_ªg_bm2
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

2519 
s32
 
ªt_vÆ
;

2520 
u16
 
∑ge
 = (u16)(
off£t
 >> 
IGP_PAGE_SHIFT
);

2522 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2523 i‡(
ªt_vÆ
)

2524  
ªt_vÆ
;

2527 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2528 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, &
d©a
,

2529 
Ál£
, false);

2530 
ªÀa£
;

2533 
hw
->
phy
.
addr
 = 1;

2535 i‡(
off£t
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2537 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_PHY_PAGE_SELECT
,

2538 
∑ge
);

2540 i‡(
ªt_vÆ
)

2541 
ªÀa£
;

2544 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
off£t
,

2545 
d©a
);

2547 
ªÀa£
:

2548 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2549  
ªt_vÆ
;

2550 
	}
}

2560 
s32
 
	$e1000_íabÀ_phy_wakeup_ªg_ac˚ss_bm
(
e1000_hw
 *
hw
, 
u16
 *
phy_ªg
)

2562 
s32
 
ªt_vÆ
;

2563 
u16
 
ãmp
;

2566 
hw
->
phy
.
addr
 = 1;

2569 
ªt_vÆ
 = 
	`e1000_£t_∑ge_igp
(
hw
, (
BM_PORT_CTRL_PAGE
 << 
IGP_PAGE_SHIFT
));

2570 i‡(
ªt_vÆ
) {

2571 
	`e_dbg
("CouldÇot set Port ControlÖage\n");

2572  
ªt_vÆ
;

2575 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
BM_WUC_ENABLE_REG
, 
phy_ªg
);

2576 i‡(
ªt_vÆ
) {

2577 
	`e_dbg
("CouldÇotÑead PHYÑegister %d.%d\n",

2578 
BM_PORT_CTRL_PAGE
, 
BM_WUC_ENABLE_REG
);

2579  
ªt_vÆ
;

2585 
ãmp
 = *
phy_ªg
;

2586 
ãmp
 |
BM_WUC_ENABLE_BIT
;

2587 
ãmp
 &~(
BM_WUC_ME_WU_BIT
 | 
BM_WUC_HOST_WU_BIT
);

2589 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_WUC_ENABLE_REG
, 
ãmp
);

2590 i‡(
ªt_vÆ
) {

2591 
	`e_dbg
("CouldÇot write PHYÑegister %d.%d\n",

2592 
BM_PORT_CTRL_PAGE
, 
BM_WUC_ENABLE_REG
);

2593  
ªt_vÆ
;

2599  
	`e1000_£t_∑ge_igp
(
hw
, (
BM_WUC_PAGE
 << 
IGP_PAGE_SHIFT
));

2600 
	}
}

2613 
s32
 
	$e1000_dißbÀ_phy_wakeup_ªg_ac˚ss_bm
(
e1000_hw
 *
hw
, 
u16
 *
phy_ªg
)

2615 
s32
 
ªt_vÆ
;

2618 
ªt_vÆ
 = 
	`e1000_£t_∑ge_igp
(
hw
, (
BM_PORT_CTRL_PAGE
 << 
IGP_PAGE_SHIFT
));

2619 i‡(
ªt_vÆ
) {

2620 
	`e_dbg
("CouldÇot set Port ControlÖage\n");

2621  
ªt_vÆ
;

2625 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_WUC_ENABLE_REG
, *
phy_ªg
);

2626 i‡(
ªt_vÆ
)

2627 
	`e_dbg
("CouldÇotÑestore PHYÑegister %d.%d\n",

2628 
BM_PORT_CTRL_PAGE
, 
BM_WUC_ENABLE_REG
);

2630  
ªt_vÆ
;

2631 
	}
}

2658 
s32
 
	$e1000_ac˚ss_phy_wakeup_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

2659 
u16
 *
d©a
, 
boﬁ
 
ªad
, boﬁ 
∑ge_£t
)

2661 
s32
 
ªt_vÆ
;

2662 
u16
 
ªg
 = 
	`BM_PHY_REG_NUM
(
off£t
);

2663 
u16
 
∑ge
 = 
	`BM_PHY_REG_PAGE
(
off£t
);

2664 
u16
 
phy_ªg
 = 0;

2667 i‡((
hw
->
mac
.
ty≥
 =
e1000_pchœn
) &&

2668 (!(
	`î32
(
PHY_CTRL
Ë& 
E1000_PHY_CTRL_GBE_DISABLE
)))

2669 
	`e_dbg
("AttemptingÅoáccessÖage %d while gigÉnabled.\n",

2670 
∑ge
);

2672 i‡(!
∑ge_£t
) {

2674 
ªt_vÆ
 = 
	`e1000_íabÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
phy_ªg
);

2675 i‡(
ªt_vÆ
) {

2676 
	`e_dbg
("CouldÇotÉnable PHY wakeupÑegáccess\n");

2677  
ªt_vÆ
;

2681 
	`e_dbg
("Ac˚ssög PHYÖagê%dÑeg 0x%x\n", 
∑ge
, 
ªg
);

2684 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_WUC_ADDRESS_OPCODE
, 
ªg
);

2685 i‡(
ªt_vÆ
) {

2686 
	`e_dbg
("CouldÇŸ wrôêaddªs†›codêtÿ∑gê%d\n", 
∑ge
);

2687  
ªt_vÆ
;

2690 i‡(
ªad
) {

2692 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
BM_WUC_DATA_OPCODE
,

2693 
d©a
);

2696 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
BM_WUC_DATA_OPCODE
,

2697 *
d©a
);

2700 i‡(
ªt_vÆ
) {

2701 
	`e_dbg
("CouldÇŸác˚s†PHYÑeg %d.%d\n", 
∑ge
, 
ªg
);

2702  
ªt_vÆ
;

2705 i‡(!
∑ge_£t
)

2706 
ªt_vÆ
 = 
	`e1000_dißbÀ_phy_wakeup_ªg_ac˚ss_bm
(
hw
, &
phy_ªg
);

2708  
ªt_vÆ
;

2709 
	}
}

2719 
	$e1000_powî_up_phy_c›≥r
(
e1000_hw
 *
hw
)

2721 
u16
 
mii_ªg
 = 0;

2724 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
mii_ªg
);

2725 
mii_ªg
 &~
BMCR_PDOWN
;

2726 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
mii_ªg
);

2727 
	}
}

2737 
	$e1000_powî_down_phy_c›≥r
(
e1000_hw
 *
hw
)

2739 
u16
 
mii_ªg
 = 0;

2742 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
mii_ªg
);

2743 
mii_ªg
 |
BMCR_PDOWN
;

2744 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
mii_ªg
);

2745 
	`u¶ìp_ønge
(1000, 2000);

2746 
	}
}

2759 
s32
 
	$__e1000_ªad_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
,

2760 
boﬁ
 
locked
, boﬁ 
∑ge_£t
)

2762 
s32
 
ªt_vÆ
;

2763 
u16
 
∑ge
 = 
	`BM_PHY_REG_PAGE
(
off£t
);

2764 
u16
 
ªg
 = 
	`BM_PHY_REG_NUM
(
off£t
);

2765 
u32
 
phy_addr
 = 
hw
->
phy
.
addr
 = 
	`e1000_gë_phy_addr_f‹_hv_∑ge
(
∑ge
);

2767 i‡(!
locked
) {

2768 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2769 i‡(
ªt_vÆ
)

2770  
ªt_vÆ
;

2774 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2775 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, 
d©a
,

2776 
åue
, 
∑ge_£t
);

2777 
out
;

2780 i‡(
∑ge
 > 0 &&Öagê< 
HV_INTC_FC_PAGE_START
) {

2781 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_debug_ªgs_hv
(
hw
, 
off£t
,

2782 
d©a
, 
åue
);

2783 
out
;

2786 i‡(!
∑ge_£t
) {

2787 i‡(
∑ge
 =
HV_INTC_FC_PAGE_START
)

2788 
∑ge
 = 0;

2790 i‡(
ªg
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2792 
ªt_vÆ
 = 
	`e1000_£t_∑ge_igp
(
hw
,

2793 (
∑ge
 << 
IGP_PAGE_SHIFT
));

2795 
hw
->
phy
.
addr
 = 
phy_addr
;

2797 i‡(
ªt_vÆ
)

2798 
out
;

2802 
	`e_dbg
("ªadög PHYÖagê%d (‹ 0x%x shi·edËªg 0x%x\n", 
∑ge
,

2803 
∑ge
 << 
IGP_PAGE_SHIFT
, 
ªg
);

2805 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
ªg
, 
d©a
);

2806 
out
:

2807 i‡(!
locked
)

2808 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2810  
ªt_vÆ
;

2811 
	}
}

2823 
s32
 
	$e1000_ªad_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

2825  
	`__e1000_ªad_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
Ál£
, false);

2826 
	}
}

2837 
s32
 
	$e1000_ªad_phy_ªg_hv_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

2839  
	`__e1000_ªad_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
åue
, 
Ál£
);

2840 
	}
}

2851 
s32
 
	$e1000_ªad_phy_ªg_∑ge_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
)

2853  
	`__e1000_ªad_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
åue
,Årue);

2854 
	}
}

2866 
s32
 
	$__e1000_wrôe_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
,

2867 
boﬁ
 
locked
, boﬁ 
∑ge_£t
)

2869 
s32
 
ªt_vÆ
;

2870 
u16
 
∑ge
 = 
	`BM_PHY_REG_PAGE
(
off£t
);

2871 
u16
 
ªg
 = 
	`BM_PHY_REG_NUM
(
off£t
);

2872 
u32
 
phy_addr
 = 
hw
->
phy
.
addr
 = 
	`e1000_gë_phy_addr_f‹_hv_∑ge
(
∑ge
);

2874 i‡(!
locked
) {

2875 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`acquúe
(hw);

2876 i‡(
ªt_vÆ
)

2877  
ªt_vÆ
;

2881 i‡(
∑ge
 =
BM_WUC_PAGE
) {

2882 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_wakeup_ªg_bm
(
hw
, 
off£t
, &
d©a
,

2883 
Ál£
, 
∑ge_£t
);

2884 
out
;

2887 i‡(
∑ge
 > 0 &&Öagê< 
HV_INTC_FC_PAGE_START
) {

2888 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_debug_ªgs_hv
(
hw
, 
off£t
,

2889 &
d©a
, 
Ál£
);

2890 
out
;

2893 i‡(!
∑ge_£t
) {

2894 i‡(
∑ge
 =
HV_INTC_FC_PAGE_START
)

2895 
∑ge
 = 0;

2900 i‡((
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) &&

2901 (
hw
->
phy
.
ªvisi⁄
 >= 1) &&

2902 (
hw
->
phy
.
addr
 == 2) &&

2903 !(
MAX_PHY_REG_ADDRESS
 & 
ªg
Ë&& (
d©a
 & (1 << 11))) {

2904 
u16
 
d©a2
 = 0x7EFF;

2905 
ªt_vÆ
 = 
	`e1000_ac˚ss_phy_debug_ªgs_hv
(
hw
,

2907 &
d©a2
, 
Ál£
);

2908 i‡(
ªt_vÆ
)

2909 
out
;

2912 i‡(
ªg
 > 
MAX_PHY_MULTI_PAGE_REG
) {

2914 
ªt_vÆ
 = 
	`e1000_£t_∑ge_igp
(
hw
,

2915 (
∑ge
 << 
IGP_PAGE_SHIFT
));

2917 
hw
->
phy
.
addr
 = 
phy_addr
;

2919 i‡(
ªt_vÆ
)

2920 
out
;

2924 
	`e_dbg
("wrôög PHYÖagê%d (‹ 0x%x shi·edËªg 0x%x\n", 
∑ge
,

2925 
∑ge
 << 
IGP_PAGE_SHIFT
, 
ªg
);

2927 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
MAX_PHY_REG_ADDRESS
 & 
ªg
,

2928 
d©a
);

2930 
out
:

2931 i‡(!
locked
)

2932 
hw
->
phy
.
›s
.
	`ªÀa£
(hw);

2934  
ªt_vÆ
;

2935 
	}
}

2946 
s32
 
	$e1000_wrôe_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

2948  
	`__e1000_wrôe_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
Ál£
, false);

2949 
	}
}

2960 
s32
 
	$e1000_wrôe_phy_ªg_hv_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

2962  
	`__e1000_wrôe_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
åue
, 
Ál£
);

2963 
	}
}

2974 
s32
 
	$e1000_wrôe_phy_ªg_∑ge_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
)

2976  
	`__e1000_wrôe_phy_ªg_hv
(
hw
, 
off£t
, 
d©a
, 
åue
,Årue);

2977 
	}
}

2983 
u32
 
	$e1000_gë_phy_addr_f‹_hv_∑ge
(
u32
 
∑ge
)

2985 
u32
 
phy_addr
 = 2;

2987 i‡(
∑ge
 >
HV_INTC_FC_PAGE_START
)

2988 
phy_addr
 = 1;

2990  
phy_addr
;

2991 
	}
}

3005 
s32
 
	$e1000_ac˚ss_phy_debug_ªgs_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
,

3006 
u16
 *
d©a
, 
boﬁ
 
ªad
)

3008 
s32
 
ªt_vÆ
;

3009 
u32
 
addr_ªg
;

3010 
u32
 
d©a_ªg
;

3013 
addr_ªg
 = ((
hw
->
phy
.
ty≥
 =
e1000_phy_82578
) ?

3014 
I82578_ADDR_REG
 : 
I82577_ADDR_REG
);

3015 
d©a_ªg
 = 
addr_ªg
 + 1;

3018 
hw
->
phy
.
addr
 = 2;

3021 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
addr_ªg
, (
u16
)
off£t
 & 0x3F);

3022 i‡(
ªt_vÆ
) {

3023 
	`e_dbg
("CouldÇot writeÅhe Address OffsetÖortÑegister\n");

3024  
ªt_vÆ
;

3028 i‡(
ªad
)

3029 
ªt_vÆ
 = 
	`e1000e_ªad_phy_ªg_mdic
(
hw
, 
d©a_ªg
, 
d©a
);

3031 
ªt_vÆ
 = 
	`e1000e_wrôe_phy_ªg_mdic
(
hw
, 
d©a_ªg
, *
d©a
);

3033 i‡(
ªt_vÆ
)

3034 
	`e_dbg
("CouldÇotáccessÅhe DataÖortÑegister\n");

3036  
ªt_vÆ
;

3037 
	}
}

3050 
s32
 
	$e1000_lök_°Æl_w‹k¨ound_hv
(
e1000_hw
 *
hw
)

3052 
s32
 
ªt_vÆ
 = 0;

3053 
u16
 
d©a
;

3055 i‡(
hw
->
phy
.
ty≥
 !
e1000_phy_82578
)

3059 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
d©a
);

3060 i‡(
d©a
 & 
BMCR_LOOPBACK
)

3064 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
BM_CS_STATUS
, &
d©a
);

3065 i‡(
ªt_vÆ
)

3066  
ªt_vÆ
;

3068 
d©a
 &(
BM_CS_STATUS_LINK_UP
 | 
BM_CS_STATUS_RESOLVED
 |

3069 
BM_CS_STATUS_SPEED_MASK
);

3071 i‡(
d©a
 !(
BM_CS_STATUS_LINK_UP
 | 
BM_CS_STATUS_RESOLVED
 |

3072 
BM_CS_STATUS_SPEED_1000
))

3075 
	`m¶ìp
(200);

3078 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
HV_MUX_DATA_CTRL
,

3079 (
HV_MUX_DATA_CTRL_GEN_TO_MAC
 |

3080 
HV_MUX_DATA_CTRL_FORCE_SPEED
));

3081 i‡(
ªt_vÆ
)

3082  
ªt_vÆ
;

3084  
	`e1e_wphy
(
hw
, 
HV_MUX_DATA_CTRL
, 
HV_MUX_DATA_CTRL_GEN_TO_MAC
);

3085 
	}
}

3095 
s32
 
	$e1000_check_pﬁ¨ôy_82577
(
e1000_hw
 *
hw
)

3097 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

3098 
s32
 
ªt_vÆ
;

3099 
u16
 
d©a
;

3101 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82577_PHY_STATUS_2
, &
d©a
);

3103 i‡(!
ªt_vÆ
)

3104 
phy
->
ˇbÀ_pﬁ¨ôy
 = ((
d©a
 & 
I82577_PHY_STATUS2_REV_POLARITY
)

3105 ? 
e1000_ªv_pﬁ¨ôy_ªvî£d


3106 : 
e1000_ªv_pﬁ¨ôy_n‹mÆ
);

3108  
ªt_vÆ
;

3109 
	}
}

3117 
s32
 
	$e1000_phy_f‹˚_•ìd_du∂ex_82577
(
e1000_hw
 *
hw
)

3119 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

3120 
s32
 
ªt_vÆ
;

3121 
u16
 
phy_d©a
;

3122 
boﬁ
 
lök
;

3124 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_BMCR
, &
phy_d©a
);

3125 i‡(
ªt_vÆ
)

3126  
ªt_vÆ
;

3128 
	`e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
hw
, &
phy_d©a
);

3130 
ªt_vÆ
 = 
	`e1e_wphy
(
hw
, 
MII_BMCR
, 
phy_d©a
);

3131 i‡(
ªt_vÆ
)

3132  
ªt_vÆ
;

3134 
	`udñay
(1);

3136 i‡(
phy
->
aut⁄eg_waô_to_com∂ëe
) {

3137 
	`e_dbg
("Waiting for forced speed/duplexÜink on 82577Öhy\n");

3139 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

3140 100000, &
lök
);

3141 i‡(
ªt_vÆ
)

3142  
ªt_vÆ
;

3144 i‡(!
lök
)

3145 
	`e_dbg
("LinkÅakingÜongerÅhanÉxpected.\n");

3148 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 
PHY_FORCE_LIMIT
,

3149 100000, &
lök
);

3152  
ªt_vÆ
;

3153 
	}
}

3164 
s32
 
	$e1000_gë_phy_öfo_82577
(
e1000_hw
 *
hw
)

3166 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

3167 
s32
 
ªt_vÆ
;

3168 
u16
 
d©a
;

3169 
boﬁ
 
lök
;

3171 
ªt_vÆ
 = 
	`e1000e_phy_has_lök_gíîic
(
hw
, 1, 0, &
lök
);

3172 i‡(
ªt_vÆ
)

3173  
ªt_vÆ
;

3175 i‡(!
lök
) {

3176 
	`e_dbg
("Phy info is only valid ifÜink is up\n");

3177  -
E1000_ERR_CONFIG
;

3180 
phy
->
pﬁ¨ôy_c‹ª˘i⁄
 = 
åue
;

3182 
ªt_vÆ
 = 
	`e1000_check_pﬁ¨ôy_82577
(
hw
);

3183 i‡(
ªt_vÆ
)

3184  
ªt_vÆ
;

3186 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82577_PHY_STATUS_2
, &
d©a
);

3187 i‡(
ªt_vÆ
)

3188  
ªt_vÆ
;

3190 
phy
->
is_mdix
 = !!(
d©a
 & 
I82577_PHY_STATUS2_MDIX
);

3192 i‡((
d©a
 & 
I82577_PHY_STATUS2_SPEED_MASK
) ==

3193 
I82577_PHY_STATUS2_SPEED_1000MBPS
) {

3194 
ªt_vÆ
 = 
hw
->
phy
.
›s
.
	`gë_ˇbÀ_Àngth
(hw);

3195 i‡(
ªt_vÆ
)

3196  
ªt_vÆ
;

3198 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
MII_STAT1000
, &
d©a
);

3199 i‡(
ªt_vÆ
)

3200  
ªt_vÆ
;

3202 
phy
->
loˇl_rx
 = (
d©a
 & 
LPA_1000LOCALRXOK
)

3203 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

3205 
phy
->
ªmŸe_rx
 = (
d©a
 & 
LPA_1000REMRXOK
)

3206 ? 
e1000_1000t_rx_°©us_ok
 : 
e1000_1000t_rx_°©us_nŸ_ok
;

3208 
phy
->
ˇbÀ_Àngth
 = 
E1000_CABLE_LENGTH_UNDEFINED
;

3209 
phy
->
loˇl_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

3210 
phy
->
ªmŸe_rx
 = 
e1000_1000t_rx_°©us_undeföed
;

3214 
	}
}

3223 
s32
 
	$e1000_gë_ˇbÀ_Àngth_82577
(
e1000_hw
 *
hw
)

3225 
e1000_phy_öfo
 *
phy
 = &
hw
->phy;

3226 
s32
 
ªt_vÆ
;

3227 
u16
 
phy_d©a
, 
Àngth
;

3229 
ªt_vÆ
 = 
	`e1e_Ωhy
(
hw
, 
I82577_PHY_DIAG_STATUS
, &
phy_d©a
);

3230 i‡(
ªt_vÆ
)

3231  
ªt_vÆ
;

3233 
Àngth
 = ((
phy_d©a
 & 
I82577_DSTATUS_CABLE_LENGTH
) >>

3234 
I82577_DSTATUS_CABLE_LENGTH_SHIFT
);

3236 i‡(
Àngth
 =
E1000_CABLE_LENGTH_UNDEFINED
)

3237  -
E1000_ERR_PHY
;

3239 
phy
->
ˇbÀ_Àngth
 = 
Àngth
;

3242 
	}
}

	@phy.h

29 #i‚de‡
_E1000E_PHY_H_


30 
	#_E1000E_PHY_H_


	)

32 
s32
 
e1000e_check_downshi·
(
e1000_hw
 *
hw
);

33 
s32
 
e1000_check_pﬁ¨ôy_m88
(
e1000_hw
 *
hw
);

34 
s32
 
e1000_check_pﬁ¨ôy_igp
(
e1000_hw
 *
hw
);

35 
s32
 
e1000_check_pﬁ¨ôy_i„
(
e1000_hw
 *
hw
);

36 
s32
 
e1000e_check_ª£t_block_gíîic
(
e1000_hw
 *
hw
);

37 
s32
 
e1000e_c›≥r_lök_£tup_igp
(
e1000_hw
 *
hw
);

38 
s32
 
e1000e_c›≥r_lök_£tup_m88
(
e1000_hw
 *
hw
);

39 
s32
 
e1000e_phy_f‹˚_•ìd_du∂ex_igp
(
e1000_hw
 *
hw
);

40 
s32
 
e1000e_phy_f‹˚_•ìd_du∂ex_m88
(
e1000_hw
 *
hw
);

41 
s32
 
e1000_phy_f‹˚_•ìd_du∂ex_i„
(
e1000_hw
 *
hw
);

42 
s32
 
e1000e_gë_ˇbÀ_Àngth_m88
(
e1000_hw
 *
hw
);

43 
s32
 
e1000e_gë_ˇbÀ_Àngth_igp_2
(
e1000_hw
 *
hw
);

44 
s32
 
e1000e_gë_cfg_d⁄e_gíîic
(
e1000_hw
 *
hw
);

45 
s32
 
e1000e_gë_phy_id
(
e1000_hw
 *
hw
);

46 
s32
 
e1000e_gë_phy_öfo_igp
(
e1000_hw
 *
hw
);

47 
s32
 
e1000e_gë_phy_öfo_m88
(
e1000_hw
 *
hw
);

48 
s32
 
e1000_gë_phy_öfo_i„
(
e1000_hw
 *
hw
);

49 
s32
 
e1000e_phy_sw_ª£t
(
e1000_hw
 *
hw
);

50 
e1000e_phy_f‹˚_•ìd_du∂ex_£tup
(
e1000_hw
 *
hw
, 
u16
 *
phy_˘æ
);

51 
s32
 
e1000e_phy_hw_ª£t_gíîic
(
e1000_hw
 *
hw
);

52 
s32
 
e1000e_phy_ª£t_d•
(
e1000_hw
 *
hw
);

53 
s32
 
e1000e_ªad_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

54 
s32
 
e1000e_ªad_km∫_ªg_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

55 
s32
 
e1000_£t_∑ge_igp
(
e1000_hw
 *
hw
, 
u16
 
∑ge
);

56 
s32
 
e1000e_ªad_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

57 
s32
 
e1000e_ªad_phy_ªg_igp_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

58 
s32
 
e1000e_ªad_phy_ªg_m88
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

59 
s32
 
e1000e_£t_d3_Õlu_°©e
(
e1000_hw
 *
hw
, 
boﬁ
 
a˘ive
);

60 
s32
 
e1000e_£tup_c›≥r_lök
(
e1000_hw
 *
hw
);

61 
s32
 
e1000e_wrôe_km∫_ªg
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

62 
s32
 
e1000e_wrôe_km∫_ªg_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

63 
s32
 
e1000e_wrôe_phy_ªg_igp
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

64 
s32
 
e1000e_wrôe_phy_ªg_igp_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

65 
s32
 
e1000e_wrôe_phy_ªg_m88
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

66 
s32
 
e1000e_phy_has_lök_gíîic
(
e1000_hw
 *
hw
, 
u32
 
ôî©i⁄s
,

67 
u32
 
u£c_öãrvÆ
, 
boﬁ
 *
suc˚ss
);

68 
s32
 
e1000e_phy_öô_s¸ùt_igp3
(
e1000_hw
 *
hw
);

69 
e1000_phy_ty≥
 
e1000e_gë_phy_ty≥_‰om_id
(
u32
 
phy_id
);

70 
s32
 
e1000e_dëîmöe_phy_addªss
(
e1000_hw
 *
hw
);

71 
s32
 
e1000e_wrôe_phy_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

72 
s32
 
e1000e_ªad_phy_ªg_bm
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

73 
s32
 
e1000_íabÀ_phy_wakeup_ªg_ac˚ss_bm
(
e1000_hw
 *
hw
, 
u16
 *
phy_ªg
);

74 
s32
 
e1000_dißbÀ_phy_wakeup_ªg_ac˚ss_bm
(
e1000_hw
 *
hw
, 
u16
 *
phy_ªg
);

75 
s32
 
e1000e_ªad_phy_ªg_bm2
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

76 
s32
 
e1000e_wrôe_phy_ªg_bm2
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

77 
e1000_powî_up_phy_c›≥r
(
e1000_hw
 *
hw
);

78 
e1000_powî_down_phy_c›≥r
(
e1000_hw
 *
hw
);

79 
s32
 
e1000e_ªad_phy_ªg_mdic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

80 
s32
 
e1000e_wrôe_phy_ªg_mdic
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

81 
s32
 
e1000_ªad_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

82 
s32
 
e1000_ªad_phy_ªg_hv_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

83 
s32
 
e1000_ªad_phy_ªg_∑ge_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 *
d©a
);

84 
s32
 
e1000_wrôe_phy_ªg_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

85 
s32
 
e1000_wrôe_phy_ªg_hv_locked
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

86 
s32
 
e1000_wrôe_phy_ªg_∑ge_hv
(
e1000_hw
 *
hw
, 
u32
 
off£t
, 
u16
 
d©a
);

87 
s32
 
e1000_lök_°Æl_w‹k¨ound_hv
(
e1000_hw
 *
hw
);

88 
s32
 
e1000_c›≥r_lök_£tup_82577
(
e1000_hw
 *
hw
);

89 
s32
 
e1000_check_pﬁ¨ôy_82577
(
e1000_hw
 *
hw
);

90 
s32
 
e1000_gë_phy_öfo_82577
(
e1000_hw
 *
hw
);

91 
s32
 
e1000_phy_f‹˚_•ìd_du∂ex_82577
(
e1000_hw
 *
hw
);

92 
s32
 
e1000_gë_ˇbÀ_Àngth_82577
(
e1000_hw
 *
hw
);

94 
	#E1000_MAX_PHY_ADDR
 8

	)

97 
	#IGP01E1000_PHY_PORT_CONFIG
 0x10

	)

98 
	#IGP01E1000_PHY_PORT_STATUS
 0x11

	)

99 
	#IGP01E1000_PHY_PORT_CTRL
 0x12

	)

100 
	#IGP01E1000_PHY_LINK_HEALTH
 0x13

	)

101 
	#IGP02E1000_PHY_POWER_MGMT
 0x19

	)

102 
	#IGP01E1000_PHY_PAGE_SELECT
 0x1F

	)

103 
	#BM_PHY_PAGE_SELECT
 22

	)

104 
	#IGP_PAGE_SHIFT
 5

	)

105 
	#PHY_REG_MASK
 0x1F

	)

108 
	#BM_PORT_CTRL_PAGE
 769

	)

109 
	#BM_WUC_PAGE
 800

	)

110 
	#BM_WUC_ADDRESS_OPCODE
 0x11

	)

111 
	#BM_WUC_DATA_OPCODE
 0x12

	)

112 
	#BM_WUC_ENABLE_PAGE
 
BM_PORT_CTRL_PAGE


	)

113 
	#BM_WUC_ENABLE_REG
 17

	)

114 
	#BM_WUC_ENABLE_BIT
 (1 << 2)

	)

115 
	#BM_WUC_HOST_WU_BIT
 (1 << 4)

	)

116 
	#BM_WUC_ME_WU_BIT
 (1 << 5)

	)

118 
	#PHY_UPPER_SHIFT
 21

	)

119 
	#BM_PHY_REG
(
∑ge
, 
ªg
) \

120 (((
ªg
Ë& 
MAX_PHY_REG_ADDRESS
) |\

121 (((
∑ge
Ë& 0xFFFFË<< 
PHY_PAGE_SHIFT
) |\

122 (((
ªg
Ë& ~
MAX_PHY_REG_ADDRESS
Ë<< (
PHY_UPPER_SHIFT
 - 
PHY_PAGE_SHIFT
)))

	)

123 
	#BM_PHY_REG_PAGE
(
off£t
) \

124 ((
u16
)(((
off£t
Ë>> 
PHY_PAGE_SHIFT
Ë& 0xFFFF))

	)

125 
	#BM_PHY_REG_NUM
(
off£t
) \

126 ((
u16
)(((
off£t
Ë& 
MAX_PHY_REG_ADDRESS
) |\

127 (((
off£t
Ë>> (
PHY_UPPER_SHIFT
 - 
PHY_PAGE_SHIFT
)) &\

128 ~
MAX_PHY_REG_ADDRESS
)))

	)

130 
	#HV_INTC_FC_PAGE_START
 768

	)

131 
	#I82578_ADDR_REG
 29

	)

132 
	#I82577_ADDR_REG
 16

	)

133 
	#I82577_CFG_REG
 22

	)

134 
	#I82577_CFG_ASSERT_CRS_ON_TX
 (1 << 15)

	)

135 
	#I82577_CFG_ENABLE_DOWNSHIFT
 (3 << 10Ë

	)

136 
	#I82577_CTRL_REG
 23

	)

139 
	#I82577_PHY_CTRL_2
 18

	)

140 
	#I82577_PHY_LBK_CTRL
 19

	)

141 
	#I82577_PHY_STATUS_2
 26

	)

142 
	#I82577_PHY_DIAG_STATUS
 31

	)

145 
	#I82577_PHY_STATUS2_REV_POLARITY
 0x0400

	)

146 
	#I82577_PHY_STATUS2_MDIX
 0x0800

	)

147 
	#I82577_PHY_STATUS2_SPEED_MASK
 0x0300

	)

148 
	#I82577_PHY_STATUS2_SPEED_1000MBPS
 0x0200

	)

151 
	#I82577_PHY_CTRL2_MANUAL_MDIX
 0x0200

	)

152 
	#I82577_PHY_CTRL2_AUTO_MDI_MDIX
 0x0400

	)

153 
	#I82577_PHY_CTRL2_MDIX_CFG_MASK
 0x0600

	)

156 
	#I82577_DSTATUS_CABLE_LENGTH
 0x03FC

	)

157 
	#I82577_DSTATUS_CABLE_LENGTH_SHIFT
 2

	)

160 
	#BM_CS_CTRL1
 16

	)

163 
	#BM_CS_STATUS
 17

	)

164 
	#BM_CS_STATUS_LINK_UP
 0x0400

	)

165 
	#BM_CS_STATUS_RESOLVED
 0x0800

	)

166 
	#BM_CS_STATUS_SPEED_MASK
 0xC000

	)

167 
	#BM_CS_STATUS_SPEED_1000
 0x8000

	)

170 
	#HV_M_STATUS
 26

	)

171 
	#HV_M_STATUS_AUTONEG_COMPLETE
 0x1000

	)

172 
	#HV_M_STATUS_SPEED_MASK
 0x0300

	)

173 
	#HV_M_STATUS_SPEED_1000
 0x0200

	)

174 
	#HV_M_STATUS_LINK_UP
 0x0040

	)

176 
	#IGP01E1000_PHY_PCS_INIT_REG
 0x00B4

	)

177 
	#IGP01E1000_PHY_POLARITY_MASK
 0x0078

	)

179 
	#IGP01E1000_PSCR_AUTO_MDIX
 0x1000

	)

180 
	#IGP01E1000_PSCR_FORCE_MDI_MDIX
 0x2000

	)

182 
	#IGP01E1000_PSCFR_SMART_SPEED
 0x0080

	)

184 
	#IGP02E1000_PM_SPD
 0x0001

	)

185 
	#IGP02E1000_PM_D0_LPLU
 0x0002

	)

186 
	#IGP02E1000_PM_D3_LPLU
 0x0004

	)

188 
	#IGP01E1000_PLHR_SS_DOWNGRADE
 0x8000

	)

190 
	#IGP01E1000_PSSR_POLARITY_REVERSED
 0x0002

	)

191 
	#IGP01E1000_PSSR_MDIX
 0x0800

	)

192 
	#IGP01E1000_PSSR_SPEED_MASK
 0xC000

	)

193 
	#IGP01E1000_PSSR_SPEED_1000MBPS
 0xC000

	)

195 
	#IGP02E1000_PHY_CHANNEL_NUM
 4

	)

196 
	#IGP02E1000_PHY_AGC_A
 0x11B1

	)

197 
	#IGP02E1000_PHY_AGC_B
 0x12B1

	)

198 
	#IGP02E1000_PHY_AGC_C
 0x14B1

	)

199 
	#IGP02E1000_PHY_AGC_D
 0x18B1

	)

201 
	#IGP02E1000_AGC_LENGTH_SHIFT
 9

	)

202 
	#IGP02E1000_AGC_LENGTH_MASK
 0x7F

	)

203 
	#IGP02E1000_AGC_RANGE
 15

	)

205 
	#E1000_CABLE_LENGTH_UNDEFINED
 0xFF

	)

207 
	#E1000_KMRNCTRLSTA_OFFSET
 0x001F0000

	)

208 
	#E1000_KMRNCTRLSTA_OFFSET_SHIFT
 16

	)

209 
	#E1000_KMRNCTRLSTA_REN
 0x00200000

	)

210 
	#E1000_KMRNCTRLSTA_CTRL_OFFSET
 0x1

	)

211 
	#E1000_KMRNCTRLSTA_DIAG_OFFSET
 0x3

	)

212 
	#E1000_KMRNCTRLSTA_TIMEOUTS
 0x4

	)

213 
	#E1000_KMRNCTRLSTA_INBAND_PARAM
 0x9

	)

214 
	#E1000_KMRNCTRLSTA_IBIST_DISABLE
 0x0200

	)

215 
	#E1000_KMRNCTRLSTA_DIAG_NELPBK
 0x1000

	)

216 
	#E1000_KMRNCTRLSTA_K1_CONFIG
 0x7

	)

217 
	#E1000_KMRNCTRLSTA_K1_ENABLE
 0x0002

	)

218 
	#E1000_KMRNCTRLSTA_HD_CTRL
 0x10

	)

220 
	#IFE_PHY_EXTENDED_STATUS_CONTROL
 0x10

	)

221 
	#IFE_PHY_SPECIAL_CONTROL
 0x11

	)

222 
	#IFE_PHY_SPECIAL_CONTROL_LED
 0x1B

	)

223 
	#IFE_PHY_MDIX_CONTROL
 0x1C

	)

226 
	#IFE_PESC_POLARITY_REVERSED
 0x0100

	)

229 
	#IFE_PSC_AUTO_POLARITY_DISABLE
 0x0010

	)

230 
	#IFE_PSC_FORCE_POLARITY
 0x0020

	)

233 
	#IFE_PSCL_PROBE_MODE
 0x0020

	)

234 
	#IFE_PSCL_PROBE_LEDS_OFF
 0x0006

	)

235 
	#IFE_PSCL_PROBE_LEDS_ON
 0x0007

	)

238 
	#IFE_PMC_MDIX_STATUS
 0x0020

	)

239 
	#IFE_PMC_FORCE_MDIX
 0x0040

	)

240 
	#IFE_PMC_AUTO_MDIX
 0x0080

	)

	@ptp.c

34 
	~"e1000.h
"

44 
	$e1000e_phc_adj‰eq
(
±p_˛ock_öfo
 *
±p
, 
s32
 
dñè
)

46 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
±p
, e1000_adapter,

47 
±p_˛ock_öfo
);

48 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

49 
boﬁ
 
√g_adj
 = 
Ál£
;

50 
u64
 
adju°mít
;

51 
u32
 
timöˇ
, 
öcvÆue
;

52 
s32
 
ªt_vÆ
;

54 i‡((
dñè
 > 
±p
->
max_adj
) || (delta <= -1000000000))

55  -
EINVAL
;

57 i‡(
dñè
 < 0) {

58 
√g_adj
 = 
åue
;

59 
dñè
 = -delta;

63 
ªt_vÆ
 = 
	`e1000e_gë_ba£_timöˇ
(
ad≠ãr
, &
timöˇ
);

64 i‡(
ªt_vÆ
)

65  
ªt_vÆ
;

67 
öcvÆue
 = 
timöˇ
 & 
E1000_TIMINCA_INCVALUE_MASK
;

69 
adju°mít
 = 
öcvÆue
;

70 
adju°mít
 *
dñè
;

71 
adju°mít
 = 
	`div_u64
(adjustment, 1000000000);

73 
öcvÆue
 = 
√g_adj
 ? (öcvÆuê- 
adju°mít
) : (incvalue +ádjustment);

75 
timöˇ
 &~
E1000_TIMINCA_INCVALUE_MASK
;

76 
timöˇ
 |
öcvÆue
;

78 
	`ew32
(
TIMINCA
, 
timöˇ
);

81 
	}
}

90 
	$e1000e_phc_adjtime
(
±p_˛ock_öfo
 *
±p
, 
s64
 
dñè
)

92 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
±p
, e1000_adapter,

93 
±p_˛ock_öfo
);

94 
Êags
;

95 
s64
 
now
;

97 
	`•ö_lock_úqßve
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

98 
now
 = 
	`timecou¡î_ªad
(&
ad≠ãr
->
tc
);

99 
now
 +
dñè
;

100 
	`timecou¡î_öô
(&
ad≠ãr
->
tc
, &ad≠ãr->
cc
, 
now
);

101 
	`•ö_u∆ock_úqª°‹e
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

104 
	}
}

114 
	$e1000e_phc_gëtime
(
±p_˛ock_öfo
 *
±p
, 
time•ec
 *
ts
)

116 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
±p
, e1000_adapter,

117 
±p_˛ock_öfo
);

118 
Êags
;

119 
u32
 
ªmaödî
;

120 
u64
 
ns
;

122 
	`•ö_lock_úqßve
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

123 
ns
 = 
	`timecou¡î_ªad
(&
ad≠ãr
->
tc
);

124 
	`•ö_u∆ock_úqª°‹e
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

126 
ts
->
tv_£c
 = 
	`div_u64_ªm
(
ns
, 
NSEC_PER_SEC
, &
ªmaödî
);

127 
ts
->
tv_n£c
 = 
ªmaödî
;

130 
	}
}

140 
	$e1000e_phc_£âime
(
±p_˛ock_öfo
 *
±p
,

141 c⁄° 
time•ec
 *
ts
)

143 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
±p
, e1000_adapter,

144 
±p_˛ock_öfo
);

145 
Êags
;

146 
u64
 
ns
;

148 
ns
 = 
	`time•ec_to_ns
(
ts
);

151 
	`•ö_lock_úqßve
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

152 
	`timecou¡î_öô
(&
ad≠ãr
->
tc
, &ad≠ãr->
cc
, 
ns
);

153 
	`•ö_u∆ock_úqª°‹e
(&
ad≠ãr
->
sy°im_lock
, 
Êags
);

156 
	}
}

167 
	$e1000e_phc_íabÀ
(
±p_˛ock_öfo
 
__Æways_unu£d
 *
±p
,

168 
±p_˛ock_ªque°
 
__Æways_unu£d
 *
ªque°
,

169 
__Æways_unu£d
 
⁄
)

171  -
EOPNOTSUPP
;

172 
	}
}

174 
	$e1000e_sy°im_ovîÊow_w‹k
(
w‹k_°ru˘
 *
w‹k
)

176 
e1000_ad≠ãr
 *
ad≠ãr
 = 
	`c⁄èöî_of
(
w‹k
, e1000_adapter,

177 
sy°im_ovîÊow_w‹k
.
w‹k
);

178 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

179 
time•ec
 
ts
;

181 
ad≠ãr
->
±p_˛ock_öfo
.
	`gëtime
(&ad≠ãr->±p_˛ock_öfo, &
ts
);

183 
	`e_dbg
("SYSTIM ovîÊow checkáà%ld.%09lu\n", 
ts
.
tv_£c
,Ås.
tv_n£c
);

185 
	`scheduÀ_dñayed_w‹k
(&
ad≠ãr
->
sy°im_ovîÊow_w‹k
,

186 
E1000_SYSTIM_OVERFLOW_PERIOD
);

187 
	}
}

189 c⁄° 
±p_˛ock_öfo
 
	ge1000e_±p_˛ock_öfo
 = {

190 .
ow√r
 = 
THIS_MODULE
,

191 .
	gn_Æ¨m
 = 0,

192 .
	gn_ext_ts
 = 0,

193 .
	gn_≥r_out
 = 0,

194 .
	gµs
 = 0,

195 .
	gadj‰eq
 = 
e1000e_phc_adj‰eq
,

196 .
	gadjtime
 = 
e1000e_phc_adjtime
,

197 .
	ggëtime
 = 
e1000e_phc_gëtime
,

198 .
	g£âime
 = 
e1000e_phc_£âime
,

199 .
	gíabÀ
 = 
e1000e_phc_íabÀ
,

210 
	$e1000e_±p_öô
(
e1000_ad≠ãr
 *
ad≠ãr
)

212 
e1000_hw
 *
hw
 = &
ad≠ãr
->hw;

214 
ad≠ãr
->
±p_˛ock
 = 
NULL
;

216 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
))

219 
ad≠ãr
->
±p_˛ock_öfo
 = 
e1000e_±p_˛ock_öfo
;

221 
	`¢¥ötf
(
ad≠ãr
->
±p_˛ock_öfo
.
«me
,

222 (
ad≠ãr
->
±p_˛ock_öfo
.
«me
), "%pm",

223 
ad≠ãr
->
√tdev
->
≥rm_addr
);

225 
hw
->
mac
.
ty≥
) {

226 
e1000_pch2œn
:

227 
e1000_pch_Õt
:

228 i‡((
hw
->
mac
.
ty≥
 !
e1000_pch_Õt
) ||

229 (
	`î32
(
TSYNCRXCTL
Ë& 
E1000_TSYNCRXCTL_SYSCFI
)) {

230 
ad≠ãr
->
±p_˛ock_öfo
.
max_adj
 = 24000000 - 1;

234 
e1000_82574
:

235 
e1000_82583
:

236 
ad≠ãr
->
±p_˛ock_öfo
.
max_adj
 = 600000000 - 1;

242 
	`INIT_DELAYED_WORK
(&
ad≠ãr
->
sy°im_ovîÊow_w‹k
,

243 
e1000e_sy°im_ovîÊow_w‹k
);

245 
	`scheduÀ_dñayed_w‹k
(&
ad≠ãr
->
sy°im_ovîÊow_w‹k
,

246 
E1000_SYSTIM_OVERFLOW_PERIOD
);

248 
ad≠ãr
->
±p_˛ock
 = 
	`±p_˛ock_ªgi°î
(&ad≠ãr->
±p_˛ock_öfo
,

249 
	`pci_dev_to_dev
(
ad≠ãr
->
pdev
));

250 i‡(
	`IS_ERR
(
ad≠ãr
->
±p_˛ock
)) {

251 
ad≠ãr
->
±p_˛ock
 = 
NULL
;

252 
	`e_îr
("ptp_clock_register failed\n");

254 
	`e_öfo
("registered PHC clock\n");

256 
	}
}

264 
	$e1000e_±p_ªmove
(
e1000_ad≠ãr
 *
ad≠ãr
)

266 i‡(!(
ad≠ãr
->
Êags
 & 
FLAG_HAS_HW_TIMESTAMP
))

269 
	`ˇn˚l_dñayed_w‹k_sync
(&
ad≠ãr
->
sy°im_ovîÊow_w‹k
);

271 i‡(
ad≠ãr
->
±p_˛ock
) {

272 
	`±p_˛ock_uƒegi°î
(
ad≠ãr
->
±p_˛ock
);

273 
ad≠ãr
->
±p_˛ock
 = 
NULL
;

274 
	`e_öfo
("removed PHC\n");

276 
	}
}

	@regs.h

29 #i‚de‡
_E1000E_REGS_H_


30 
	#_E1000E_REGS_H_


	)

32 
	#E1000_CTRL
 0x00000

	)

33 
	#E1000_STATUS
 0x00008

	)

34 
	#E1000_EECD
 0x00010

	)

35 
	#E1000_EERD
 0x00014

	)

36 
	#E1000_CTRL_EXT
 0x00018

	)

37 
	#E1000_FLA
 0x0001C

	)

38 
	#E1000_MDIC
 0x00020

	)

39 
	#E1000_SCTL
 0x00024

	)

40 
	#E1000_FCAL
 0x00028

	)

41 
	#E1000_FCAH
 0x0002C

	)

42 
	#E1000_FEXT
 0x0002C

	)

43 
	#E1000_FEXTNVM
 0x00028

	)

44 
	#E1000_FEXTNVM3
 0x0003C

	)

45 
	#E1000_FEXTNVM4
 0x00024

	)

46 
	#E1000_FEXTNVM6
 0x00010

	)

47 
	#E1000_FEXTNVM7
 0x000E4

	)

48 
	#E1000_FCT
 0x00030

	)

49 
	#E1000_VET
 0x00038

	)

50 
	#E1000_ICR
 0x000C0

	)

51 
	#E1000_ITR
 0x000C4

	)

52 
	#E1000_ICS
 0x000C8

	)

53 
	#E1000_IMS
 0x000D0

	)

54 
	#E1000_IMC
 0x000D8

	)

55 
	#E1000_IAM
 0x000E0

	)

56 
	#E1000_IVAR
 0x000E4

	)

57 
	#E1000_SVCR
 0x000F0

	)

58 
	#E1000_SVT
 0x000F4

	)

59 
	#E1000_LPIC
 0x000FC

	)

60 
	#E1000_RCTL
 0x00100

	)

61 
	#E1000_FCTTV
 0x00170

	)

62 
	#E1000_TXCW
 0x00178

	)

63 
	#E1000_RXCW
 0x00180

	)

64 
	#E1000_PBA_ECC
 0x01100

	)

65 
	#E1000_TCTL
 0x00400

	)

66 
	#E1000_TCTL_EXT
 0x00404

	)

67 
	#E1000_TIPG
 0x00410

	)

68 
	#E1000_AIT
 0x00458

	)

69 
	#E1000_LEDCTL
 0x00E00

	)

70 
	#E1000_EXTCNF_CTRL
 0x00F00

	)

71 
	#E1000_EXTCNF_SIZE
 0x00F08

	)

72 
	#E1000_PHY_CTRL
 0x00F10

	)

73 
	#E1000_POEMB
 
E1000_PHY_CTRL


	)

74 
	#E1000_PBA
 0x01000

	)

75 
	#E1000_PBS
 0x01008

	)

76 
	#E1000_PBECCSTS
 0x0100C

	)

77 
	#E1000_EEMNGCTL
 0x01010

	)

78 
	#E1000_EEWR
 0x0102C

	)

79 
	#E1000_FLOP
 0x0103C

	)

80 
	#E1000_ERT
 0x02008

	)

81 
	#E1000_FCRTL
 0x02160

	)

82 
	#E1000_FCRTH
 0x02168

	)

83 
	#E1000_PSRCTL
 0x02170

	)

84 
	#E1000_RDFH
 0x02410

	)

85 
	#E1000_RDFT
 0x02418

	)

86 
	#E1000_RDFHS
 0x02420

	)

87 
	#E1000_RDFTS
 0x02428

	)

88 
	#E1000_RDFPC
 0x02430

	)

90 
	#E1000_RDTR
 0x02820

	)

91 
	#E1000_RADV
 0x0282C

	)

99 
	#E1000_RDBAL
(
_n
) ((_n) < 4 ? (0x02800 + ((_n) * 0x100)) : \

100 (0x0C000 + ((
_n
Ë* 0x40)))

	)

101 
	#E1000_RDBAH
(
_n
) ((_n) < 4 ? (0x02804 + ((_n) * 0x100)) : \

102 (0x0C004 + ((
_n
Ë* 0x40)))

	)

103 
	#E1000_RDLEN
(
_n
) ((_n) < 4 ? (0x02808 + ((_n) * 0x100)) : \

104 (0x0C008 + ((
_n
Ë* 0x40)))

	)

105 
	#E1000_RDH
(
_n
) ((_n) < 4 ? (0x02810 + ((_n) * 0x100)) : \

106 (0x0C010 + ((
_n
Ë* 0x40)))

	)

107 
	#E1000_RDT
(
_n
) ((_n) < 4 ? (0x02818 + ((_n) * 0x100)) : \

108 (0x0C018 + ((
_n
Ë* 0x40)))

	)

109 
	#E1000_RXDCTL
(
_n
) ((_n) < 4 ? (0x02828 + ((_n) * 0x100)) : \

110 (0x0C028 + ((
_n
Ë* 0x40)))

	)

111 
	#E1000_TDBAL
(
_n
) ((_n) < 4 ? (0x03800 + ((_n) * 0x100)) : \

112 (0x0E000 + ((
_n
Ë* 0x40)))

	)

113 
	#E1000_TDBAH
(
_n
) ((_n) < 4 ? (0x03804 + ((_n) * 0x100)) : \

114 (0x0E004 + ((
_n
Ë* 0x40)))

	)

115 
	#E1000_TDLEN
(
_n
) ((_n) < 4 ? (0x03808 + ((_n) * 0x100)) : \

116 (0x0E008 + ((
_n
Ë* 0x40)))

	)

117 
	#E1000_TDH
(
_n
) ((_n) < 4 ? (0x03810 + ((_n) * 0x100)) : \

118 (0x0E010 + ((
_n
Ë* 0x40)))

	)

119 
	#E1000_TDT
(
_n
) ((_n) < 4 ? (0x03818 + ((_n) * 0x100)) : \

120 (0x0E018 + ((
_n
Ë* 0x40)))

	)

121 
	#E1000_TXDCTL
(
_n
) ((_n) < 4 ? (0x03828 + ((_n) * 0x100)) : \

122 (0x0E028 + ((
_n
Ë* 0x40)))

	)

123 
	#E1000_TARC
(
_n
Ë(0x03840 + ((_nË* 0x100))

	)

124 
	#E1000_KABGTXD
 0x03004

	)

125 
	#E1000_RAL
(
_i
) (((_i) <= 15) ? (0x05400 + ((_i) * 8)) : \

126 (0x054E0 + ((
_i
 - 16Ë* 8)))

	)

127 
	#E1000_RAH
(
_i
) (((_i) <= 15) ? (0x05404 + ((_i) * 8)) : \

128 (0x054E4 + ((
_i
 - 16Ë* 8)))

	)

129 
	#E1000_SHRAL
(
_i
Ë(0x05438 + ((_iË* 8))

	)

130 
	#E1000_SHRAH
(
_i
Ë(0x0543C + ((_iË* 8))

	)

131 
	#E1000_TDFH
 0x03410

	)

132 
	#E1000_TDFT
 0x03418

	)

133 
	#E1000_TDFHS
 0x03420

	)

134 
	#E1000_TDFTS
 0x03428

	)

135 
	#E1000_TDFPC
 0x03430

	)

136 
	#E1000_TIDV
 0x03820

	)

137 
	#E1000_TADV
 0x0382C

	)

138 
	#E1000_CRCERRS
 0x04000

	)

139 
	#E1000_ALGNERRC
 0x04004

	)

140 
	#E1000_SYMERRS
 0x04008

	)

141 
	#E1000_RXERRC
 0x0400C

	)

142 
	#E1000_MPC
 0x04010

	)

143 
	#E1000_SCC
 0x04014

	)

144 
	#E1000_ECOL
 0x04018

	)

145 
	#E1000_MCC
 0x0401C

	)

146 
	#E1000_LATECOL
 0x04020

	)

147 
	#E1000_COLC
 0x04028

	)

148 
	#E1000_DC
 0x04030

	)

149 
	#E1000_TNCRS
 0x04034

	)

150 
	#E1000_SEC
 0x04038

	)

151 
	#E1000_CEXTERR
 0x0403C

	)

152 
	#E1000_RLEC
 0x04040

	)

153 
	#E1000_XONRXC
 0x04048

	)

154 
	#E1000_XONTXC
 0x0404C

	)

155 
	#E1000_XOFFRXC
 0x04050

	)

156 
	#E1000_XOFFTXC
 0x04054

	)

157 
	#E1000_FCRUC
 0x04058

	)

158 
	#E1000_PRC64
 0x0405C

	)

159 
	#E1000_PRC127
 0x04060

	)

160 
	#E1000_PRC255
 0x04064

	)

161 
	#E1000_PRC511
 0x04068

	)

162 
	#E1000_PRC1023
 0x0406C

	)

163 
	#E1000_PRC1522
 0x04070

	)

164 
	#E1000_GPRC
 0x04074

	)

165 
	#E1000_BPRC
 0x04078

	)

166 
	#E1000_MPRC
 0x0407C

	)

167 
	#E1000_GPTC
 0x04080

	)

168 
	#E1000_GORCL
 0x04088

	)

169 
	#E1000_GORCH
 0x0408C

	)

170 
	#E1000_GOTCL
 0x04090

	)

171 
	#E1000_GOTCH
 0x04094

	)

172 
	#E1000_RNBC
 0x040A0

	)

173 
	#E1000_RUC
 0x040A4

	)

174 
	#E1000_RFC
 0x040A8

	)

175 
	#E1000_ROC
 0x040AC

	)

176 
	#E1000_RJC
 0x040B0

	)

177 
	#E1000_MGTPRC
 0x040B4

	)

178 
	#E1000_MGTPDC
 0x040B8

	)

179 
	#E1000_MGTPTC
 0x040BC

	)

180 
	#E1000_TORL
 0x040C0

	)

181 
	#E1000_TORH
 0x040C4

	)

182 
	#E1000_TOTL
 0x040C8

	)

183 
	#E1000_TOTH
 0x040CC

	)

184 
	#E1000_TPR
 0x040D0

	)

185 
	#E1000_TPT
 0x040D4

	)

186 
	#E1000_PTC64
 0x040D8

	)

187 
	#E1000_PTC127
 0x040DC

	)

188 
	#E1000_PTC255
 0x040E0

	)

189 
	#E1000_PTC511
 0x040E4

	)

190 
	#E1000_PTC1023
 0x040E8

	)

191 
	#E1000_PTC1522
 0x040EC

	)

192 
	#E1000_MPTC
 0x040F0

	)

193 
	#E1000_BPTC
 0x040F4

	)

194 
	#E1000_TSCTC
 0x040F8

	)

195 
	#E1000_TSCTFC
 0x040FC

	)

196 
	#E1000_IAC
 0x04100

	)

197 
	#E1000_ICRXPTC
 0x04104

	)

198 
	#E1000_ICRXATC
 0x04108

	)

199 
	#E1000_ICTXPTC
 0x0410C

	)

200 
	#E1000_ICTXATC
 0x04110

	)

201 
	#E1000_ICTXQEC
 0x04118

	)

202 
	#E1000_ICTXQMTC
 0x0411C

	)

203 
	#E1000_ICRXDMTC
 0x04120

	)

204 
	#E1000_ICRXOC
 0x04124

	)

205 
	#E1000_CRC_OFFSET
 0x05F50

	)

207 
	#E1000_PCS_LCTL
 0x04208

	)

208 
	#E1000_PCS_LSTAT
 0x0420C

	)

209 
	#E1000_PCS_ANADV
 0x04218

	)

210 
	#E1000_PCS_LPAB
 0x0421C

	)

211 
	#E1000_RXCSUM
 0x05000

	)

212 
	#E1000_RFCTL
 0x05008

	)

213 
	#E1000_MTA
 0x05200

	)

214 
	#E1000_RA
 0x05400

	)

215 
	#E1000_VFTA
 0x05600

	)

216 
	#E1000_WUC
 0x05800

	)

217 
	#E1000_WUFC
 0x05808

	)

218 
	#E1000_WUS
 0x05810

	)

219 
	#E1000_MANC
 0x05820

	)

220 
	#E1000_FFLT
 0x05F00

	)

221 
	#E1000_HOST_IF
 0x08800

	)

223 
	#E1000_KMRNCTRLSTA
 0x00034

	)

224 
	#E1000_MANC2H
 0x05860

	)

226 
	#E1000_MDEF
(
_n
Ë(0x05890 + (4 * (_n)))

	)

227 
	#E1000_SW_FW_SYNC
 0x05B5C

	)

228 
	#E1000_GCR
 0x05B00

	)

229 
	#E1000_GCR2
 0x05B64

	)

230 
	#E1000_FACTPS
 0x05B30

	)

231 
	#E1000_SWSM
 0x05B50

	)

232 
	#E1000_FWSM
 0x05B54

	)

234 
	#E1000_SWSM2
 0x05B58

	)

235 
	#E1000_FFLT_DBG
 0x05F04

	)

236 
	#E1000_HICR
 0x08F00

	)

239 
	#E1000_MRQC
 0x05818

	)

240 
	#E1000_RETA
(
_i
Ë(0x05C00 + ((_iË* 4)Ë

	)

241 
	#E1000_RSSRK
(
_i
Ë(0x05C80 + ((_iË* 4)Ë

	)

242 
	#E1000_TSYNCRXCTL
 0x0B620

	)

243 
	#E1000_TSYNCTXCTL
 0x0B614

	)

244 
	#E1000_RXSTMPL
 0x0B624

	)

245 
	#E1000_RXSTMPH
 0x0B628

	)

246 
	#E1000_TXSTMPL
 0x0B618

	)

247 
	#E1000_TXSTMPH
 0x0B61C

	)

248 
	#E1000_SYSTIML
 0x0B600

	)

249 
	#E1000_SYSTIMH
 0x0B604

	)

250 
	#E1000_TIMINCA
 0x0B608

	)

251 
	#E1000_RXMTRL
 0x0B634

	)

252 
	#E1000_RXUDP
 0x0B638

	)

	@
1
.
0
25
219
80003es2lan.c
80003es2lan.h
82571.c
82571.h
defines.h
e1000.h
ethtool.c
hw.h
ich8lan.c
ich8lan.h
kcompat.c
kcompat.h
kcompat_ethtool.c
mac.c
mac.h
manage.c
manage.h
netdev.c
nvm.c
nvm.h
param.c
phy.c
phy.h
ptp.c
regs.h
