cscope 15 $HOME/Projects/misc/compile/Hext -q 0000000078 0000007002
	@driver.c

6 
	~<¡dio.h
>

7 
	~<¡dlib.h
>

8 
	~<¡ršg.h
>

10 
	~"driv”.h
"

11 
	~"h¬dw¬e.h
"

12 
	~"·r£r.h
"

13 
	~"´št.h
"

16 
	$”rÜ
(cÚ¡ *
s
) {

17 
	`´štf
("ERROR: %s\n", 
s
);

18 
	`ex™
(1);

19 
	}
}

22 
	$ruË
(
lhs
, cÚ¡ *
rhs
) {

23 
	`add_ruË
(
lhs
, 
rhs
);

24 
	}
}

28 
	$maš
() {

29 
	`g¿mm¬
();

30 
	`´št_g¿mm¬
();

31 
	`®gÜ™hm_B
(0);

33 
	}
}

	@driver.h

2 
	#MAXSTACK
 400

	)

3 
	#MAXRULE
 20

	)

5 
šput
[];

6 
¡¬t
;

7 
g¿mm¬
();

9 
ruË
(
lhs
, cÚ¡ *
rhs
);

10 
”rÜ
(cÚ¡ *
s
);

	@gram1.c

1 
	~"driv”.h
"

3 
	gšput
[] = "p+p+p";

5 
	g¡¬t
 = 'E';

8 
	$g¿mm¬
() {

9 
	`ruË
('E', "E+T");

10 
	`ruË
('E', "T");

12 
	`ruË
('T', "T*F");

13 
	`ruË
('T', "F");

15 
	`ruË
('F', "F^p");

16 
	`ruË
('F', "p");

17 
	}
}

	@gram2.c

1 
	~"driv”.h
"

3 
	gšput
[] = "xxxxxx";

5 
	g¡¬t
 = 'S';

8 
	$g¿mm¬
() {

9 
	`ruË
('S', "A");

10 
	`ruË
('A', "xAx");

11 
	`ruË
('A', "xx");

12 
	}
}

	@gram3.c

1 
	~"driv”.h
"

3 
	gšput
[] = "xxxxxx";

5 
	g¡¬t
 = 'S';

8 
	$g¿mm¬
() {

9 
	`ruË
('S', "A");

11 
	`ruË
('A', "AA");

12 
	`ruË
('A', "x");

13 
	}
}

	@gram4.c

9 
	~"driv”.h
"

11 
	gšput
[] = "x-y*z+(x+z/y)*y";

13 
	g¡¬t
 = 'E';

16 
	$g¿mm¬
() {

17 
	`ruË
('E', "E+T");

18 
	`ruË
('E', "E-T");

19 
	`ruË
('E', "T");

21 
	`ruË
('T', "T*F");

22 
	`ruË
('T', "T/F");

23 
	`ruË
('T', "F");

25 
	`ruË
('F', "x");

26 
	`ruË
('F', "y");

27 
	`ruË
('F', "z");

28 
	`ruË
('F', "(E)");

29 
	}
}

	@hardware.c

3 
	~"h¬dw¬e.h
"

5 
veùÜ
 
	gz”o
;

7 
	gG
[
MACHINE_WIDTH
];

8 
	gG_size
;

10 
veùÜ


11 
	$ªd
(
veùÜ
 
v1
, veùÜ 
v2
) {

12 
j
;

14 
j
 = 0; j < 
G_size
; j++)

15 
v1
.
b™
[
j
] &ğ
v2
.bit[j];

16  
v1
;

17 
	}
}

19 
veùÜ


20 
	$Ü
(
veùÜ
 
v1
, veùÜ 
v2
) {

21 
j
;

23 
j
 = 0; j < 
G_size
; j++)

24 
v1
.
b™
[
j
] |ğ
v2
.bit[j];

25  
v1
;

26 
	}
}

29 
	$is_z”o
(
veùÜ
 
v
) {

30 
j
;

32 
j
 = 0; j < 
G_size
; j++)

33 ià(
v
.
b™
[
j
])

36 
	}
}

38 
veùÜ


39 
	$rsh
(
veùÜ
 
v
) {

40 
j
;

41 
ÿ¼y
 = 0;

43 
j
 = 0; j < 
G_size
; j++) {

44 
b™
 = 
v
.b™[
j
] ;

45 
v
.
b™
[
j
] = 
ÿ¼y
;

46 
ÿ¼y
 = 
b™
;

48  
v
;

49 
	}
}

52 
	$fœ¡_š
(
veùÜ
 
v
) {

53 
j
;

55 
j
 = 0; j < 
G_size
; j++) {

56 ià(
v
.
b™
[
j
])

59  
j
;

60 
	}
}

62 
veùÜ


63 
	$Ëss_™s_fœ¡_1b™_th©_m©ches
(
veùÜ
 
v1
, veùÜ 
v2
) {

64 
j
;

66 
j
 = 0; j < 
G_size
; j++) {

67 ià(
v1
.
b™
[
j
] & 
v2
.bit[j]) {

68 
v1
.
b™
[
j
] = 0;

72  
v1
;

73 
	}
}

75 
veùÜ


76 
	$M¡¬
(
c
) {

77 
j
;

78 
veùÜ
 
v
;

80 
v
 = 
z”o
;

81 
j
 = 0; j < 
G_size
; j++) {

82 ià(
G
[
j
] =ğ
c
) {

83 
v
.
b™
[
j
] = 1;

86  
v
;

87 
	}
}

	@hardware.h

3 
	#MACHINE_WIDTH
 60

	)

5 
	sveùÜ
 {

6 
	mb™
[
MACHINE_WIDTH
];

9 
veùÜ
 
z”o
;

11 
veùÜ
 
ªd
(veùÜ 
v1
, veùÜ 
v2
);

12 
veùÜ
 
Ü
(veùÜ 
v1
, veùÜ 
v2
);

13 
is_z”o
(
veùÜ
 
v
);

14 
veùÜ
 
rsh
(veùÜ 
v
);

15 
fœ¡_š
(
veùÜ
 
v
);

16 
veùÜ
 
Ëss_™s_fœ¡_1b™_th©_m©ches


17 (
veùÜ
 
v1
, veùÜ 
v2
);

18 
veùÜ
 
M¡¬
(
c
);

20 
G
[
MACHINE_WIDTH
];

21 
G_size
;

	@parser.c

11 
	~<¡dio.h
>

12 
	~<¡ršg.h
>

14 
	~"driv”.h
"

15 
	~"h¬dw¬e.h
"

16 
	~"·r£r.h
"

17 
	~"´št.h
"

19 
	#DEBUG


	)

21 
¡ack_’Œy
 
	g¡ack
[
MAXSTACK
];

22 
	gp
;

23 
	gi
;

25 
veùÜ
 
	gU
, 
	gV
;

26 
	g²
[
MACHINE_WIDTH
];

28 
	gËngth
[
MAXRULE
];

29 
	gsubjeù
[
MAXRULE
];

31 #ifdef 
DEBUG


32 
	#debugf
(
f
,
v
è
	`´štf
(f, v)

	)

33 
	#debug_vec
(
n
,
v
è
	`´št_vec
Ò,v)

	)

35 
	#debugf
(
f
,
v
)

	)

36 
	#debug_vec
(
n
,
v
)

	)

40 
	$add_ruË
(
lhs
, cÚ¡ *
rhs
) {

41 
ruË_út
;

42 
rhs_Ê
 = 
	`¡¾’
(
rhs
);

44 
ruË_út
++;

45 ià(
ruË_út
 =ğ
MAXRULE
)

46 
	`”rÜ
("Too many„ules");

47 ià(
rhs_Ê
 == 0)

48 
	`”rÜ
("Empty„ight hand side");

49 
subjeù
[
ruË_út
] = 
lhs
;

50 
Ëngth
[
ruË_út
] = 
rhs_Ê
;

51 ià(
G_size
+
rhs_Ê
 >ğ
MACHINE_WIDTH
)

52 
	`”rÜ
("Grammaroo†ong");

53 
	`¡rıy
(&
G
[
G_size
], 
rhs
);

54 
U
.
b™
[
G_size
] = 1;

55 
G_size
 +ğ
rhs_Ê
;

56 
²
[
G_size
-1] = 
ruË_út
;

57 
V
.
b™
[
G_size
-1] = 1;

58 
	}
}

61 
	$®gÜ™hm_B
(
exhau¡ive
) {

62 
C
;

63 
pi
, 
lšk
, 
r
;

64 
veùÜ
 
Q
;

66 
i
 = -1;

67 
p
 = 0;

68 
Q
 = 
z”o
;

69 
¡ack
[0].
pi
 = -1;

70 
AA
:

71 
i
 = i + 1;

72 
C
 = 
šput
[
i
];

73 
	`debugf
("AA: iÅuˆ%c\n", 
C
);

74 
pi
 = 0;

75 
lšk
 = 
p
;

76 
BB
:

77 
	`debugf
("BB: C = %c\n", 
C
);

78 
	`debug_vec
("Q", 
Q
);

79 
Q
 = 
	`ªd
(
	`Ü
(
	`rsh
(Q), 
U
), 
	`M¡¬
(
C
));

80 
	`debug_vec
("Q", 
Q
);

81 
p
 =… + 1;

82 ià(
p
 =ğ
MAXSTACK
)

83 
	`”rÜ
("Stack overflow");

84 
¡ack
[
p
].
C
 = C;

85 
¡ack
[
p
].
Q
 = Q;

86 
¡ack
[
p
].
i
 = i;

87 
¡ack
[
p
].
pi
 =…i;

88 
¡ack
[
p
].
lšk
 =†ink;

89 
CC
:

90 ià(
	`is_z”o
(
Q
))

91 
backŒack
;

92 ià(
	`is_z”o
(
	`ªd
(
Q
, 
V
)))

93 
AA
;

96 
pi
 = 
²
[
	`fœ¡_š
(
	`ªd
(
Q
, 
V
))];

97 
r
 = 
Ëngth
[
pi
];

98 
C
 = 
subjeù
[
pi
];

99 
	`debugf
("com¶‘ed„uË %d", 
pi
);

100 
	`debugf
(",†’gth = %d", 
r
);

101 
	`debugf
(", subjeù = %c\n", 
C
);

103 
lšk
 = 
p
;

104 
r
) {

105 
lšk
 = 
¡ack
[link].link;

106 
r
 =„ - 1;

108 
Q
 = 
¡ack
[
lšk
].Q;

109 ià(
C
 =ğ
¡¬t
 && 
lšk
 =ğ0 && 
šput
[
i
+1] == '\0')

110 
·r£_found
;

112 
BB
;

114 
backŒack
:

116 
¡ack
[
p
].
pi
 == 0) {

117 
p
 =… - 1;

119 ià(
p
 =ğ0è
no_·r£_possibË
;

121 
p
 =… - 1;

122 
Q
 = 
¡ack
[
p
].Q;

123 
i
 = 
¡ack
[
p
].i;

124 
Q
 = 
	`Ëss_™s_fœ¡_1b™_th©_m©ches
(Q, 
V
);

125 
¡ack
[
p
].
Q
 = Q;

126 
	`debugf
("backŒackedØ%d\n", 
p
);

127 
CC
;

129 
·r£_found
:

130 
	`´štf
("OK,…˜ğ%d\n", 
pi
);

131 
	`´št_¡ack
("parse_found");

132 ià(
exhau¡ive
)

133 
BB
;

137 
no_·r£_possibË
:

138 ià(!
exhau¡ive
)

139 
	`´štf
("KO\n");

141 
	}
}

	@parser.h

1 
	s¡ack_’Œy
 {

2 
	mC
;

3 
veùÜ
 
	mQ
;

4 
	mi
;

5 
	mpi
;

6 
	mlšk
;

10 
¡ack_’Œy
 
¡ack
[];

11 
p
;

13 
veùÜ
 
U
, 
V
;

15 
add_ruË
(
lhs
, cÚ¡ *
rhs
);

16 
®gÜ™hm_B
(
exhau¡ive
);

	@print.c

3 
	~<¡dio.h
>

5 
	~"h¬dw¬e.h
"

6 
	~"·r£r.h
"

7 
	~"´št.h
"

10 
	$´št_g¿mm¬
() {

11 
	`´štf
("G: %s\n", 
G
);

12 
	`´št_vec
("U", 
U
);

13 
	`´št_vec
("V", 
V
);

14 
	}
}

17 
	$´št_vec
(cÚ¡ *
m
, 
veùÜ
 
v
) {

18 
j
;

20 
	`´štf
("%s: ", 
m
);

21 
j
 = 0; j < 
G_size
; j++) {

22 
	`putch¬
(
v
.
b™
[
j
] ? '1' : '0');

24 
	`´štf
("\n");

25 
	}
}

28 
	$´št_¡ack
(cÚ¡ *
s
) {

29 
q
;

31 
	`´štf
(" C i…˜lšk Q,‡ˆ%s\n", 
s
);

32 
q
 = 0; q <ğ
p
; q++) {

33 
j
;

34 
¡ack_’Œy
 *
£
 = &
¡ack
[
q
];

36 
	`´štf
("[%2d] ", 
q
);

37 
	`´štf
("'%c' ", 
£
->
C
 ? se->C : ' ');

38 
	`´štf
("%2d ", 
£
->
i
);

39 
	`´štf
("%2d ", 
£
->
pi
);

40 
	`´štf
("%2d ", 
£
->
lšk
);

41 
	`´štf
(" ");

42 
j
 = 0; j < 
G_size
; j++) {

43 
	`putch¬
(
£
->
Q
.
b™
[
j
] ? '1' : '0');

45 
	`´štf
("\n");

47 
	}
}

	@print.h

1 
´št_g¿mm¬
();

2 
´št_vec
(cÚ¡ *
m
, 
veùÜ
 
v
);

3 
´št_¡ack
(cÚ¡ *
s
);

	@
1
.
0
12
106
driver.c
driver.h
gram1.c
gram2.c
gram3.c
gram4.c
hardware.c
hardware.h
parser.c
parser.h
print.c
print.h
