cscope 15 $HOME/Projects/pcap -q 0000000166 0000014074
	@a.c

1 
	~<pÿp.h
>

2 
	~<Ãtš‘/š.h
>

4 
	$maš
()

6 * 
dev
, 
”rbuf
[
PCAP_ERRBUF_SIZE
];

8 
bpf_u_št32
 
Ãt
;

9 
bpf_u_št32
 
mask
;

12 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

14 
	`´štf
("Deviû %s\n", 
dev
);

16 
	`pÿp_looku²‘
(
dev
, &
Ãt
, &
mask
, 
”rbuf
);

18 
š_addr
 
d
;

19 
d
.
s_addr
 = 
Ãt
;

21 * 
z
 = 
	`š‘_Áß
(
d
);

23 
d
.
s_addr
 = 
mask
;

25 * 
z2
 = 
	`š‘_Áß
(
d
);

27 
	`´štf
("Ãˆ- % - %s\n", 
z
, 
z2
);

30 
	}
}

	@b.c

1 
	~<pÿp.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

7 
	~<¬·/š‘.h
>

8 
	~<Ãtš‘/if_‘h”.h
>

10 
	$my_ÿÎback
(
u_ch¬
* 
u£Ëss
, cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

11 cÚ¡ 
u_ch¬
* 
·ck‘
) {

12 
couÁ
 = 1;

13 
	`årštf
(
¡dout
, "%d-%s-%s-%d-%d\n", 
couÁ
, 
·ck‘
, 
u£Ëss
, 
pkthdr
->
ÿ¶’
,…kthdr->
Ën
);

14 
	`fæush
(
¡dout
);

15 
couÁ
++;

16 
	}
}

18 
	$maš
(
¬gc
, ** 
¬gv
)

20 
i
;

21 *
dev
;

22 
”rbuf
[
PCAP_ERRBUF_SIZE
];

23 
pÿp_t
 *
desü
;

24 cÚ¡ 
u_ch¬
 *
·ck‘
;

25 
pÿp_pkthdr
 
hdr
;

26 
‘h”_h—d”
 *
•thr
;

28 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

30 
desü
 = 
	`pÿp_İ’_live
(
dev
,100, 0, -1, 
”rbuf
);

32 
	`pÿp_loİ
(
desü
, 
	`©oi
(
¬gv
[1]), 
my_ÿÎback
, "kkk");

34 
	`årštf
(
¡dout
, "aoaoa");

37 
	}
}

	@c.c

1 
	~<pÿp.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

7 
	~<¬·/š‘.h
>

8 
	~<Ãtš‘/if_‘h”.h
>

10 
	$my_ÿÎback
(
u_ch¬
* 
u£Ëss
, cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

11 cÚ¡ 
u_ch¬
* 
·ck‘
) {

12 
couÁ
 = 1;

13 
	`årštf
(
¡dout
, "%d-%s-%s-%d-%d\n", 
couÁ
, 
·ck‘
, 
u£Ëss
, 
pkthdr
->
ÿ¶’
,…kthdr->
Ën
);

14 
	`fæush
(
¡dout
);

15 
couÁ
++;

16 
	}
}

18 
	$maš
(
¬gc
, ** 
¬gv
)

20 
i
;

21 *
dev
;

22 
”rbuf
[
PCAP_ERRBUF_SIZE
];

23 
pÿp_t
 *
desü
;

24 cÚ¡ 
u_ch¬
 *
·ck‘
;

25 
pÿp_pkthdr
 
hdr
;

26 
‘h”_h—d”
 *
•thr
;

27 
bpf_´og¿m
 
å
;

28 
bpf_u_št32
 
maskp
;

29 
bpf_u_št32
 
Ã
;

31 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

32 
	`´štf
("%s", 
dev
);

33 
	`fæush
(
¡dout
);

34 
	`pÿp_looku²‘
(
dev
, &
Ã
, &
maskp
, 
”rbuf
);

36 
desü
 = 
	`pÿp_İ’_live
(
dev
, 200, 0, -1, 
”rbuf
);

38 
	`pÿp_compe
(
desü
, &
å
, 
¬gv
[1], 0, 
Ã
);

40 
	`pÿp_£tf‹r
(
desü
, &
å
);

42 
	`pÿp_loİ
(
desü
, -1, 
my_ÿÎback
, "kkk");

44 
	`årštf
(
¡dout
, "aoaoa");

47 
	}
}

	@d.c

1 
	~<sys/sock‘.h
>

2 
	~<Ãtš‘/š.h
>

3 
	~<¬·/š‘.h
>

5 
	$maš
()

8 
š_addr
 
d
;

10 
	`š‘_©Ú
("127.0.0.1", &
d
);

12 
	}
}

	@e.c

1 
	~<pÿp.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

7 
	~<¬·/š‘.h
>

8 
	~<Ãtš‘/if_‘h”.h
>

10 
	#SIZE_ETHERNET
 14

	)

12 
	s¢iff_‘h”Ãt
 {

13 
u_ch¬
 
	m‘h”_dho¡
[
ETHER_ADDR_LEN
];

14 
u_ch¬
 
	m‘h”_sho¡
[
ETHER_ADDR_LEN
];

15 
u_shÜt
 
	m‘h”_ty³
;

19 
	s¢iff_
 {

20 
u_ch¬
 
	m_vhl
;

21 
u_ch¬
 
	m_tos
;

22 
u_shÜt
 
	m_Ën
;

23 
u_shÜt
 
	m_id
;

24 
u_shÜt
 
	m_off
;

25 
	#IP_RF
 0x8000

	)

26 
	#IP_DF
 0x4000

	)

27 
	#IP_MF
 0x2000

	)

28 
	#IP_OFFMASK
 0x1ffà

	)

29 
u_ch¬
 
	m_‰l
;

30 
u_ch¬
 
	m_p
;

31 
u_shÜt
 
	m_sum
;

32 
š_addr
 
	m_¤c
,
	m_d¡
;

34 
	#IP_HL
(

è((()->
_vhl
è& 0x0f)

	)

35 
	#IP_V
(

è((()->
_vhl
è>> 4)

	)

37 
	s¢iff_tı
 {

38 
ušt16_t
 
	mth_¥Üt
;

39 
ušt16_t
 
	mth_dpÜt
;

40 
ušt32_t
 
	mth_£q
;

41 
ušt32_t
 
	mth_ack
;

43 
u_ch¬
 
	mth_offx2
;

44 
	#TH_OFF
(
th
è((Ñh)->
th_offx2
 & 0xf0è>> 4)

	)

45 
u_ch¬
 
	mth_æags
;

46 
	#TH_FIN
 0x01

	)

47 
	#TH_SYN
 0x02

	)

48 
	#TH_RST
 0x04

	)

49 
	#TH_PUSH
 0x08

	)

50 
	#TH_ACK
 0x10

	)

51 
	#TH_URG
 0x20

	)

52 
	#TH_ECE
 0x40

	)

53 
	#TH_CWR
 0x80

	)

54 
	#TH_FLAGS
 (
TH_FIN
|
TH_SYN
|
TH_RST
|
TH_ACK
|
TH_URG
|
TH_ECE
|
TH_CWR
)

	)

55 
u_shÜt
 
	mth_wš
;

56 
u_shÜt
 
	mth_sum
;

57 
u_shÜt
 
	mth_u½
;

60 cÚ¡ 
¢iff_‘h”Ãt
 *
	g‘h”Ãt
;

61 cÚ¡ 
¢iff_
 *
	ghdr
;

62 cÚ¡ 
¢iff_tı
 *
	gtıhdr
;

63 cÚ¡ *
	g·ylßd
;

65 
u_št
 
	gsize_hdr
;

66 
u_št
 
	gsize_tıhdr
;

68 
	$my_ÿÎback
(
u_ch¬
* 
u£Ëss
, cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

69 cÚ¡ 
u_ch¬
* 
s
) {

70 
couÁ
 = 1;

72 
‘h”Ãt
 = (
¢iff_‘h”Ãt
*)(
s
);

74 
hdr
 = (
¢iff_
 *)(
s
 + 
SIZE_ETHERNET
);

75 
size_hdr
 = 
	`IP_HL
(
hdr
)*4;

76 ià(
size_hdr
 < 20) {

77 
	`´štf
(" * Inv®id IP h—d”†’gth: %u by‹s\n", 
size_hdr
);

81 
tıhdr
 = (
¢iff_tı
 *)(
s
 + 
SIZE_ETHERNET
 + 
size_hdr
);

82 
size_tıhdr
 = 
	`TH_OFF
(
tıhdr
)*4;

83 ià(
size_tıhdr
 < 20) {

84 
	`´štf
(" * Inv®id TCP h—d”†’gth: %u by‹s\n", 
size_tıhdr
);

88 
	`årštf
(
¡dout
, "%d-%s-%s-%d-%d\n", 
couÁ
, 
s
, 
u£Ëss
, 
pkthdr
->
ÿ¶’
,…kthdr->
Ën
);

89 
	`fæush
(
¡dout
);

90 
couÁ
++;

91 
	}
}

93 
	$maš
(
¬gc
, ** 
¬gv
)

95 
i
;

96 *
dev
;

97 
”rbuf
[
PCAP_ERRBUF_SIZE
];

98 
pÿp_t
 *
desü
;

99 cÚ¡ 
u_ch¬
 *
·ck‘
;

100 
pÿp_pkthdr
 
hdr
;

101 
‘h”_h—d”
 *
•thr
;

102 
bpf_´og¿m
 
å
;

103 
bpf_u_št32
 
maskp
;

104 
bpf_u_št32
 
Ã
;

106 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

108 
	`pÿp_looku²‘
(
dev
, &
Ã
, &
maskp
, 
”rbuf
);

110 
desü
 = 
	`pÿp_İ’_live
("ªy", 100, 0, -1, 
”rbuf
);

112 
	`pÿp_compe
(
desü
, &
å
, 
¬gv
[1], 0, 
Ã
);

114 
	`pÿp_£tf‹r
(
desü
, &
å
);

116 
	`pÿp_loİ
(
desü
, -1, 
my_ÿÎback
, "kkk");

118 
	`årštf
(
¡dout
, "aoaoa");

121 
	}
}

	@f.c

1 
	~<pÿp.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

7 
	~<¬·/š‘.h
>

8 
	~<Ãtš‘/if_‘h”.h
>

10 
	$my_ÿÎback
(
u_ch¬
* 
u£Ëss
, cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,

11 cÚ¡ 
u_ch¬
* 
·ck‘
) {

12 
couÁ
 = 1;

14 ià(
pkthdr
 =ğ
NULL
) {

15 
couÁ
++;

19 
	`årštf
(
¡dout
, "%d-%s-%s-%d-%d\n", 
couÁ
, 
·ck‘
, 
u£Ëss
, 
pkthdr
->
ÿ¶’
,…kthdr->
Ën
);

20 
	`fæush
(
¡dout
);

21 
couÁ
++;

22 
	}
}

24 
	$maš
(
¬gc
, ** 
¬gv
)

26 
i
;

27 *
dev
;

28 
”rbuf
[
PCAP_ERRBUF_SIZE
];

29 
pÿp_t
 *
desü
;

30 cÚ¡ 
u_ch¬
 *
·ck‘
;

31 
pÿp_pkthdr
 
hdr
;

32 
‘h”_h—d”
 *
•thr
;

33 
bpf_´og¿m
 
å
;

34 
bpf_u_št32
 
maskp
;

35 
bpf_u_št32
 
Ã
;

37 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

39 
	`pÿp_looku²‘
(
dev
, &
Ã
, &
maskp
, 
”rbuf
);

41 
desü
 = 
	`pÿp_İ’_live
("ªy", 100, 0, -1, 
”rbuf
);

43 
	`pÿp_compe
(
desü
, &
å
, 
¬gv
[1], 0, 
Ã
);

45 
	`pÿp_£tf‹r
(
desü
, &
å
);

47 
	`pÿp_di¥©ch
(
desü
, -1, 
my_ÿÎback
, "kkk");

49 
	`årštf
(
¡dout
, "aoaoa");

52 
	}
}

	@pcap_bond.c

1 
	~<¡dio.h
>

2 
	~<uni¡d.h
>

3 
	~<¡ršg.h
>

4 
	~<¡dlib.h
>

5 
	~<pÿp.h
>

6 
	~<time.h
>

7 
	~<libg’.h
>

8 
	~<sigÇl.h
>

9 
	~<¡dšt.h
>

10 
	~<¡d¬g.h
>

11 
	~<sys/sock‘.h
>

12 
	~<Ãtš‘/š.h
>

13 
	~<¬·/š‘.h
>

14 
	~<sys/ty³s.h
>

15 
	~<hœedis/hœedis.h
>

16 
	~<sys/¡©.h
>

17 
	~<fú.h
>

18 
	~<”ºo.h
>

19 
	~<¡ršg.h
>

21 
	#OK
 (0)

	)

22 
	#ERR
 (-1)

	)

23 
	#PEND
 (1)

	)

25 
	#SIZE_IP
 16

	)

26 
	#SIZE_ETHERNET
 14

	)

27 
	#ETHER_ADDR_LEN
 6

	)

28 
	#HOSTNAME_LEN
 128

	)

30 
	#PKT_TYPE_TCP
 1

	)

31 
	#PKT_TYPE_UDP
 2

	)

33 
	#OUTPUT_INTERVAL
 300

	)

36 
	s¢iff_‘h”Ãt
 {

37 
u_ch¬
 
	m‘h”_dho¡
[
ETHER_ADDR_LEN
];

38 
u_ch¬
 
	m‘h”_sho¡
[
ETHER_ADDR_LEN
];

39 
u_shÜt
 
	m‘h”_ty³
;

43 
	s¢iff_
 {

44 
u_ch¬
 
	m_vhl
;

45 
u_ch¬
 
	m_tos
;

46 
u_shÜt
 
	m_Ën
;

47 
u_shÜt
 
	m_id
;

48 
u_shÜt
 
	m_off
;

49 
	#IP_RF
 0x8000

	)

50 
	#IP_DF
 0x4000

	)

51 
	#IP_MF
 0x2000

	)

52 
	#IP_OFFMASK
 0x1ffà

	)

53 
u_ch¬
 
	m_‰l
;

54 
u_ch¬
 
	m_p
;

55 
u_shÜt
 
	m_sum
;

56 
š_addr
 
	m_¤c
,
	m_d¡
;

58 
	#IP_HL
(

è((()->
_vhl
è& 0x0f)

	)

59 
	#IP_V
(

è((()->
_vhl
è>> 4)

	)

62 
	s¢iff_tı
 {

63 
ušt16_t
 
	mth_¥Üt
;

64 
ušt16_t
 
	mth_dpÜt
;

65 
ušt32_t
 
	mth_£q
;

66 
ušt32_t
 
	mth_ack
;

68 
u_ch¬
 
	mth_offx2
;

69 
	#TH_OFF
(
th
è((Ñh)->
th_offx2
 & 0xf0è>> 4)

	)

70 
u_ch¬
 
	mth_æags
;

71 
	#TH_FIN
 0x01

	)

72 
	#TH_SYN
 0x02

	)

73 
	#TH_RST
 0x04

	)

74 
	#TH_PUSH
 0x08

	)

75 
	#TH_ACK
 0x10

	)

76 
	#TH_URG
 0x20

	)

77 
	#TH_ECE
 0x40

	)

78 
	#TH_CWR
 0x80

	)

79 
	#TH_FLAGS
 (
TH_FIN
|
TH_SYN
|
TH_RST
|
TH_ACK
|
TH_URG
|
TH_ECE
|
TH_CWR
)

	)

80 
u_shÜt
 
	mth_wš
;

81 
u_shÜt
 
	mth_sum
;

82 
u_shÜt
 
	mth_u½
;

85 cÚ¡ 
¢iff_‘h”Ãt
 *
	g‘h”Ãt
;

86 cÚ¡ 
¢iff_
 *
	ghdr
;

87 cÚ¡ 
¢iff_tı
 *
	gtıhdr
;

88 cÚ¡ *
	g·ylßd
;

90 
u_št
 
	gsize_hdr
;

91 
u_št
 
	gsize_tıhdr
;

93 
	$my_ÿÎback
(
u_ch¬
* 
u£Ëss
, cÚ¡ 
pÿp_pkthdr
* 
h
,

94 cÚ¡ 
u_ch¬
* 
s
) {

96 
	`´štf
("ssss");

97 
	`fæush
(
¡dout
);

99 
tm
 *tm;

100 
time_t
 
timeSmpSec
;

101 
¤c_
[
SIZE_IP
], 
d¡_
[SIZE_IP];

102 
ušt16_t
 
¤c_pÜt
, 
d¡_pÜt
;

104 
timeSmpSec
 = 
h
->
ts
.
tv_£c
;

105 
tm
 = 
	`loÿÉime
(&
timeSmpSec
);

107 
‘h”Ãt
 = (
¢iff_‘h”Ãt
*)(
s
);

109 
hdr
 = (
¢iff_
 *)(
s
 + 
SIZE_ETHERNET
);

110 
size_hdr
 = 
	`IP_HL
(
hdr
)*4;

111 ià(
size_hdr
 < 20) {

112 
	`´štf
(" * Inv®id IP h—d”†’gth: %u by‹s", 
size_hdr
);

116 
tıhdr
 = (
¢iff_tı
 *)(
s
 + 
SIZE_ETHERNET
 + 
size_hdr
);

117 
size_tıhdr
 = 
	`TH_OFF
(
tıhdr
)*4;

118 ià(
size_tıhdr
 < 20) {

119 
	`´štf
(" * Inv®id TCP h—d”†’gth: %u by‹s\n", 
size_tıhdr
);

123 
	`š‘_Áİ
(
AF_INET
, (*)&(
hdr
->
_¤c
), 
¤c_
, 
SIZE_IP
);

124 
	`š‘_Áİ
(
AF_INET
, (*)&(
hdr
->
_d¡
), 
d¡_
, 
SIZE_IP
);

125 
¤c_pÜt
 = 
	`Áohs
(
tıhdr
->
th_¥Üt
);

126 
d¡_pÜt
 = 
	`Áohs
(
tıhdr
->
th_dpÜt
);

129 
	`´štf
("caplen:%d†en:%d %s:%d->%s:%d ip_total_bytes:%d\n\n",

130 
h
->
ÿ¶’
, h->
Ën
,

131 
¤c_
, 
¤c_pÜt
, 
d¡_
, 
d¡_pÜt
,

132 
	`Áohs
(
hdr
->
_Ën
));

133 
	}
}

135 
	$maš
(
¬gc
, ** 
¬gv
)

137 
i
;

138 *
dev
;

139 
”rbuf
[
PCAP_ERRBUF_SIZE
];

140 
pÿp_t
 *
desü
;

141 cÚ¡ 
u_ch¬
 *
·ck‘
;

142 
pÿp_pkthdr
 
hdr
;

143 
‘h”_h—d”
 *
•thr
;

144 
bpf_´og¿m
 
å
;

145 
bpf_u_št32
 
maskp
;

146 
bpf_u_št32
 
Ã
;

148 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

150 
	`´štf
("%s", 
dev
);

151 
	`fæush
(
¡dout
);

152 
	`pÿp_looku²‘
(
dev
, &
Ã
, &
maskp
, 
”rbuf
);

154 
desü
 = 
	`pÿp_İ’_live
(
dev
, 100, 0, -1, 
”rbuf
);

155 
desü
 = 
	`pÿp_İ’_live
("ªy", 100, 0, -1, 
”rbuf
);

157 
	`pÿp_compe
(
desü
, &
å
, 
¬gv
[1], 0, 
Ã
);

159 
	`pÿp_£tf‹r
(
desü
, &
å
);

161 
	`pÿp_loİ
(
desü
, -1, 
my_ÿÎback
, "kkk");

163 
	`årštf
(
¡dout
, "aoaoa");

166 
	}
}

	@pcap_z2.c

1 
	~<pÿp.h
>

2 
	~<¡dio.h
>

3 
	~<¡dlib.h
>

4 
	~<”ºo.h
>

5 
	~<sys/sock‘.h
>

6 
	~<Ãtš‘/š.h
>

7 
	~<¬·/š‘.h
>

8 
	~<Ãtš‘/if_‘h”.h
>

9 
	~<Ãt/‘h”Ãt.h
>

10 
	~<Ãtš‘/‘h”.h
>

11 
	~<Ãtš‘/.h
>

14 #iâdeà
ETHER_HDRLEN


15 
	#ETHER_HDRLEN
 14

	)

19 
u_št16_t
 
	ghªdË_‘h”Ãt


20 (
u_ch¬
 *
	g¬gs
,cÚ¡ 
pÿp_pkthdr
* 
	gpkthdr
,const u_char*

21 
	g·ck‘
);

22 
u_ch¬
* 
	ghªdË_IP


23 (
u_ch¬
 *
	g¬gs
,cÚ¡ 
pÿp_pkthdr
* 
	gpkthdr
,const u_char*

24 
	g·ck‘
);

36 
	smy_
 {

37 
u_št8_t
 
	m_vhl
;

38 
	#IP_V
(

è((()->
_vhl
 & 0xf0è>> 4)

	)

39 
	#IP_HL
(

è(()->
_vhl
 & 0x0f)

	)

40 
u_št8_t
 
	m_tos
;

41 
u_št16_t
 
	m_Ën
;

42 
u_št16_t
 
	m_id
;

43 
u_št16_t
 
	m_off
;

44 
	#IP_DF
 0x4000

	)

45 
	#IP_MF
 0x2000

	)

46 
	#IP_OFFMASK
 0x1ffà

	)

47 
u_št8_t
 
	m_‰l
;

48 
u_št8_t
 
	m_p
;

49 
u_št16_t
 
	m_sum
;

50 
š_addr
 
	m_¤c
,
	m_d¡
;

54 
	$my_ÿÎback
(
u_ch¬
 *
¬gs
,cÚ¡ 
pÿp_pkthdr
* 
pkthdr
,const u_char*

55 
·ck‘
)

57 
	`´štf
("aaaa");

58 
	`fæush
(
¡dout
);

60 
u_št16_t
 
ty³
 = 
	`hªdË_‘h”Ãt
(
¬gs
,
pkthdr
,
·ck‘
);

62 if(
ty³
 =ğ
ETHERTYPE_IP
)

64 
	`hªdË_IP
(
¬gs
,
pkthdr
,
·ck‘
);

65 }if(
ty³
 =ğ
ETHERTYPE_ARP
)

68 if(
ty³
 =ğ
ETHERTYPE_REVARP
)

71 
	}
}

73 
u_ch¬
* 
	ghªdË_IP


74 (
u_ch¬
 *
	g¬gs
,cÚ¡ 
pÿp_pkthdr
* 
	gpkthdr
,const u_char*

75 
	g·ck‘
)

77 cÚ¡ 
my_
* 
	g
;

78 
u_št
 
	gËngth
 = 
pkthdr
->
Ën
;

79 
u_št
 
	ghËn
,
	goff
,
	gv”siÚ
;

80 
	gi
;

82 
	gËn
;

85 
	g
 = (
my_
*)(
·ck‘
 + (
‘h”_h—d”
));

86 
	gËngth
 -ğ(
‘h”_h—d”
);

89 ià(
	gËngth
 < (
	gmy_
))

91 
´štf
("Œunÿ‹d i°%d",
Ëngth
);

92  
	gNULL
;

95 
	gËn
 = 
Áohs
(

->
_Ën
);

96 
	ghËn
 = 
IP_HL
(

);

97 
	gv”siÚ
 = 
IP_V
(

);

100 if(
	gv”siÚ
 != 4)

102 
årštf
(
¡dout
,"UnknowÀv”siÚ %d\n",
v”siÚ
);

103  
	gNULL
;

107 if(
	ghËn
 < 5 )

109 
årštf
(
¡dout
,"bad-hËÀ%d \n",
hËn
);

113 if(
	gËngth
 < 
	gËn
)

114 
´štf
("\Árunÿ‹d IP - %d by‹ missšg\n",
Ën
 - 
Ëngth
);

117 
	goff
 = 
Áohs
(

->
_off
);

118 if((
	goff
 & 0x1fff) == 0 )

120 
årštf
(
¡dout
,"IP: ");

121 
årštf
(
¡dout
,"%s ",

122 
š‘_Áß
(

->
_¤c
));

123 
årštf
(
¡dout
,"%s %d %d %d %d\n",

124 
š‘_Áß
(

->
_d¡
),

125 
hËn
,
v”siÚ
,
Ën
,
off
);

128  
	gNULL
;

134 
u_št16_t
 
	ghªdË_‘h”Ãt


135 (
u_ch¬
 *
	g¬gs
,cÚ¡ 
pÿp_pkthdr
* 
	gpkthdr
,const u_char*

136 
	g·ck‘
)

138 
u_št
 
	gÿ¶’
 = 
pkthdr
->
ÿ¶’
;

139 
u_št
 
	gËngth
 = 
pkthdr
->
Ën
;

140 
‘h”_h—d”
 *
	g•Œ
;

141 
u_shÜt
 
	g‘h”_ty³
;

143 ià(
	gÿ¶’
 < 
	gETHER_HDRLEN
)

145 
årštf
(
¡dout
,"Packet†ength†esshanƒthernet header†ength\n");

150 
	g•Œ
 = (
‘h”_h—d”
 *è
·ck‘
;

151 
	g‘h”_ty³
 = 
Áohs
(
•Œ
->
‘h”_ty³
);

154 
årštf
(
¡dout
,"ETH: ");

155 
årštf
(
¡dout
,"%s "

156 ,
‘h”_Áß
((
‘h”_addr
*)
•Œ
->
‘h”_sho¡
));

157 
årštf
(
¡dout
,"%s "

158 ,
‘h”_Áß
((
‘h”_addr
*)
•Œ
->
‘h”_dho¡
));

161 ià(
	g‘h”_ty³
 =ğ
ETHERTYPE_IP
)

163 
årštf
(
¡dout
,"(IP)");

164 }ià(
	g‘h”_ty³
 =ğ
ETHERTYPE_ARP
)

166 
årštf
(
¡dout
,"(ARP)");

167 }ià(
	g•Œ
->
	g‘h”_ty³
 =ğ
ETHERTYPE_REVARP
)

169 
årštf
(
¡dout
,"(RARP)");

171 
årštf
(
¡dout
,"(%d)", 
•Œ
->
‘h”_ty³
);

173 
årštf
(
¡dout
," %d\n",
Ëngth
);

175  
	g‘h”_ty³
;

179 
	$maš
(
¬gc
, ** 
¬gv
)

181 
i
;

182 *
dev
;

183 
”rbuf
[
PCAP_ERRBUF_SIZE
];

184 
pÿp_t
 *
desü
;

185 cÚ¡ 
u_ch¬
 *
·ck‘
;

186 
pÿp_pkthdr
 
hdr
;

187 
‘h”_h—d”
 *
•thr
;

188 
bpf_´og¿m
 
å
;

189 
bpf_u_št32
 
maskp
;

190 
bpf_u_št32
 
Ã
;

192 
dev
 = 
	`pÿp_lookupdev
(
”rbuf
);

193 
	`´štf
("%s", 
dev
);

194 
	`fæush
(
¡dout
);

196 
	`pÿp_looku²‘
(
dev
, &
Ã
, &
maskp
, 
”rbuf
);

198 
desü
 = 
	`pÿp_İ’_live
(
dev
, 100, 0, -1, 
”rbuf
);

200 
	`pÿp_compe
(
desü
, &
å
, 
¬gv
[1], 0, 
Ã
);

202 
	`pÿp_£tf‹r
(
desü
, &
å
);

204 
	`pÿp_loİ
(
desü
, -1, 
my_ÿÎback
, "kkk");

206 
	`årštf
(
¡dout
, "aoaoa");

209 
	}
}

	@
1
.
0
8
46
a.c
b.c
c.c
d.c
e.c
f.c
pcap_bond.c
pcap_z2.c
